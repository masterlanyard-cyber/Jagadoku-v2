(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,32341,36180,98925,59141,e=>{"use strict";let t,r,n;var i,s,a,o,l,u,h,c,d,f,p,m,g,y,w,v,_,I=e.i(43476),b=e.i(71645),E=e.i(47167);let T=function(e){let t=[],r=0;for(let n=0;n<e.length;n++){let i=e.charCodeAt(n);i<128?t[r++]=i:(i<2048?t[r++]=i>>6|192:((64512&i)==55296&&n+1<e.length&&(64512&e.charCodeAt(n+1))==56320?(i=65536+((1023&i)<<10)+(1023&e.charCodeAt(++n)),t[r++]=i>>18|240,t[r++]=i>>12&63|128):t[r++]=i>>12|224,t[r++]=i>>6&63|128),t[r++]=63&i|128)}return t},S=function(e){let t=[],r=0,n=0;for(;r<e.length;){let i=e[r++];if(i<128)t[n++]=String.fromCharCode(i);else if(i>191&&i<224){let s=e[r++];t[n++]=String.fromCharCode((31&i)<<6|63&s)}else if(i>239&&i<365){let s=((7&i)<<18|(63&e[r++])<<12|(63&e[r++])<<6|63&e[r++])-65536;t[n++]=String.fromCharCode(55296+(s>>10)),t[n++]=String.fromCharCode(56320+(1023&s))}else{let s=e[r++],a=e[r++];t[n++]=String.fromCharCode((15&i)<<12|(63&s)<<6|63&a)}}return t.join("")},C={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:"function"==typeof atob,encodeByteArray(e,t){if(!Array.isArray(e))throw Error("encodeByteArray takes an array as a parameter");this.init_();let r=t?this.byteToCharMapWebSafe_:this.byteToCharMap_,n=[];for(let t=0;t<e.length;t+=3){let i=e[t],s=t+1<e.length,a=s?e[t+1]:0,o=t+2<e.length,l=o?e[t+2]:0,u=i>>2,h=(3&i)<<4|a>>4,c=(15&a)<<2|l>>6,d=63&l;!o&&(d=64,s||(c=64)),n.push(r[u],r[h],r[c],r[d])}return n.join("")},encodeString(e,t){return this.HAS_NATIVE_SUPPORT&&!t?btoa(e):this.encodeByteArray(T(e),t)},decodeString(e,t){return this.HAS_NATIVE_SUPPORT&&!t?atob(e):S(this.decodeStringToByteArray(e,t))},decodeStringToByteArray(e,t){this.init_();let r=t?this.charToByteMapWebSafe_:this.charToByteMap_,n=[];for(let t=0;t<e.length;){let i=r[e.charAt(t++)],s=t<e.length?r[e.charAt(t)]:0,a=++t<e.length?r[e.charAt(t)]:64,o=++t<e.length?r[e.charAt(t)]:64;if(++t,null==i||null==s||null==a||null==o)throw new A;let l=i<<2|s>>4;if(n.push(l),64!==a){let e=s<<4&240|a>>2;if(n.push(e),64!==o){let e=a<<6&192|o;n.push(e)}}}return n},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let e=0;e<this.ENCODED_VALS.length;e++)this.byteToCharMap_[e]=this.ENCODED_VALS.charAt(e),this.charToByteMap_[this.byteToCharMap_[e]]=e,this.byteToCharMapWebSafe_[e]=this.ENCODED_VALS_WEBSAFE.charAt(e),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[e]]=e,e>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(e)]=e,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(e)]=e)}}};class A extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}let k=function(e){let t=T(e);return C.encodeByteArray(t,!0)},x=function(e){return k(e).replace(/\./g,"")},N=function(e){try{return C.decodeString(e,!0)}catch(e){console.error("base64Decode failed: ",e)}return null};function D(){return"u">typeof self?self:"u">typeof window?window:e.g}let R=()=>{try{return D().__FIREBASE_DEFAULTS__||(()=>{if(void 0===E.default||void 0===E.default.env)return;let e=E.default.env.__FIREBASE_DEFAULTS__;if(e)return JSON.parse(e)})()||(()=>{let e;if("u"<typeof document)return;try{e=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch(e){return}let t=e&&N(e[1]);return t&&JSON.parse(t)})()}catch(e){console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${e}`);return}},P=e=>R()?.emulatorHosts?.[e],O=()=>R()?.config,L=e=>R()?.[`_${e}`];class M{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}wrapCallback(e){return(t,r)=>{t?this.reject(t):this.resolve(r),"function"==typeof e&&(this.promise.catch(()=>{}),1===e.length?e(t):e(t,r))}}}function F(e){try{return(e.startsWith("http://")||e.startsWith("https://")?new URL(e).hostname:e).endsWith(".cloudworkstations.dev")}catch{return!1}}async function V(e){return(await fetch(e,{credentials:"include"})).ok}let U={},B=!1;function q(e,t){if("u"<typeof window||"u"<typeof document||!F(window.location.host)||U[e]===t||U[e]||B)return;function r(e){return`__firebase__banner__${e}`}U[e]=t;let n="__firebase__banner",i=function(){let e={prod:[],emulator:[]};for(let t of Object.keys(U))U[t]?e.emulator.push(t):e.prod.push(t);return e}().prod.length>0;function s(){let e,t,s=(e=document.getElementById(n),t=!1,e||((e=document.createElement("div")).setAttribute("id",n),t=!0),{created:t,element:e}),a=r("text"),o=document.getElementById(a)||document.createElement("span"),l=r("learnmore"),u=document.getElementById(l)||document.createElement("a"),h=r("preprendIcon"),c=document.getElementById(h)||document.createElementNS("http://www.w3.org/2000/svg","svg");if(s.created){let e,t=s.element;t.style.display="flex",t.style.background="#7faaf0",t.style.position="fixed",t.style.bottom="5px",t.style.left="5px",t.style.padding=".5em",t.style.borderRadius="5px",t.style.alignItems="center",u.setAttribute("id",l),u.innerText="Learn more",u.href="https://firebase.google.com/docs/studio/preview-apps#preview-backend",u.setAttribute("target","__blank"),u.style.paddingLeft="5px",u.style.textDecoration="underline";let r=((e=document.createElement("span")).style.cursor="pointer",e.style.marginLeft="16px",e.style.fontSize="24px",e.innerHTML=" &times;",e.onclick=()=>{let e;B=!0,(e=document.getElementById(n))&&e.remove()},e);c.setAttribute("width","24"),c.setAttribute("id",h),c.setAttribute("height","24"),c.setAttribute("viewBox","0 0 24 24"),c.setAttribute("fill","none"),c.style.marginLeft="-6px",t.append(c,o,u,r),document.body.appendChild(t)}i?(o.innerText="Preview backend disconnected.",c.innerHTML=`<g clip-path="url(#clip0_6013_33858)">
<path d="M4.8 17.6L12 5.6L19.2 17.6H4.8ZM6.91667 16.4H17.0833L12 7.93333L6.91667 16.4ZM12 15.6C12.1667 15.6 12.3056 15.5444 12.4167 15.4333C12.5389 15.3111 12.6 15.1667 12.6 15C12.6 14.8333 12.5389 14.6944 12.4167 14.5833C12.3056 14.4611 12.1667 14.4 12 14.4C11.8333 14.4 11.6889 14.4611 11.5667 14.5833C11.4556 14.6944 11.4 14.8333 11.4 15C11.4 15.1667 11.4556 15.3111 11.5667 15.4333C11.6889 15.5444 11.8333 15.6 12 15.6ZM11.4 13.6H12.6V10.4H11.4V13.6Z" fill="#212121"/>
</g>
<defs>
<clipPath id="clip0_6013_33858">
<rect width="24" height="24" fill="white"/>
</clipPath>
</defs>`):(c.innerHTML=`<g clip-path="url(#clip0_6083_34804)">
<path d="M11.4 15.2H12.6V11.2H11.4V15.2ZM12 10C12.1667 10 12.3056 9.94444 12.4167 9.83333C12.5389 9.71111 12.6 9.56667 12.6 9.4C12.6 9.23333 12.5389 9.09444 12.4167 8.98333C12.3056 8.86111 12.1667 8.8 12 8.8C11.8333 8.8 11.6889 8.86111 11.5667 8.98333C11.4556 9.09444 11.4 9.23333 11.4 9.4C11.4 9.56667 11.4556 9.71111 11.5667 9.83333C11.6889 9.94444 11.8333 10 12 10ZM12 18.4C11.1222 18.4 10.2944 18.2333 9.51667 17.9C8.73889 17.5667 8.05556 17.1111 7.46667 16.5333C6.88889 15.9444 6.43333 15.2611 6.1 14.4833C5.76667 13.7056 5.6 12.8778 5.6 12C5.6 11.1111 5.76667 10.2833 6.1 9.51667C6.43333 8.73889 6.88889 8.06111 7.46667 7.48333C8.05556 6.89444 8.73889 6.43333 9.51667 6.1C10.2944 5.76667 11.1222 5.6 12 5.6C12.8889 5.6 13.7167 5.76667 14.4833 6.1C15.2611 6.43333 15.9389 6.89444 16.5167 7.48333C17.1056 8.06111 17.5667 8.73889 17.9 9.51667C18.2333 10.2833 18.4 11.1111 18.4 12C18.4 12.8778 18.2333 13.7056 17.9 14.4833C17.5667 15.2611 17.1056 15.9444 16.5167 16.5333C15.9389 17.1111 15.2611 17.5667 14.4833 17.9C13.7167 18.2333 12.8889 18.4 12 18.4ZM12 17.2C13.4444 17.2 14.6722 16.6944 15.6833 15.6833C16.6944 14.6722 17.2 13.4444 17.2 12C17.2 10.5556 16.6944 9.32778 15.6833 8.31667C14.6722 7.30555 13.4444 6.8 12 6.8C10.5556 6.8 9.32778 7.30555 8.31667 8.31667C7.30556 9.32778 6.8 10.5556 6.8 12C6.8 13.4444 7.30556 14.6722 8.31667 15.6833C9.32778 16.6944 10.5556 17.2 12 17.2Z" fill="#212121"/>
</g>
<defs>
<clipPath id="clip0_6083_34804">
<rect width="24" height="24" fill="white"/>
</clipPath>
</defs>`,o.innerText="Preview backend running in this workspace."),o.setAttribute("id",a)}"loading"===document.readyState?window.addEventListener("DOMContentLoaded",s):s()}function j(){return"u">typeof navigator&&"string"==typeof navigator.userAgent?navigator.userAgent:""}function z(){let t=R()?.forceEnvironment;if("node"===t)return!0;if("browser"===t)return!1;try{return"[object process]"===Object.prototype.toString.call(e.g.process)}catch(e){return!1}}function $(){return"u">typeof WorkerGlobalScope&&"u">typeof self&&self instanceof WorkerGlobalScope}function K(){return!z()&&!!navigator.userAgent&&navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome")}function G(){return!z()&&!!navigator.userAgent&&(navigator.userAgent.includes("Safari")||navigator.userAgent.includes("WebKit"))&&!navigator.userAgent.includes("Chrome")}function H(){try{return"object"==typeof indexedDB}catch(e){return!1}}class W extends Error{constructor(e,t,r){super(t),this.code=e,this.customData=r,this.name="FirebaseError",Object.setPrototypeOf(this,W.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,Q.prototype.create)}}class Q{constructor(e,t,r){this.service=e,this.serviceName=t,this.errors=r}create(e,...t){var r,n;let i=t[0]||{},s=`${this.service}/${e}`,a=this.errors[e],o=a?(r=a,n=i,r.replace(J,(e,t)=>{let r=n[t];return null!=r?String(r):`<${t}?>`})):"Error",l=`${this.serviceName}: ${o} (${s}).`;return new W(s,l,i)}}let J=/\{\$([^}]+)}/g;function Y(e,t){if(e===t)return!0;let r=Object.keys(e),n=Object.keys(t);for(let i of r){if(!n.includes(i))return!1;let r=e[i],s=t[i];if(X(r)&&X(s)){if(!Y(r,s))return!1}else if(r!==s)return!1}for(let e of n)if(!r.includes(e))return!1;return!0}function X(e){return null!==e&&"object"==typeof e}function Z(e){let t=[];for(let[r,n]of Object.entries(e))Array.isArray(n)?n.forEach(e=>{t.push(encodeURIComponent(r)+"="+encodeURIComponent(e))}):t.push(encodeURIComponent(r)+"="+encodeURIComponent(n));return t.length?"&"+t.join("&"):""}function ee(e){let t={};return e.replace(/^\?/,"").split("&").forEach(e=>{if(e){let[r,n]=e.split("=");t[decodeURIComponent(r)]=decodeURIComponent(n)}}),t}function et(e){let t=e.indexOf("?");if(!t)return"";let r=e.indexOf("#",t);return e.substring(t,r>0?r:void 0)}class er{constructor(e,t){this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=t,this.task.then(()=>{e(this)}).catch(e=>{this.error(e)})}next(e){this.forEachObserver(t=>{t.next(e)})}error(e){this.forEachObserver(t=>{t.error(e)}),this.close(e)}complete(){this.forEachObserver(e=>{e.complete()}),this.close()}subscribe(e,t,r){let n;if(void 0===e&&void 0===t&&void 0===r)throw Error("Missing Observer.");void 0===(n=!function(e,t){if("object"!=typeof e||null===e)return!1;for(let r of t)if(r in e&&"function"==typeof e[r])return!0;return!1}(e,["next","error","complete"])?{next:e,error:t,complete:r}:e).next&&(n.next=en),void 0===n.error&&(n.error=en),void 0===n.complete&&(n.complete=en);let i=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then(()=>{try{this.finalError?n.error(this.finalError):n.complete()}catch(e){}}),this.observers.push(n),i}unsubscribeOne(e){void 0!==this.observers&&void 0!==this.observers[e]&&(delete this.observers[e],this.observerCount-=1,0===this.observerCount&&void 0!==this.onNoObservers&&this.onNoObservers(this))}forEachObserver(e){if(!this.finalized)for(let t=0;t<this.observers.length;t++)this.sendOne(t,e)}sendOne(e,t){this.task.then(()=>{if(void 0!==this.observers&&void 0!==this.observers[e])try{t(this.observers[e])}catch(e){"u">typeof console&&console.error&&console.error(e)}})}close(e){this.finalized||(this.finalized=!0,void 0!==e&&(this.finalError=e),this.task.then(()=>{this.observers=void 0,this.onNoObservers=void 0}))}}function en(){}function ei(e){return e&&e._delegate?e._delegate:e}class es{constructor(e,t,r){this.name=e,this.instanceFactory=t,this.type=r,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(e){return this.instantiationMode=e,this}setMultipleInstances(e){return this.multipleInstances=e,this}setServiceProps(e){return this.serviceProps=e,this}setInstanceCreatedCallback(e){return this.onInstanceCreated=e,this}}let ea="[DEFAULT]";class eo{constructor(e,t){this.name=e,this.container=t,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(e){let t=this.normalizeInstanceIdentifier(e);if(!this.instancesDeferred.has(t)){let e=new M;if(this.instancesDeferred.set(t,e),this.isInitialized(t)||this.shouldAutoInitialize())try{let r=this.getOrInitializeService({instanceIdentifier:t});r&&e.resolve(r)}catch(e){}}return this.instancesDeferred.get(t).promise}getImmediate(e){let t=this.normalizeInstanceIdentifier(e?.identifier),r=e?.optional??!1;if(this.isInitialized(t)||this.shouldAutoInitialize())try{return this.getOrInitializeService({instanceIdentifier:t})}catch(e){if(r)return null;throw e}if(r)return null;throw Error(`Service ${this.name} is not available`)}getComponent(){return this.component}setComponent(e){if(e.name!==this.name)throw Error(`Mismatching Component ${e.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=e,this.shouldAutoInitialize()){if("EAGER"===e.instantiationMode)try{this.getOrInitializeService({instanceIdentifier:ea})}catch(e){}for(let[e,t]of this.instancesDeferred.entries()){let r=this.normalizeInstanceIdentifier(e);try{let e=this.getOrInitializeService({instanceIdentifier:r});t.resolve(e)}catch(e){}}}}clearInstance(e=ea){this.instancesDeferred.delete(e),this.instancesOptions.delete(e),this.instances.delete(e)}async delete(){let e=Array.from(this.instances.values());await Promise.all([...e.filter(e=>"INTERNAL"in e).map(e=>e.INTERNAL.delete()),...e.filter(e=>"_delete"in e).map(e=>e._delete())])}isComponentSet(){return null!=this.component}isInitialized(e=ea){return this.instances.has(e)}getOptions(e=ea){return this.instancesOptions.get(e)||{}}initialize(e={}){let{options:t={}}=e,r=this.normalizeInstanceIdentifier(e.instanceIdentifier);if(this.isInitialized(r))throw Error(`${this.name}(${r}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);let n=this.getOrInitializeService({instanceIdentifier:r,options:t});for(let[e,t]of this.instancesDeferred.entries())r===this.normalizeInstanceIdentifier(e)&&t.resolve(n);return n}onInit(e,t){let r=this.normalizeInstanceIdentifier(t),n=this.onInitCallbacks.get(r)??new Set;n.add(e),this.onInitCallbacks.set(r,n);let i=this.instances.get(r);return i&&e(i,r),()=>{n.delete(e)}}invokeOnInitCallbacks(e,t){let r=this.onInitCallbacks.get(t);if(r)for(let n of r)try{n(e,t)}catch{}}getOrInitializeService({instanceIdentifier:e,options:t={}}){var r;let n=this.instances.get(e);if(!n&&this.component&&(n=this.component.instanceFactory(this.container,{instanceIdentifier:(r=e)===ea?void 0:r,options:t}),this.instances.set(e,n),this.instancesOptions.set(e,t),this.invokeOnInitCallbacks(n,e),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,e,n)}catch{}return n||null}normalizeInstanceIdentifier(e=ea){return this.component?this.component.multipleInstances?e:ea:e}shouldAutoInitialize(){return!!this.component&&"EXPLICIT"!==this.component.instantiationMode}}class el{constructor(e){this.name=e,this.providers=new Map}addComponent(e){let t=this.getProvider(e.name);if(t.isComponentSet())throw Error(`Component ${e.name} has already been registered with ${this.name}`);t.setComponent(e)}addOrOverwriteComponent(e){this.getProvider(e.name).isComponentSet()&&this.providers.delete(e.name),this.addComponent(e)}getProvider(e){if(this.providers.has(e))return this.providers.get(e);let t=new eo(e,this);return this.providers.set(e,t),t}getProviders(){return Array.from(this.providers.values())}}let eu=[];(i=a||(a={}))[i.DEBUG=0]="DEBUG",i[i.VERBOSE=1]="VERBOSE",i[i.INFO=2]="INFO",i[i.WARN=3]="WARN",i[i.ERROR=4]="ERROR",i[i.SILENT=5]="SILENT";let eh={debug:a.DEBUG,verbose:a.VERBOSE,info:a.INFO,warn:a.WARN,error:a.ERROR,silent:a.SILENT},ec=a.INFO,ed={[a.DEBUG]:"log",[a.VERBOSE]:"log",[a.INFO]:"info",[a.WARN]:"warn",[a.ERROR]:"error"},ef=(e,t,...r)=>{if(t<e.logLevel)return;let n=new Date().toISOString(),i=ed[t];if(i)console[i](`[${n}]  ${e.name}:`,...r);else throw Error(`Attempted to log a message with an invalid logType (value: ${t})`)};class ep{constructor(e){this.name=e,this._logLevel=ec,this._logHandler=ef,this._userLogHandler=null,eu.push(this)}get logLevel(){return this._logLevel}set logLevel(e){if(!(e in a))throw TypeError(`Invalid value "${e}" assigned to \`logLevel\``);this._logLevel=e}setLogLevel(e){this._logLevel="string"==typeof e?eh[e]:e}get logHandler(){return this._logHandler}set logHandler(e){if("function"!=typeof e)throw TypeError("Value assigned to `logHandler` must be a function");this._logHandler=e}get userLogHandler(){return this._userLogHandler}set userLogHandler(e){this._userLogHandler=e}debug(...e){this._userLogHandler&&this._userLogHandler(this,a.DEBUG,...e),this._logHandler(this,a.DEBUG,...e)}log(...e){this._userLogHandler&&this._userLogHandler(this,a.VERBOSE,...e),this._logHandler(this,a.VERBOSE,...e)}info(...e){this._userLogHandler&&this._userLogHandler(this,a.INFO,...e),this._logHandler(this,a.INFO,...e)}warn(...e){this._userLogHandler&&this._userLogHandler(this,a.WARN,...e),this._logHandler(this,a.WARN,...e)}error(...e){this._userLogHandler&&this._userLogHandler(this,a.ERROR,...e),this._logHandler(this,a.ERROR,...e)}}let em=new WeakMap,eg=new WeakMap,ey=new WeakMap,ew=new WeakMap,ev=new WeakMap,e_={get(e,t,r){if(e instanceof IDBTransaction){if("done"===t)return eg.get(e);if("objectStoreNames"===t)return e.objectStoreNames||ey.get(e);if("store"===t)return r.objectStoreNames[1]?void 0:r.objectStore(r.objectStoreNames[0])}return eI(e[t])},set:(e,t,r)=>(e[t]=r,!0),has:(e,t)=>e instanceof IDBTransaction&&("done"===t||"store"===t)||t in e};function eI(e){if(e instanceof IDBRequest){let t;return(t=new Promise((t,r)=>{let n=()=>{e.removeEventListener("success",i),e.removeEventListener("error",s)},i=()=>{t(eI(e.result)),n()},s=()=>{r(e.error),n()};e.addEventListener("success",i),e.addEventListener("error",s)})).then(t=>{t instanceof IDBCursor&&em.set(t,e)}).catch(()=>{}),ev.set(t,e),t}if(ew.has(e))return ew.get(e);let n=function(e){if("function"==typeof e)return e!==IDBDatabase.prototype.transaction||"objectStoreNames"in IDBTransaction.prototype?(r||(r=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])).includes(e)?function(...t){return e.apply(eb(this),t),eI(em.get(this))}:function(...t){return eI(e.apply(eb(this),t))}:function(t,...r){let n=e.call(eb(this),t,...r);return ey.set(n,t.sort?t.sort():[t]),eI(n)};return e instanceof IDBTransaction&&function(e){if(eg.has(e))return;let t=new Promise((t,r)=>{let n=()=>{e.removeEventListener("complete",i),e.removeEventListener("error",s),e.removeEventListener("abort",s)},i=()=>{t(),n()},s=()=>{r(e.error||new DOMException("AbortError","AbortError")),n()};e.addEventListener("complete",i),e.addEventListener("error",s),e.addEventListener("abort",s)});eg.set(e,t)}(e),(t||(t=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])).some(t=>e instanceof t)?new Proxy(e,e_):e}(e);return n!==e&&(ew.set(e,n),ev.set(n,e)),n}let eb=e=>ev.get(e),eE=["get","getKey","getAll","getAllKeys","count"],eT=["put","add","delete","clear"],eS=new Map;function eC(e,t){if(!(e instanceof IDBDatabase&&!(t in e)&&"string"==typeof t))return;if(eS.get(t))return eS.get(t);let r=t.replace(/FromIndex$/,""),n=t!==r,i=eT.includes(r);if(!(r in(n?IDBIndex:IDBObjectStore).prototype)||!(i||eE.includes(r)))return;let s=async function(e,...t){let s=this.transaction(e,i?"readwrite":"readonly"),a=s.store;return n&&(a=a.index(t.shift())),(await Promise.all([a[r](...t),i&&s.done]))[0]};return eS.set(t,s),s}e_={...n=e_,get:(e,t,r)=>eC(e,t)||n.get(e,t,r),has:(e,t)=>!!eC(e,t)||n.has(e,t)};class eA{constructor(e){this.container=e}getPlatformInfoString(){return this.container.getProviders().map(e=>{let t;if(t=e.getComponent(),t?.type!=="VERSION")return null;{let t=e.getImmediate();return`${t.library}/${t.version}`}}).filter(e=>e).join(" ")}}let ek="@firebase/app",ex="0.14.8",eN=new ep("@firebase/app"),eD="[DEFAULT]",eR={[ek]:"fire-core","@firebase/app-compat":"fire-core-compat","@firebase/analytics":"fire-analytics","@firebase/analytics-compat":"fire-analytics-compat","@firebase/app-check":"fire-app-check","@firebase/app-check-compat":"fire-app-check-compat","@firebase/auth":"fire-auth","@firebase/auth-compat":"fire-auth-compat","@firebase/database":"fire-rtdb","@firebase/data-connect":"fire-data-connect","@firebase/database-compat":"fire-rtdb-compat","@firebase/functions":"fire-fn","@firebase/functions-compat":"fire-fn-compat","@firebase/installations":"fire-iid","@firebase/installations-compat":"fire-iid-compat","@firebase/messaging":"fire-fcm","@firebase/messaging-compat":"fire-fcm-compat","@firebase/performance":"fire-perf","@firebase/performance-compat":"fire-perf-compat","@firebase/remote-config":"fire-rc","@firebase/remote-config-compat":"fire-rc-compat","@firebase/storage":"fire-gcs","@firebase/storage-compat":"fire-gcs-compat","@firebase/firestore":"fire-fst","@firebase/firestore-compat":"fire-fst-compat","@firebase/ai":"fire-vertex","fire-js":"fire-js",firebase:"fire-js-all"},eP=new Map,eO=new Map,eL=new Map;function eM(e,t){try{e.container.addComponent(t)}catch(r){eN.debug(`Component ${t.name} failed to register with FirebaseApp ${e.name}`,r)}}function eF(e,t){e.container.addOrOverwriteComponent(t)}function eV(e){let t=e.name;if(eL.has(t))return eN.debug(`There were multiple attempts to register component ${t}.`),!1;for(let r of(eL.set(t,e),eP.values()))eM(r,e);for(let t of eO.values())eM(t,e);return!0}function eU(e,t){let r=e.container.getProvider("heartbeat").getImmediate({optional:!0});return r&&r.triggerHeartbeat(),e.container.getProvider(t)}function eB(e,t,r=eD){eU(e,t).clearInstance(r)}function eq(e){return void 0!==e.options}function ej(e){return!eq(e)&&("authIdToken"in e||"appCheckToken"in e||"releaseOnDeref"in e||"automaticDataCollectionEnabled"in e)}function ez(e){return null!=e&&void 0!==e.settings}function e$(){eL.clear()}let eK=new Q("app","Firebase",{"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}'","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","server-app-deleted":"Firebase Server App has been deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}.","finalization-registry-not-supported":"FirebaseServerApp deleteOnDeref field defined but the JS runtime does not support FinalizationRegistry.","invalid-server-app-environment":"FirebaseServerApp is not for use in browser environments."});class eG{constructor(e,t,r){this._isDeleted=!1,this._options={...e},this._config={...t},this._name=t.name,this._automaticDataCollectionEnabled=t.automaticDataCollectionEnabled,this._container=r,this.container.addComponent(new es("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(e){this.checkDestroyed(),this._automaticDataCollectionEnabled=e}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(e){this._isDeleted=e}checkDestroyed(){if(this.isDeleted)throw eK.create("app-deleted",{appName:this._name})}}function eH(e,t){let r=N(e.split(".")[1]);null===r?console.error(`FirebaseServerApp ${t} is invalid: second part could not be parsed.`):void 0===JSON.parse(r).exp?console.error(`FirebaseServerApp ${t} is invalid: expiration claim could not be parsed`):1e3*JSON.parse(r).exp-new Date().getTime()<=0&&console.error(`FirebaseServerApp ${t} is invalid: the token has expired.`)}class eW extends eG{constructor(e,t,r,n){const i=void 0===t.automaticDataCollectionEnabled||t.automaticDataCollectionEnabled,s={name:r,automaticDataCollectionEnabled:i};void 0!==e.apiKey?super(e,s,n):super(e.options,s,n),this._serverConfig={automaticDataCollectionEnabled:i,...t},this._serverConfig.authIdToken&&eH(this._serverConfig.authIdToken,"authIdToken"),this._serverConfig.appCheckToken&&eH(this._serverConfig.appCheckToken,"appCheckToken"),this._finalizationRegistry=null,"u">typeof FinalizationRegistry&&(this._finalizationRegistry=new FinalizationRegistry(()=>{this.automaticCleanup()})),this._refCount=0,this.incRefCount(this._serverConfig.releaseOnDeref),this._serverConfig.releaseOnDeref=void 0,t.releaseOnDeref=void 0,e1(ek,ex,"serverapp")}toJSON(){}get refCount(){return this._refCount}incRefCount(e){this.isDeleted||(this._refCount++,void 0!==e&&null!==this._finalizationRegistry&&this._finalizationRegistry.register(e,this))}decRefCount(){return this.isDeleted?0:--this._refCount}automaticCleanup(){e0(this)}get settings(){return this.checkDestroyed(),this._serverConfig}checkDestroyed(){if(this.isDeleted)throw eK.create("server-app-deleted")}}let eQ="12.9.0";function eJ(e,t={}){let r=e;"object"!=typeof t&&(t={name:t});let n={name:eD,automaticDataCollectionEnabled:!0,...t},i=n.name;if("string"!=typeof i||!i)throw eK.create("bad-app-name",{appName:String(i)});if(r||(r=O()),!r)throw eK.create("no-options");let s=eP.get(i);if(s)if(Y(r,s.options)&&Y(n,s.config))return s;else throw eK.create("duplicate-app",{appName:i});let a=new el(i);for(let e of eL.values())a.addComponent(e);let o=new eG(r,n,a);return eP.set(i,o),o}function eY(e,t={}){let r;if(("u">typeof window||$())&&!$())throw eK.create("invalid-server-app-environment");let n=t||{};if(e&&(eq(e)?r=e.options:ej(e)?n=e:r=e),void 0===n.automaticDataCollectionEnabled&&(n.automaticDataCollectionEnabled=!0),r||(r=O()),!r)throw eK.create("no-options");let i={...n,...r};if(void 0!==i.releaseOnDeref&&delete i.releaseOnDeref,void 0!==n.releaseOnDeref&&"u"<typeof FinalizationRegistry)throw eK.create("finalization-registry-not-supported",{});let s=""+[...JSON.stringify(i)].reduce((e,t)=>Math.imul(31,e)+t.charCodeAt(0)|0,0),a=eO.get(s);if(a)return a.incRefCount(n.releaseOnDeref),a;let o=new el(s);for(let e of eL.values())o.addComponent(e);let l=new eW(r,n,s,o);return eO.set(s,l),l}function eX(e=eD){let t=eP.get(e);if(!t&&e===eD&&O())return eJ();if(!t)throw eK.create("no-app",{appName:e});return t}function eZ(){return Array.from(eP.values())}async function e0(e){let t=!1,r=e.name;eP.has(r)?(t=!0,eP.delete(r)):eO.has(r)&&0>=e.decRefCount()&&(eO.delete(r),t=!0),t&&(await Promise.all(e.container.getProviders().map(e=>e.delete())),e.isDeleted=!0)}function e1(e,t,r){let n=eR[e]??e;r&&(n+=`-${r}`);let i=n.match(/\s|\//),s=t.match(/\s|\//);if(i||s){let e=[`Unable to register library "${n}" with version "${t}":`];i&&e.push(`library name "${n}" contains illegal characters (whitespace or "/")`),i&&s&&e.push("and"),s&&e.push(`version name "${t}" contains illegal characters (whitespace or "/")`),eN.warn(e.join(" "));return}eV(new es(`${n}-version`,()=>({library:n,version:t}),"VERSION"))}function e2(e,t){if(null!==e&&"function"!=typeof e)throw eK.create("invalid-log-argument");for(let r of eu){let n=null;t&&t.level&&(n=eh[t.level]),null===e?r.userLogHandler=null:r.userLogHandler=(t,r,...i)=>{let s=i.map(e=>{if(null==e)return null;if("string"==typeof e)return e;if("number"==typeof e||"boolean"==typeof e)return e.toString();if(e instanceof Error)return e.message;try{return JSON.stringify(e)}catch(e){return null}}).filter(e=>e).join(" ");r>=(n??t.logLevel)&&e({level:a[r].toLowerCase(),message:s,args:i,type:t.name})}}}function e6(e){eu.forEach(t=>{t.setLogLevel(e)})}let e3="firebase-heartbeat-store",e4=null;function e5(){return e4||(e4=(function(e,t,{blocked:r,upgrade:n,blocking:i,terminated:s}={}){let a=indexedDB.open(e,1),o=eI(a);return n&&a.addEventListener("upgradeneeded",e=>{n(eI(a.result),e.oldVersion,e.newVersion,eI(a.transaction),e)}),r&&a.addEventListener("blocked",e=>r(e.oldVersion,e.newVersion,e)),o.then(e=>{s&&e.addEventListener("close",()=>s()),i&&e.addEventListener("versionchange",e=>i(e.oldVersion,e.newVersion,e))}).catch(()=>{}),o})("firebase-heartbeat-database",0,{upgrade:(e,t)=>{if(0===t)try{e.createObjectStore(e3)}catch(e){console.warn(e)}}}).catch(e=>{throw eK.create("idb-open",{originalErrorMessage:e.message})})),e4}async function e8(e){try{let t=(await e5()).transaction(e3),r=await t.objectStore(e3).get(e9(e));return await t.done,r}catch(e){if(e instanceof W)eN.warn(e.message);else{let t=eK.create("idb-get",{originalErrorMessage:e?.message});eN.warn(t.message)}}}async function e7(e,t){try{let r=(await e5()).transaction(e3,"readwrite"),n=r.objectStore(e3);await n.put(t,e9(e)),await r.done}catch(e){if(e instanceof W)eN.warn(e.message);else{let t=eK.create("idb-set",{originalErrorMessage:e?.message});eN.warn(t.message)}}}function e9(e){return`${e.name}!${e.options.appId}`}class te{constructor(e){this.container=e,this._heartbeatsCache=null;const t=this.container.getProvider("app").getImmediate();this._storage=new tr(t),this._heartbeatsCachePromise=this._storage.read().then(e=>(this._heartbeatsCache=e,e))}async triggerHeartbeat(){try{let e=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),t=tt();if(this._heartbeatsCache?.heartbeats==null&&(this._heartbeatsCache=await this._heartbeatsCachePromise,this._heartbeatsCache?.heartbeats==null)||this._heartbeatsCache.lastSentHeartbeatDate===t||this._heartbeatsCache.heartbeats.some(e=>e.date===t))return;if(this._heartbeatsCache.heartbeats.push({date:t,agent:e}),this._heartbeatsCache.heartbeats.length>30){let e=function(e){if(0===e.length)return -1;let t=0,r=e[0].date;for(let n=1;n<e.length;n++)e[n].date<r&&(r=e[n].date,t=n);return t}(this._heartbeatsCache.heartbeats);this._heartbeatsCache.heartbeats.splice(e,1)}return this._storage.overwrite(this._heartbeatsCache)}catch(e){eN.warn(e)}}async getHeartbeatsHeader(){try{if(null===this._heartbeatsCache&&await this._heartbeatsCachePromise,this._heartbeatsCache?.heartbeats==null||0===this._heartbeatsCache.heartbeats.length)return"";let e=tt(),{heartbeatsToSend:t,unsentEntries:r}=function(e,t=1024){let r=[],n=e.slice();for(let i of e){let e=r.find(e=>e.agent===i.agent);if(e){if(e.dates.push(i.date),tn(r)>t){e.dates.pop();break}}else if(r.push({agent:i.agent,dates:[i.date]}),tn(r)>t){r.pop();break}n=n.slice(1)}return{heartbeatsToSend:r,unsentEntries:n}}(this._heartbeatsCache.heartbeats),n=x(JSON.stringify({version:2,heartbeats:t}));return this._heartbeatsCache.lastSentHeartbeatDate=e,r.length>0?(this._heartbeatsCache.heartbeats=r,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),n}catch(e){return eN.warn(e),""}}}function tt(){return new Date().toISOString().substring(0,10)}class tr{constructor(e){this.app=e,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return!!H()&&new Promise((e,t)=>{try{let r=!0,n="validate-browser-context-for-indexeddb-analytics-module",i=self.indexedDB.open(n);i.onsuccess=()=>{i.result.close(),r||self.indexedDB.deleteDatabase(n),e(!0)},i.onupgradeneeded=()=>{r=!1},i.onerror=()=>{t(i.error?.message||"")}}catch(e){t(e)}}).then(()=>!0).catch(()=>!1)}async read(){if(!await this._canUseIndexedDBPromise)return{heartbeats:[]};{let e=await e8(this.app);return e?.heartbeats?e:{heartbeats:[]}}}async overwrite(e){if(await this._canUseIndexedDBPromise){let t=await this.read();return e7(this.app,{lastSentHeartbeatDate:e.lastSentHeartbeatDate??t.lastSentHeartbeatDate,heartbeats:e.heartbeats})}}async add(e){if(await this._canUseIndexedDBPromise){let t=await this.read();return e7(this.app,{lastSentHeartbeatDate:e.lastSentHeartbeatDate??t.lastSentHeartbeatDate,heartbeats:[...t.heartbeats,...e.heartbeats]})}}}function tn(e){return x(JSON.stringify({version:2,heartbeats:e})).length}function ti(){return{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}}eV(new es("platform-logger",e=>new eA(e),"PRIVATE")),eV(new es("heartbeat",e=>new te(e),"PRIVATE")),e1(ek,ex,""),e1(ek,ex,"esm2020"),e1("fire-js",""),e.s(["SDK_VERSION",()=>eQ,"_DEFAULT_ENTRY_NAME",()=>eD,"_addComponent",()=>eM,"_addOrOverwriteComponent",()=>eF,"_apps",()=>eP,"_clearComponents",()=>e$,"_components",()=>eL,"_getProvider",()=>eU,"_isFirebaseApp",()=>eq,"_isFirebaseServerApp",()=>ez,"_isFirebaseServerAppSettings",()=>ej,"_registerComponent",()=>eV,"_removeServiceInstance",()=>eB,"_serverApps",()=>eO,"deleteApp",()=>e0,"getApp",()=>eX,"getApps",()=>eZ,"initializeApp",()=>eJ,"initializeServerApp",()=>eY,"onLog",()=>e2,"registerVersion",()=>e1,"setLogLevel",()=>e6],92953);let ts=new Q("auth","Firebase",ti()),ta=new ep("@firebase/auth");function to(e,...t){ta.logLevel<=a.ERROR&&ta.error(`Auth (${eQ}): ${e}`,...t)}function tl(e,...t){throw td(e,...t)}function tu(e,...t){return td(e,...t)}function th(e,t,r){return new Q("auth","Firebase",{...ti(),[t]:r}).create(t,{appName:e.name})}function tc(e){return th(e,"operation-not-supported-in-this-environment","Operations that alter the current user are not supported in conjunction with FirebaseServerApp")}function td(e,...t){if("string"!=typeof e){let r=t[0],n=[...t.slice(1)];return n[0]&&(n[0].appName=e.name),e._errorFactory.create(r,...n)}return ts.create(e,...t)}function tf(e,t,...r){if(!e)throw td(t,...r)}function tp(e){let t="INTERNAL ASSERTION FAILED: "+e;throw to(t),Error(t)}function tm(){return"u">typeof self&&self.location?.href||""}function tg(){return"u">typeof self&&self.location?.protocol||null}class ty{constructor(e,t){this.shortDelay=e,this.longDelay=t,function(e,t){e||tp(t)}(t>e,"Short delay should be less than long delay!"),this.isMobile="u">typeof window&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(j())||"object"==typeof navigator&&"ReactNative"===navigator.product}get(){let e;return!("u">typeof navigator&&navigator&&"onLine"in navigator&&"boolean"==typeof navigator.onLine&&("http:"===tg()||"https:"===tg()||"object"==typeof(e="object"==typeof chrome?chrome.runtime:"object"==typeof browser?browser.runtime:void 0)&&void 0!==e.id||"connection"in navigator))||navigator.onLine?this.isMobile?this.longDelay:this.shortDelay:Math.min(5e3,this.shortDelay)}}function tw(e,t){var r,n;r=e.emulator,n="Emulator should always be set here",r||tp(n);let{url:i}=e.emulator;return t?`${i}${t.startsWith("/")?t.slice(1):t}`:i}class tv{static initialize(e,t,r){this.fetchImpl=e,t&&(this.headersImpl=t),r&&(this.responseImpl=r)}static fetch(){return this.fetchImpl?this.fetchImpl:"u">typeof self&&"fetch"in self?self.fetch:"u">typeof globalThis&&globalThis.fetch?globalThis.fetch:"u">typeof fetch?fetch:void tp("Could not find fetch implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static headers(){return this.headersImpl?this.headersImpl:"u">typeof self&&"Headers"in self?self.Headers:"u">typeof globalThis&&globalThis.Headers?globalThis.Headers:"u">typeof Headers?Headers:void tp("Could not find Headers implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static response(){return this.responseImpl?this.responseImpl:"u">typeof self&&"Response"in self?self.Response:"u">typeof globalThis&&globalThis.Response?globalThis.Response:"u">typeof Response?Response:void tp("Could not find Response implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}}let t_={CREDENTIAL_MISMATCH:"custom-token-mismatch",MISSING_CUSTOM_TOKEN:"internal-error",INVALID_IDENTIFIER:"invalid-email",MISSING_CONTINUE_URI:"internal-error",INVALID_PASSWORD:"wrong-password",MISSING_PASSWORD:"missing-password",INVALID_LOGIN_CREDENTIALS:"invalid-credential",EMAIL_EXISTS:"email-already-in-use",PASSWORD_LOGIN_DISABLED:"operation-not-allowed",INVALID_IDP_RESPONSE:"invalid-credential",INVALID_PENDING_TOKEN:"invalid-credential",FEDERATED_USER_ID_ALREADY_LINKED:"credential-already-in-use",MISSING_REQ_TYPE:"internal-error",EMAIL_NOT_FOUND:"user-not-found",RESET_PASSWORD_EXCEED_LIMIT:"too-many-requests",EXPIRED_OOB_CODE:"expired-action-code",INVALID_OOB_CODE:"invalid-action-code",MISSING_OOB_CODE:"internal-error",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"requires-recent-login",INVALID_ID_TOKEN:"invalid-user-token",TOKEN_EXPIRED:"user-token-expired",USER_NOT_FOUND:"user-token-expired",TOO_MANY_ATTEMPTS_TRY_LATER:"too-many-requests",PASSWORD_DOES_NOT_MEET_REQUIREMENTS:"password-does-not-meet-requirements",INVALID_CODE:"invalid-verification-code",INVALID_SESSION_INFO:"invalid-verification-id",INVALID_TEMPORARY_PROOF:"invalid-credential",MISSING_SESSION_INFO:"missing-verification-id",SESSION_EXPIRED:"code-expired",MISSING_ANDROID_PACKAGE_NAME:"missing-android-pkg-name",UNAUTHORIZED_DOMAIN:"unauthorized-continue-uri",INVALID_OAUTH_CLIENT_ID:"invalid-oauth-client-id",ADMIN_ONLY_OPERATION:"admin-restricted-operation",INVALID_MFA_PENDING_CREDENTIAL:"invalid-multi-factor-session",MFA_ENROLLMENT_NOT_FOUND:"multi-factor-info-not-found",MISSING_MFA_ENROLLMENT_ID:"missing-multi-factor-info",MISSING_MFA_PENDING_CREDENTIAL:"missing-multi-factor-session",SECOND_FACTOR_EXISTS:"second-factor-already-in-use",SECOND_FACTOR_LIMIT_EXCEEDED:"maximum-second-factor-count-exceeded",BLOCKING_FUNCTION_ERROR_RESPONSE:"internal-error",RECAPTCHA_NOT_ENABLED:"recaptcha-not-enabled",MISSING_RECAPTCHA_TOKEN:"missing-recaptcha-token",INVALID_RECAPTCHA_TOKEN:"invalid-recaptcha-token",INVALID_RECAPTCHA_ACTION:"invalid-recaptcha-action",MISSING_CLIENT_TYPE:"missing-client-type",MISSING_RECAPTCHA_VERSION:"missing-recaptcha-version",INVALID_RECAPTCHA_VERSION:"invalid-recaptcha-version",INVALID_REQ_TYPE:"invalid-req-type"},tI=["/v1/accounts:signInWithCustomToken","/v1/accounts:signInWithEmailLink","/v1/accounts:signInWithIdp","/v1/accounts:signInWithPassword","/v1/accounts:signInWithPhoneNumber","/v1/token"],tb=new ty(3e4,6e4);function tE(e,t){return e.tenantId&&!t.tenantId?{...t,tenantId:e.tenantId}:t}async function tT(e,t,r,n,i={}){return tS(e,i,async()=>{let i={},s={};n&&("GET"===t?s=n:i={body:JSON.stringify(n)});let a=Z({key:e.config.apiKey,...s}).slice(1),o=await e._getAdditionalHeaders();o["Content-Type"]="application/json",e.languageCode&&(o["X-Firebase-Locale"]=e.languageCode);let l={method:t,headers:o,...i};return"u">typeof navigator&&"Cloudflare-Workers"===navigator.userAgent||(l.referrerPolicy="no-referrer"),e.emulatorConfig&&F(e.emulatorConfig.host)&&(l.credentials="include"),tv.fetch()(await tA(e,e.config.apiHost,r,a),l)})}async function tS(e,t,r){e._canInitEmulator=!1;let n={...t_,...t};try{let t=new tk(e),i=await Promise.race([r(),t.promise]);t.clearNetworkTimeout();let s=await i.json();if("needConfirmation"in s)throw tx(e,"account-exists-with-different-credential",s);if(i.ok&&!("errorMessage"in s))return s;{let[t,r]=(i.ok?s.errorMessage:s.error.message).split(" : ");if("FEDERATED_USER_ID_ALREADY_LINKED"===t)throw tx(e,"credential-already-in-use",s);if("EMAIL_EXISTS"===t)throw tx(e,"email-already-in-use",s);if("USER_DISABLED"===t)throw tx(e,"user-disabled",s);let a=n[t]||t.toLowerCase().replace(/[_\s]+/g,"-");if(r)throw th(e,a,r);tl(e,a)}}catch(t){if(t instanceof W)throw t;tl(e,"network-request-failed",{message:String(t)})}}async function tC(e,t,r,n,i={}){let s=await tT(e,t,r,n,i);return"mfaPendingCredential"in s&&tl(e,"multi-factor-auth-required",{_serverResponse:s}),s}async function tA(e,t,r,n){let i=`${t}${r}?${n}`,s=e.config.emulator?tw(e.config,i):`${e.config.apiScheme}://${i}`;return tI.includes(r)&&(await e._persistenceManagerAvailable,"COOKIE"===e._getPersistenceType())?e._getPersistence()._getFinalTarget(s).toString():s}class tk{clearNetworkTimeout(){clearTimeout(this.timer)}constructor(e){this.auth=e,this.timer=null,this.promise=new Promise((e,t)=>{this.timer=setTimeout(()=>t(tu(this.auth,"network-request-failed")),tb.get())})}}function tx(e,t,r){let n={appName:e.name};r.email&&(n.email=r.email),r.phoneNumber&&(n.phoneNumber=r.phoneNumber);let i=tu(e,t,n);return i.customData._tokenResponse=r,i}function tN(e){return void 0!==e&&void 0!==e.enterprise}class tD{constructor(e){if(this.siteKey="",this.recaptchaEnforcementState=[],void 0===e.recaptchaKey)throw Error("recaptchaKey undefined");this.siteKey=e.recaptchaKey.split("/")[3],this.recaptchaEnforcementState=e.recaptchaEnforcementState}getProviderEnforcementState(e){if(!this.recaptchaEnforcementState||0===this.recaptchaEnforcementState.length)return null;for(let t of this.recaptchaEnforcementState)if(t.provider&&t.provider===e)switch(t.enforcementState){case"ENFORCE":return"ENFORCE";case"AUDIT":return"AUDIT";case"OFF":return"OFF";default:return"ENFORCEMENT_STATE_UNSPECIFIED"}return null}isProviderEnabled(e){return"ENFORCE"===this.getProviderEnforcementState(e)||"AUDIT"===this.getProviderEnforcementState(e)}isAnyProviderEnabled(){return this.isProviderEnabled("EMAIL_PASSWORD_PROVIDER")||this.isProviderEnabled("PHONE_PROVIDER")}}async function tR(e,t){return tT(e,"GET","/v2/recaptchaConfig",tE(e,t))}async function tP(e,t){return tT(e,"POST","/v1/accounts:delete",t)}async function tO(e,t){return tT(e,"POST","/v1/accounts:lookup",t)}function tL(e){if(e)try{let t=new Date(Number(e));if(!isNaN(t.getTime()))return t.toUTCString()}catch(e){}}async function tM(e,t=!1){let r=ei(e),n=await r.getIdToken(t),i=tV(n);tf(i&&i.exp&&i.auth_time&&i.iat,r.auth,"internal-error");let s="object"==typeof i.firebase?i.firebase:void 0,a=s?.sign_in_provider;return{claims:i,token:n,authTime:tL(tF(i.auth_time)),issuedAtTime:tL(tF(i.iat)),expirationTime:tL(tF(i.exp)),signInProvider:a||null,signInSecondFactor:s?.sign_in_second_factor||null}}function tF(e){return 1e3*Number(e)}function tV(e){let[t,r,n]=e.split(".");if(void 0===t||void 0===r||void 0===n)return to("JWT malformed, contained fewer than 3 sections"),null;try{let e=N(r);if(!e)return to("Failed to decode base64 JWT payload"),null;return JSON.parse(e)}catch(e){return to("Caught error parsing JWT payload as JSON",e?.toString()),null}}function tU(e){let t=tV(e);return tf(t,"internal-error"),tf(void 0!==t.exp,"internal-error"),tf(void 0!==t.iat,"internal-error"),Number(t.exp)-Number(t.iat)}async function tB(e,t,r=!1){if(r)return t;try{return await t}catch(t){throw t instanceof W&&function({code:e}){return"auth/user-disabled"===e||"auth/user-token-expired"===e}(t)&&e.auth.currentUser===e&&await e.auth.signOut(),t}}class tq{constructor(e){this.user=e,this.isRunning=!1,this.timerId=null,this.errorBackoff=3e4}_start(){this.isRunning||(this.isRunning=!0,this.schedule())}_stop(){this.isRunning&&(this.isRunning=!1,null!==this.timerId&&clearTimeout(this.timerId))}getInterval(e){if(!e)return this.errorBackoff=3e4,Math.max(0,(this.user.stsTokenManager.expirationTime??0)-Date.now()-3e5);{let e=this.errorBackoff;return this.errorBackoff=Math.min(2*this.errorBackoff,96e4),e}}schedule(e=!1){if(!this.isRunning)return;let t=this.getInterval(e);this.timerId=setTimeout(async()=>{await this.iteration()},t)}async iteration(){try{await this.user.getIdToken(!0)}catch(e){e?.code==="auth/network-request-failed"&&this.schedule(!0);return}this.schedule()}}class tj{constructor(e,t){this.createdAt=e,this.lastLoginAt=t,this._initializeTime()}_initializeTime(){this.lastSignInTime=tL(this.lastLoginAt),this.creationTime=tL(this.createdAt)}_copy(e){this.createdAt=e.createdAt,this.lastLoginAt=e.lastLoginAt,this._initializeTime()}toJSON(){return{createdAt:this.createdAt,lastLoginAt:this.lastLoginAt}}}async function tz(e){var t,r;let n=e.auth,i=await e.getIdToken(),s=await tB(e,tO(n,{idToken:i}));tf(s?.users.length,n,"internal-error");let a=s.users[0];e._notifyReloadListener(a);let o=a.providerUserInfo?.length?tK(a.providerUserInfo):[],l=(t=e.providerData,r=o,[...t.filter(e=>!r.some(t=>t.providerId===e.providerId)),...r]),u=e.isAnonymous,h=!(e.email&&a.passwordHash)&&!l?.length;Object.assign(e,{uid:a.localId,displayName:a.displayName||null,photoURL:a.photoUrl||null,email:a.email||null,emailVerified:a.emailVerified||!1,phoneNumber:a.phoneNumber||null,tenantId:a.tenantId||null,providerData:l,metadata:new tj(a.createdAt,a.lastLoginAt),isAnonymous:!!u&&h})}async function t$(e){let t=ei(e);await tz(t),await t.auth._persistUserIfCurrent(t),t.auth._notifyListenersIfCurrent(t)}function tK(e){return e.map(({providerId:e,...t})=>({providerId:e,uid:t.rawId||"",displayName:t.displayName||null,email:t.email||null,phoneNumber:t.phoneNumber||null,photoURL:t.photoUrl||null}))}async function tG(e,t){let r=await tS(e,{},async()=>{let r=Z({grant_type:"refresh_token",refresh_token:t}).slice(1),{tokenApiHost:n,apiKey:i}=e.config,s=await tA(e,n,"/v1/token",`key=${i}`),a=await e._getAdditionalHeaders();a["Content-Type"]="application/x-www-form-urlencoded";let o={method:"POST",headers:a,body:r};return e.emulatorConfig&&F(e.emulatorConfig.host)&&(o.credentials="include"),tv.fetch()(s,o)});return{accessToken:r.access_token,expiresIn:r.expires_in,refreshToken:r.refresh_token}}async function tH(e,t){return tT(e,"POST","/v2/accounts:revokeToken",tE(e,t))}class tW{constructor(){this.refreshToken=null,this.accessToken=null,this.expirationTime=null}get isExpired(){return!this.expirationTime||Date.now()>this.expirationTime-3e4}updateFromServerResponse(e){tf(e.idToken,"internal-error"),tf(void 0!==e.idToken,"internal-error"),tf(void 0!==e.refreshToken,"internal-error");let t="expiresIn"in e&&void 0!==e.expiresIn?Number(e.expiresIn):tU(e.idToken);this.updateTokensAndExpiration(e.idToken,e.refreshToken,t)}updateFromIdToken(e){tf(0!==e.length,"internal-error");let t=tU(e);this.updateTokensAndExpiration(e,null,t)}async getToken(e,t=!1){return t||!this.accessToken||this.isExpired?(tf(this.refreshToken,e,"user-token-expired"),this.refreshToken)?(await this.refresh(e,this.refreshToken),this.accessToken):null:this.accessToken}clearRefreshToken(){this.refreshToken=null}async refresh(e,t){let{accessToken:r,refreshToken:n,expiresIn:i}=await tG(e,t);this.updateTokensAndExpiration(r,n,Number(i))}updateTokensAndExpiration(e,t,r){this.refreshToken=t||null,this.accessToken=e||null,this.expirationTime=Date.now()+1e3*r}static fromJSON(e,t){let{refreshToken:r,accessToken:n,expirationTime:i}=t,s=new tW;return r&&(tf("string"==typeof r,"internal-error",{appName:e}),s.refreshToken=r),n&&(tf("string"==typeof n,"internal-error",{appName:e}),s.accessToken=n),i&&(tf("number"==typeof i,"internal-error",{appName:e}),s.expirationTime=i),s}toJSON(){return{refreshToken:this.refreshToken,accessToken:this.accessToken,expirationTime:this.expirationTime}}_assign(e){this.accessToken=e.accessToken,this.refreshToken=e.refreshToken,this.expirationTime=e.expirationTime}_clone(){return Object.assign(new tW,this.toJSON())}_performRefresh(){return tp("not implemented")}}function tQ(e,t){tf("string"==typeof e||void 0===e,"internal-error",{appName:t})}class tJ{constructor({uid:e,auth:t,stsTokenManager:r,...n}){this.providerId="firebase",this.proactiveRefresh=new tq(this),this.reloadUserInfo=null,this.reloadListener=null,this.uid=e,this.auth=t,this.stsTokenManager=r,this.accessToken=r.accessToken,this.displayName=n.displayName||null,this.email=n.email||null,this.emailVerified=n.emailVerified||!1,this.phoneNumber=n.phoneNumber||null,this.photoURL=n.photoURL||null,this.isAnonymous=n.isAnonymous||!1,this.tenantId=n.tenantId||null,this.providerData=n.providerData?[...n.providerData]:[],this.metadata=new tj(n.createdAt||void 0,n.lastLoginAt||void 0)}async getIdToken(e){let t=await tB(this,this.stsTokenManager.getToken(this.auth,e));return tf(t,this.auth,"internal-error"),this.accessToken!==t&&(this.accessToken=t,await this.auth._persistUserIfCurrent(this),this.auth._notifyListenersIfCurrent(this)),t}getIdTokenResult(e){return tM(this,e)}reload(){return t$(this)}_assign(e){this!==e&&(tf(this.uid===e.uid,this.auth,"internal-error"),this.displayName=e.displayName,this.photoURL=e.photoURL,this.email=e.email,this.emailVerified=e.emailVerified,this.phoneNumber=e.phoneNumber,this.isAnonymous=e.isAnonymous,this.tenantId=e.tenantId,this.providerData=e.providerData.map(e=>({...e})),this.metadata._copy(e.metadata),this.stsTokenManager._assign(e.stsTokenManager))}_clone(e){let t=new tJ({...this,auth:e,stsTokenManager:this.stsTokenManager._clone()});return t.metadata._copy(this.metadata),t}_onReload(e){tf(!this.reloadListener,this.auth,"internal-error"),this.reloadListener=e,this.reloadUserInfo&&(this._notifyReloadListener(this.reloadUserInfo),this.reloadUserInfo=null)}_notifyReloadListener(e){this.reloadListener?this.reloadListener(e):this.reloadUserInfo=e}_startProactiveRefresh(){this.proactiveRefresh._start()}_stopProactiveRefresh(){this.proactiveRefresh._stop()}async _updateTokensIfNecessary(e,t=!1){let r=!1;e.idToken&&e.idToken!==this.stsTokenManager.accessToken&&(this.stsTokenManager.updateFromServerResponse(e),r=!0),t&&await tz(this),await this.auth._persistUserIfCurrent(this),r&&this.auth._notifyListenersIfCurrent(this)}async delete(){if(ez(this.auth.app))return Promise.reject(tc(this.auth));let e=await this.getIdToken();return await tB(this,tP(this.auth,{idToken:e})),this.stsTokenManager.clearRefreshToken(),this.auth.signOut()}toJSON(){return{uid:this.uid,email:this.email||void 0,emailVerified:this.emailVerified,displayName:this.displayName||void 0,isAnonymous:this.isAnonymous,photoURL:this.photoURL||void 0,phoneNumber:this.phoneNumber||void 0,tenantId:this.tenantId||void 0,providerData:this.providerData.map(e=>({...e})),stsTokenManager:this.stsTokenManager.toJSON(),_redirectEventId:this._redirectEventId,...this.metadata.toJSON(),apiKey:this.auth.config.apiKey,appName:this.auth.name}}get refreshToken(){return this.stsTokenManager.refreshToken||""}static _fromJSON(e,t){let r=t.displayName??void 0,n=t.email??void 0,i=t.phoneNumber??void 0,s=t.photoURL??void 0,a=t.tenantId??void 0,o=t._redirectEventId??void 0,l=t.createdAt??void 0,u=t.lastLoginAt??void 0,{uid:h,emailVerified:c,isAnonymous:d,providerData:f,stsTokenManager:p}=t;tf(h&&p,e,"internal-error");let m=tW.fromJSON(this.name,p);tf("string"==typeof h,e,"internal-error"),tQ(r,e.name),tQ(n,e.name),tf("boolean"==typeof c,e,"internal-error"),tf("boolean"==typeof d,e,"internal-error"),tQ(i,e.name),tQ(s,e.name),tQ(a,e.name),tQ(o,e.name),tQ(l,e.name),tQ(u,e.name);let g=new tJ({uid:h,auth:e,email:n,emailVerified:c,displayName:r,isAnonymous:d,photoURL:s,phoneNumber:i,tenantId:a,stsTokenManager:m,createdAt:l,lastLoginAt:u});return f&&Array.isArray(f)&&(g.providerData=f.map(e=>({...e}))),o&&(g._redirectEventId=o),g}static async _fromIdTokenResponse(e,t,r=!1){let n=new tW;n.updateFromServerResponse(t);let i=new tJ({uid:t.localId,auth:e,stsTokenManager:n,isAnonymous:r});return await tz(i),i}static async _fromGetAccountInfoResponse(e,t,r){let n=t.users[0];tf(void 0!==n.localId,"internal-error");let i=void 0!==n.providerUserInfo?tK(n.providerUserInfo):[],s=!(n.email&&n.passwordHash)&&!i?.length,a=new tW;a.updateFromIdToken(r);let o=new tJ({uid:n.localId,auth:e,stsTokenManager:a,isAnonymous:s});return Object.assign(o,{uid:n.localId,displayName:n.displayName||null,photoURL:n.photoUrl||null,email:n.email||null,emailVerified:n.emailVerified||!1,phoneNumber:n.phoneNumber||null,tenantId:n.tenantId||null,providerData:i,metadata:new tj(n.createdAt,n.lastLoginAt),isAnonymous:!(n.email&&n.passwordHash)&&!i?.length}),o}}let tY=new Map;function tX(e){var t,r;t="Expected a class definition",e instanceof Function||tp(t);let n=tY.get(e);return n?(r="Instance stored in cache mismatched with class",n instanceof e||tp(r)):(n=new e,tY.set(e,n)),n}class tZ{constructor(){this.type="NONE",this.storage={}}async _isAvailable(){return!0}async _set(e,t){this.storage[e]=t}async _get(e){let t=this.storage[e];return void 0===t?null:t}async _remove(e){delete this.storage[e]}_addListener(e,t){}_removeListener(e,t){}}function t0(e,t,r){return`firebase:${e}:${t}:${r}`}tZ.type="NONE";class t1{constructor(e,t,r){this.persistence=e,this.auth=t,this.userKey=r;const{config:n,name:i}=this.auth;this.fullUserKey=t0(this.userKey,n.apiKey,i),this.fullPersistenceKey=t0("persistence",n.apiKey,i),this.boundEventHandler=t._onStorageEvent.bind(t),this.persistence._addListener(this.fullUserKey,this.boundEventHandler)}setCurrentUser(e){return this.persistence._set(this.fullUserKey,e.toJSON())}async getCurrentUser(){let e=await this.persistence._get(this.fullUserKey);if(!e)return null;if("string"==typeof e){let t=await tO(this.auth,{idToken:e}).catch(()=>void 0);return t?tJ._fromGetAccountInfoResponse(this.auth,t,e):null}return tJ._fromJSON(this.auth,e)}removeCurrentUser(){return this.persistence._remove(this.fullUserKey)}savePersistenceForRedirect(){return this.persistence._set(this.fullPersistenceKey,this.persistence.type)}async setPersistence(e){if(this.persistence===e)return;let t=await this.getCurrentUser();if(await this.removeCurrentUser(),this.persistence=e,t)return this.setCurrentUser(t)}delete(){this.persistence._removeListener(this.fullUserKey,this.boundEventHandler)}static async create(e,t,r="authUser"){if(!t.length)return new t1(tX(tZ),e,r);let n=(await Promise.all(t.map(async e=>{if(await e._isAvailable())return e}))).filter(e=>e),i=n[0]||tX(tZ),s=t0(r,e.config.apiKey,e.name),a=null;for(let r of t)try{let t=await r._get(s);if(t){let n;if("string"==typeof t){let r=await tO(e,{idToken:t}).catch(()=>void 0);if(!r)break;n=await tJ._fromGetAccountInfoResponse(e,r,t)}else n=tJ._fromJSON(e,t);r!==i&&(a=n),i=r;break}}catch{}let o=n.filter(e=>e._shouldAllowMigration);return i._shouldAllowMigration&&o.length&&(i=o[0],a&&await i._set(s,a.toJSON()),await Promise.all(t.map(async e=>{if(e!==i)try{await e._remove(s)}catch{}}))),new t1(i,e,r)}}function t2(e){let t=e.toLowerCase();if(t.includes("opera/")||t.includes("opr/")||t.includes("opios/"))return"Opera";{if(t5(t))return"IEMobile";if(t.includes("msie")||t.includes("trident/"))return"IE";if(t.includes("edge/"))return"Edge";if(t6(t))return"Firefox";if(t.includes("silk/"))return"Silk";if(t7(t))return"Blackberry";if(t9(t))return"Webos";if(t3(t))return"Safari";if((t.includes("chrome/")||t4(t))&&!t.includes("edge/"))return"Chrome";if(t8(t))return"Android";let r=e.match(/([a-zA-Z\d\.]+)\/[a-zA-Z\d\.]*$/);if(r?.length===2)return r[1]}return"Other"}function t6(e=j()){return/firefox\//i.test(e)}function t3(e=j()){let t=e.toLowerCase();return t.includes("safari/")&&!t.includes("chrome/")&&!t.includes("crios/")&&!t.includes("android")}function t4(e=j()){return/crios\//i.test(e)}function t5(e=j()){return/iemobile/i.test(e)}function t8(e=j()){return/android/i.test(e)}function t7(e=j()){return/blackberry/i.test(e)}function t9(e=j()){return/webos/i.test(e)}function re(e=j()){return/iphone|ipad|ipod/i.test(e)||/macintosh/i.test(e)&&/mobile/i.test(e)}function rt(e=j()){return re(e)||t8(e)||t9(e)||t7(e)||/windows phone/i.test(e)||t5(e)}function rr(e,t=[]){let r;switch(e){case"Browser":r=t2(j());break;case"Worker":r=`${t2(j())}-${e}`;break;default:r=e}let n=t.length?t.join(","):"FirebaseCore-web";return`${r}/JsCore/${eQ}/${n}`}class rn{constructor(e){this.auth=e,this.queue=[]}pushCallback(e,t){let r=t=>new Promise((r,n)=>{try{let n=e(t);r(n)}catch(e){n(e)}});r.onAbort=t,this.queue.push(r);let n=this.queue.length-1;return()=>{this.queue[n]=()=>Promise.resolve()}}async runMiddleware(e){if(this.auth.currentUser===e)return;let t=[];try{for(let r of this.queue)await r(e),r.onAbort&&t.push(r.onAbort)}catch(e){for(let e of(t.reverse(),t))try{e()}catch(e){}throw this.auth._errorFactory.create("login-blocked",{originalMessage:e?.message})}}}async function ri(e,t={}){return tT(e,"GET","/v2/passwordPolicy",tE(e,t))}class rs{constructor(e){const t=e.customStrengthOptions;this.customStrengthOptions={},this.customStrengthOptions.minPasswordLength=t.minPasswordLength??6,t.maxPasswordLength&&(this.customStrengthOptions.maxPasswordLength=t.maxPasswordLength),void 0!==t.containsLowercaseCharacter&&(this.customStrengthOptions.containsLowercaseLetter=t.containsLowercaseCharacter),void 0!==t.containsUppercaseCharacter&&(this.customStrengthOptions.containsUppercaseLetter=t.containsUppercaseCharacter),void 0!==t.containsNumericCharacter&&(this.customStrengthOptions.containsNumericCharacter=t.containsNumericCharacter),void 0!==t.containsNonAlphanumericCharacter&&(this.customStrengthOptions.containsNonAlphanumericCharacter=t.containsNonAlphanumericCharacter),this.enforcementState=e.enforcementState,"ENFORCEMENT_STATE_UNSPECIFIED"===this.enforcementState&&(this.enforcementState="OFF"),this.allowedNonAlphanumericCharacters=e.allowedNonAlphanumericCharacters?.join("")??"",this.forceUpgradeOnSignin=e.forceUpgradeOnSignin??!1,this.schemaVersion=e.schemaVersion}validatePassword(e){let t={isValid:!0,passwordPolicy:this};return this.validatePasswordLengthOptions(e,t),this.validatePasswordCharacterOptions(e,t),t.isValid&&(t.isValid=t.meetsMinPasswordLength??!0),t.isValid&&(t.isValid=t.meetsMaxPasswordLength??!0),t.isValid&&(t.isValid=t.containsLowercaseLetter??!0),t.isValid&&(t.isValid=t.containsUppercaseLetter??!0),t.isValid&&(t.isValid=t.containsNumericCharacter??!0),t.isValid&&(t.isValid=t.containsNonAlphanumericCharacter??!0),t}validatePasswordLengthOptions(e,t){let r=this.customStrengthOptions.minPasswordLength,n=this.customStrengthOptions.maxPasswordLength;r&&(t.meetsMinPasswordLength=e.length>=r),n&&(t.meetsMaxPasswordLength=e.length<=n)}validatePasswordCharacterOptions(e,t){let r;this.updatePasswordCharacterOptionsStatuses(t,!1,!1,!1,!1);for(let n=0;n<e.length;n++)r=e.charAt(n),this.updatePasswordCharacterOptionsStatuses(t,r>="a"&&r<="z",r>="A"&&r<="Z",r>="0"&&r<="9",this.allowedNonAlphanumericCharacters.includes(r))}updatePasswordCharacterOptionsStatuses(e,t,r,n,i){this.customStrengthOptions.containsLowercaseLetter&&(e.containsLowercaseLetter||(e.containsLowercaseLetter=t)),this.customStrengthOptions.containsUppercaseLetter&&(e.containsUppercaseLetter||(e.containsUppercaseLetter=r)),this.customStrengthOptions.containsNumericCharacter&&(e.containsNumericCharacter||(e.containsNumericCharacter=n)),this.customStrengthOptions.containsNonAlphanumericCharacter&&(e.containsNonAlphanumericCharacter||(e.containsNonAlphanumericCharacter=i))}}class ra{constructor(e,t,r,n){this.app=e,this.heartbeatServiceProvider=t,this.appCheckServiceProvider=r,this.config=n,this.currentUser=null,this.emulatorConfig=null,this.operations=Promise.resolve(),this.authStateSubscription=new ro(this),this.idTokenSubscription=new ro(this),this.beforeStateQueue=new rn(this),this.redirectUser=null,this.isProactiveRefreshEnabled=!1,this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION=1,this._canInitEmulator=!0,this._isInitialized=!1,this._deleted=!1,this._initializationPromise=null,this._popupRedirectResolver=null,this._errorFactory=ts,this._agentRecaptchaConfig=null,this._tenantRecaptchaConfigs={},this._projectPasswordPolicy=null,this._tenantPasswordPolicies={},this._resolvePersistenceManagerAvailable=void 0,this.lastNotifiedUid=void 0,this.languageCode=null,this.tenantId=null,this.settings={appVerificationDisabledForTesting:!1},this.frameworks=[],this.name=e.name,this.clientVersion=n.sdkClientVersion,this._persistenceManagerAvailable=new Promise(e=>this._resolvePersistenceManagerAvailable=e)}_initializeWithPersistence(e,t){return t&&(this._popupRedirectResolver=tX(t)),this._initializationPromise=this.queue(async()=>{if(!this._deleted){if(this.persistenceManager=await t1.create(this,e),this._resolvePersistenceManagerAvailable?.(),!this._deleted){if(this._popupRedirectResolver?._shouldInitProactively)try{await this._popupRedirectResolver._initialize(this)}catch(e){}await this.initializeCurrentUser(t),this.lastNotifiedUid=this.currentUser?.uid||null,this._deleted||(this._isInitialized=!0)}}}),this._initializationPromise}async _onStorageEvent(){if(this._deleted)return;let e=await this.assertedPersistence.getCurrentUser();if(this.currentUser||e){if(this.currentUser&&e&&this.currentUser.uid===e.uid){this._currentUser._assign(e),await this.currentUser.getIdToken();return}await this._updateCurrentUser(e,!0)}}async initializeCurrentUserFromIdToken(e){try{let t=await tO(this,{idToken:e}),r=await tJ._fromGetAccountInfoResponse(this,t,e);await this.directlySetCurrentUser(r)}catch(e){console.warn("FirebaseServerApp could not login user with provided authIdToken: ",e),await this.directlySetCurrentUser(null)}}async initializeCurrentUser(e){if(ez(this.app)){let e=this.app.settings.authIdToken;return e?new Promise(t=>{setTimeout(()=>this.initializeCurrentUserFromIdToken(e).then(t,t))}):this.directlySetCurrentUser(null)}let t=await this.assertedPersistence.getCurrentUser(),r=t,n=!1;if(e&&this.config.authDomain){await this.getOrInitRedirectPersistenceManager();let t=this.redirectUser?._redirectEventId,i=r?._redirectEventId,s=await this.tryRedirectSignIn(e);(!t||t===i)&&s?.user&&(r=s.user,n=!0)}if(!r)return this.directlySetCurrentUser(null);if(!r._redirectEventId){if(n)try{await this.beforeStateQueue.runMiddleware(r)}catch(e){r=t,this._popupRedirectResolver._overrideRedirectResult(this,()=>Promise.reject(e))}return r?this.reloadAndSetCurrentUserOrClear(r):this.directlySetCurrentUser(null)}return(tf(this._popupRedirectResolver,this,"argument-error"),await this.getOrInitRedirectPersistenceManager(),this.redirectUser&&this.redirectUser._redirectEventId===r._redirectEventId)?this.directlySetCurrentUser(r):this.reloadAndSetCurrentUserOrClear(r)}async tryRedirectSignIn(e){let t=null;try{t=await this._popupRedirectResolver._completeRedirectFn(this,e,!0)}catch(e){await this._setRedirectUser(null)}return t}async reloadAndSetCurrentUserOrClear(e){try{await tz(e)}catch(e){if(e?.code!=="auth/network-request-failed")return this.directlySetCurrentUser(null)}return this.directlySetCurrentUser(e)}useDeviceLanguage(){this.languageCode=function(){if("u"<typeof navigator)return null;let e=navigator;return e.languages&&e.languages[0]||e.language||null}()}async _delete(){this._deleted=!0}async updateCurrentUser(e){if(ez(this.app))return Promise.reject(tc(this));let t=e?ei(e):null;return t&&tf(t.auth.config.apiKey===this.config.apiKey,this,"invalid-user-token"),this._updateCurrentUser(t&&t._clone(this))}async _updateCurrentUser(e,t=!1){if(!this._deleted)return e&&tf(this.tenantId===e.tenantId,this,"tenant-id-mismatch"),t||await this.beforeStateQueue.runMiddleware(e),this.queue(async()=>{await this.directlySetCurrentUser(e),this.notifyAuthListeners()})}async signOut(){return ez(this.app)?Promise.reject(tc(this)):(await this.beforeStateQueue.runMiddleware(null),(this.redirectPersistenceManager||this._popupRedirectResolver)&&await this._setRedirectUser(null),this._updateCurrentUser(null,!0))}setPersistence(e){return ez(this.app)?Promise.reject(tc(this)):this.queue(async()=>{await this.assertedPersistence.setPersistence(tX(e))})}_getRecaptchaConfig(){return null==this.tenantId?this._agentRecaptchaConfig:this._tenantRecaptchaConfigs[this.tenantId]}async validatePassword(e){this._getPasswordPolicyInternal()||await this._updatePasswordPolicy();let t=this._getPasswordPolicyInternal();return t.schemaVersion!==this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION?Promise.reject(this._errorFactory.create("unsupported-password-policy-schema-version",{})):t.validatePassword(e)}_getPasswordPolicyInternal(){return null===this.tenantId?this._projectPasswordPolicy:this._tenantPasswordPolicies[this.tenantId]}async _updatePasswordPolicy(){let e=new rs(await ri(this));null===this.tenantId?this._projectPasswordPolicy=e:this._tenantPasswordPolicies[this.tenantId]=e}_getPersistenceType(){return this.assertedPersistence.persistence.type}_getPersistence(){return this.assertedPersistence.persistence}_updateErrorMap(e){this._errorFactory=new Q("auth","Firebase",e())}onAuthStateChanged(e,t,r){return this.registerStateListener(this.authStateSubscription,e,t,r)}beforeAuthStateChanged(e,t){return this.beforeStateQueue.pushCallback(e,t)}onIdTokenChanged(e,t,r){return this.registerStateListener(this.idTokenSubscription,e,t,r)}authStateReady(){return new Promise((e,t)=>{if(this.currentUser)e();else{let r=this.onAuthStateChanged(()=>{r(),e()},t)}})}async revokeAccessToken(e){if(this.currentUser){let t={providerId:"apple.com",tokenType:"ACCESS_TOKEN",token:e,idToken:await this.currentUser.getIdToken()};null!=this.tenantId&&(t.tenantId=this.tenantId),await tH(this,t)}}toJSON(){return{apiKey:this.config.apiKey,authDomain:this.config.authDomain,appName:this.name,currentUser:this._currentUser?.toJSON()}}async _setRedirectUser(e,t){let r=await this.getOrInitRedirectPersistenceManager(t);return null===e?r.removeCurrentUser():r.setCurrentUser(e)}async getOrInitRedirectPersistenceManager(e){if(!this.redirectPersistenceManager){let t=e&&tX(e)||this._popupRedirectResolver;tf(t,this,"argument-error"),this.redirectPersistenceManager=await t1.create(this,[tX(t._redirectPersistence)],"redirectUser"),this.redirectUser=await this.redirectPersistenceManager.getCurrentUser()}return this.redirectPersistenceManager}async _redirectUserForId(e){return(this._isInitialized&&await this.queue(async()=>{}),this._currentUser?._redirectEventId===e)?this._currentUser:this.redirectUser?._redirectEventId===e?this.redirectUser:null}async _persistUserIfCurrent(e){if(e===this.currentUser)return this.queue(async()=>this.directlySetCurrentUser(e))}_notifyListenersIfCurrent(e){e===this.currentUser&&this.notifyAuthListeners()}_key(){return`${this.config.authDomain}:${this.config.apiKey}:${this.name}`}_startProactiveRefresh(){this.isProactiveRefreshEnabled=!0,this.currentUser&&this._currentUser._startProactiveRefresh()}_stopProactiveRefresh(){this.isProactiveRefreshEnabled=!1,this.currentUser&&this._currentUser._stopProactiveRefresh()}get _currentUser(){return this.currentUser}notifyAuthListeners(){if(!this._isInitialized)return;this.idTokenSubscription.next(this.currentUser);let e=this.currentUser?.uid??null;this.lastNotifiedUid!==e&&(this.lastNotifiedUid=e,this.authStateSubscription.next(this.currentUser))}registerStateListener(e,t,r,n){if(this._deleted)return()=>{};let i="function"==typeof t?t:t.next.bind(t),s=!1,a=this._isInitialized?Promise.resolve():this._initializationPromise;if(tf(a,this,"internal-error"),a.then(()=>{s||i(this.currentUser)}),"function"==typeof t){let i=e.addObserver(t,r,n);return()=>{s=!0,i()}}{let r=e.addObserver(t);return()=>{s=!0,r()}}}async directlySetCurrentUser(e){this.currentUser&&this.currentUser!==e&&this._currentUser._stopProactiveRefresh(),e&&this.isProactiveRefreshEnabled&&e._startProactiveRefresh(),this.currentUser=e,e?await this.assertedPersistence.setCurrentUser(e):await this.assertedPersistence.removeCurrentUser()}queue(e){return this.operations=this.operations.then(e,e),this.operations}get assertedPersistence(){return tf(this.persistenceManager,this,"internal-error"),this.persistenceManager}_logFramework(e){!e||this.frameworks.includes(e)||(this.frameworks.push(e),this.frameworks.sort(),this.clientVersion=rr(this.config.clientPlatform,this._getFrameworks()))}_getFrameworks(){return this.frameworks}async _getAdditionalHeaders(){let e={"X-Client-Version":this.clientVersion};this.app.options.appId&&(e["X-Firebase-gmpid"]=this.app.options.appId);let t=await this.heartbeatServiceProvider.getImmediate({optional:!0})?.getHeartbeatsHeader();t&&(e["X-Firebase-Client"]=t);let r=await this._getAppCheckToken();return r&&(e["X-Firebase-AppCheck"]=r),e}async _getAppCheckToken(){if(ez(this.app)&&this.app.settings.appCheckToken)return this.app.settings.appCheckToken;let e=await this.appCheckServiceProvider.getImmediate({optional:!0})?.getToken();return e?.error&&function(e,...t){ta.logLevel<=a.WARN&&ta.warn(`Auth (${eQ}): ${e}`,...t)}(`Error while retrieving App Check token: ${e.error}`),e?.token}}class ro{constructor(e){this.auth=e,this.observer=null,this.addObserver=function(e,t){let r=new er(e,void 0);return r.subscribe.bind(r)}(e=>this.observer=e)}get next(){return tf(this.observer,this.auth,"internal-error"),this.observer.next.bind(this.observer)}}let rl={async loadJS(){throw Error("Unable to load external scripts")},recaptchaV2Script:"",recaptchaEnterpriseScript:"",gapiScript:""};function ru(e){return`__${e}${Math.floor(1e6*Math.random())}`}class rh{constructor(){this.enterprise=new rc}ready(e){e()}execute(e,t){return Promise.resolve("token")}render(e,t){return""}}class rc{ready(e){e()}execute(e,t){return Promise.resolve("token")}render(e,t){return""}}let rd="NO_RECAPTCHA";class rf{constructor(e){this.type="recaptcha-enterprise",this.auth=function(e){return ei(e)}(e)}async verify(e="verify",t=!1){async function r(e){if(!t){if(null==e.tenantId&&null!=e._agentRecaptchaConfig)return e._agentRecaptchaConfig.siteKey;if(null!=e.tenantId&&void 0!==e._tenantRecaptchaConfigs[e.tenantId])return e._tenantRecaptchaConfigs[e.tenantId].siteKey}return new Promise(async(t,r)=>{tR(e,{clientType:"CLIENT_TYPE_WEB",version:"RECAPTCHA_ENTERPRISE"}).then(n=>{if(void 0===n.recaptchaKey)r(Error("recaptcha Enterprise site key undefined"));else{let r=new tD(n);return null==e.tenantId?e._agentRecaptchaConfig=r:e._tenantRecaptchaConfigs[e.tenantId]=r,t(r.siteKey)}}).catch(e=>{r(e)})})}function n(t,r,n){let i=window.grecaptcha;tN(i)?i.enterprise.ready(()=>{i.enterprise.execute(t,{action:e}).then(e=>{r(e)}).catch(()=>{r(rd)})}):n(Error("No reCAPTCHA enterprise script loaded."))}return this.auth.settings.appVerificationDisabledForTesting?new rh().execute("siteKey",{action:"verify"}):new Promise((e,i)=>{r(this.auth).then(r=>{if(!t&&tN(window.grecaptcha))n(r,e,i);else{var s;if("u"<typeof window)return void i(Error("RecaptchaVerifier is only supported in browser"));let t=rl.recaptchaEnterpriseScript;0!==t.length&&(t+=r),(s=t,rl.loadJS(s)).then(()=>{n(r,e,i)}).catch(e=>{i(e)})}}).catch(e=>{i(e)})})}}async function rp(e,t,r,n=!1,i=!1){let s,a=new rf(e);if(i)s=rd;else try{s=await a.verify(r)}catch(e){s=await a.verify(r,!0)}let o={...t};if("mfaSmsEnrollment"===r||"mfaSmsSignIn"===r){if("phoneEnrollmentInfo"in o){let e=o.phoneEnrollmentInfo.phoneNumber,t=o.phoneEnrollmentInfo.recaptchaToken;Object.assign(o,{phoneEnrollmentInfo:{phoneNumber:e,recaptchaToken:t,captchaResponse:s,clientType:"CLIENT_TYPE_WEB",recaptchaVersion:"RECAPTCHA_ENTERPRISE"}})}else if("phoneSignInInfo"in o){let e=o.phoneSignInInfo.recaptchaToken;Object.assign(o,{phoneSignInInfo:{recaptchaToken:e,captchaResponse:s,clientType:"CLIENT_TYPE_WEB",recaptchaVersion:"RECAPTCHA_ENTERPRISE"}})}return o}return n?Object.assign(o,{captchaResp:s}):Object.assign(o,{captchaResponse:s}),Object.assign(o,{clientType:"CLIENT_TYPE_WEB"}),Object.assign(o,{recaptchaVersion:"RECAPTCHA_ENTERPRISE"}),o}async function rm(e,t,r,n,i){if("EMAIL_PASSWORD_PROVIDER"===i)if(!e._getRecaptchaConfig()?.isProviderEnabled("EMAIL_PASSWORD_PROVIDER"))return n(e,t).catch(async i=>{if("auth/missing-recaptcha-token"!==i.code)return Promise.reject(i);{console.log(`${r} is protected by reCAPTCHA Enterprise for this project. Automatically triggering the reCAPTCHA flow and restarting the flow.`);let i=await rp(e,t,r,"getOobCode"===r);return n(e,i)}});else{let i=await rp(e,t,r,"getOobCode"===r);return n(e,i)}if("PHONE_PROVIDER"!==i)return Promise.reject(i+" provider is not supported.");if(e._getRecaptchaConfig()?.isProviderEnabled("PHONE_PROVIDER")){let i=await rp(e,t,r);return n(e,i).catch(async i=>{if(e._getRecaptchaConfig()?.getProviderEnforcementState("PHONE_PROVIDER")==="AUDIT"&&("auth/missing-recaptcha-token"===i.code||"auth/invalid-app-credential"===i.code)){console.log(`Failed to verify with reCAPTCHA Enterprise. Automatically triggering the reCAPTCHA v2 flow to complete the ${r} flow.`);let i=await rp(e,t,r,!1,!0);return n(e,i)}return Promise.reject(i)})}{let i=await rp(e,t,r,!1,!0);return n(e,i)}}async function rg(e){let t=ei(e),r=new tD(await tR(t,{clientType:"CLIENT_TYPE_WEB",version:"RECAPTCHA_ENTERPRISE"}));null==t.tenantId?t._agentRecaptchaConfig=r:t._tenantRecaptchaConfigs[t.tenantId]=r,r.isAnyProviderEnabled()&&new rf(t).verify()}function ry(e){let t=e.indexOf(":");return t<0?"":e.substr(0,t+1)}function rw(e){if(!e)return null;let t=Number(e);return isNaN(t)?null:t}class rv{constructor(e,t){this.providerId=e,this.signInMethod=t}toJSON(){return tp("not implemented")}_getIdTokenResponse(e){return tp("not implemented")}_linkToIdToken(e,t){return tp("not implemented")}_getReauthenticationResolver(e){return tp("not implemented")}}async function r_(e,t){return tT(e,"POST","/v1/accounts:signUp",t)}async function rI(e,t){return tC(e,"POST","/v1/accounts:signInWithPassword",tE(e,t))}async function rb(e,t){return tC(e,"POST","/v1/accounts:signInWithEmailLink",tE(e,t))}async function rE(e,t){return tC(e,"POST","/v1/accounts:signInWithEmailLink",tE(e,t))}class rT extends rv{constructor(e,t,r,n=null){super("password",r),this._email=e,this._password=t,this._tenantId=n}static _fromEmailAndPassword(e,t){return new rT(e,t,"password")}static _fromEmailAndCode(e,t,r=null){return new rT(e,t,"emailLink",r)}toJSON(){return{email:this._email,password:this._password,signInMethod:this.signInMethod,tenantId:this._tenantId}}static fromJSON(e){let t="string"==typeof e?JSON.parse(e):e;if(t?.email&&t?.password){if("password"===t.signInMethod)return this._fromEmailAndPassword(t.email,t.password);else if("emailLink"===t.signInMethod)return this._fromEmailAndCode(t.email,t.password,t.tenantId)}return null}async _getIdTokenResponse(e){switch(this.signInMethod){case"password":return rm(e,{returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"},"signInWithPassword",rI,"EMAIL_PASSWORD_PROVIDER");case"emailLink":return rb(e,{email:this._email,oobCode:this._password});default:tl(e,"internal-error")}}async _linkToIdToken(e,t){switch(this.signInMethod){case"password":return rm(e,{idToken:t,returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"},"signUpPassword",r_,"EMAIL_PASSWORD_PROVIDER");case"emailLink":return rE(e,{idToken:t,email:this._email,oobCode:this._password});default:tl(e,"internal-error")}}_getReauthenticationResolver(e){return this._getIdTokenResponse(e)}}async function rS(e,t){return tC(e,"POST","/v1/accounts:signInWithIdp",tE(e,t))}class rC extends rv{constructor(){super(...arguments),this.pendingToken=null}static _fromParams(e){let t=new rC(e.providerId,e.signInMethod);return e.idToken||e.accessToken?(e.idToken&&(t.idToken=e.idToken),e.accessToken&&(t.accessToken=e.accessToken),e.nonce&&!e.pendingToken&&(t.nonce=e.nonce),e.pendingToken&&(t.pendingToken=e.pendingToken)):e.oauthToken&&e.oauthTokenSecret?(t.accessToken=e.oauthToken,t.secret=e.oauthTokenSecret):tl("argument-error"),t}toJSON(){return{idToken:this.idToken,accessToken:this.accessToken,secret:this.secret,nonce:this.nonce,pendingToken:this.pendingToken,providerId:this.providerId,signInMethod:this.signInMethod}}static fromJSON(e){let{providerId:t,signInMethod:r,...n}="string"==typeof e?JSON.parse(e):e;if(!t||!r)return null;let i=new rC(t,r);return i.idToken=n.idToken||void 0,i.accessToken=n.accessToken||void 0,i.secret=n.secret,i.nonce=n.nonce,i.pendingToken=n.pendingToken||null,i}_getIdTokenResponse(e){return rS(e,this.buildRequest())}_linkToIdToken(e,t){let r=this.buildRequest();return r.idToken=t,rS(e,r)}_getReauthenticationResolver(e){let t=this.buildRequest();return t.autoCreate=!1,rS(e,t)}buildRequest(){let e={requestUri:"http://localhost",returnSecureToken:!0};if(this.pendingToken)e.pendingToken=this.pendingToken;else{let t={};this.idToken&&(t.id_token=this.idToken),this.accessToken&&(t.access_token=this.accessToken),this.secret&&(t.oauth_token_secret=this.secret),t.providerId=this.providerId,this.nonce&&!this.pendingToken&&(t.nonce=this.nonce),e.postBody=Z(t)}return e}}async function rA(e,t){return tT(e,"POST","/v1/accounts:sendVerificationCode",tE(e,t))}async function rk(e,t){return tC(e,"POST","/v1/accounts:signInWithPhoneNumber",tE(e,t))}async function rx(e,t){let r=await tC(e,"POST","/v1/accounts:signInWithPhoneNumber",tE(e,t));if(r.temporaryProof)throw tx(e,"account-exists-with-different-credential",r);return r}let rN={USER_NOT_FOUND:"user-not-found"};async function rD(e,t){return tC(e,"POST","/v1/accounts:signInWithPhoneNumber",tE(e,{...t,operation:"REAUTH"}),rN)}class rR extends rv{constructor(e){super("phone","phone"),this.params=e}static _fromVerification(e,t){return new rR({verificationId:e,verificationCode:t})}static _fromTokenResponse(e,t){return new rR({phoneNumber:e,temporaryProof:t})}_getIdTokenResponse(e){return rk(e,this._makeVerificationRequest())}_linkToIdToken(e,t){return rx(e,{idToken:t,...this._makeVerificationRequest()})}_getReauthenticationResolver(e){return rD(e,this._makeVerificationRequest())}_makeVerificationRequest(){let{temporaryProof:e,phoneNumber:t,verificationId:r,verificationCode:n}=this.params;return e&&t?{temporaryProof:e,phoneNumber:t}:{sessionInfo:r,code:n}}toJSON(){let e={providerId:this.providerId};return this.params.phoneNumber&&(e.phoneNumber=this.params.phoneNumber),this.params.temporaryProof&&(e.temporaryProof=this.params.temporaryProof),this.params.verificationCode&&(e.verificationCode=this.params.verificationCode),this.params.verificationId&&(e.verificationId=this.params.verificationId),e}static fromJSON(e){"string"==typeof e&&(e=JSON.parse(e));let{verificationId:t,verificationCode:r,phoneNumber:n,temporaryProof:i}=e;return r||t||n||i?new rR({verificationId:t,verificationCode:r,phoneNumber:n,temporaryProof:i}):null}}class rP{constructor(e){const t=ee(et(e)),r=t.apiKey??null,n=t.oobCode??null,i=function(e){switch(e){case"recoverEmail":return"RECOVER_EMAIL";case"resetPassword":return"PASSWORD_RESET";case"signIn":return"EMAIL_SIGNIN";case"verifyEmail":return"VERIFY_EMAIL";case"verifyAndChangeEmail":return"VERIFY_AND_CHANGE_EMAIL";case"revertSecondFactorAddition":return"REVERT_SECOND_FACTOR_ADDITION";default:return null}}(t.mode??null);tf(r&&n&&i,"argument-error"),this.apiKey=r,this.operation=i,this.code=n,this.continueUrl=t.continueUrl??null,this.languageCode=t.lang??null,this.tenantId=t.tenantId??null}static parseLink(e){let t,r,n,i=(r=(t=ee(et(e)).link)?ee(et(t)).deep_link_id:null,((n=ee(et(e)).deep_link_id)?ee(et(n)).link:null)||n||r||t||e);try{return new rP(i)}catch{return null}}}class rO{constructor(){this.providerId=rO.PROVIDER_ID}static credential(e,t){return rT._fromEmailAndPassword(e,t)}static credentialWithLink(e,t){let r=rP.parseLink(t);return tf(r,"argument-error"),rT._fromEmailAndCode(e,r.code,r.tenantId)}}rO.PROVIDER_ID="password",rO.EMAIL_PASSWORD_SIGN_IN_METHOD="password",rO.EMAIL_LINK_SIGN_IN_METHOD="emailLink";class rL{constructor(e){this.providerId=e,this.defaultLanguageCode=null,this.customParameters={}}setDefaultLanguage(e){this.defaultLanguageCode=e}setCustomParameters(e){return this.customParameters=e,this}getCustomParameters(){return this.customParameters}}class rM extends rL{constructor(){super(...arguments),this.scopes=[]}addScope(e){return this.scopes.includes(e)||this.scopes.push(e),this}getScopes(){return[...this.scopes]}}class rF extends rM{constructor(){super("facebook.com")}static credential(e){return rC._fromParams({providerId:rF.PROVIDER_ID,signInMethod:rF.FACEBOOK_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return rF.credentialFromTaggedObject(e)}static credentialFromError(e){return rF.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e)||!e.oauthAccessToken)return null;try{return rF.credential(e.oauthAccessToken)}catch{return null}}}rF.FACEBOOK_SIGN_IN_METHOD="facebook.com",rF.PROVIDER_ID="facebook.com";class rV extends rM{constructor(){super("google.com"),this.addScope("profile")}static credential(e,t){return rC._fromParams({providerId:rV.PROVIDER_ID,signInMethod:rV.GOOGLE_SIGN_IN_METHOD,idToken:e,accessToken:t})}static credentialFromResult(e){return rV.credentialFromTaggedObject(e)}static credentialFromError(e){return rV.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;let{oauthIdToken:t,oauthAccessToken:r}=e;if(!t&&!r)return null;try{return rV.credential(t,r)}catch{return null}}}rV.GOOGLE_SIGN_IN_METHOD="google.com",rV.PROVIDER_ID="google.com";class rU extends rM{constructor(){super("github.com")}static credential(e){return rC._fromParams({providerId:rU.PROVIDER_ID,signInMethod:rU.GITHUB_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return rU.credentialFromTaggedObject(e)}static credentialFromError(e){return rU.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e)||!e.oauthAccessToken)return null;try{return rU.credential(e.oauthAccessToken)}catch{return null}}}rU.GITHUB_SIGN_IN_METHOD="github.com",rU.PROVIDER_ID="github.com";class rB extends rM{constructor(){super("twitter.com")}static credential(e,t){return rC._fromParams({providerId:rB.PROVIDER_ID,signInMethod:rB.TWITTER_SIGN_IN_METHOD,oauthToken:e,oauthTokenSecret:t})}static credentialFromResult(e){return rB.credentialFromTaggedObject(e)}static credentialFromError(e){return rB.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;let{oauthAccessToken:t,oauthTokenSecret:r}=e;if(!t||!r)return null;try{return rB.credential(t,r)}catch{return null}}}async function rq(e,t){return tC(e,"POST","/v1/accounts:signUp",tE(e,t))}rB.TWITTER_SIGN_IN_METHOD="twitter.com",rB.PROVIDER_ID="twitter.com";class rj{constructor(e){this.user=e.user,this.providerId=e.providerId,this._tokenResponse=e._tokenResponse,this.operationType=e.operationType}static async _fromIdTokenResponse(e,t,r,n=!1){return new rj({user:await tJ._fromIdTokenResponse(e,r,n),providerId:rz(r),_tokenResponse:r,operationType:t})}static async _forOperation(e,t,r){return await e._updateTokensIfNecessary(r,!0),new rj({user:e,providerId:rz(r),_tokenResponse:r,operationType:t})}}function rz(e){return e.providerId?e.providerId:"phoneNumber"in e?"phone":null}class r$ extends W{constructor(e,t,r,n){super(t.code,t.message),this.operationType=r,this.user=n,Object.setPrototypeOf(this,r$.prototype),this.customData={appName:e.name,tenantId:e.tenantId??void 0,_serverResponse:t.customData._serverResponse,operationType:r}}static _fromErrorAndOperation(e,t,r,n){return new r$(e,t,r,n)}}function rK(e,t,r,n){return("reauthenticate"===t?r._getReauthenticationResolver(e):r._getIdTokenResponse(e)).catch(r=>{if("auth/multi-factor-auth-required"===r.code)throw r$._fromErrorAndOperation(e,r,t,n);throw r})}async function rG(e,t,r=!1){let n=await tB(e,t._linkToIdToken(e.auth,await e.getIdToken()),r);return rj._forOperation(e,"link",n)}async function rH(e,t,r=!1){let{auth:n}=e;if(ez(n.app))return Promise.reject(tc(n));let i="reauthenticate";try{let s=await tB(e,rK(n,i,t,e),r);tf(s.idToken,n,"internal-error");let a=tV(s.idToken);tf(a,n,"internal-error");let{sub:o}=a;return tf(e.uid===o,n,"user-mismatch"),rj._forOperation(e,i,s)}catch(e){throw e?.code==="auth/user-not-found"&&tl(n,"user-mismatch"),e}}async function rW(e,t,r=!1){if(ez(e.app))return Promise.reject(tc(e));let n="signIn",i=await rK(e,n,t),s=await rj._fromIdTokenResponse(e,n,i);return r||await e._updateCurrentUser(s.user),s}async function rQ(e,t){return rW(ei(e),t)}class rJ{constructor(e,t){this.factorId=e,this.uid=t.mfaEnrollmentId,this.enrollmentTime=new Date(t.enrolledAt).toUTCString(),this.displayName=t.displayName}static _fromServerResponse(e,t){return"phoneInfo"in t?rY._fromServerResponse(e,t):"totpInfo"in t?rX._fromServerResponse(e,t):tl(e,"internal-error")}}class rY extends rJ{constructor(e){super("phone",e),this.phoneNumber=e.phoneInfo}static _fromServerResponse(e,t){return new rY(t)}}class rX extends rJ{constructor(e){super("totp",e)}static _fromServerResponse(e,t){return new rX(t)}}async function rZ(e){let t=ei(e);t._getPasswordPolicyInternal()&&await t._updatePasswordPolicy()}async function r0(e,t,r){if(ez(e.app))return Promise.reject(tc(e));let n=ei(e),i=rm(n,{returnSecureToken:!0,email:t,password:r,clientType:"CLIENT_TYPE_WEB"},"signUpPassword",rq,"EMAIL_PASSWORD_PROVIDER"),s=await i.catch(t=>{throw"auth/password-does-not-meet-requirements"===t.code&&rZ(e),t}),a=await rj._fromIdTokenResponse(n,"signIn",s);return await n._updateCurrentUser(a.user),a}function r1(e,t){return tT(e,"POST","/v2/accounts/mfaEnrollment:start",tE(e,t))}new WeakMap;let r2="__sak";class r6{constructor(e,t){this.storageRetriever=e,this.type=t}_isAvailable(){try{if(!this.storage)return Promise.resolve(!1);return this.storage.setItem(r2,"1"),this.storage.removeItem(r2),Promise.resolve(!0)}catch{return Promise.resolve(!1)}}_set(e,t){return this.storage.setItem(e,JSON.stringify(t)),Promise.resolve()}_get(e){let t=this.storage.getItem(e);return Promise.resolve(t?JSON.parse(t):null)}_remove(e){return this.storage.removeItem(e),Promise.resolve()}get storage(){return this.storageRetriever()}}class r3 extends r6{constructor(){super(()=>window.localStorage,"LOCAL"),this.boundEventHandler=(e,t)=>this.onStorageEvent(e,t),this.listeners={},this.localCache={},this.pollTimer=null,this.fallbackToPolling=rt(),this._shouldAllowMigration=!0}forAllChangedKeys(e){for(let t of Object.keys(this.listeners)){let r=this.storage.getItem(t),n=this.localCache[t];r!==n&&e(t,n,r)}}onStorageEvent(e,t=!1){let r;if(!e.key)return void this.forAllChangedKeys((e,t,r)=>{this.notifyListeners(e,r)});let n=e.key;t?this.detachListener():this.stopPolling();let i=()=>{let e=this.storage.getItem(n);(t||this.localCache[n]!==e)&&this.notifyListeners(n,e)},s=this.storage.getItem(n);((r=j()).indexOf("MSIE ")>=0||r.indexOf("Trident/")>=0)&&10===document.documentMode&&s!==e.newValue&&e.newValue!==e.oldValue?setTimeout(i,10):i()}notifyListeners(e,t){this.localCache[e]=t;let r=this.listeners[e];if(r)for(let e of Array.from(r))e(t?JSON.parse(t):t)}startPolling(){this.stopPolling(),this.pollTimer=setInterval(()=>{this.forAllChangedKeys((e,t,r)=>{this.onStorageEvent(new StorageEvent("storage",{key:e,oldValue:t,newValue:r}),!0)})},1e3)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}attachListener(){window.addEventListener("storage",this.boundEventHandler)}detachListener(){window.removeEventListener("storage",this.boundEventHandler)}_addListener(e,t){0===Object.keys(this.listeners).length&&(this.fallbackToPolling?this.startPolling():this.attachListener()),this.listeners[e]||(this.listeners[e]=new Set,this.localCache[e]=this.storage.getItem(e)),this.listeners[e].add(t)}_removeListener(e,t){this.listeners[e]&&(this.listeners[e].delete(t),0===this.listeners[e].size&&delete this.listeners[e]),0===Object.keys(this.listeners).length&&(this.detachListener(),this.stopPolling())}async _set(e,t){await super._set(e,t),this.localCache[e]=JSON.stringify(t)}async _get(e){let t=await super._get(e);return this.localCache[e]=JSON.stringify(t),t}async _remove(e){await super._remove(e),delete this.localCache[e]}}r3.type="LOCAL";class r4 extends r6{constructor(){super(()=>window.sessionStorage,"SESSION")}_addListener(e,t){}_removeListener(e,t){}}r4.type="SESSION";class r5{constructor(e){this.eventTarget=e,this.handlersMap={},this.boundEventHandler=this.handleEvent.bind(this)}static _getInstance(e){let t=this.receivers.find(t=>t.isListeningto(e));if(t)return t;let r=new r5(e);return this.receivers.push(r),r}isListeningto(e){return this.eventTarget===e}async handleEvent(e){let{eventId:t,eventType:r,data:n}=e.data,i=this.handlersMap[r];if(!i?.size)return;e.ports[0].postMessage({status:"ack",eventId:t,eventType:r});let s=Array.from(i).map(async t=>t(e.origin,n)),a=await Promise.all(s.map(async e=>{try{let t=await e;return{fulfilled:!0,value:t}}catch(e){return{fulfilled:!1,reason:e}}}));e.ports[0].postMessage({status:"done",eventId:t,eventType:r,response:a})}_subscribe(e,t){0===Object.keys(this.handlersMap).length&&this.eventTarget.addEventListener("message",this.boundEventHandler),this.handlersMap[e]||(this.handlersMap[e]=new Set),this.handlersMap[e].add(t)}_unsubscribe(e,t){this.handlersMap[e]&&t&&this.handlersMap[e].delete(t),t&&0!==this.handlersMap[e].size||delete this.handlersMap[e],0===Object.keys(this.handlersMap).length&&this.eventTarget.removeEventListener("message",this.boundEventHandler)}}function r8(e="",t=10){let r="";for(let e=0;e<t;e++)r+=Math.floor(10*Math.random());return e+r}r5.receivers=[];class r7{constructor(e){this.target=e,this.handlers=new Set}removeMessageHandler(e){e.messageChannel&&(e.messageChannel.port1.removeEventListener("message",e.onMessage),e.messageChannel.port1.close()),this.handlers.delete(e)}async _send(e,t,r=50){let n,i,s="u">typeof MessageChannel?new MessageChannel:null;if(!s)throw Error("connection_unavailable");return new Promise((a,o)=>{let l=r8("",20);s.port1.start();let u=setTimeout(()=>{o(Error("unsupported_event"))},r);i={messageChannel:s,onMessage(e){if(e.data.eventId===l)switch(e.data.status){case"ack":clearTimeout(u),n=setTimeout(()=>{o(Error("timeout"))},3e3);break;case"done":clearTimeout(n),a(e.data.response);break;default:clearTimeout(u),clearTimeout(n),o(Error("invalid_response"))}}},this.handlers.add(i),s.port1.addEventListener("message",i.onMessage),this.target.postMessage({eventType:e,eventId:l,data:t},[s.port2])}).finally(()=>{i&&this.removeMessageHandler(i)})}}function r9(){return window}function ne(){return void 0!==r9().WorkerGlobalScope&&"function"==typeof r9().importScripts}async function nt(){if(!navigator?.serviceWorker)return null;try{return(await navigator.serviceWorker.ready).active}catch{return null}}let nr="firebaseLocalStorageDb",nn="firebaseLocalStorage",ni="fbase_key";class ns{constructor(e){this.request=e}toPromise(){return new Promise((e,t)=>{this.request.addEventListener("success",()=>{e(this.request.result)}),this.request.addEventListener("error",()=>{t(this.request.error)})})}}function na(e,t){return e.transaction([nn],t?"readwrite":"readonly").objectStore(nn)}function no(){let e=indexedDB.open(nr,1);return new Promise((t,r)=>{e.addEventListener("error",()=>{r(e.error)}),e.addEventListener("upgradeneeded",()=>{let t=e.result;try{t.createObjectStore(nn,{keyPath:ni})}catch(e){r(e)}}),e.addEventListener("success",async()=>{let r=e.result;r.objectStoreNames.contains(nn)?t(r):(r.close(),await new ns(indexedDB.deleteDatabase(nr)).toPromise(),t(await no()))})})}async function nl(e,t,r){return new ns(na(e,!0).put({[ni]:t,value:r})).toPromise()}async function nu(e,t){let r=na(e,!1).get(t),n=await new ns(r).toPromise();return void 0===n?null:n.value}function nh(e,t){return new ns(na(e,!0).delete(t)).toPromise()}class nc{constructor(){this.type="LOCAL",this._shouldAllowMigration=!0,this.listeners={},this.localCache={},this.pollTimer=null,this.pendingWrites=0,this.receiver=null,this.sender=null,this.serviceWorkerReceiverAvailable=!1,this.activeServiceWorker=null,this._workerInitializationPromise=this.initializeServiceWorkerMessaging().then(()=>{},()=>{})}async _openDb(){return this.db||(this.db=await no()),this.db}async _withRetries(e){let t=0;for(;;)try{let t=await this._openDb();return await e(t)}catch(e){if(t++>3)throw e;this.db&&(this.db.close(),this.db=void 0)}}async initializeServiceWorkerMessaging(){return ne()?this.initializeReceiver():this.initializeSender()}async initializeReceiver(){this.receiver=r5._getInstance(ne()?self:null),this.receiver._subscribe("keyChanged",async(e,t)=>({keyProcessed:(await this._poll()).includes(t.key)})),this.receiver._subscribe("ping",async(e,t)=>["keyChanged"])}async initializeSender(){if(this.activeServiceWorker=await nt(),!this.activeServiceWorker)return;this.sender=new r7(this.activeServiceWorker);let e=await this.sender._send("ping",{},800);e&&e[0]?.fulfilled&&e[0]?.value.includes("keyChanged")&&(this.serviceWorkerReceiverAvailable=!0)}async notifyServiceWorker(e){if(this.sender&&this.activeServiceWorker&&(navigator?.serviceWorker?.controller||null)===this.activeServiceWorker)try{await this.sender._send("keyChanged",{key:e},this.serviceWorkerReceiverAvailable?800:50)}catch{}}async _isAvailable(){try{if(!indexedDB)return!1;let e=await no();return await nl(e,r2,"1"),await nh(e,r2),!0}catch{}return!1}async _withPendingWrite(e){this.pendingWrites++;try{await e()}finally{this.pendingWrites--}}async _set(e,t){return this._withPendingWrite(async()=>(await this._withRetries(r=>nl(r,e,t)),this.localCache[e]=t,this.notifyServiceWorker(e)))}async _get(e){let t=await this._withRetries(t=>nu(t,e));return this.localCache[e]=t,t}async _remove(e){return this._withPendingWrite(async()=>(await this._withRetries(t=>nh(t,e)),delete this.localCache[e],this.notifyServiceWorker(e)))}async _poll(){let e=await this._withRetries(e=>new ns(na(e,!1).getAll()).toPromise());if(!e||0!==this.pendingWrites)return[];let t=[],r=new Set;if(0!==e.length)for(let{fbase_key:n,value:i}of e)r.add(n),JSON.stringify(this.localCache[n])!==JSON.stringify(i)&&(this.notifyListeners(n,i),t.push(n));for(let e of Object.keys(this.localCache))this.localCache[e]&&!r.has(e)&&(this.notifyListeners(e,null),t.push(e));return t}notifyListeners(e,t){this.localCache[e]=t;let r=this.listeners[e];if(r)for(let e of Array.from(r))e(t)}startPolling(){this.stopPolling(),this.pollTimer=setInterval(async()=>this._poll(),800)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}_addListener(e,t){0===Object.keys(this.listeners).length&&this.startPolling(),this.listeners[e]||(this.listeners[e]=new Set,this._get(e)),this.listeners[e].add(t)}_removeListener(e,t){this.listeners[e]&&(this.listeners[e].delete(t),0===this.listeners[e].size&&delete this.listeners[e]),0===Object.keys(this.listeners).length&&this.stopPolling()}}function nd(e,t){return tT(e,"POST","/v2/accounts/mfaSignIn:start",tE(e,t))}nc.type="LOCAL",ru("rcb"),new ty(3e4,6e4);let nf="recaptcha";async function np(e,t,r){if(!e._getRecaptchaConfig())try{await rg(e)}catch(e){console.log("Failed to initialize reCAPTCHA Enterprise config. Triggering the reCAPTCHA v2 verification.")}try{let n;if(n="string"==typeof t?{phoneNumber:t}:t,"session"in n){let t=n.session;if("phoneNumber"in n){tf("enroll"===t.type,e,"internal-error");let i={idToken:t.credential,phoneEnrollmentInfo:{phoneNumber:n.phoneNumber,clientType:"CLIENT_TYPE_WEB"}},s=async(e,t)=>{if(t.phoneEnrollmentInfo.captchaResponse===rd){tf(r?.type===nf,e,"argument-error");let n=await nm(e,t,r);return r1(e,n)}return r1(e,t)},a=rm(e,i,"mfaSmsEnrollment",s,"PHONE_PROVIDER");return(await a.catch(e=>Promise.reject(e))).phoneSessionInfo.sessionInfo}{tf("signin"===t.type,e,"internal-error");let i=n.multiFactorHint?.uid||n.multiFactorUid;tf(i,e,"missing-multi-factor-info");let s={mfaPendingCredential:t.credential,mfaEnrollmentId:i,phoneSignInInfo:{clientType:"CLIENT_TYPE_WEB"}},a=async(e,t)=>{if(t.phoneSignInInfo.captchaResponse===rd){tf(r?.type===nf,e,"argument-error");let n=await nm(e,t,r);return nd(e,n)}return nd(e,t)},o=rm(e,s,"mfaSmsSignIn",a,"PHONE_PROVIDER");return(await o.catch(e=>Promise.reject(e))).phoneResponseInfo.sessionInfo}}{let t={phoneNumber:n.phoneNumber,clientType:"CLIENT_TYPE_WEB"},i=async(e,t)=>{if(t.captchaResponse===rd){tf(r?.type===nf,e,"argument-error");let n=await nm(e,t,r);return rA(e,n)}return rA(e,t)},s=rm(e,t,"sendVerificationCode",i,"PHONE_PROVIDER");return(await s.catch(e=>Promise.reject(e))).sessionInfo}}finally{r?._reset()}}async function nm(e,t,r){tf(r.type===nf,e,"argument-error");let n=await r.verify();tf("string"==typeof n,e,"argument-error");let i={...t};if("phoneEnrollmentInfo"in i){let e=i.phoneEnrollmentInfo.phoneNumber,t=i.phoneEnrollmentInfo.captchaResponse,r=i.phoneEnrollmentInfo.clientType,s=i.phoneEnrollmentInfo.recaptchaVersion;return Object.assign(i,{phoneEnrollmentInfo:{phoneNumber:e,recaptchaToken:n,captchaResponse:t,clientType:r,recaptchaVersion:s}}),i}if(!("phoneSignInInfo"in i))return Object.assign(i,{recaptchaToken:n}),i;{let e=i.phoneSignInInfo.captchaResponse,t=i.phoneSignInInfo.clientType,r=i.phoneSignInInfo.recaptchaVersion;return Object.assign(i,{phoneSignInInfo:{recaptchaToken:n,captchaResponse:e,clientType:t,recaptchaVersion:r}}),i}}class ng{constructor(e){this.providerId=ng.PROVIDER_ID,this.auth=function(e){return ei(e)}(e)}verifyPhoneNumber(e,t){return np(this.auth,e,ei(t))}static credential(e,t){return rR._fromVerification(e,t)}static credentialFromResult(e){return ng.credentialFromTaggedObject(e)}static credentialFromError(e){return ng.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;let{phoneNumber:t,temporaryProof:r}=e;return t&&r?rR._fromTokenResponse(t,r):null}}ng.PROVIDER_ID="phone",ng.PHONE_SIGN_IN_METHOD="phone";class ny extends rv{constructor(e){super("custom","custom"),this.params=e}_getIdTokenResponse(e){return rS(e,this._buildIdpRequest())}_linkToIdToken(e,t){return rS(e,this._buildIdpRequest(t))}_getReauthenticationResolver(e){return rS(e,this._buildIdpRequest())}_buildIdpRequest(e){let t={requestUri:this.params.requestUri,sessionId:this.params.sessionId,postBody:this.params.postBody,tenantId:this.params.tenantId,pendingToken:this.params.pendingToken,returnSecureToken:!0,returnIdpCredential:!0};return e&&(t.idToken=e),t}}function nw(e){return rW(e.auth,new ny(e),e.bypassAuthState)}function nv(e){let{auth:t,user:r}=e;return tf(r,t,"internal-error"),rH(r,new ny(e),e.bypassAuthState)}async function n_(e){let{auth:t,user:r}=e;return tf(r,t,"internal-error"),rG(r,new ny(e),e.bypassAuthState)}class nI{constructor(e,t,r,n,i=!1){this.auth=e,this.resolver=r,this.user=n,this.bypassAuthState=i,this.pendingPromise=null,this.eventManager=null,this.filter=Array.isArray(t)?t:[t]}execute(){return new Promise(async(e,t)=>{this.pendingPromise={resolve:e,reject:t};try{this.eventManager=await this.resolver._initialize(this.auth),await this.onExecution(),this.eventManager.registerConsumer(this)}catch(e){this.reject(e)}})}async onAuthEvent(e){let{urlResponse:t,sessionId:r,postBody:n,tenantId:i,error:s,type:a}=e;if(s)return void this.reject(s);let o={auth:this.auth,requestUri:t,sessionId:r,tenantId:i||void 0,postBody:n||void 0,user:this.user,bypassAuthState:this.bypassAuthState};try{this.resolve(await this.getIdpTask(a)(o))}catch(e){this.reject(e)}}onError(e){this.reject(e)}getIdpTask(e){switch(e){case"signInViaPopup":case"signInViaRedirect":return nw;case"linkViaPopup":case"linkViaRedirect":return n_;case"reauthViaPopup":case"reauthViaRedirect":return nv;default:tl(this.auth,"internal-error")}}resolve(e){var t,r;t=this.pendingPromise,r="Pending promise was never set",t||tp(r),this.pendingPromise.resolve(e),this.unregisterAndCleanUp()}reject(e){var t,r;t=this.pendingPromise,r="Pending promise was never set",t||tp(r),this.pendingPromise.reject(e),this.unregisterAndCleanUp()}unregisterAndCleanUp(){this.eventManager&&this.eventManager.unregisterConsumer(this),this.pendingPromise=null,this.cleanUp()}}let nb=new ty(2e3,1e4);class nE extends nI{constructor(e,t,r,n,i){super(e,t,n,i),this.provider=r,this.authWindow=null,this.pollId=null,nE.currentPopupAction&&nE.currentPopupAction.cancel(),nE.currentPopupAction=this}async executeNotNull(){let e=await this.execute();return tf(e,this.auth,"internal-error"),e}async onExecution(){var e,t;e=1===this.filter.length,t="Popup operations only handle one event",e||tp(t);let r=r8();this.authWindow=await this.resolver._openPopup(this.auth,this.provider,this.filter[0],r),this.authWindow.associatedEvent=r,this.resolver._originValidation(this.auth).catch(e=>{this.reject(e)}),this.resolver._isIframeWebStorageSupported(this.auth,e=>{e||this.reject(tu(this.auth,"web-storage-unsupported"))}),this.pollUserCancellation()}get eventId(){return this.authWindow?.associatedEvent||null}cancel(){this.reject(tu(this.auth,"cancelled-popup-request"))}cleanUp(){this.authWindow&&this.authWindow.close(),this.pollId&&window.clearTimeout(this.pollId),this.authWindow=null,this.pollId=null,nE.currentPopupAction=null}pollUserCancellation(){let e=()=>{if(this.authWindow?.window?.closed){this.pollId=window.setTimeout(()=>{this.pollId=null,this.reject(tu(this.auth,"popup-closed-by-user"))},8e3);return}this.pollId=window.setTimeout(e,nb.get())};e()}}nE.currentPopupAction=null;let nT=new Map;class nS extends nI{constructor(e,t,r=!1){super(e,["signInViaRedirect","linkViaRedirect","reauthViaRedirect","unknown"],t,void 0,r),this.eventId=null}async execute(){let e=nT.get(this.auth._key());if(!e){try{let t=await nC(this.resolver,this.auth)?await super.execute():null;e=()=>Promise.resolve(t)}catch(t){e=()=>Promise.reject(t)}nT.set(this.auth._key(),e)}return this.bypassAuthState||nT.set(this.auth._key(),()=>Promise.resolve(null)),e()}async onAuthEvent(e){if("signInViaRedirect"===e.type)return super.onAuthEvent(e);if("unknown"===e.type)return void this.resolve(null);if(e.eventId){let t=await this.auth._redirectUserForId(e.eventId);if(t)return this.user=t,super.onAuthEvent(e);this.resolve(null)}}async onExecution(){}cleanUp(){}}async function nC(e,t){var r;let n=t0("pendingRedirect",(r=t).config.apiKey,r.name),i=tX(e._redirectPersistence);if(!await i._isAvailable())return!1;let s=await i._get(n)==="true";return await i._remove(n),s}function nA(e,t){nT.set(e._key(),t)}async function nk(e,t,r=!1){if(ez(e.app))return Promise.reject(tc(e));let n=ei(e),i=t?tX(t):(tf(n._popupRedirectResolver,n,"argument-error"),n._popupRedirectResolver),s=new nS(n,i,r),a=await s.execute();return a&&!r&&(delete a.user._redirectEventId,await n._persistUserIfCurrent(a.user),await n._setRedirectUser(null,t)),a}class nx{constructor(e){this.auth=e,this.cachedEventUids=new Set,this.consumers=new Set,this.queuedRedirectEvent=null,this.hasHandledPotentialRedirect=!1,this.lastProcessedEventTime=Date.now()}registerConsumer(e){this.consumers.add(e),this.queuedRedirectEvent&&this.isEventForConsumer(this.queuedRedirectEvent,e)&&(this.sendToConsumer(this.queuedRedirectEvent,e),this.saveEventToCache(this.queuedRedirectEvent),this.queuedRedirectEvent=null)}unregisterConsumer(e){this.consumers.delete(e)}onEvent(e){if(this.hasEventBeenHandled(e))return!1;let t=!1;return this.consumers.forEach(r=>{this.isEventForConsumer(e,r)&&(t=!0,this.sendToConsumer(e,r),this.saveEventToCache(e))}),this.hasHandledPotentialRedirect||!function(e){switch(e.type){case"signInViaRedirect":case"linkViaRedirect":case"reauthViaRedirect":return!0;case"unknown":return nD(e);default:return!1}}(e)||(this.hasHandledPotentialRedirect=!0,t||(this.queuedRedirectEvent=e,t=!0)),t}sendToConsumer(e,t){if(e.error&&!nD(e)){let r=e.error.code?.split("auth/")[1]||"internal-error";t.onError(tu(this.auth,r))}else t.onAuthEvent(e)}isEventForConsumer(e,t){let r=null===t.eventId||!!e.eventId&&e.eventId===t.eventId;return t.filter.includes(e.type)&&r}hasEventBeenHandled(e){return Date.now()-this.lastProcessedEventTime>=6e5&&this.cachedEventUids.clear(),this.cachedEventUids.has(nN(e))}saveEventToCache(e){this.cachedEventUids.add(nN(e)),this.lastProcessedEventTime=Date.now()}}function nN(e){return[e.type,e.eventId,e.sessionId,e.tenantId].filter(e=>e).join("-")}function nD({type:e,error:t}){return"unknown"===e&&t?.code==="auth/no-auth-event"}async function nR(e,t={}){return tT(e,"GET","/v1/projects",t)}let nP=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,nO=/^https?/;async function nL(e){if(e.config.emulator)return;let{authorizedDomains:t}=await nR(e);for(let e of t)try{if(function(e){let t=tm(),{protocol:r,hostname:n}=new URL(t);if(e.startsWith("chrome-extension://")){let i=new URL(e);return""===i.hostname&&""===n?"chrome-extension:"===r&&e.replace("chrome-extension://","")===t.replace("chrome-extension://",""):"chrome-extension:"===r&&i.hostname===n}if(!nO.test(r))return!1;if(nP.test(e))return n===e;let i=e.replace(/\./g,"\\.");return RegExp("^(.+\\."+i+"|"+i+")$","i").test(n)}(e))return}catch{}tl(e,"unauthorized-domain")}let nM=new ty(3e4,6e4);function nF(){let e=r9().___jsl;if(e?.H){for(let t of Object.keys(e.H))if(e.H[t].r=e.H[t].r||[],e.H[t].L=e.H[t].L||[],e.H[t].r=[...e.H[t].L],e.CP)for(let t=0;t<e.CP.length;t++)e.CP[t]=null}}let nV=null,nU=new ty(5e3,15e3),nB={style:{position:"absolute",top:"-100px",width:"1px",height:"1px"},"aria-hidden":"true",tabindex:"-1"},nq=new Map([["identitytoolkit.googleapis.com","p"],["staging-identitytoolkit.sandbox.googleapis.com","s"],["test-identitytoolkit.sandbox.googleapis.com","t"]]);async function nj(e){let t,r,n,i,s,a=await (nV=nV||new Promise((t,r)=>{function n(){nF(),gapi.load("gapi.iframes",{callback:()=>{t(gapi.iframes.getContext())},ontimeout:()=>{nF(),r(tu(e,"network-request-failed"))},timeout:nM.get()})}if(r9().gapi?.iframes?.Iframe)t(gapi.iframes.getContext());else if(r9().gapi?.load)n();else{var i;let t=ru("iframefcb");return r9()[t]=()=>{gapi.load?n():r(tu(e,"network-request-failed"))},(i=`${rl.gapiScript}?onload=${t}`,rl.loadJS(i)).catch(e=>r(e))}}).catch(e=>{throw nV=null,e})),o=r9().gapi;return tf(o,e,"internal-error"),a.open({where:document.body,url:(tf((t=e.config).authDomain,e,"auth-domain-config-required"),r=t.emulator?tw(t,"emulator/auth/iframe"):`https://${e.config.authDomain}/__/auth/iframe`,n={apiKey:t.apiKey,appName:e.name,v:eQ},(i=nq.get(e.config.apiHost))&&(n.eid=i),(s=e._getFrameworks()).length&&(n.fw=s.join(",")),`${r}?${Z(n).slice(1)}`),messageHandlersFilter:o.iframes.CROSS_ORIGIN_IFRAMES_FILTER,attributes:nB,dontclear:!0},t=>new Promise(async(r,n)=>{await t.restyle({setHideOnLeave:!1});let i=tu(e,"network-request-failed"),s=r9().setTimeout(()=>{n(i)},nU.get());function a(){r9().clearTimeout(s),r(t)}t.ping(a).then(a,()=>{n(i)})}))}let nz={location:"yes",resizable:"yes",statusbar:"yes",toolbar:"no"};class n${constructor(e){this.window=e,this.associatedEvent=null}close(){if(this.window)try{this.window.close()}catch(e){}}}let nK=encodeURIComponent("fac");async function nG(e,t,r,n,i,s){tf(e.config.authDomain,e,"auth-domain-config-required"),tf(e.config.apiKey,e,"invalid-api-key");let a={apiKey:e.config.apiKey,appName:e.name,authType:r,redirectUrl:n,v:eQ,eventId:i};if(t instanceof rL)for(let[r,n]of(t.setDefaultLanguage(e.languageCode),a.providerId=t.providerId||"",!function(e){for(let t in e)if(Object.prototype.hasOwnProperty.call(e,t))return!1;return!0}(t.getCustomParameters())&&(a.customParameters=JSON.stringify(t.getCustomParameters())),Object.entries(s||{})))a[r]=n;if(t instanceof rM){let e=t.getScopes().filter(e=>""!==e);e.length>0&&(a.scopes=e.join(","))}for(let t of(e.tenantId&&(a.tid=e.tenantId),Object.keys(a)))void 0===a[t]&&delete a[t];let o=await e._getAppCheckToken(),l=o?`#${nK}=${encodeURIComponent(o)}`:"";return`${function({config:e}){return e.emulator?tw(e,"emulator/auth/handler"):`https://${e.authDomain}/__/auth/handler`}(e)}?${Z(a).slice(1)}${l}`}let nH="webStorageSupport",nW=class{constructor(){this.eventManagers={},this.iframes={},this.originValidationPromises={},this._redirectPersistence=r4,this._completeRedirectFn=nk,this._overrideRedirectResult=nA}async _openPopup(e,t,r,n){var i,s;i=this.eventManagers[e._key()]?.manager,s="_initialize() not called before _openPopup()",i||tp(s);let a=await nG(e,t,r,tm(),n);return function(e,t,r,n=500,i=600){let s=Math.max((window.screen.availHeight-i)/2,0).toString(),a=Math.max((window.screen.availWidth-n)/2,0).toString(),o="",l={...nz,width:n.toString(),height:i.toString(),top:s,left:a},u=j().toLowerCase();r&&(o=t4(u)?"_blank":r),t6(u)&&(t=t||"http://localhost",l.scrollbars="yes");let h=Object.entries(l).reduce((e,[t,r])=>`${e}${t}=${r},`,"");if(function(e=j()){return re(e)&&!!window.navigator?.standalone}(u)&&"_self"!==o){var c,d;let e,r;return c=t||"",d=o,(e=document.createElement("a")).href=c,e.target=d,(r=document.createEvent("MouseEvent")).initMouseEvent("click",!0,!0,window,1,0,0,0,0,!1,!1,!1,!1,1,null),e.dispatchEvent(r),new n$(null)}let f=window.open(t||"",o,h);tf(f,e,"popup-blocked");try{f.focus()}catch(e){}return new n$(f)}(e,a,r8())}async _openRedirect(e,t,r,n){var i;return await this._originValidation(e),i=await nG(e,t,r,tm(),n),r9().location.href=i,new Promise(()=>{})}_initialize(e){let t=e._key();if(this.eventManagers[t]){var r;let{manager:e,promise:n}=this.eventManagers[t];return e?Promise.resolve(e):(r="If manager is not set, promise should be",n||tp(r),n)}let n=this.initAndGetManager(e);return this.eventManagers[t]={promise:n},n.catch(()=>{delete this.eventManagers[t]}),n}async initAndGetManager(e){let t=await nj(e),r=new nx(e);return t.register("authEvent",t=>(tf(t?.authEvent,e,"invalid-auth-event"),{status:r.onEvent(t.authEvent)?"ACK":"ERROR"}),gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER),this.eventManagers[e._key()]={manager:r},this.iframes[e._key()]=t,r}_isIframeWebStorageSupported(e,t){this.iframes[e._key()].send(nH,{type:nH},r=>{let n=r?.[0]?.[nH];void 0!==n&&t(!!n),tl(e,"internal-error")},gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER)}_originValidation(e){let t=e._key();return this.originValidationPromises[t]||(this.originValidationPromises[t]=nL(e)),this.originValidationPromises[t]}get _shouldInitProactively(){return rt()||t3()||re()}};var nQ="@firebase/auth",nJ="1.12.0";class nY{constructor(e){this.auth=e,this.internalListeners=new Map}getUid(){return this.assertAuthConfigured(),this.auth.currentUser?.uid||null}async getToken(e){return(this.assertAuthConfigured(),await this.auth._initializationPromise,this.auth.currentUser)?{accessToken:await this.auth.currentUser.getIdToken(e)}:null}addAuthTokenListener(e){if(this.assertAuthConfigured(),this.internalListeners.has(e))return;let t=this.auth.onIdTokenChanged(t=>{e(t?.stsTokenManager.accessToken||null)});this.internalListeners.set(e,t),this.updateProactiveRefresh()}removeAuthTokenListener(e){this.assertAuthConfigured();let t=this.internalListeners.get(e);t&&(this.internalListeners.delete(e),t(),this.updateProactiveRefresh())}assertAuthConfigured(){tf(this.auth._initializationPromise,"dependent-sdk-initialized-before-auth")}updateProactiveRefresh(){this.internalListeners.size>0?this.auth._startProactiveRefresh():this.auth._stopProactiveRefresh()}}let nX=L("authIdTokenMaxAge")||300,nZ=null;rl={loadJS:e=>new Promise((t,r)=>{let n=document.createElement("script");n.setAttribute("src",e),n.onload=t,n.onerror=e=>{let t=tu("internal-error");t.customData=e,r(t)},n.type="text/javascript",n.charset="UTF-8",(document.getElementsByTagName("head")?.[0]??document).appendChild(n)}),gapiScript:"https://apis.google.com/js/api.js",recaptchaV2Script:"https://www.google.com/recaptcha/api.js",recaptchaEnterpriseScript:"https://www.google.com/recaptcha/enterprise.js?render="},s="Browser",eV(new es("auth",(e,{options:t})=>{let r,n,i=e.getProvider("app").getImmediate(),a=e.getProvider("heartbeat"),o=e.getProvider("app-check-internal"),{apiKey:l,authDomain:u}=i.options;tf(l&&!l.includes(":"),"invalid-api-key",{appName:i.name});let h=new ra(i,a,o,{apiKey:l,authDomain:u,clientPlatform:s,apiHost:"identitytoolkit.googleapis.com",tokenApiHost:"securetoken.googleapis.com",apiScheme:"https",sdkClientVersion:rr(s)});return n=(Array.isArray(r=t?.persistence||[])?r:[r]).map(tX),t?.errorMap&&h._updateErrorMap(t.errorMap),h._initializeWithPersistence(n,t?.popupRedirectResolver),h},"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((e,t,r)=>{e.getProvider("auth-internal").initialize()})),eV(new es("auth-internal",e=>new nY(ei(e.getProvider("auth").getImmediate())),"PRIVATE").setInstantiationMode("EXPLICIT")),e1(nQ,nJ,function(e){switch(e){case"Node":return"node";case"ReactNative":return"rn";case"Worker":return"webworker";case"Cordova":return"cordova";case"WebExtension":return"web-extension";default:return}}(s)),e1(nQ,nJ,"esm2020"),e.s([],58556),e.i(58556),e1("firebase","12.9.0","app"),e.i(92953);var n0=e.i(67034),n1="u">typeof globalThis?globalThis:"u">typeof window?window:e.g,n2={};(function(){function e(){this.blockSize=-1,this.blockSize=64,this.g=[,,,,],this.C=Array(this.blockSize),this.o=this.h=0,this.u()}var t=function(){this.blockSize=-1};function r(){}function n(e,t,r){r||(r=0);let n=Array(16);if("string"==typeof t)for(var i=0;i<16;++i)n[i]=t.charCodeAt(r++)|t.charCodeAt(r++)<<8|t.charCodeAt(r++)<<16|t.charCodeAt(r++)<<24;else for(i=0;i<16;++i)n[i]=t[r++]|t[r++]<<8|t[r++]<<16|t[r++]<<24;t=e.g[0],r=e.g[1],i=e.g[2];let s=e.g[3],a;a=t+(s^r&(i^s))+n[0]+0xd76aa478|0,a=s+(i^(t=r+(a<<7|a>>>25))&(r^i))+n[1]+0xe8c7b756|0,a=i+(r^(s=t+(a<<12|a>>>20))&(t^r))+n[2]+0x242070db|0,a=r+(t^(i=s+(a<<17|a>>>15))&(s^t))+n[3]+0xc1bdceee|0,a=t+(s^(r=i+(a<<22|a>>>10))&(i^s))+n[4]+0xf57c0faf|0,a=s+(i^(t=r+(a<<7|a>>>25))&(r^i))+n[5]+0x4787c62a|0,a=i+(r^(s=t+(a<<12|a>>>20))&(t^r))+n[6]+0xa8304613|0,a=r+(t^(i=s+(a<<17|a>>>15))&(s^t))+n[7]+0xfd469501|0,a=t+(s^(r=i+(a<<22|a>>>10))&(i^s))+n[8]+0x698098d8|0,a=s+(i^(t=r+(a<<7|a>>>25))&(r^i))+n[9]+0x8b44f7af|0,a=i+(r^(s=t+(a<<12|a>>>20))&(t^r))+n[10]+0xffff5bb1|0,a=r+(t^(i=s+(a<<17|a>>>15))&(s^t))+n[11]+0x895cd7be|0,a=t+(s^(r=i+(a<<22|a>>>10))&(i^s))+n[12]+0x6b901122|0,a=s+(i^(t=r+(a<<7|a>>>25))&(r^i))+n[13]+0xfd987193|0,a=i+(r^(s=t+(a<<12|a>>>20))&(t^r))+n[14]+0xa679438e|0,a=r+(t^(i=s+(a<<17|a>>>15))&(s^t))+n[15]+0x49b40821|0,r=i+(a<<22|a>>>10),a=t+(i^s&(r^i))+n[1]+0xf61e2562|0,t=r+(a<<5|a>>>27),a=s+(r^i&(t^r))+n[6]+0xc040b340|0,s=t+(a<<9|a>>>23),a=i+(t^r&(s^t))+n[11]+0x265e5a51|0,i=s+(a<<14|a>>>18),a=r+(s^t&(i^s))+n[0]+0xe9b6c7aa|0,r=i+(a<<20|a>>>12),a=t+(i^s&(r^i))+n[5]+0xd62f105d|0,t=r+(a<<5|a>>>27),a=s+(r^i&(t^r))+n[10]+0x2441453|0,s=t+(a<<9|a>>>23),a=i+(t^r&(s^t))+n[15]+0xd8a1e681|0,i=s+(a<<14|a>>>18),a=r+(s^t&(i^s))+n[4]+0xe7d3fbc8|0,r=i+(a<<20|a>>>12),a=t+(i^s&(r^i))+n[9]+0x21e1cde6|0,t=r+(a<<5|a>>>27),a=s+(r^i&(t^r))+n[14]+0xc33707d6|0,s=t+(a<<9|a>>>23),a=i+(t^r&(s^t))+n[3]+0xf4d50d87|0,i=s+(a<<14|a>>>18),a=r+(s^t&(i^s))+n[8]+0x455a14ed|0,r=i+(a<<20|a>>>12),a=t+(i^s&(r^i))+n[13]+0xa9e3e905|0,t=r+(a<<5|a>>>27),a=s+(r^i&(t^r))+n[2]+0xfcefa3f8|0,s=t+(a<<9|a>>>23),a=i+(t^r&(s^t))+n[7]+0x676f02d9|0,i=s+(a<<14|a>>>18),a=r+(s^t&(i^s))+n[12]+0x8d2a4c8a|0,a=t+((r=i+(a<<20|a>>>12))^i^s)+n[5]+0xfffa3942|0,a=s+((t=r+(a<<4|a>>>28))^r^i)+n[8]+0x8771f681|0,a=i+((s=t+(a<<11|a>>>21))^t^r)+n[11]+0x6d9d6122|0,a=r+((i=s+(a<<16|a>>>16))^s^t)+n[14]+0xfde5380c|0,a=t+((r=i+(a<<23|a>>>9))^i^s)+n[1]+0xa4beea44|0,a=s+((t=r+(a<<4|a>>>28))^r^i)+n[4]+0x4bdecfa9|0,a=i+((s=t+(a<<11|a>>>21))^t^r)+n[7]+0xf6bb4b60|0,a=r+((i=s+(a<<16|a>>>16))^s^t)+n[10]+0xbebfbc70|0,a=t+((r=i+(a<<23|a>>>9))^i^s)+n[13]+0x289b7ec6|0,a=s+((t=r+(a<<4|a>>>28))^r^i)+n[0]+0xeaa127fa|0,a=i+((s=t+(a<<11|a>>>21))^t^r)+n[3]+0xd4ef3085|0,a=r+((i=s+(a<<16|a>>>16))^s^t)+n[6]+0x4881d05|0,a=t+((r=i+(a<<23|a>>>9))^i^s)+n[9]+0xd9d4d039|0,a=s+((t=r+(a<<4|a>>>28))^r^i)+n[12]+0xe6db99e5|0,a=i+((s=t+(a<<11|a>>>21))^t^r)+n[15]+0x1fa27cf8|0,a=r+((i=s+(a<<16|a>>>16))^s^t)+n[2]+0xc4ac5665|0,r=i+(a<<23|a>>>9),a=t+(i^(r|~s))+n[0]+0xf4292244|0,t=r+(a<<6|a>>>26),a=s+(r^(t|~i))+n[7]+0x432aff97|0,s=t+(a<<10|a>>>22),a=i+(t^(s|~r))+n[14]+0xab9423a7|0,i=s+(a<<15|a>>>17),a=r+(s^(i|~t))+n[5]+0xfc93a039|0,r=i+(a<<21|a>>>11),a=t+(i^(r|~s))+n[12]+0x655b59c3|0,t=r+(a<<6|a>>>26),a=s+(r^(t|~i))+n[3]+0x8f0ccc92|0,s=t+(a<<10|a>>>22),a=i+(t^(s|~r))+n[10]+0xffeff47d|0,i=s+(a<<15|a>>>17),a=r+(s^(i|~t))+n[1]+0x85845dd1|0,r=i+(a<<21|a>>>11),a=t+(i^(r|~s))+n[8]+0x6fa87e4f|0,t=r+(a<<6|a>>>26),a=s+(r^(t|~i))+n[15]+0xfe2ce6e0|0,s=t+(a<<10|a>>>22),a=i+(t^(s|~r))+n[6]+0xa3014314|0,i=s+(a<<15|a>>>17),a=r+(s^(i|~t))+n[13]+0x4e0811a1|0,r=i+(a<<21|a>>>11),a=t+(i^(r|~s))+n[4]+0xf7537e82|0,t=r+(a<<6|a>>>26),a=s+(r^(t|~i))+n[11]+0xbd3af235|0,s=t+(a<<10|a>>>22),a=i+(t^(s|~r))+n[2]+0x2ad7d2bb|0,i=s+(a<<15|a>>>17),a=r+(s^(i|~t))+n[9]+0xeb86d391|0,e.g[0]=e.g[0]+t|0,e.g[1]=e.g[1]+(i+(a<<21|a>>>11))|0,e.g[2]=e.g[2]+i|0,e.g[3]=e.g[3]+s|0}function i(e,t){this.h=t;let r=[],n=!0;for(let i=e.length-1;i>=0;i--){let s=0|e[i];n&&s==t||(r[i]=s,n=!1)}this.g=r}r.prototype=t.prototype,e.F=t.prototype,e.prototype=new r,e.prototype.constructor=e,e.D=function(e,r,n){for(var i=Array(arguments.length-2),s=2;s<arguments.length;s++)i[s-2]=arguments[s];return t.prototype[r].apply(e,i)},e.prototype.u=function(){this.g[0]=0x67452301,this.g[1]=0xefcdab89,this.g[2]=0x98badcfe,this.g[3]=0x10325476,this.o=this.h=0},e.prototype.v=function(e,t){void 0===t&&(t=e.length);let r=t-this.blockSize,i=this.C,s=this.h,a=0;for(;a<t;){if(0==s)for(;a<=r;)n(this,e,a),a+=this.blockSize;if("string"==typeof e){for(;a<t;)if(i[s++]=e.charCodeAt(a++),s==this.blockSize){n(this,i),s=0;break}}else for(;a<t;)if(i[s++]=e[a++],s==this.blockSize){n(this,i),s=0;break}}this.h=s,this.o+=t},e.prototype.A=function(){var e=Array((this.h<56?this.blockSize:2*this.blockSize)-this.h);e[0]=128;for(var t=1;t<e.length-8;++t)e[t]=0;t=8*this.o;for(var r=e.length-8;r<e.length;++r)e[r]=255&t,t/=256;for(this.v(e),e=Array(16),t=0,r=0;r<4;++r)for(let n=0;n<32;n+=8)e[t++]=this.g[r]>>>n&255;return e};var s,a={};function u(e){var t;return -128<=e&&e<128?(t=function(e){return new i([0|e],e<0?-1:0)},Object.prototype.hasOwnProperty.call(a,e)?a[e]:a[e]=t(e)):new i([0|e],e<0?-1:0)}function h(e){if(isNaN(e)||!isFinite(e))return c;if(e<0)return g(h(-e));let t=[],r=1;for(let n=0;e>=r;n++)t[n]=e/r|0,r*=0x100000000;return new i(t,0)}var c=u(0),d=u(1),f=u(0x1000000);function p(e){if(0!=e.h)return!1;for(let t=0;t<e.g.length;t++)if(0!=e.g[t])return!1;return!0}function m(e){return -1==e.h}function g(e){let t=e.g.length,r=[];for(let n=0;n<t;n++)r[n]=~e.g[n];return new i(r,~e.h).add(d)}function y(e,t){return e.add(g(t))}function w(e,t){for(;(65535&e[t])!=e[t];)e[t+1]+=e[t]>>>16,e[t]&=65535,t++}function v(e,t){this.g=e,this.h=t}function _(e,t){if(p(t))throw Error("division by zero");if(p(e))return new v(c,c);if(m(e))return t=_(g(e),t),new v(g(t.g),g(t.h));if(m(t))return t=_(e,g(t)),new v(g(t.g),t.h);if(e.g.length>30){if(m(e)||m(t))throw Error("slowDivide_ only works with positive integers.");for(var r=d,n=t;0>=n.l(e);)r=I(r),n=I(n);var i=b(r,1),s=b(n,1);for(n=b(n,2),r=b(r,2);!p(n);){var a=s.add(n);0>=a.l(e)&&(i=i.add(r),s=a),n=b(n,1),r=b(r,1)}return t=y(e,i.j(t)),new v(i,t)}for(i=c;e.l(t)>=0;){for(n=(n=Math.ceil(Math.log(r=Math.max(1,Math.floor(e.m()/t.m())))/Math.LN2))<=48?1:Math.pow(2,n-48),a=(s=h(r)).j(t);m(a)||a.l(e)>0;)r-=n,a=(s=h(r)).j(t);p(s)&&(s=d),i=i.add(s),e=y(e,a)}return new v(i,e)}function I(e){let t=e.g.length+1,r=[];for(let n=0;n<t;n++)r[n]=e.i(n)<<1|e.i(n-1)>>>31;return new i(r,e.h)}function b(e,t){let r=t>>5;t%=32;let n=e.g.length-r,s=[];for(let i=0;i<n;i++)s[i]=t>0?e.i(i+r)>>>t|e.i(i+r+1)<<32-t:e.i(i+r);return new i(s,e.h)}(s=i.prototype).m=function(){if(m(this))return-g(this).m();let e=0,t=1;for(let r=0;r<this.g.length;r++){let n=this.i(r);e+=(n>=0?n:0x100000000+n)*t,t*=0x100000000}return e},s.toString=function(e){if((e=e||10)<2||36<e)throw Error("radix out of range: "+e);if(p(this))return"0";if(m(this))return"-"+g(this).toString(e);let t=h(Math.pow(e,6));var r=this;let n="";for(;;){let i=_(r,t).g,s=(((r=y(r,i.j(t))).g.length>0?r.g[0]:r.h)>>>0).toString(e);if(p(r=i))return s+n;for(;s.length<6;)s="0"+s;n=s+n}},s.i=function(e){return e<0?0:e<this.g.length?this.g[e]:this.h},s.l=function(e){return m(e=y(this,e))?-1:+!p(e)},s.abs=function(){return m(this)?g(this):this},s.add=function(e){let t=Math.max(this.g.length,e.g.length),r=[],n=0;for(let i=0;i<=t;i++){let t=n+(65535&this.i(i))+(65535&e.i(i)),s=(t>>>16)+(this.i(i)>>>16)+(e.i(i)>>>16);n=s>>>16,t&=65535,s&=65535,r[i]=s<<16|t}return new i(r,-0x80000000&r[r.length-1]?-1:0)},s.j=function(e){if(p(this)||p(e))return c;if(m(this))return m(e)?g(this).j(g(e)):g(g(this).j(e));if(m(e))return g(this.j(g(e)));if(0>this.l(f)&&0>e.l(f))return h(this.m()*e.m());let t=this.g.length+e.g.length,r=[];for(var n=0;n<2*t;n++)r[n]=0;for(n=0;n<this.g.length;n++)for(let t=0;t<e.g.length;t++){let i=this.i(n)>>>16,s=65535&this.i(n),a=e.i(t)>>>16,o=65535&e.i(t);r[2*n+2*t]+=s*o,w(r,2*n+2*t),r[2*n+2*t+1]+=i*o,w(r,2*n+2*t+1),r[2*n+2*t+1]+=s*a,w(r,2*n+2*t+1),r[2*n+2*t+2]+=i*a,w(r,2*n+2*t+2)}for(e=0;e<t;e++)r[e]=r[2*e+1]<<16|r[2*e];for(e=t;e<2*t;e++)r[e]=0;return new i(r,0)},s.B=function(e){return _(this,e).h},s.and=function(e){let t=Math.max(this.g.length,e.g.length),r=[];for(let n=0;n<t;n++)r[n]=this.i(n)&e.i(n);return new i(r,this.h&e.h)},s.or=function(e){let t=Math.max(this.g.length,e.g.length),r=[];for(let n=0;n<t;n++)r[n]=this.i(n)|e.i(n);return new i(r,this.h|e.h)},s.xor=function(e){let t=Math.max(this.g.length,e.g.length),r=[];for(let n=0;n<t;n++)r[n]=this.i(n)^e.i(n);return new i(r,this.h^e.h)},e.prototype.digest=e.prototype.A,e.prototype.reset=e.prototype.u,e.prototype.update=e.prototype.v,l=n2.Md5=e,i.prototype.add=i.prototype.add,i.prototype.multiply=i.prototype.j,i.prototype.modulo=i.prototype.B,i.prototype.compare=i.prototype.l,i.prototype.toNumber=i.prototype.m,i.prototype.toString=i.prototype.toString,i.prototype.getBits=i.prototype.i,i.fromNumber=h,i.fromString=function e(t,r){if(0==t.length)throw Error("number format error: empty string");if((r=r||10)<2||36<r)throw Error("radix out of range: "+r);if("-"==t.charAt(0))return g(e(t.substring(1),r));if(t.indexOf("-")>=0)throw Error('number format error: interior "-" character');let n=h(Math.pow(r,8)),i=c;for(let e=0;e<t.length;e+=8){var s=Math.min(8,t.length-e);let a=parseInt(t.substring(e,e+s),r);s<8?(s=h(Math.pow(r,s)),i=i.j(s).add(h(a))):i=(i=i.j(n)).add(h(a))}return i},o=n2.Integer=i}).apply(void 0!==n1?n1:"u">typeof self?self:"u">typeof window?window:{});var n6="u">typeof globalThis?globalThis:"u">typeof window?window:e.g,n3={};(function(){var e,t,r=Object.defineProperty,n=function(e){e=["object"==typeof globalThis&&globalThis,e,"object"==typeof window&&window,"object"==typeof self&&self,"object"==typeof n6&&n6];for(var t=0;t<e.length;++t){var r=e[t];if(r&&r.Math==Math)return r}throw Error("Cannot find global object")}(this);function i(e,t){if(t)e:{var i=n;e=e.split(".");for(var s=0;s<e.length-1;s++){var a=e[s];if(!(a in i))break e;i=i[a]}(t=t(s=i[e=e[e.length-1]]))!=s&&null!=t&&r(i,e,{configurable:!0,writable:!0,value:t})}}i("Symbol.dispose",function(e){return e||Symbol("Symbol.dispose")}),i("Array.prototype.values",function(e){return e||function(){return this[Symbol.iterator]()}}),i("Object.entries",function(e){return e||function(e){var t,r=[];for(t in e)Object.prototype.hasOwnProperty.call(e,t)&&r.push([t,e[t]]);return r}});var s=s||{},a=this||self;function o(e){var t=typeof e;return"object"==t&&null!=e||"function"==t}function l(e,t,r){return e.call.apply(e.bind,arguments)}function y(e,t,r){return(y=l).apply(null,arguments)}function w(e,t){var r=Array.prototype.slice.call(arguments,1);return function(){var t=r.slice();return t.push.apply(t,arguments),e.apply(this,t)}}function v(e,t){function r(){}r.prototype=t.prototype,e.Z=t.prototype,e.prototype=new r,e.prototype.constructor=e,e.Ob=function(e,r,n){for(var i=Array(arguments.length-2),s=2;s<arguments.length;s++)i[s-2]=arguments[s];return t.prototype[r].apply(e,i)}}var _="u">typeof AsyncContext&&"function"==typeof AsyncContext.Snapshot?e=>e&&AsyncContext.Snapshot.wrap(e):e=>e;function I(e){let t=e.length;if(t>0){let r=Array(t);for(let n=0;n<t;n++)r[n]=e[n];return r}return[]}function b(e,t){for(let t=1;t<arguments.length;t++){let n=arguments[t];var r=typeof n;if("array"==(r="object"!=r?r:n?Array.isArray(n)?"array":r:"null")||"object"==r&&"number"==typeof n.length){r=e.length||0;let t=n.length||0;e.length=r+t;for(let i=0;i<t;i++)e[r+i]=n[i]}else e.push(n)}}var E=new class{constructor(e,t){this.i=e,this.j=t,this.h=0,this.g=null}get(){let e;return this.h>0?(this.h--,e=this.g,this.g=e.next,e.next=null):e=this.i(),e}}(()=>new T,e=>e.reset());class T{constructor(){this.next=this.g=this.h=null}set(e,t){this.h=e,this.g=t,this.next=null}reset(){this.next=this.g=this.h=null}}let S,C=!1,A=new class{constructor(){this.h=this.g=null}add(e,t){let r=E.get();r.set(e,t),this.h?this.h.next=r:this.g=r,this.h=r}},k=()=>{let e=Promise.resolve(void 0);S=()=>{e.then(x)}};function x(){let e;for(var t;e=null,A.g&&(e=A.g,A.g=A.g.next,A.g||(A.h=null),e.next=null),t=e;){try{t.h.call(t.g)}catch(e){!function(e){a.setTimeout(()=>{throw e},0)}(e)}E.j(t),E.h<100&&(E.h++,t.next=E.g,E.g=t)}C=!1}function N(){this.u=this.u,this.C=this.C}function D(e,t){this.type=e,this.g=this.target=t,this.defaultPrevented=!1}N.prototype.u=!1,N.prototype.dispose=function(){this.u||(this.u=!0,this.N())},N.prototype[Symbol.dispose]=function(){this.dispose()},N.prototype.N=function(){if(this.C)for(;this.C.length;)this.C.shift()()},D.prototype.h=function(){this.defaultPrevented=!0};var R=function(){if(!a.addEventListener||!Object.defineProperty)return!1;var e=!1,t=Object.defineProperty({},"passive",{get:function(){e=!0}});try{let e=()=>{};a.addEventListener("test",e,t),a.removeEventListener("test",e,t)}catch(e){}return e}();function P(e){return/^[\s\xa0]*$/.test(e)}function O(e,t){D.call(this,e?e.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,e&&this.init(e,t)}v(O,D),O.prototype.init=function(e,t){let r=this.type=e.type,n=e.changedTouches&&e.changedTouches.length?e.changedTouches[0]:null;this.target=e.target||e.srcElement,this.g=t,(t=e.relatedTarget)||("mouseover"==r?t=e.fromElement:"mouseout"==r&&(t=e.toElement)),this.relatedTarget=t,n?(this.clientX=void 0!==n.clientX?n.clientX:n.pageX,this.clientY=void 0!==n.clientY?n.clientY:n.pageY,this.screenX=n.screenX||0,this.screenY=n.screenY||0):(this.clientX=void 0!==e.clientX?e.clientX:e.pageX,this.clientY=void 0!==e.clientY?e.clientY:e.pageY,this.screenX=e.screenX||0,this.screenY=e.screenY||0),this.button=e.button,this.key=e.key||"",this.ctrlKey=e.ctrlKey,this.altKey=e.altKey,this.shiftKey=e.shiftKey,this.metaKey=e.metaKey,this.pointerId=e.pointerId||0,this.pointerType=e.pointerType,this.state=e.state,this.i=e,e.defaultPrevented&&O.Z.h.call(this)},O.prototype.h=function(){O.Z.h.call(this);let e=this.i;e.preventDefault?e.preventDefault():e.returnValue=!1};var L="closure_listenable_"+(1e6*Math.random()|0),M=0;function F(e,t,r,n,i){this.listener=e,this.proxy=null,this.src=t,this.type=r,this.capture=!!n,this.ha=i,this.key=++M,this.da=this.fa=!1}function V(e){e.da=!0,e.listener=null,e.proxy=null,e.src=null,e.ha=null}function U(e,t,r){for(let n in e)t.call(r,e[n],n,e)}function B(e){let t={};for(let r in e)t[r]=e[r];return t}let q="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function j(e,t){let r,n;for(let t=1;t<arguments.length;t++){for(r in n=arguments[t])e[r]=n[r];for(let t=0;t<q.length;t++)r=q[t],Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}}function z(e){this.src=e,this.g={},this.h=0}function $(e,t){let r=t.type;if(r in e.g){var n,i=e.g[r],s=Array.prototype.indexOf.call(i,t,void 0);(n=s>=0)&&Array.prototype.splice.call(i,s,1),n&&(V(t),0==e.g[r].length&&(delete e.g[r],e.h--))}}function K(e,t,r,n){for(let i=0;i<e.length;++i){let s=e[i];if(!s.da&&s.listener==t&&!!r==s.capture&&s.ha==n)return i}return -1}z.prototype.add=function(e,t,r,n,i){let s=e.toString();(e=this.g[s])||(e=this.g[s]=[],this.h++);let a=K(e,t,n,i);return a>-1?(t=e[a],r||(t.fa=!1)):((t=new F(t,this.src,s,!!n,i)).fa=r,e.push(t)),t};var G="closure_lm_"+(1e6*Math.random()|0),H={};function W(e,t,r,n,i,s){if(!t)throw Error("Invalid event type");let a=o(i)?!!i.capture:!!i,l=X(e);if(l||(e[G]=l=new z(e)),(r=l.add(t,r,n,a,s)).proxy)return r;if(n=function e(t){return Y.call(e.src,e.listener,t)},r.proxy=n,n.src=e,n.listener=r,e.addEventListener)R||(i=a),void 0===i&&(i=!1),e.addEventListener(t.toString(),n,i);else if(e.attachEvent)e.attachEvent(J(t.toString()),n);else if(e.addListener&&e.removeListener)e.addListener(n);else throw Error("addEventListener and attachEvent are unavailable.");return r}function Q(e){if("number"!=typeof e&&e&&!e.da){var t=e.src;if(t&&t[L])$(t.i,e);else{var r=e.type,n=e.proxy;t.removeEventListener?t.removeEventListener(r,n,e.capture):t.detachEvent?t.detachEvent(J(r),n):t.addListener&&t.removeListener&&t.removeListener(n),(r=X(t))?($(r,e),0==r.h&&(r.src=null,t[G]=null)):V(e)}}}function J(e){return e in H?H[e]:H[e]="on"+e}function Y(e,t){if(e.da)e=!0;else{t=new O(t,this);let r=e.listener,n=e.ha||e.src;e.fa&&Q(e),e=r.call(n,t)}return e}function X(e){return(e=e[G])instanceof z?e:null}var Z="__closure_events_fn_"+(1e9*Math.random()>>>0);function ee(e){return"function"==typeof e?e:(e[Z]||(e[Z]=function(t){return e.handleEvent(t)}),e[Z])}function et(){N.call(this),this.i=new z(this),this.M=this,this.G=null}function er(e,t){let r,n;var i,s=e.G;if(s)for(i=[];s;s=s.G)i.push(s);if(e=e.M,s=t.type||t,"string"==typeof t)t=new D(t,e);else if(t instanceof D)t.target=t.target||e;else{var a=t;j(t=new D(s,e),a)}if(a=!0,i)for(n=i.length-1;n>=0;n--)a=en(r=t.g=i[n],s,!0,t)&&a;if(a=en(r=t.g=e,s,!0,t)&&a,a=en(r,s,!1,t)&&a,i)for(n=0;n<i.length;n++)a=en(r=t.g=i[n],s,!1,t)&&a}function en(e,t,r,n){if(!(t=e.i.g[String(t)]))return!0;t=t.concat();let i=!0;for(let s=0;s<t.length;++s){let a=t[s];if(a&&!a.da&&a.capture==r){let t=a.listener,r=a.ha||a.src;a.fa&&$(e.i,a),i=!1!==t.call(r,n)&&i}}return i&&!n.defaultPrevented}v(et,N),et.prototype[L]=!0,et.prototype.removeEventListener=function(e,t,r,n){!function e(t,r,n,i,s){if(Array.isArray(r))for(var a=0;a<r.length;a++)e(t,r[a],n,i,s);else(i=o(i)?!!i.capture:!!i,n=ee(n),t&&t[L])?(t=t.i,(a=String(r).toString())in t.g&&(n=K(r=t.g[a],n,i,s))>-1&&(V(r[n]),Array.prototype.splice.call(r,n,1),0==r.length&&(delete t.g[a],t.h--))):t&&(t=X(t))&&(r=t.g[r.toString()],t=-1,r&&(t=K(r,n,i,s)),(n=t>-1?r[t]:null)&&Q(n))}(this,e,t,r,n)},et.prototype.N=function(){if(et.Z.N.call(this),this.i){var e=this.i;for(let t in e.g){let r=e.g[t];for(let e=0;e<r.length;e++)V(r[e]);delete e.g[t],e.h--}}this.G=null},et.prototype.J=function(e,t,r,n){return this.i.add(String(e),t,!1,r,n)},et.prototype.K=function(e,t,r,n){return this.i.add(String(e),t,!0,r,n)};class ei extends N{constructor(e,t){super(),this.m=e,this.l=t,this.h=null,this.i=!1,this.g=null}j(e){this.h=arguments,this.g?this.i=!0:function e(t){t.g=function(e,t){if("function"!=typeof e)if(e&&"function"==typeof e.handleEvent)e=y(e.handleEvent,e);else throw Error("Invalid listener argument");return Number(t)>0x7fffffff?-1:a.setTimeout(e,t||0)}(()=>{t.g=null,t.i&&(t.i=!1,e(t))},t.l);let r=t.h;t.h=null,t.m.apply(null,r)}(this)}N(){super.N(),this.g&&(a.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function es(e){N.call(this),this.h=e,this.g={}}v(es,N);var ea=[];function eo(e){U(e.g,function(e,t){this.g.hasOwnProperty(t)&&Q(e)},e),e.g={}}es.prototype.N=function(){es.Z.N.call(this),eo(this)},es.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};var el=a.JSON.stringify,eu=a.JSON.parse,eh=class{stringify(e){return a.JSON.stringify(e,void 0)}parse(e){return a.JSON.parse(e,void 0)}};function ec(){}function ed(){}var ef={OPEN:"a",hb:"b",ERROR:"c",tb:"d"};function ep(){D.call(this,"d")}function em(){D.call(this,"c")}v(ep,D),v(em,D);var eg={},ey=null;function ew(){return ey=ey||new et}function ev(e){D.call(this,eg.Ia,e)}function e_(e){let t=ew();er(t,new ev(t))}function eI(e,t){D.call(this,eg.STAT_EVENT,e),this.stat=t}function eb(e){let t=ew();er(t,new eI(t,e))}function eE(e,t){D.call(this,eg.Ja,e),this.size=t}function eT(e,t){if("function"!=typeof e)throw Error("Fn must not be null and must be a function");return a.setTimeout(function(){e()},t)}function eS(){this.g=!0}function eC(e,t,r,n){e.info(function(){return"XMLHTTP TEXT ("+t+"): "+function(e,t){if(!e.g)return t;if(!t)return null;try{let s=JSON.parse(t);if(s){for(e=0;e<s.length;e++)if(Array.isArray(s[e])){var r=s[e];if(!(r.length<2)){var n=r[1];if(Array.isArray(n)&&!(n.length<1)){var i=n[0];if("noop"!=i&&"stop"!=i&&"close"!=i)for(let e=1;e<n.length;e++)n[e]=""}}}}return el(s)}catch(e){return t}}(e,r)+(n?" "+n:"")})}eg.Ia="serverreachability",v(ev,D),eg.STAT_EVENT="statevent",v(eI,D),eg.Ja="timingevent",v(eE,D),eS.prototype.ua=function(){this.g=!1},eS.prototype.info=function(){};var eA={NO_ERROR:0,cb:1,qb:2,pb:3,kb:4,ob:5,rb:6,Ga:7,TIMEOUT:8,ub:9},ek={ib:"complete",Fb:"success",ERROR:"error",Ga:"abort",xb:"ready",yb:"readystatechange",TIMEOUT:"timeout",sb:"incrementaldata",wb:"progress",lb:"downloadprogress",Nb:"uploadprogress"};function ex(){}function eN(e){return encodeURIComponent(String(e))}function eD(e,t,r,n){this.j=e,this.i=t,this.l=r,this.S=n||1,this.V=new es(this),this.H=45e3,this.J=null,this.o=!1,this.u=this.B=this.A=this.M=this.F=this.T=this.D=null,this.G=[],this.g=null,this.C=0,this.m=this.v=null,this.X=-1,this.K=!1,this.P=0,this.O=null,this.W=this.L=this.U=this.R=!1,this.h=new eR}function eR(){this.i=null,this.g="",this.h=!1}v(ex,ec),ex.prototype.g=function(){return new XMLHttpRequest},e=new ex;var eP={},eO={};function eL(e,t,r){e.M=1,e.A=e4(e0(t)),e.u=r,e.R=!0,eM(e,null)}function eM(e,t){e.F=Date.now(),eV(e),e.B=e0(e.A);var r,n,i,s,a,l,u=e.B,h=e.S;Array.isArray(h)||(h=[String(h)]),tu(u.i,"t",h),e.C=0,u=e.j.L,e.h=new eR,e.g=tQ(e.j,u?t:null,!e.u),e.P>0&&(e.O=new ei(y(e.Y,e,e.g),e.P)),t=e.V,u=e.g,h=e.ba;var c="readystatechange";Array.isArray(c)||(c&&(ea[0]=c.toString()),c=ea);for(let e=0;e<c.length;e++){let r=function e(t,r,n,i,s){if(i&&i.once)return function e(t,r,n,i,s){if(Array.isArray(r)){for(let a=0;a<r.length;a++)e(t,r[a],n,i,s);return null}return n=ee(n),t&&t[L]?t.K(r,n,o(i)?!!i.capture:!!i,s):W(t,r,n,!0,i,s)}(t,r,n,i,s);if(Array.isArray(r)){for(let a=0;a<r.length;a++)e(t,r[a],n,i,s);return null}return n=ee(n),t&&t[L]?t.J(r,n,o(i)?!!i.capture:!!i,s):W(t,r,n,!1,i,s)}(u,c[e],h||t.handleEvent,!1,t.h||t);if(!r)break;t.g[r.key]=r}t=e.J?B(e.J):{},e.u?(e.v||(e.v="POST"),t["Content-Type"]="application/x-www-form-urlencoded",e.g.ea(e.B,e.v,e.u,t)):(e.v="GET",e.g.ea(e.B,e.v,null,t)),e_(),r=e.i,n=e.v,i=e.B,s=e.l,a=e.S,l=e.u,r.info(function(){if(r.g)if(l){var e="",t=l.split("&");for(let r=0;r<t.length;r++){var o=t[r].split("=");if(o.length>1){let t=o[0];o=o[1];let r=t.split("_");e=r.length>=2&&"type"==r[1]?e+(t+"=")+o+"&":e+(t+"=redacted&")}}}else e=null;else e=l;return"XMLHTTP REQ ("+s+") [attempt "+a+"]: "+n+"\n"+i+"\n"+e})}function eF(e){return!!e.g&&"GET"==e.v&&2!=e.M&&e.j.Aa}function eV(e){e.T=Date.now()+e.H,eU(e,e.H)}function eU(e,t){if(null!=e.D)throw Error("WatchDog timer not null");e.D=eT(y(e.aa,e),t)}function eB(e){e.D&&(a.clearTimeout(e.D),e.D=null)}function eq(e){0==e.j.I||e.K||t$(e.j,e)}function ej(e){eB(e);var t=e.O;t&&"function"==typeof t.dispose&&t.dispose(),e.O=null,eo(e.V),e.g&&(t=e.g,e.g=null,t.abort(),t.dispose())}function ez(e,t){try{var r=e.j;if(0!=r.I&&(r.g==e||eW(r.h,e))){if(!e.L&&eW(r.h,e)&&3==r.I){try{var n=r.Ba.g.parse(t)}catch(e){n=null}if(Array.isArray(n)&&3==n.length){var i=n;if(0==i[0]){e:if(!r.v){if(r.g)if(r.g.F+3e3<e.F)tz(r),tP(r);else break e;tB(r),eb(18)}}else r.xa=i[1],0<r.xa-r.K&&i[2]<37500&&r.F&&0==r.A&&!r.C&&(r.C=eT(y(r.Va,r),6e3));1>=eH(r.h)&&r.ta&&(r.ta=void 0)}else tG(r,11)}else if((e.L||r.g==e)&&tz(r),!P(t))for(i=r.Ba.g.parse(t),t=0;t<i.length;t++){let o=i[t],l=o[0];if(!(l<=r.K))if(r.K=l,o=o[1],2==r.I)if("c"==o[0]){r.M=o[1],r.ba=o[2];let t=o[3];null!=t&&(r.ka=t,r.j.info("VER="+r.ka));let i=o[4];null!=i&&(r.za=i,r.j.info("SVER="+r.za));let l=o[5];null!=l&&"number"==typeof l&&l>0&&(r.O=n=1.5*l,r.j.info("backChannelRequestTimeoutMs_="+n)),n=r;let u=e.g;if(u){let e=u.g?u.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(e){var s=n.h;s.g||-1==e.indexOf("spdy")&&-1==e.indexOf("quic")&&-1==e.indexOf("h2")||(s.j=s.l,s.g=new Set,s.h&&(eQ(s,s.h),s.h=null))}if(n.G){let e=u.g?u.g.getResponseHeader("X-HTTP-Session-Id"):null;e&&(n.wa=e,e3(n.J,n.G,e))}}if(r.I=3,r.l&&r.l.ra(),r.aa&&(r.T=Date.now()-e.F,r.j.info("Handshake RTT: "+r.T+"ms")),(n=r).na=tW(n,n.L?n.ba:null,n.W),e.L){eJ(n.h,e);var a=n.O;a&&(e.H=a),e.D&&(eB(e),eV(e)),n.g=e}else tU(n);r.i.length>0&&tL(r)}else"stop"!=o[0]&&"close"!=o[0]||tG(r,7);else 3==r.I&&("stop"==o[0]||"close"==o[0]?"stop"==o[0]?tG(r,7):tR(r):"noop"!=o[0]&&r.l&&r.l.qa(o),r.A=0)}}e_(4)}catch(e){}}eD.prototype.ba=function(e){e=e.target;let t=this.O;t&&3==tk(e)?t.j():this.Y(e)},eD.prototype.Y=function(e){try{if(e==this.g)e:{let f=tk(this.g),p=this.g.ya(),m=this.g.ca();if(!(f<3)&&(3!=f||this.g&&(this.h.h||this.g.la()||tx(this.g)))){this.K||4!=f||7==p||(8==p||m<=0?e_(3):e_(2)),eB(this);var t=this.g.ca();this.X=t;var r=function(e){if(!eF(e))return e.g.la();let t=tx(e.g);if(""===t)return"";let r="",n=t.length,i=4==tk(e.g);if(!e.h.i){if("u"<typeof TextDecoder)return ej(e),eq(e),"";e.h.i=new a.TextDecoder}for(let s=0;s<n;s++)e.h.h=!0,r+=e.h.i.decode(t[s],{stream:!(i&&s==n-1)});return t.length=0,e.h.g+=r,e.C=0,e.h.g}(this);if(this.o=200==t,n=this.i,i=this.v,s=this.B,o=this.l,l=this.S,n.info(function(){return"XMLHTTP RESP ("+o+") [ attempt "+l+"]: "+i+"\n"+s+"\n"+f+" "+t}),this.o){if(this.U&&!this.L){t:{if(this.g){var n,i,s,o,l,u,h=this.g;if((u=h.g?h.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!P(u)){var c=u;break t}}c=null}if(e=c)eC(this.i,this.l,e,"Initial handshake response via X-HTTP-Initial-Response"),this.L=!0,ez(this,e);else{this.o=!1,this.m=3,eb(12),ej(this),eq(this);break e}}if(this.R){let t;for(e=!0;!this.K&&this.C<r.length;)if((t=function(e,t){var r=e.C,n=t.indexOf("\n",r);return -1==n?eO:isNaN(r=Number(t.substring(r,n)))?eP:(n+=1)+r>t.length?eO:(t=t.slice(n,n+r),e.C=n+r,t)}(this,r))==eO){4==f&&(this.m=4,eb(14),e=!1),eC(this.i,this.l,null,"[Incomplete Response]");break}else if(t==eP){this.m=4,eb(15),eC(this.i,this.l,r,"[Invalid Chunk]"),e=!1;break}else eC(this.i,this.l,t,null),ez(this,t);if(eF(this)&&0!=this.C&&(this.h.g=this.h.g.slice(this.C),this.C=0),4!=f||0!=r.length||this.h.h||(this.m=1,eb(16),e=!1),this.o=this.o&&e,e){if(r.length>0&&!this.W){this.W=!0;var d=this.j;d.g==this&&d.aa&&!d.P&&(d.j.info("Great, no buffering proxy detected. Bytes received: "+r.length),tq(d),d.P=!0,eb(11))}}else eC(this.i,this.l,r,"[Invalid Chunked Response]"),ej(this),eq(this)}else eC(this.i,this.l,r,null),ez(this,r);4==f&&ej(this),this.o&&!this.K&&(4==f?t$(this.j,this):(this.o=!1,eV(this)))}else(function(e){let t={};e=(e.g&&tk(e)>=2&&e.g.getAllResponseHeaders()||"").split("\r\n");for(let n=0;n<e.length;n++){if(P(e[n]))continue;var r=function(e){var t=1;e=e.split(":");let r=[];for(;t>0&&e.length;)r.push(e.shift()),t--;return e.length&&r.push(e.join(":")),r}(e[n]);let i=r[0];if("string"!=typeof(r=r[1]))continue;r=r.trim();let s=t[i]||[];t[i]=s,s.push(r)}var n=function(e){return e.join(", ")};for(let e in t)n.call(void 0,t[e],e,t)})(this.g),400==t&&r.indexOf("Unknown SID")>0?(this.m=3,eb(12)):(this.m=0,eb(13)),ej(this),eq(this)}}}catch(e){}finally{}},eD.prototype.cancel=function(){this.K=!0,ej(this)},eD.prototype.aa=function(){var e,t;this.D=null;let r=Date.now();r-this.T>=0?(e=this.i,t=this.B,e.info(function(){return"TIMEOUT: "+t}),2!=this.M&&(e_(),eb(17)),ej(this),this.m=2,eq(this)):eU(this,this.T-r)};var e$=class{constructor(e,t){this.g=e,this.map=t}};function eK(e){this.l=e||10,e=a.PerformanceNavigationTiming?(e=a.performance.getEntriesByType("navigation")).length>0&&("hq"==e[0].nextHopProtocol||"h2"==e[0].nextHopProtocol):!!(a.chrome&&a.chrome.loadTimes&&a.chrome.loadTimes()&&a.chrome.loadTimes().wasFetchedViaSpdy),this.j=e?this.l:1,this.g=null,this.j>1&&(this.g=new Set),this.h=null,this.i=[]}function eG(e){return!!e.h||!!e.g&&e.g.size>=e.j}function eH(e){return e.h?1:e.g?e.g.size:0}function eW(e,t){return e.h?e.h==t:!!e.g&&e.g.has(t)}function eQ(e,t){e.g?e.g.add(t):e.h=t}function eJ(e,t){e.h&&e.h==t?e.h=null:e.g&&e.g.has(t)&&e.g.delete(t)}function eY(e){if(null!=e.h)return e.i.concat(e.h.G);if(null!=e.g&&0!==e.g.size){let t=e.i;for(let r of e.g.values())t=t.concat(r.G);return t}return I(e.i)}eK.prototype.cancel=function(){if(this.i=eY(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&0!==this.g.size){for(let e of this.g.values())e.cancel();this.g.clear()}};var eX=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function eZ(e){let t;this.g=this.o=this.j="",this.u=null,this.m=this.h="",this.l=!1,e instanceof eZ?(this.l=e.l,e1(this,e.j),this.o=e.o,this.g=e.g,e2(this,e.u),this.h=e.h,e6(this,th(e.i)),this.m=e.m):e&&(t=String(e).match(eX))?(this.l=!1,e1(this,t[1]||"",!0),this.o=e5(t[2]||""),this.g=e5(t[3]||"",!0),e2(this,t[4]),this.h=e5(t[5]||"",!0),e6(this,t[6]||"",!0),this.m=e5(t[7]||"")):(this.l=!1,this.i=new ti(null,this.l))}function e0(e){return new eZ(e)}function e1(e,t,r){e.j=r?e5(t,!0):t,e.j&&(e.j=e.j.replace(/:$/,""))}function e2(e,t){if(t){if(isNaN(t=Number(t))||t<0)throw Error("Bad port number "+t);e.u=t}else e.u=null}function e6(e,t,r){var n,i;t instanceof ti?(e.i=t,n=e.i,(i=e.l)&&!n.j&&(ts(n),n.i=null,n.g.forEach(function(e,t){let r=t.toLowerCase();t!=r&&(ta(this,t),tu(this,r,e))},n)),n.j=i):(r||(t=e8(t,tr)),e.i=new ti(t,e.l))}function e3(e,t,r){e.i.set(t,r)}function e4(e){return e3(e,"zx",Math.floor(0x80000000*Math.random()).toString(36)+Math.abs(Math.floor(0x80000000*Math.random())^Date.now()).toString(36)),e}function e5(e,t){return e?t?decodeURI(e.replace(/%25/g,"%2525")):decodeURIComponent(e):""}function e8(e,t,r){return"string"==typeof e?(e=encodeURI(e).replace(t,e7),r&&(e=e.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),e):null}function e7(e){return"%"+((e=e.charCodeAt(0))>>4&15).toString(16)+(15&e).toString(16)}eZ.prototype.toString=function(){let e=[];var t=this.j;t&&e.push(e8(t,e9,!0),":");var r=this.g;return(r||"file"==t)&&(e.push("//"),(t=this.o)&&e.push(e8(t,e9,!0),"@"),e.push(eN(r).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),null!=(r=this.u)&&e.push(":",String(r))),(r=this.h)&&(this.g&&"/"!=r.charAt(0)&&e.push("/"),e.push(e8(r,"/"==r.charAt(0)?tt:te,!0))),(r=this.i.toString())&&e.push("?",r),(r=this.m)&&e.push("#",e8(r,tn)),e.join("")},eZ.prototype.resolve=function(e){let t=e0(this),r=!!e.j;r?e1(t,e.j):r=!!e.o,r?t.o=e.o:r=!!e.g,r?t.g=e.g:r=null!=e.u;var n=e.h;if(r)e2(t,e.u);else if(r=!!e.h){if("/"!=n.charAt(0))if(this.g&&!this.h)n="/"+n;else{var i=t.h.lastIndexOf("/");-1!=i&&(n=t.h.slice(0,i+1)+n)}if(".."==(i=n)||"."==i)n="";else if(-1!=i.indexOf("./")||-1!=i.indexOf("/.")){n=0==i.lastIndexOf("/",0),i=i.split("/");let e=[];for(let t=0;t<i.length;){let r=i[t++];"."==r?n&&t==i.length&&e.push(""):".."==r?((e.length>1||1==e.length&&""!=e[0])&&e.pop(),n&&t==i.length&&e.push("")):(e.push(r),n=!0)}n=e.join("/")}else n=i}return r?t.h=n:r=""!==e.i.toString(),r?e6(t,th(e.i)):r=!!e.m,r&&(t.m=e.m),t};var e9=/[#\/\?@]/g,te=/[#\?:]/g,tt=/[#\?]/g,tr=/[#\?@]/g,tn=/#/g;function ti(e,t){this.h=this.g=null,this.i=e||null,this.j=!!t}function ts(e){e.g||(e.g=new Map,e.h=0,e.i&&function(e,t){if(e){e=e.split("&");for(let r=0;r<e.length;r++){let n=e[r].indexOf("="),i,s=null;n>=0?(i=e[r].substring(0,n),s=e[r].substring(n+1)):i=e[r],t(i,s?decodeURIComponent(s.replace(/\+/g," ")):"")}}}(e.i,function(t,r){e.add(decodeURIComponent(t.replace(/\+/g," ")),r)}))}function ta(e,t){ts(e),t=tc(e,t),e.g.has(t)&&(e.i=null,e.h-=e.g.get(t).length,e.g.delete(t))}function to(e,t){return ts(e),t=tc(e,t),e.g.has(t)}function tl(e,t){ts(e);let r=[];if("string"==typeof t)to(e,t)&&(r=r.concat(e.g.get(tc(e,t))));else for(e=Array.from(e.g.values()),t=0;t<e.length;t++)r=r.concat(e[t]);return r}function tu(e,t,r){ta(e,t),r.length>0&&(e.i=null,e.g.set(tc(e,t),I(r)),e.h+=r.length)}function th(e){let t=new ti;return t.i=e.i,e.g&&(t.g=new Map(e.g),t.h=e.h),t}function tc(e,t){return t=String(t),e.j&&(t=t.toLowerCase()),t}function td(e,t,r,n,i){try{i&&(i.onload=null,i.onerror=null,i.onabort=null,i.ontimeout=null),n(r)}catch(e){}}function tf(){this.g=new eh}function tp(e){this.i=e.Sb||null,this.h=e.ab||!1}function tm(e,t){et.call(this),this.H=e,this.o=t,this.m=void 0,this.status=this.readyState=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.A=new Headers,this.h=null,this.F="GET",this.D="",this.g=!1,this.B=this.j=this.l=null,this.v=new AbortController}function tg(e){e.j.read().then(e.Ma.bind(e)).catch(e.ga.bind(e))}function ty(e){e.readyState=4,e.l=null,e.j=null,e.B=null,tw(e)}function tw(e){e.onreadystatechange&&e.onreadystatechange.call(e)}function tv(e){let t="";return U(e,function(e,r){t+=r,t+=":",t+=e,t+="\r\n"}),t}function t_(e,t,r){e:{for(n in r){var n=!1;break e}n=!0}n||(r=tv(r),"string"==typeof e?null!=r&&eN(r):e3(e,t,r))}function tI(e){et.call(this),this.headers=new Map,this.L=e||null,this.h=!1,this.g=null,this.D="",this.o=0,this.l="",this.j=this.B=this.v=this.A=!1,this.m=null,this.F="",this.H=!1}(t=ti.prototype).add=function(e,t){ts(this),this.i=null,e=tc(this,e);let r=this.g.get(e);return r||this.g.set(e,r=[]),r.push(t),this.h+=1,this},t.forEach=function(e,t){ts(this),this.g.forEach(function(r,n){r.forEach(function(r){e.call(t,r,n,this)},this)},this)},t.set=function(e,t){return ts(this),this.i=null,to(this,e=tc(this,e))&&(this.h-=this.g.get(e).length),this.g.set(e,[t]),this.h+=1,this},t.get=function(e,t){return e&&(e=tl(this,e)).length>0?String(e[0]):t},t.toString=function(){if(this.i)return this.i;if(!this.g)return"";let e=[],t=Array.from(this.g.keys());for(let n=0;n<t.length;n++){var r=t[n];let i=eN(r);r=tl(this,r);for(let t=0;t<r.length;t++){let n=i;""!==r[t]&&(n+="="+eN(r[t])),e.push(n)}}return this.i=e.join("&")},v(tp,ec),tp.prototype.g=function(){return new tm(this.i,this.h)},v(tm,et),(t=tm.prototype).open=function(e,t){if(0!=this.readyState)throw this.abort(),Error("Error reopening a connection");this.F=e,this.D=t,this.readyState=1,tw(this)},t.send=function(e){if(1!=this.readyState)throw this.abort(),Error("need to call open() first. ");if(this.v.signal.aborted)throw this.abort(),Error("Request was aborted.");this.g=!0;let t={headers:this.A,method:this.F,credentials:this.m,cache:void 0,signal:this.v.signal};e&&(t.body=e),(this.H||a).fetch(new Request(this.D,t)).then(this.Pa.bind(this),this.ga.bind(this))},t.abort=function(){this.response=this.responseText="",this.A=new Headers,this.status=0,this.v.abort(),this.j&&this.j.cancel("Request was aborted.").catch(()=>{}),this.readyState>=1&&this.g&&4!=this.readyState&&(this.g=!1,ty(this)),this.readyState=0},t.Pa=function(e){if(this.g&&(this.l=e,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=e.headers,this.readyState=2,tw(this)),this.g&&(this.readyState=3,tw(this),this.g)))if("arraybuffer"===this.responseType)e.arrayBuffer().then(this.Na.bind(this),this.ga.bind(this));else if(void 0!==a.ReadableStream&&"body"in e){if(this.j=e.body.getReader(),this.o){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.B=new TextDecoder;tg(this)}else e.text().then(this.Oa.bind(this),this.ga.bind(this))},t.Ma=function(e){if(this.g){if(this.o&&e.value)this.response.push(e.value);else if(!this.o){var t=e.value?e.value:new Uint8Array(0);(t=this.B.decode(t,{stream:!e.done}))&&(this.response=this.responseText+=t)}e.done?ty(this):tw(this),3==this.readyState&&tg(this)}},t.Oa=function(e){this.g&&(this.response=this.responseText=e,ty(this))},t.Na=function(e){this.g&&(this.response=e,ty(this))},t.ga=function(){this.g&&ty(this)},t.setRequestHeader=function(e,t){this.A.append(e,t)},t.getResponseHeader=function(e){return this.h&&this.h.get(e.toLowerCase())||""},t.getAllResponseHeaders=function(){if(!this.h)return"";let e=[],t=this.h.entries();for(var r=t.next();!r.done;)e.push((r=r.value)[0]+": "+r[1]),r=t.next();return e.join("\r\n")},Object.defineProperty(tm.prototype,"withCredentials",{get:function(){return"include"===this.m},set:function(e){this.m=e?"include":"same-origin"}}),v(tI,et);var tb=/^https?$/i,tE=["POST","PUT"];function tT(e,t){e.h=!1,e.g&&(e.j=!0,e.g.abort(),e.j=!1),e.l=t,e.o=5,tS(e),tA(e)}function tS(e){e.A||(e.A=!0,er(e,"complete"),er(e,"error"))}function tC(e){if(e.h&&void 0!==s){if(e.v&&4==tk(e))setTimeout(e.Ca.bind(e),0);else if(er(e,"readystatechange"),4==tk(e)){e.h=!1;try{let s=e.ca();switch(s){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var t,r,n=!0;break;default:n=!1}if(!(t=n)){if(r=0===s){let t=String(e.D).match(eX)[1]||null;!t&&a.self&&a.self.location&&(t=a.self.location.protocol.slice(0,-1)),r=!tb.test(t?t.toLowerCase():"")}t=r}if(t)er(e,"complete"),er(e,"success");else{e.o=6;try{var i=tk(e)>2?e.g.statusText:""}catch(e){i=""}e.l=i+" ["+e.ca()+"]",tS(e)}}finally{tA(e)}}}}function tA(e,t){if(e.g){e.m&&(clearTimeout(e.m),e.m=null);let r=e.g;e.g=null,t||er(e,"ready");try{r.onreadystatechange=null}catch(e){}}}function tk(e){return e.g?e.g.readyState:0}function tx(e){try{if(!e.g)return null;if("response"in e.g)return e.g.response;switch(e.F){case"":case"text":return e.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in e.g)return e.g.mozResponseArrayBuffer}return null}catch(e){return null}}function tN(e,t,r){return r&&r.internalChannelParams&&r.internalChannelParams[e]||t}function tD(e){this.za=0,this.i=[],this.j=new eS,this.ba=this.na=this.J=this.W=this.g=this.wa=this.G=this.H=this.u=this.U=this.o=null,this.Ya=this.V=0,this.Sa=tN("failFast",!1,e),this.F=this.C=this.v=this.m=this.l=null,this.X=!0,this.xa=this.K=-1,this.Y=this.A=this.D=0,this.Qa=tN("baseRetryDelayMs",5e3,e),this.Za=tN("retryDelaySeedMs",1e4,e),this.Ta=tN("forwardChannelMaxRetries",2,e),this.va=tN("forwardChannelRequestTimeoutMs",2e4,e),this.ma=e&&e.xmlHttpFactory||void 0,this.Ua=e&&e.Rb||void 0,this.Aa=e&&e.useFetchStreams||!1,this.O=void 0,this.L=e&&e.supportsCrossDomainXhr||!1,this.M="",this.h=new eK(e&&e.concurrentRequestLimit),this.Ba=new tf,this.S=e&&e.fastHandshake||!1,this.R=e&&e.encodeInitMessageHeaders||!1,this.S&&this.R&&(this.R=!1),this.Ra=e&&e.Pb||!1,e&&e.ua&&this.j.ua(),e&&e.forceLongPolling&&(this.X=!1),this.aa=!this.S&&this.X&&e&&e.detectBufferingProxy||!1,this.ia=void 0,e&&e.longPollingTimeout&&e.longPollingTimeout>0&&(this.ia=e.longPollingTimeout),this.ta=void 0,this.T=0,this.P=!1,this.ja=this.B=null}function tR(e){if(tO(e),3==e.I){var t=e.V++,r=e0(e.J);if(e3(r,"SID",e.M),e3(r,"RID",t),e3(r,"TYPE","terminate"),tF(e,r),(t=new eD(e,e.j,t)).M=2,t.A=e4(e0(r)),r=!1,a.navigator&&a.navigator.sendBeacon)try{r=a.navigator.sendBeacon(t.A.toString(),"")}catch(e){}!r&&a.Image&&((new Image).src=t.A,r=!0),r||(t.g=tQ(t.j,null),t.g.ea(t.A)),t.F=Date.now(),eV(t)}tH(e)}function tP(e){e.g&&(tq(e),e.g.cancel(),e.g=null)}function tO(e){tP(e),e.v&&(a.clearTimeout(e.v),e.v=null),tz(e),e.h.cancel(),e.m&&("number"==typeof e.m&&a.clearTimeout(e.m),e.m=null)}function tL(e){if(!eG(e.h)&&!e.m){e.m=!0;var t=e.Ea;S||k(),C||(S(),C=!0),A.add(t,e),e.D=0}}function tM(e,t){var r;r=t?t.l:e.V++;let n=e0(e.J);e3(n,"SID",e.M),e3(n,"RID",r),e3(n,"AID",e.K),tF(e,n),e.u&&e.o&&t_(n,e.u,e.o),r=new eD(e,e.j,r,e.D+1),null===e.u&&(r.J=e.o),t&&(e.i=t.G.concat(e.i)),t=tV(e,r,1e3),r.H=Math.round(.5*e.va)+Math.round(.5*e.va*Math.random()),eQ(e.h,r),eL(r,n,t)}function tF(e,t){e.H&&U(e.H,function(e,r){e3(t,r,e)}),e.l&&U({},function(e,r){e3(t,r,e)})}function tV(e,t,r){r=Math.min(e.i.length,r);let n=e.l?y(e.l.Ka,e.l,e):null;e:{var i=e.i;let t=-1;for(;;){let e=["count="+r];-1==t?r>0?(t=i[0].g,e.push("ofs="+t)):t=0:e.push("ofs="+t);let l=!0;for(let u=0;u<r;u++){var s=i[u].g;let r=i[u].map;if((s-=t)<0)t=Math.max(0,i[u].g-100),l=!1;else try{s="req"+s+"_";try{var a=r instanceof Map?r:Object.entries(r);for(let[t,r]of a){let n=r;o(r)&&(n=el(r)),e.push(s+t+"="+encodeURIComponent(n))}}catch(t){throw e.push(s+"type="+encodeURIComponent("_badmap")),t}}catch(e){n&&n(r)}}if(l){a=e.join("&");break e}}a=void 0}return t.G=e=e.i.splice(0,r),a}function tU(e){if(!e.g&&!e.v){e.Y=1;var t=e.Da;S||k(),C||(S(),C=!0),A.add(t,e),e.A=0}}function tB(e){return!e.g&&!e.v&&!(e.A>=3)&&(e.Y++,e.v=eT(y(e.Da,e),tK(e,e.A)),e.A++,!0)}function tq(e){null!=e.B&&(a.clearTimeout(e.B),e.B=null)}function tj(e){e.g=new eD(e,e.j,"rpc",e.Y),null===e.u&&(e.g.J=e.o),e.g.P=0;var t=e0(e.na);e3(t,"RID","rpc"),e3(t,"SID",e.M),e3(t,"AID",e.K),e3(t,"CI",e.F?"0":"1"),!e.F&&e.ia&&e3(t,"TO",e.ia),e3(t,"TYPE","xmlhttp"),tF(e,t),e.u&&e.o&&t_(t,e.u,e.o),e.O&&(e.g.H=e.O);var r=e.g;e=e.ba,r.M=1,r.A=e4(e0(t)),r.u=null,r.R=!0,eM(r,e)}function tz(e){null!=e.C&&(a.clearTimeout(e.C),e.C=null)}function t$(e,t){var r,n=null;if(e.g==t){tz(e),tq(e),e.g=null;var i=2}else{if(!eW(e.h,t))return;n=t.G,eJ(e.h,t),i=1}if(0!=e.I){if(t.o)if(1==i){n=t.u?t.u.length:0,t=Date.now()-t.F;var s=e.D;er(i=ew(),new eE(i,n)),tL(e)}else tU(e);else if(3==(s=t.m)||0==s&&t.X>0||!(1==i&&(r=t,!(eH(e.h)>=e.h.j-!!e.m)&&(e.m?(e.i=r.G.concat(e.i),!0):1!=e.I&&2!=e.I&&!(e.D>=(e.Sa?0:e.Ta))&&(e.m=eT(y(e.Ea,e,r),tK(e,e.D)),e.D++,!0)))||2==i&&tB(e)))switch(n&&n.length>0&&((t=e.h).i=t.i.concat(n)),s){case 1:tG(e,5);break;case 4:tG(e,10);break;case 3:tG(e,6);break;default:tG(e,2)}}}function tK(e,t){let r=e.Qa+Math.floor(Math.random()*e.Za);return e.isActive()||(r*=2),r*t}function tG(e,t){if(e.j.info("Error code "+t),2==t){let t,s,o;var r,n=y(e.bb,e),i=e.Ua;let l=!i;i=new eZ(i||"//www.google.com/images/cleardot.gif"),a.location&&"http"==a.location.protocol||e1(i,"https"),e4(i),l?function(e,t){let r=new eS;if(a.Image){let n=new Image;n.onload=w(td,r,"TestLoadImage: loaded",!0,t,n),n.onerror=w(td,r,"TestLoadImage: error",!1,t,n),n.onabort=w(td,r,"TestLoadImage: abort",!1,t,n),n.ontimeout=w(td,r,"TestLoadImage: timeout",!1,t,n),a.setTimeout(function(){n.ontimeout&&n.ontimeout()},1e4),n.src=e}else t(!1)}(i.toString(),n):(r=i.toString(),t=new eS,s=new AbortController,o=setTimeout(()=>{s.abort(),td(t,"TestPingServer: timeout",!1,n)},1e4),fetch(r,{signal:s.signal}).then(e=>{clearTimeout(o),e.ok?td(t,"TestPingServer: ok",!0,n):td(t,"TestPingServer: server error",!1,n)}).catch(()=>{clearTimeout(o),td(t,"TestPingServer: error",!1,n)}))}else eb(2);e.I=0,e.l&&e.l.pa(t),tH(e),tO(e)}function tH(e){if(e.I=0,e.ja=[],e.l){let t=eY(e.h);(0!=t.length||0!=e.i.length)&&(b(e.ja,t),b(e.ja,e.i),e.h.i.length=0,I(e.i),e.i.length=0),e.l.oa()}}function tW(e,t,r){var n=r instanceof eZ?e0(r):new eZ(r);if(""!=n.g)t&&(n.g=t+"."+n.g),e2(n,n.u);else{var i=a.location;n=i.protocol,t=t?t+"."+i.hostname:i.hostname,i=+i.port;let e=new eZ(null);n&&e1(e,n),t&&(e.g=t),i&&e2(e,i),r&&(e.h=r),n=e}return r=e.G,t=e.wa,r&&t&&e3(n,r,t),e3(n,"VER",e.ka),tF(e,n),n}function tQ(e,t,r){if(t&&!e.L)throw Error("Can't create secondary domain capable XhrIo object.");return(t=new tI(e.Aa&&!e.ma?new tp({ab:r}):e.ma)).Fa(e.L),t}function tJ(){}function tY(){}function tX(e,t){et.call(this),this.g=new tD(t),this.l=e,this.h=t&&t.messageUrlParams||null,e=t&&t.messageHeaders||null,t&&t.clientProtocolHeaderRequired&&(e?e["X-Client-Protocol"]="webchannel":e={"X-Client-Protocol":"webchannel"}),this.g.o=e,e=t&&t.initMessageHeaders||null,t&&t.messageContentType&&(e?e["X-WebChannel-Content-Type"]=t.messageContentType:e={"X-WebChannel-Content-Type":t.messageContentType}),t&&t.sa&&(e?e["X-WebChannel-Client-Profile"]=t.sa:e={"X-WebChannel-Client-Profile":t.sa}),this.g.U=e,(e=t&&t.Qb)&&!P(e)&&(this.g.u=e),this.A=t&&t.supportsCrossDomainXhr||!1,this.v=t&&t.sendRawJson||!1,(t=t&&t.httpSessionIdParam)&&!P(t)&&(this.g.G=t,null!==(e=this.h)&&t in e&&t in(e=this.h)&&delete e[t]),this.j=new t1(this)}function tZ(e){ep.call(this),e.__headers__&&(this.headers=e.__headers__,this.statusCode=e.__status__,delete e.__headers__,delete e.__status__);var t=e.__sm__;if(t){e:{for(let r in t){e=r;break e}e=void 0}(this.i=e)&&(e=this.i,t=null!==t&&e in t?t[e]:void 0),this.data=t}else this.data=e}function t0(){em.call(this),this.status=1}function t1(e){this.g=e}(t=tI.prototype).Fa=function(e){this.H=e},t.ea=function(t,r,n,i){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.D+"; newUri="+t);r=r?r.toUpperCase():"GET",this.D=t,this.l="",this.o=0,this.A=!1,this.h=!0,this.g=this.L?this.L.g():e.g(),this.g.onreadystatechange=_(y(this.Ca,this));try{this.B=!0,this.g.open(r,String(t),!0),this.B=!1}catch(e){tT(this,e);return}if(t=n||"",n=new Map(this.headers),i)if(Object.getPrototypeOf(i)===Object.prototype)for(var s in i)n.set(s,i[s]);else if("function"==typeof i.keys&&"function"==typeof i.get)for(let e of i.keys())n.set(e,i.get(e));else throw Error("Unknown input type for opt_headers: "+String(i));for(let[e,o]of(i=Array.from(n.keys()).find(e=>"content-type"==e.toLowerCase()),s=a.FormData&&t instanceof a.FormData,!(Array.prototype.indexOf.call(tE,r,void 0)>=0)||i||s||n.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8"),n))this.g.setRequestHeader(e,o);this.F&&(this.g.responseType=this.F),"withCredentials"in this.g&&this.g.withCredentials!==this.H&&(this.g.withCredentials=this.H);try{this.m&&(clearTimeout(this.m),this.m=null),this.v=!0,this.g.send(t),this.v=!1}catch(e){tT(this,e)}},t.abort=function(e){this.g&&this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1,this.o=e||7,er(this,"complete"),er(this,"abort"),tA(this))},t.N=function(){this.g&&(this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1),tA(this,!0)),tI.Z.N.call(this)},t.Ca=function(){this.u||(this.B||this.v||this.j?tC(this):this.Xa())},t.Xa=function(){tC(this)},t.isActive=function(){return!!this.g},t.ca=function(){try{return tk(this)>2?this.g.status:-1}catch(e){return -1}},t.la=function(){try{return this.g?this.g.responseText:""}catch(e){return""}},t.La=function(e){if(this.g){var t=this.g.responseText;return e&&0==t.indexOf(e)&&(t=t.substring(e.length)),eu(t)}},t.ya=function(){return this.o},t.Ha=function(){return"string"==typeof this.l?this.l:String(this.l)},(t=tD.prototype).ka=8,t.I=1,t.connect=function(e,t,r,n){eb(0),this.W=e,this.H=t||{},r&&void 0!==n&&(this.H.OSID=r,this.H.OAID=n),this.F=this.X,this.J=tW(this,null,this.W),tL(this)},t.Ea=function(e){if(this.m)if(this.m=null,1==this.I){if(!e){this.V=Math.floor(1e5*Math.random()),e=this.V++;let i=new eD(this,this.j,e),s=this.o;if(this.U&&(s?j(s=B(s),this.U):s=this.U),null!==this.u||this.R||(i.J=s,s=null),this.S)e:{for(var t=0,r=0;r<this.i.length;r++){t:{var n=this.i[r];if("__data__"in n.map&&"string"==typeof(n=n.map.__data__)){n=n.length;break t}n=void 0}if(void 0===n)break;if((t+=n)>4096){t=r;break e}if(4096===t||r===this.i.length-1){t=r+1;break e}}t=1e3}else t=1e3;t=tV(this,i,t),e3(r=e0(this.J),"RID",e),e3(r,"CVER",22),this.G&&e3(r,"X-HTTP-Session-Id",this.G),tF(this,r),s&&(this.R?t="headers="+eN(tv(s))+"&"+t:this.u&&t_(r,this.u,s)),eQ(this.h,i),this.Ra&&e3(r,"TYPE","init"),this.S?(e3(r,"$req",t),e3(r,"SID","null"),i.U=!0,eL(i,r,null)):eL(i,r,t),this.I=2}}else 3==this.I&&(e?tM(this,e):0==this.i.length||eG(this.h)||tM(this))},t.Da=function(){if(this.v=null,tj(this),this.aa&&!(this.P||null==this.g||this.T<=0)){var e=4*this.T;this.j.info("BP detection timer enabled: "+e),this.B=eT(y(this.Wa,this),e)}},t.Wa=function(){this.B&&(this.B=null,this.j.info("BP detection timeout reached."),this.j.info("Buffering proxy detected and switch to long-polling!"),this.F=!1,this.P=!0,eb(10),tP(this),tj(this))},t.Va=function(){null!=this.C&&(this.C=null,tP(this),tB(this),eb(19))},t.bb=function(e){e?(this.j.info("Successfully pinged google.com"),eb(2)):(this.j.info("Failed to ping google.com"),eb(1))},t.isActive=function(){return!!this.l&&this.l.isActive(this)},(t=tJ.prototype).ra=function(){},t.qa=function(){},t.pa=function(){},t.oa=function(){},t.isActive=function(){return!0},t.Ka=function(){},tY.prototype.g=function(e,t){return new tX(e,t)},v(tX,et),tX.prototype.m=function(){this.g.l=this.j,this.A&&(this.g.L=!0),this.g.connect(this.l,this.h||void 0)},tX.prototype.close=function(){tR(this.g)},tX.prototype.o=function(e){var t=this.g;if("string"==typeof e){var r={};r.__data__=e,e=r}else this.v&&((r={}).__data__=el(e),e=r);t.i.push(new e$(t.Ya++,e)),3==t.I&&tL(t)},tX.prototype.N=function(){this.g.l=null,delete this.j,tR(this.g),delete this.g,tX.Z.N.call(this)},v(tZ,ep),v(t0,em),v(t1,tJ),t1.prototype.ra=function(){er(this.g,"a")},t1.prototype.qa=function(e){er(this.g,new tZ(e))},t1.prototype.pa=function(e){er(this.g,new t0)},t1.prototype.oa=function(){er(this.g,"b")},tY.prototype.createWebChannel=tY.prototype.g,tX.prototype.send=tX.prototype.o,tX.prototype.open=tX.prototype.m,tX.prototype.close=tX.prototype.close,g=n3.createWebChannelTransport=function(){return new tY},m=n3.getStatEventTarget=function(){return ew()},p=n3.Event=eg,f=n3.Stat={jb:0,mb:1,nb:2,Hb:3,Mb:4,Jb:5,Kb:6,Ib:7,Gb:8,Lb:9,PROXY:10,NOPROXY:11,Eb:12,Ab:13,Bb:14,zb:15,Cb:16,Db:17,fb:18,eb:19,gb:20},eA.NO_ERROR=0,eA.TIMEOUT=8,eA.HTTP_ERROR=6,d=n3.ErrorCode=eA,ek.COMPLETE="complete",c=n3.EventType=ek,ed.EventType=ef,ef.OPEN="a",ef.CLOSE="b",ef.ERROR="c",ef.MESSAGE="d",et.prototype.listen=et.prototype.J,h=n3.WebChannel=ed,n3.FetchXmlHttpFactory=tp,tI.prototype.listenOnce=tI.prototype.K,tI.prototype.getLastError=tI.prototype.Ha,tI.prototype.getLastErrorCode=tI.prototype.ya,tI.prototype.getStatus=tI.prototype.ca,tI.prototype.getResponseJson=tI.prototype.La,tI.prototype.getResponseText=tI.prototype.la,tI.prototype.send=tI.prototype.ea,tI.prototype.setWithCredentials=tI.prototype.Fa,u=n3.XhrIo=tI}).apply(void 0!==n6?n6:"u">typeof self?self:"u">typeof window?window:{});class n4{constructor(e){this.uid=e}isAuthenticated(){return null!=this.uid}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}}n4.UNAUTHENTICATED=new n4(null),n4.GOOGLE_CREDENTIALS=new n4("google-credentials-uid"),n4.FIRST_PARTY=new n4("first-party-uid"),n4.MOCK_USER=new n4("mock-user");let n5="12.9.0",n8=new ep("@firebase/firestore");function n7(){return n8.logLevel}function n9(e,...t){if(n8.logLevel<=a.DEBUG){let r=t.map(ir);n8.debug(`Firestore (${n5}): ${e}`,...r)}}function ie(e,...t){if(n8.logLevel<=a.ERROR){let r=t.map(ir);n8.error(`Firestore (${n5}): ${e}`,...r)}}function it(e,...t){if(n8.logLevel<=a.WARN){let r=t.map(ir);n8.warn(`Firestore (${n5}): ${e}`,...r)}}function ir(e){if("string"==typeof e)return e;try{return JSON.stringify(e)}catch(t){return e}}function ii(e,t,r){let n="Unexpected state";"string"==typeof t?n=t:r=t,is(e,n,r)}function is(e,t,r){let n=`FIRESTORE (${n5}) INTERNAL ASSERTION FAILED: ${t} (ID: ${e.toString(16)})`;if(void 0!==r)try{n+=" CONTEXT: "+JSON.stringify(r)}catch(e){n+=" CONTEXT: "+r}throw ie(n),Error(n)}function ia(e,t,r,n){let i="Unexpected state";"string"==typeof r?i=r:n=r,e||is(t,i,n)}let io={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class il extends W{constructor(e,t){super(e,t),this.code=e,this.message=t,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}class iu{constructor(){this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}}class ih{constructor(e,t){this.user=t,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${e}`)}}class ic{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,t){e.enqueueRetryable(()=>t(n4.UNAUTHENTICATED))}shutdown(){}}class id{constructor(e){this.token=e,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(e,t){this.changeListener=t,e.enqueueRetryable(()=>t(this.token.user))}shutdown(){this.changeListener=null}}class ip{constructor(e){this.t=e,this.currentUser=n4.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(e,t){ia(void 0===this.o,42304);let r=this.i,n=e=>this.i!==r?(r=this.i,t(e)):Promise.resolve(),i=new iu;this.o=()=>{this.i++,this.currentUser=this.u(),i.resolve(),i=new iu,e.enqueueRetryable(()=>n(this.currentUser))};let s=()=>{let t=i;e.enqueueRetryable(async()=>{await t.promise,await n(this.currentUser)})},a=e=>{n9("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=e,this.o&&(this.auth.addAuthTokenListener(this.o),s())};this.t.onInit(e=>a(e)),setTimeout(()=>{if(!this.auth){let e=this.t.getImmediate({optional:!0});e?a(e):(n9("FirebaseAuthCredentialsProvider","Auth not yet detected"),i.resolve(),i=new iu)}},0),s()}getToken(){let e=this.i,t=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(t).then(t=>this.i!==e?(n9("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):t?(ia("string"==typeof t.accessToken,31837,{l:t}),new ih(t.accessToken,this.currentUser)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.o&&this.auth.removeAuthTokenListener(this.o),this.o=void 0}u(){let e=this.auth&&this.auth.getUid();return ia(null===e||"string"==typeof e,2055,{h:e}),new n4(e)}}class im{constructor(e,t,r){this.P=e,this.T=t,this.I=r,this.type="FirstParty",this.user=n4.FIRST_PARTY,this.R=new Map}A(){return this.I?this.I():null}get headers(){this.R.set("X-Goog-AuthUser",this.P);let e=this.A();return e&&this.R.set("Authorization",e),this.T&&this.R.set("X-Goog-Iam-Authorization-Token",this.T),this.R}}class ig{constructor(e,t,r){this.P=e,this.T=t,this.I=r}getToken(){return Promise.resolve(new im(this.P,this.T,this.I))}start(e,t){e.enqueueRetryable(()=>t(n4.FIRST_PARTY))}shutdown(){}invalidateToken(){}}class iy{constructor(e){this.value=e,this.type="AppCheck",this.headers=new Map,e&&e.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class iw{constructor(e,t){this.V=t,this.forceRefresh=!1,this.appCheck=null,this.m=null,this.p=null,ez(e)&&e.settings.appCheckToken&&(this.p=e.settings.appCheckToken)}start(e,t){ia(void 0===this.o,3512);let r=e=>{null!=e.error&&n9("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${e.error.message}`);let r=e.token!==this.m;return this.m=e.token,n9("FirebaseAppCheckTokenProvider",`Received ${r?"new":"existing"} token.`),r?t(e.token):Promise.resolve()};this.o=t=>{e.enqueueRetryable(()=>r(t))};let n=e=>{n9("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=e,this.o&&this.appCheck.addTokenListener(this.o)};this.V.onInit(e=>n(e)),setTimeout(()=>{if(!this.appCheck){let e=this.V.getImmediate({optional:!0});e?n(e):n9("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}},0)}getToken(){if(this.p)return Promise.resolve(new iy(this.p));let e=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(e).then(e=>e?(ia("string"==typeof e.token,44558,{tokenResult:e}),this.m=e.token,new iy(e.token)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.o&&this.appCheck.removeTokenListener(this.o),this.o=void 0}}class iv{static newId(){let e=62*Math.floor(256/62),t="";for(;t.length<20;){let r=function(e){let t="u">typeof self&&(self.crypto||self.msCrypto),r=new Uint8Array(40);if(t&&"function"==typeof t.getRandomValues)t.getRandomValues(r);else for(let e=0;e<40;e++)r[e]=Math.floor(256*Math.random());return r}(0);for(let n=0;n<r.length;++n)t.length<20&&r[n]<e&&(t+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789".charAt(r[n]%62))}return t}}function i_(e,t){return e<t?-1:+(e>t)}function iI(e,t){let r=Math.min(e.length,t.length);for(let n=0;n<r;n++){let r=e.charAt(n),i=t.charAt(n);if(r!==i)return ib(r)===ib(i)?i_(r,i):ib(r)?1:-1}return i_(e.length,t.length)}function ib(e){let t=e.charCodeAt(0);return t>=55296&&t<=57343}function iE(e,t,r){return e.length===t.length&&e.every((e,n)=>r(e,t[n]))}let iT="__name__";class iS{constructor(e,t,r){void 0===t?t=0:t>e.length&&ii(637,{offset:t,range:e.length}),void 0===r?r=e.length-t:r>e.length-t&&ii(1746,{length:r,range:e.length-t}),this.segments=e,this.offset=t,this.len=r}get length(){return this.len}isEqual(e){return 0===iS.comparator(this,e)}child(e){let t=this.segments.slice(this.offset,this.limit());return e instanceof iS?e.forEach(e=>{t.push(e)}):t.push(e),this.construct(t)}limit(){return this.offset+this.length}popFirst(e){return e=void 0===e?1:e,this.construct(this.segments,this.offset+e,this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return 0===this.length}isPrefixOf(e){if(e.length<this.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}isImmediateParentOf(e){if(this.length+1!==e.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}forEach(e){for(let t=this.offset,r=this.limit();t<r;t++)e(this.segments[t])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(e,t){let r=Math.min(e.length,t.length);for(let n=0;n<r;n++){let r=iS.compareSegments(e.get(n),t.get(n));if(0!==r)return r}return i_(e.length,t.length)}static compareSegments(e,t){let r=iS.isNumericId(e),n=iS.isNumericId(t);return r&&!n?-1:!r&&n?1:r&&n?iS.extractNumericId(e).compare(iS.extractNumericId(t)):iI(e,t)}static isNumericId(e){return e.startsWith("__id")&&e.endsWith("__")}static extractNumericId(e){return o.fromString(e.substring(4,e.length-2))}}class iC extends iS{construct(e,t,r){return new iC(e,t,r)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(...e){let t=[];for(let r of e){if(r.indexOf("//")>=0)throw new il(io.INVALID_ARGUMENT,`Invalid segment (${r}). Paths must not contain // in them.`);t.push(...r.split("/").filter(e=>e.length>0))}return new iC(t)}static emptyPath(){return new iC([])}}let iA=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class ik extends iS{construct(e,t,r){return new ik(e,t,r)}static isValidIdentifier(e){return iA.test(e)}canonicalString(){return this.toArray().map(e=>(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),ik.isValidIdentifier(e)||(e="`"+e+"`"),e)).join(".")}toString(){return this.canonicalString()}isKeyField(){return 1===this.length&&this.get(0)===iT}static keyField(){return new ik([iT])}static fromServerFormat(e){let t=[],r="",n=0,i=()=>{if(0===r.length)throw new il(io.INVALID_ARGUMENT,`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);t.push(r),r=""},s=!1;for(;n<e.length;){let t=e[n];if("\\"===t){if(n+1===e.length)throw new il(io.INVALID_ARGUMENT,"Path has trailing escape character: "+e);let t=e[n+1];if("\\"!==t&&"."!==t&&"`"!==t)throw new il(io.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);r+=t,n+=2}else"`"===t?s=!s:"."!==t||s?r+=t:i(),n++}if(i(),s)throw new il(io.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new ik(t)}static emptyPath(){return new ik([])}}class ix{constructor(e){this.path=e}static fromPath(e){return new ix(iC.fromString(e))}static fromName(e){return new ix(iC.fromString(e).popFirst(5))}static empty(){return new ix(iC.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(e){return null!==e&&0===iC.comparator(this.path,e.path)}toString(){return this.path.toString()}static comparator(e,t){return iC.comparator(e.path,t.path)}static isDocumentKey(e){return e.length%2==0}static fromSegments(e){return new ix(new iC(e.slice()))}}function iN(e,t,r){if(!r)throw new il(io.INVALID_ARGUMENT,`Function ${e}() cannot be called with an empty ${t}.`)}function iD(e){if(!ix.isDocumentKey(e))throw new il(io.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${e} has ${e.length}.`)}function iR(e){if(ix.isDocumentKey(e))throw new il(io.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${e} has ${e.length}.`)}function iP(e){return"object"==typeof e&&null!==e&&(Object.getPrototypeOf(e)===Object.prototype||null===Object.getPrototypeOf(e))}function iO(e){if(void 0===e)return"undefined";if(null===e)return"null";if("string"==typeof e)return e.length>20&&(e=`${e.substring(0,20)}...`),JSON.stringify(e);if("number"==typeof e||"boolean"==typeof e)return""+e;if("object"==typeof e){if(e instanceof Array)return"an array";{var t;let r=(t=e).constructor?t.constructor.name:null;return r?`a custom ${r} object`:"an object"}}return"function"==typeof e?"a function":ii(12329,{type:typeof e})}function iL(e,t){if("_delegate"in e&&(e=e._delegate),!(e instanceof t)){if(t.name===e.constructor.name)throw new il(io.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{let r=iO(e);throw new il(io.INVALID_ARGUMENT,`Expected type '${t.name}', but it was: ${r}`)}}return e}function iM(e,t){if(t<=0)throw new il(io.INVALID_ARGUMENT,`Function ${e}() requires a positive number, but it was: ${t}.`)}function iF(e,t){let r={typeString:e};return t&&(r.value=t),r}function iV(e,t){let r;if(!iP(e))throw new il(io.INVALID_ARGUMENT,"JSON must be an object");for(let n in t)if(t[n]){let i=t[n].typeString,s="value"in t[n]?{value:t[n].value}:void 0;if(!(n in e)){r=`JSON missing required field: '${n}'`;break}let a=e[n];if(i&&typeof a!==i){r=`JSON field '${n}' must be a ${i}.`;break}if(void 0!==s&&a!==s.value){r=`Expected '${n}' field to equal '${s.value}'`;break}}if(r)throw new il(io.INVALID_ARGUMENT,r);return!0}class iU{static now(){return iU.fromMillis(Date.now())}static fromDate(e){return iU.fromMillis(e.getTime())}static fromMillis(e){let t=Math.floor(e/1e3),r=Math.floor((e-1e3*t)*1e6);return new iU(t,r)}constructor(e,t){if(this.seconds=e,this.nanoseconds=t,t<0||t>=1e9)throw new il(io.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(e<-0xe7791f700||e>=0x3afff44180)throw new il(io.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/1e6}_compareTo(e){return this.seconds===e.seconds?i_(this.nanoseconds,e.nanoseconds):i_(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{type:iU._jsonSchemaVersion,seconds:this.seconds,nanoseconds:this.nanoseconds}}static fromJSON(e){if(iV(e,iU._jsonSchema))return new iU(e.seconds,e.nanoseconds)}valueOf(){return String(this.seconds- -0xe7791f700).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}iU._jsonSchemaVersion="firestore/timestamp/1.0",iU._jsonSchema={type:iF("string",iU._jsonSchemaVersion),seconds:iF("number"),nanoseconds:iF("number")};class iB{static fromTimestamp(e){return new iB(e)}static min(){return new iB(new iU(0,0))}static max(){return new iB(new iU(0x3afff4417f,0x3b9ac9ff))}constructor(e){this.timestamp=e}compareTo(e){return this.timestamp._compareTo(e.timestamp)}isEqual(e){return this.timestamp.isEqual(e.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}class iq{constructor(e,t,r,n){this.indexId=e,this.collectionGroup=t,this.fields=r,this.indexState=n}}function ij(e){return e.fields.find(e=>2===e.kind)}function iz(e){return e.fields.filter(e=>2!==e.kind)}function i$(e,t){let r=i_(e.collectionGroup,t.collectionGroup);if(0!==r)return r;for(let n=0;n<Math.min(e.fields.length,t.fields.length);++n)if(0!==(r=function(e,t){let r=ik.comparator(e.fieldPath,t.fieldPath);return 0!==r?r:i_(e.kind,t.kind)}(e.fields[n],t.fields[n])))return r;return i_(e.fields.length,t.fields.length)}iq.UNKNOWN_ID=-1;class iK{constructor(e,t){this.fieldPath=e,this.kind=t}}class iG{constructor(e,t){this.sequenceNumber=e,this.offset=t}static empty(){return new iG(0,iQ.min())}}function iH(e,t){let r=e.toTimestamp().seconds,n=e.toTimestamp().nanoseconds+1;return new iQ(iB.fromTimestamp(1e9===n?new iU(r+1,0):new iU(r,n)),ix.empty(),t)}function iW(e){return new iQ(e.readTime,e.key,-1)}class iQ{constructor(e,t,r){this.readTime=e,this.documentKey=t,this.largestBatchId=r}static min(){return new iQ(iB.min(),ix.empty(),-1)}static max(){return new iQ(iB.max(),ix.empty(),-1)}}function iJ(e,t){let r=e.readTime.compareTo(t.readTime);return 0!==r||0!==(r=ix.comparator(e.documentKey,t.documentKey))?r:i_(e.largestBatchId,t.largestBatchId)}let iY="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.";class iX{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(e){this.onCommittedListeners.push(e)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach(e=>e())}}async function iZ(e){if(e.code!==io.FAILED_PRECONDITION||e.message!==iY)throw e;n9("LocalStore","Unexpectedly lost primary lease")}class i0{constructor(e){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e(e=>{this.isDone=!0,this.result=e,this.nextCallback&&this.nextCallback(e)},e=>{this.isDone=!0,this.error=e,this.catchCallback&&this.catchCallback(e)})}catch(e){return this.next(void 0,e)}next(e,t){return this.callbackAttached&&ii(59440),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(t,this.error):this.wrapSuccess(e,this.result):new i0((r,n)=>{this.nextCallback=t=>{this.wrapSuccess(e,t).next(r,n)},this.catchCallback=e=>{this.wrapFailure(t,e).next(r,n)}})}toPromise(){return new Promise((e,t)=>{this.next(e,t)})}wrapUserFunction(e){try{let t=e();return t instanceof i0?t:i0.resolve(t)}catch(e){return i0.reject(e)}}wrapSuccess(e,t){return e?this.wrapUserFunction(()=>e(t)):i0.resolve(t)}wrapFailure(e,t){return e?this.wrapUserFunction(()=>e(t)):i0.reject(t)}static resolve(e){return new i0((t,r)=>{t(e)})}static reject(e){return new i0((t,r)=>{r(e)})}static waitFor(e){return new i0((t,r)=>{let n=0,i=0,s=!1;e.forEach(e=>{++n,e.next(()=>{++i,s&&i===n&&t()},e=>r(e))}),s=!0,i===n&&t()})}static or(e){let t=i0.resolve(!1);for(let r of e)t=t.next(e=>e?i0.resolve(e):r());return t}static forEach(e,t){let r=[];return e.forEach((e,n)=>{r.push(t.call(this,e,n))}),this.waitFor(r)}static mapArray(e,t){return new i0((r,n)=>{let i=e.length,s=Array(i),a=0;for(let o=0;o<i;o++){let l=o;t(e[l]).next(e=>{s[l]=e,++a===i&&r(s)},e=>n(e))}})}static doWhile(e,t){return new i0((r,n)=>{let i=()=>{!0===e()?t().next(()=>{i()},n):r()};i()})}}let i1="SimpleDb";class i2{static open(e,t,r,n){try{return new i2(t,e.transaction(n,r))}catch(e){throw new i5(t,e)}}constructor(e,t){this.action=e,this.transaction=t,this.aborted=!1,this.S=new iu,this.transaction.oncomplete=()=>{this.S.resolve()},this.transaction.onabort=()=>{t.error?this.S.reject(new i5(e,t.error)):this.S.resolve()},this.transaction.onerror=t=>{let r=st(t.target.error);this.S.reject(new i5(e,r))}}get D(){return this.S.promise}abort(e){e&&this.S.reject(e),this.aborted||(n9(i1,"Aborting transaction:",e?e.message:"Client-initiated abort"),this.aborted=!0,this.transaction.abort())}C(){let e=this.transaction;this.aborted||"function"!=typeof e.commit||e.commit()}store(e){return new i7(this.transaction.objectStore(e))}}class i6{static delete(e){return n9(i1,"Removing database:",e),i9(D().indexedDB.deleteDatabase(e)).toPromise()}static v(){if(!H())return!1;if(i6.F())return!0;let e=j(),t=i6.M(e),r=i3(e);return!(e.indexOf("MSIE ")>0||e.indexOf("Trident/")>0||e.indexOf("Edge/")>0||0<t&&t<10||0<r&&r<4.5)}static F(){return void 0!==E.default&&"YES"===E.default.__PRIVATE_env?.__PRIVATE_USE_MOCK_PERSISTENCE}static O(e,t){return e.store(t)}static M(e){let t=e.match(/i(?:phone|pad|pod) os ([\d_]+)/i);return Number(t?t[1].split("_").slice(0,2).join("."):"-1")}constructor(e,t,r){this.name=e,this.version=t,this.N=r,this.B=null,12.2===i6.M(j())&&ie("Firestore persistence suffers from a bug in iOS 12.2 Safari that may cause your app to stop working. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.")}async L(e){return this.db||(n9(i1,"Opening database:",this.name),this.db=await new Promise((t,r)=>{let n=indexedDB.open(this.name,this.version);n.onsuccess=e=>{t(e.target.result)},n.onblocked=()=>{r(new i5(e,"Cannot upgrade IndexedDB schema while another tab is open. Close all tabs that access Firestore and reload this page to proceed."))},n.onerror=t=>{let n=t.target.error;"VersionError"===n.name?r(new il(io.FAILED_PRECONDITION,"A newer version of the Firestore SDK was previously used and so the persisted data is not compatible with the version of the SDK you are now using. The SDK will operate with persistence disabled. If you need persistence, please re-upgrade to a newer version of the SDK or else clear the persisted IndexedDB data for your app to start fresh.")):"InvalidStateError"===n.name?r(new il(io.FAILED_PRECONDITION,"Unable to open an IndexedDB connection. This could be due to running in a private browsing session on a browser whose private browsing sessions do not support IndexedDB: "+n)):r(new i5(e,n))},n.onupgradeneeded=e=>{n9(i1,'Database "'+this.name+'" requires upgrade from version:',e.oldVersion);let t=e.target.result;this.N.k(t,n.transaction,e.oldVersion,this.version).next(()=>{n9(i1,"Database upgrade to version "+this.version+" complete")})}})),this.K&&(this.db.onversionchange=e=>this.K(e)),this.db}q(e){this.K=e,this.db&&(this.db.onversionchange=t=>e(t))}async runTransaction(e,t,r,n){let i="readonly"===t,s=0;for(;;){++s;try{this.db=await this.L(e);let t=i2.open(this.db,e,i?"readonly":"readwrite",r),s=n(t).next(e=>(t.C(),e)).catch(e=>(t.abort(e),i0.reject(e))).toPromise();return s.catch(()=>{}),await t.D,s}catch(t){let e="FirebaseError"!==t.name&&s<3;if(n9(i1,"Transaction failed with error:",t.message,"Retrying:",e),this.close(),!e)return Promise.reject(t)}}}close(){this.db&&this.db.close(),this.db=void 0}}function i3(e){let t=e.match(/Android ([\d.]+)/i);return Number(t?t[1].split(".").slice(0,2).join("."):"-1")}class i4{constructor(e){this.U=e,this.$=!1,this.W=null}get isDone(){return this.$}get G(){return this.W}set cursor(e){this.U=e}done(){this.$=!0}j(e){this.W=e}delete(){return i9(this.U.delete())}}class i5 extends il{constructor(e,t){super(io.UNAVAILABLE,`IndexedDB transaction '${e}' failed: ${t}`),this.name="IndexedDbTransactionError"}}function i8(e){return"IndexedDbTransactionError"===e.name}class i7{constructor(e){this.store=e}put(e,t){let r;return void 0!==t?(n9(i1,"PUT",this.store.name,e,t),r=this.store.put(t,e)):(n9(i1,"PUT",this.store.name,"<auto-key>",e),r=this.store.put(e)),i9(r)}add(e){return n9(i1,"ADD",this.store.name,e,e),i9(this.store.add(e))}get(e){return i9(this.store.get(e)).next(t=>(void 0===t&&(t=null),n9(i1,"GET",this.store.name,e,t),t))}delete(e){return n9(i1,"DELETE",this.store.name,e),i9(this.store.delete(e))}count(){return n9(i1,"COUNT",this.store.name),i9(this.store.count())}H(e,t){let r=this.options(e,t),n=r.index?this.store.index(r.index):this.store;if("function"==typeof n.getAll){let e=n.getAll(r.range);return new i0((t,r)=>{e.onerror=e=>{r(e.target.error)},e.onsuccess=e=>{t(e.target.result)}})}{let e=this.cursor(r),t=[];return this.J(e,(e,r)=>{t.push(r)}).next(()=>t)}}Z(e,t){let r=this.store.getAll(e,null===t?void 0:t);return new i0((e,t)=>{r.onerror=e=>{t(e.target.error)},r.onsuccess=t=>{e(t.target.result)}})}X(e,t){n9(i1,"DELETE ALL",this.store.name);let r=this.options(e,t);r.Y=!1;let n=this.cursor(r);return this.J(n,(e,t,r)=>r.delete())}ee(e,t){let r;t?r=e:(r={},t=e);let n=this.cursor(r);return this.J(n,t)}te(e){let t=this.cursor({});return new i0((r,n)=>{t.onerror=e=>{n(st(e.target.error))},t.onsuccess=t=>{let n=t.target.result;n?e(n.primaryKey,n.value).next(e=>{e?n.continue():r()}):r()}})}J(e,t){let r=[];return new i0((n,i)=>{e.onerror=e=>{i(e.target.error)},e.onsuccess=e=>{let i=e.target.result;if(!i)return void n();let s=new i4(i),a=t(i.primaryKey,i.value,s);if(a instanceof i0){let e=a.catch(e=>(s.done(),i0.reject(e)));r.push(e)}s.isDone?n():null===s.G?i.continue():i.continue(s.G)}}).next(()=>i0.waitFor(r))}options(e,t){let r;return void 0!==e&&("string"==typeof e?r=e:t=e),{index:r,range:t}}cursor(e){let t="next";if(e.reverse&&(t="prev"),e.index){let r=this.store.index(e.index);return e.Y?r.openKeyCursor(e.range,t):r.openCursor(e.range,t)}return this.store.openCursor(e.range,t)}}function i9(e){return new i0((t,r)=>{e.onsuccess=e=>{t(e.target.result)},e.onerror=e=>{r(st(e.target.error))}})}let se=!1;function st(e){let t=i6.M(j());if(t>=12.2&&t<13){let t="An internal error was encountered in the Indexed Database server";if(e.message.indexOf(t)>=0){let e=new il("internal",`IOS_INDEXEDDB_BUG1: IndexedDb has thrown '${t}'. This is likely due to an unavoidable bug in iOS. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.`);return se||(se=!0,setTimeout(()=>{throw e},0)),e}}return e}let sr="IndexBackfiller";class sn{constructor(e,t){this.asyncQueue=e,this.ne=t,this.task=null}start(){this.re(15e3)}stop(){this.task&&(this.task.cancel(),this.task=null)}get started(){return null!==this.task}re(e){n9(sr,`Scheduled in ${e}ms`),this.task=this.asyncQueue.enqueueAfterDelay("index_backfill",e,async()=>{this.task=null;try{let e=await this.ne.ie();n9(sr,`Documents written: ${e}`)}catch(e){i8(e)?n9(sr,"Ignoring IndexedDB error during index backfill: ",e):await iZ(e)}await this.re(6e4)})}}class si{constructor(e,t){this.localStore=e,this.persistence=t}async ie(e=50){return this.persistence.runTransaction("Backfill Indexes","readwrite-primary",t=>this.se(t,e))}se(e,t){let r=new Set,n=t,i=!0;return i0.doWhile(()=>!0===i&&n>0,()=>this.localStore.indexManager.getNextCollectionGroupToUpdate(e).next(t=>{if(null!==t&&!r.has(t))return n9(sr,`Processing collection: ${t}`),this.oe(e,t,n).next(e=>{n-=e,r.add(t)});i=!1})).next(()=>t-n)}oe(e,t,r){return this.localStore.indexManager.getMinOffsetFromCollectionGroup(e,t).next(n=>this.localStore.localDocuments.getNextDocuments(e,t,n,r).next(r=>{let i=r.changes;return this.localStore.indexManager.updateIndexEntries(e,i).next(()=>this._e(n,r)).next(r=>(n9(sr,`Updating offset: ${r}`),this.localStore.indexManager.updateCollectionGroup(e,t,r))).next(()=>i.size)}))}_e(e,t){let r=e;return t.changes.forEach((e,t)=>{let n=iW(t);iJ(n,r)>0&&(r=n)}),new iQ(r.readTime,r.documentKey,Math.max(t.batchId,e.largestBatchId))}}class ss{constructor(e,t){this.previousValue=e,t&&(t.sequenceNumberHandler=e=>this.ae(e),this.ue=e=>t.writeSequenceNumber(e))}ae(e){return this.previousValue=Math.max(e,this.previousValue),this.previousValue}next(){let e=++this.previousValue;return this.ue&&this.ue(e),e}}function sa(e){return null==e}function so(e){return 0===e&&1/e==-1/0}function sl(e){return"number"==typeof e&&Number.isInteger(e)&&!so(e)&&e<=Number.MAX_SAFE_INTEGER&&e>=Number.MIN_SAFE_INTEGER}function su(e){let t="";for(let r=0;r<e.length;r++)t.length>0&&(t+="\x01\x01"),t=function(e,t){let r=t,n=e.length;for(let t=0;t<n;t++){let n=e.charAt(t);switch(n){case"\0":r+="\x01\x10";break;case"\x01":r+="\x01\x11";break;default:r+=n}}return r}(e.get(r),t);return t+"\x01\x01"}ss.ce=-1;function sh(e){let t=e.length;if(ia(t>=2,64408,{path:e}),2===t)return ia("\x01"===e.charAt(0)&&"\x01"===e.charAt(1),56145,{path:e}),iC.emptyPath();let r=t-2,n=[],i="";for(let s=0;s<t;){let t=e.indexOf("\x01",s);switch((t<0||t>r)&&ii(50515,{path:e}),e.charAt(t+1)){case"\x01":let a,o=e.substring(s,t);0===i.length?a=o:(i+=o,a=i,i=""),n.push(a);break;case"\x10":i+=e.substring(s,t),i+="\0";break;case"\x11":i+=e.substring(s,t+1);break;default:ii(61167,{path:e})}s=t+2}return new iC(n)}let sc="remoteDocuments",sd="owner",sf="owner",sp="mutationQueues",sm="mutations",sg="batchId",sy="userMutationsIndex",sw=["userId","batchId"],sv={},s_="documentMutations",sI="remoteDocumentsV14",sb=["prefixPath","collectionGroup","readTime","documentId"],sE="documentKeyIndex",sT=["prefixPath","collectionGroup","documentId"],sS="collectionGroupIndex",sC=["collectionGroup","readTime","prefixPath","documentId"],sA="remoteDocumentGlobal",sk="remoteDocumentGlobalKey",sx="targets",sN="queryTargetsIndex",sD=["canonicalId","targetId"],sR="targetDocuments",sP=["targetId","path"],sO="documentTargetsIndex",sL=["path","targetId"],sM="targetGlobalKey",sF="targetGlobal",sV="collectionParents",sU=["collectionId","parent"],sB="clientMetadata",sq="bundles",sj="namedQueries",sz="indexConfiguration",s$="collectionGroupIndex",sK="indexState",sG=["indexId","uid"],sH="sequenceNumberIndex",sW=["uid","sequenceNumber"],sQ="indexEntries",sJ=["indexId","uid","arrayValue","directionalValue","orderedDocumentKey","documentKey"],sY="documentKeyIndex",sX=["indexId","uid","orderedDocumentKey"],sZ="documentOverlays",s0=["userId","collectionPath","documentId"],s1="collectionPathOverlayIndex",s2=["userId","collectionPath","largestBatchId"],s6="collectionGroupOverlayIndex",s3=["userId","collectionGroup","largestBatchId"],s4="globals",s5=[sp,sm,s_,sc,sx,sd,sF,sR,sB,sA,sV,sq,sj],s8=[...s5,sZ],s7=[sp,sm,s_,sI,sx,sd,sF,sR,sB,sA,sV,sq,sj,sZ],s9=[...s7,sz,sK,sQ],ae=[...s9,s4];class at extends iX{constructor(e,t){super(),this.le=e,this.currentSequenceNumber=t}}function ar(e,t){return i6.O(e.le,t)}function an(e){let t=0;for(let r in e)Object.prototype.hasOwnProperty.call(e,r)&&t++;return t}function ai(e,t){for(let r in e)Object.prototype.hasOwnProperty.call(e,r)&&t(r,e[r])}function as(e){for(let t in e)if(Object.prototype.hasOwnProperty.call(e,t))return!1;return!0}class aa{constructor(e,t){this.comparator=e,this.root=t||al.EMPTY}insert(e,t){return new aa(this.comparator,this.root.insert(e,t,this.comparator).copy(null,null,al.BLACK,null,null))}remove(e){return new aa(this.comparator,this.root.remove(e,this.comparator).copy(null,null,al.BLACK,null,null))}get(e){let t=this.root;for(;!t.isEmpty();){let r=this.comparator(e,t.key);if(0===r)return t.value;r<0?t=t.left:r>0&&(t=t.right)}return null}indexOf(e){let t=0,r=this.root;for(;!r.isEmpty();){let n=this.comparator(e,r.key);if(0===n)return t+r.left.size;n<0?r=r.left:(t+=r.left.size+1,r=r.right)}return -1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(e){this.inorderTraversal((t,r)=>(e(t,r),!1))}toString(){let e=[];return this.inorderTraversal((t,r)=>(e.push(`${t}:${r}`),!1)),`{${e.join(", ")}}`}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new ao(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new ao(this.root,e,this.comparator,!1)}getReverseIterator(){return new ao(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new ao(this.root,e,this.comparator,!0)}}class ao{constructor(e,t,r,n){this.isReverse=n,this.nodeStack=[];let i=1;for(;!e.isEmpty();)if(i=t?r(e.key,t):1,t&&n&&(i*=-1),i<0)e=this.isReverse?e.left:e.right;else{if(0===i){this.nodeStack.push(e);break}this.nodeStack.push(e),e=this.isReverse?e.right:e.left}}getNext(){let e=this.nodeStack.pop(),t={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return t}hasNext(){return this.nodeStack.length>0}peek(){if(0===this.nodeStack.length)return null;let e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}}class al{constructor(e,t,r,n,i){this.key=e,this.value=t,this.color=null!=r?r:al.RED,this.left=null!=n?n:al.EMPTY,this.right=null!=i?i:al.EMPTY,this.size=this.left.size+1+this.right.size}copy(e,t,r,n,i){return new al(null!=e?e:this.key,null!=t?t:this.value,null!=r?r:this.color,null!=n?n:this.left,null!=i?i:this.right)}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,t,r){let n=this,i=r(e,n.key);return(n=i<0?n.copy(null,null,null,n.left.insert(e,t,r),null):0===i?n.copy(null,t,null,null,null):n.copy(null,null,null,null,n.right.insert(e,t,r))).fixUp()}removeMin(){if(this.left.isEmpty())return al.EMPTY;let e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),(e=e.copy(null,null,null,e.left.removeMin(),null)).fixUp()}remove(e,t){let r,n=this;if(0>t(e,n.key))n.left.isEmpty()||n.left.isRed()||n.left.left.isRed()||(n=n.moveRedLeft()),n=n.copy(null,null,null,n.left.remove(e,t),null);else{if(n.left.isRed()&&(n=n.rotateRight()),n.right.isEmpty()||n.right.isRed()||n.right.left.isRed()||(n=n.moveRedRight()),0===t(e,n.key)){if(n.right.isEmpty())return al.EMPTY;r=n.right.min(),n=n.copy(r.key,r.value,null,null,n.right.removeMin())}n=n.copy(null,null,null,null,n.right.remove(e,t))}return n.fixUp()}isRed(){return this.color}fixUp(){let e=this;return e.right.isRed()&&!e.left.isRed()&&(e=e.rotateLeft()),e.left.isRed()&&e.left.left.isRed()&&(e=e.rotateRight()),e.left.isRed()&&e.right.isRed()&&(e=e.colorFlip()),e}moveRedLeft(){let e=this.colorFlip();return e.right.left.isRed()&&(e=(e=(e=e.copy(null,null,null,null,e.right.rotateRight())).rotateLeft()).colorFlip()),e}moveRedRight(){let e=this.colorFlip();return e.left.left.isRed()&&(e=(e=e.rotateRight()).colorFlip()),e}rotateLeft(){let e=this.copy(null,null,al.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight(){let e=this.copy(null,null,al.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip(){let e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}checkMaxDepth(){return Math.pow(2,this.check())<=this.size+1}check(){if(this.isRed()&&this.left.isRed())throw ii(43730,{key:this.key,value:this.value});if(this.right.isRed())throw ii(14113,{key:this.key,value:this.value});let e=this.left.check();if(e!==this.right.check())throw ii(27949);return e+ +!this.isRed()}}al.EMPTY=null,al.RED=!0,al.BLACK=!1,al.EMPTY=new class{constructor(){this.size=0}get key(){throw ii(57766)}get value(){throw ii(16141)}get color(){throw ii(16727)}get left(){throw ii(29726)}get right(){throw ii(36894)}copy(e,t,r,n,i){return this}insert(e,t,r){return new al(e,t)}remove(e,t){return this}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};class au{constructor(e){this.comparator=e,this.data=new aa(this.comparator)}has(e){return null!==this.data.get(e)}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(e){this.data.inorderTraversal((t,r)=>(e(t),!1))}forEachInRange(e,t){let r=this.data.getIteratorFrom(e[0]);for(;r.hasNext();){let n=r.getNext();if(this.comparator(n.key,e[1])>=0)return;t(n.key)}}forEachWhile(e,t){let r;for(r=void 0!==t?this.data.getIteratorFrom(t):this.data.getIterator();r.hasNext();)if(!e(r.getNext().key))return}firstAfterOrEqual(e){let t=this.data.getIteratorFrom(e);return t.hasNext()?t.getNext().key:null}getIterator(){return new ah(this.data.getIterator())}getIteratorFrom(e){return new ah(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let t=this;return t.size<e.size&&(t=e,e=this),e.forEach(e=>{t=t.add(e)}),t}isEqual(e){if(!(e instanceof au)||this.size!==e.size)return!1;let t=this.data.getIterator(),r=e.data.getIterator();for(;t.hasNext();){let e=t.getNext().key,n=r.getNext().key;if(0!==this.comparator(e,n))return!1}return!0}toArray(){let e=[];return this.forEach(t=>{e.push(t)}),e}toString(){let e=[];return this.forEach(t=>e.push(t)),"SortedSet("+e.toString()+")"}copy(e){let t=new au(this.comparator);return t.data=e,t}}class ah{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}function ac(e){return e.hasNext()?e.getNext():void 0}class ad{constructor(e){this.fields=e,e.sort(ik.comparator)}static empty(){return new ad([])}unionWith(e){let t=new au(ik.comparator);for(let e of this.fields)t=t.add(e);for(let r of e)t=t.add(r);return new ad(t.toArray())}covers(e){for(let t of this.fields)if(t.isPrefixOf(e))return!0;return!1}isEqual(e){return iE(this.fields,e.fields,(e,t)=>e.isEqual(t))}}class af extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}}class ap{constructor(e){this.binaryString=e}static fromBase64String(e){return new ap(function(e){try{return atob(e)}catch(e){throw"u">typeof DOMException&&e instanceof DOMException?new af("Invalid base64 string: "+e):e}}(e))}static fromUint8Array(e){return new ap(function(e){let t="";for(let r=0;r<e.length;++r)t+=String.fromCharCode(e[r]);return t}(e))}[Symbol.iterator](){let e=0;return{next:()=>e<this.binaryString.length?{value:this.binaryString.charCodeAt(e++),done:!1}:{value:void 0,done:!0}}}toBase64(){return btoa(this.binaryString)}toUint8Array(){var e=this.binaryString;let t=new Uint8Array(e.length);for(let r=0;r<e.length;r++)t[r]=e.charCodeAt(r);return t}approximateByteSize(){return 2*this.binaryString.length}compareTo(e){return i_(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}}ap.EMPTY_BYTE_STRING=new ap("");let am=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function ag(e){if(ia(!!e,39018),"string"==typeof e){let t=0,r=am.exec(e);if(ia(!!r,46558,{timestamp:e}),r[1]){let e=r[1];t=Number(e=(e+"000000000").substr(0,9))}return{seconds:Math.floor(new Date(e).getTime()/1e3),nanos:t}}return{seconds:ay(e.seconds),nanos:ay(e.nanos)}}function ay(e){return"number"==typeof e?e:"string"==typeof e?Number(e):0}function aw(e){return"string"==typeof e?ap.fromBase64String(e):ap.fromUint8Array(e)}let av="server_timestamp",a_="__type__",aI="__previous_value__",ab="__local_write_time__";function aE(e){return(e?.mapValue?.fields||{})[a_]?.stringValue===av}function aT(e){let t=e.mapValue.fields[aI];return aE(t)?aT(t):t}function aS(e){let t=ag(e.mapValue.fields[ab].timestampValue);return new iU(t.seconds,t.nanos)}class aC{constructor(e,t,r,n,i,s,a,o,l,u,h){this.databaseId=e,this.appId=t,this.persistenceKey=r,this.host=n,this.ssl=i,this.forceLongPolling=s,this.autoDetectLongPolling=a,this.longPollingOptions=o,this.useFetchStreams=l,this.isUsingEmulator=u,this.apiKey=h}}let aA="(default)";class ak{constructor(e,t){this.projectId=e,this.database=t||aA}static empty(){return new ak("","")}get isDefaultDatabase(){return this.database===aA}isEqual(e){return e instanceof ak&&e.projectId===this.projectId&&e.database===this.database}}let ax="__type__",aN="__max__",aD={mapValue:{fields:{__type__:{stringValue:aN}}}},aR="__vector__",aP="value",aO={nullValue:"NULL_VALUE"};function aL(e){return"nullValue"in e?0:"booleanValue"in e?1:"integerValue"in e||"doubleValue"in e?2:"timestampValue"in e?3:"stringValue"in e?5:"bytesValue"in e?6:"referenceValue"in e?7:"geoPointValue"in e?8:"arrayValue"in e?9:"mapValue"in e?aE(e)?4:aJ(e)?0x1fffffffffffff:aW(e)?10:11:ii(28295,{value:e})}function aM(e,t){if(e===t)return!0;let r=aL(e);if(r!==aL(t))return!1;switch(r){case 0:case 0x1fffffffffffff:return!0;case 1:return e.booleanValue===t.booleanValue;case 4:return aS(e).isEqual(aS(t));case 3:if("string"==typeof e.timestampValue&&"string"==typeof t.timestampValue&&e.timestampValue.length===t.timestampValue.length)return e.timestampValue===t.timestampValue;let n=ag(e.timestampValue),i=ag(t.timestampValue);return n.seconds===i.seconds&&n.nanos===i.nanos;case 5:return e.stringValue===t.stringValue;case 6:return aw(e.bytesValue).isEqual(aw(t.bytesValue));case 7:return e.referenceValue===t.referenceValue;case 8:return ay(e.geoPointValue.latitude)===ay(t.geoPointValue.latitude)&&ay(e.geoPointValue.longitude)===ay(t.geoPointValue.longitude);case 2:if("integerValue"in e&&"integerValue"in t)return ay(e.integerValue)===ay(t.integerValue);if("doubleValue"in e&&"doubleValue"in t){let r=ay(e.doubleValue),n=ay(t.doubleValue);return r===n?so(r)===so(n):isNaN(r)&&isNaN(n)}return!1;case 9:return iE(e.arrayValue.values||[],t.arrayValue.values||[],aM);case 10:case 11:let s=e.mapValue.fields||{},a=t.mapValue.fields||{};if(an(s)!==an(a))return!1;for(let e in s)if(s.hasOwnProperty(e)&&(void 0===a[e]||!aM(s[e],a[e])))return!1;return!0;default:return ii(52216,{left:e})}}function aF(e,t){return void 0!==(e.values||[]).find(e=>aM(e,t))}function aV(e,t){var r,n,i,s,a,o;if(e===t)return 0;let l=aL(e),u=aL(t);if(l!==u)return i_(l,u);switch(l){case 0:case 0x1fffffffffffff:return 0;case 1:return i_(e.booleanValue,t.booleanValue);case 2:let h,c;return h=ay(e.integerValue||e.doubleValue),h<(c=ay(t.integerValue||t.doubleValue))?-1:h>c?1:h===c?0:isNaN(h)?isNaN(c)?0:-1:1;case 3:return aU(e.timestampValue,t.timestampValue);case 4:return aU(aS(e),aS(t));case 5:return iI(e.stringValue,t.stringValue);case 6:let d,f;return r=e.bytesValue,n=t.bytesValue,d=aw(r),f=aw(n),d.compareTo(f);case 7:return function(e,t){let r=e.split("/"),n=t.split("/");for(let e=0;e<r.length&&e<n.length;e++){let t=i_(r[e],n[e]);if(0!==t)return t}return i_(r.length,n.length)}(e.referenceValue,t.referenceValue);case 8:let p;return i=e.geoPointValue,s=t.geoPointValue,0!==(p=i_(ay(i.latitude),ay(s.latitude)))?p:i_(ay(i.longitude),ay(s.longitude));case 9:return aB(e.arrayValue,t.arrayValue);case 10:let m,g,y,w,v;return a=e.mapValue,o=t.mapValue,m=a.fields||{},g=o.fields||{},y=m[aP]?.arrayValue,w=g[aP]?.arrayValue,0!==(v=i_(y?.values?.length||0,w?.values?.length||0))?v:aB(y,w);case 11:return function(e,t){if(e===aD.mapValue&&t===aD.mapValue)return 0;if(e===aD.mapValue)return 1;if(t===aD.mapValue)return -1;let r=e.fields||{},n=Object.keys(r),i=t.fields||{},s=Object.keys(i);n.sort(),s.sort();for(let e=0;e<n.length&&e<s.length;++e){let t=iI(n[e],s[e]);if(0!==t)return t;let a=aV(r[n[e]],i[s[e]]);if(0!==a)return a}return i_(n.length,s.length)}(e.mapValue,t.mapValue);default:throw ii(23264,{he:l})}}function aU(e,t){if("string"==typeof e&&"string"==typeof t&&e.length===t.length)return i_(e,t);let r=ag(e),n=ag(t),i=i_(r.seconds,n.seconds);return 0!==i?i:i_(r.nanos,n.nanos)}function aB(e,t){let r=e.values||[],n=t.values||[];for(let e=0;e<r.length&&e<n.length;++e){let t=aV(r[e],n[e]);if(t)return t}return i_(r.length,n.length)}function aq(e){var t,r;let n;return"nullValue"in e?"null":"booleanValue"in e?""+e.booleanValue:"integerValue"in e?""+e.integerValue:"doubleValue"in e?""+e.doubleValue:"timestampValue"in e?(n=ag(e.timestampValue),`time(${n.seconds},${n.nanos})`):"stringValue"in e?e.stringValue:"bytesValue"in e?aw(e.bytesValue).toBase64():"referenceValue"in e?(t=e.referenceValue,ix.fromName(t).toString()):"geoPointValue"in e?(r=e.geoPointValue,`geo(${r.latitude},${r.longitude})`):"arrayValue"in e?function(e){let t="[",r=!0;for(let n of e.values||[])r?r=!1:t+=",",t+=aq(n);return t+"]"}(e.arrayValue):"mapValue"in e?function(e){let t=Object.keys(e.fields||{}).sort(),r="{",n=!0;for(let i of t)n?n=!1:r+=",",r+=`${i}:${aq(e.fields[i])}`;return r+"}"}(e.mapValue):ii(61005,{value:e})}function aj(e,t){return{referenceValue:`projects/${e.projectId}/databases/${e.database}/documents/${t.path.canonicalString()}`}}function az(e){return!!e&&"integerValue"in e}function a$(e){return!!e&&"arrayValue"in e}function aK(e){return!!e&&"nullValue"in e}function aG(e){return!!e&&"doubleValue"in e&&isNaN(Number(e.doubleValue))}function aH(e){return!!e&&"mapValue"in e}function aW(e){return(e?.mapValue?.fields||{})[ax]?.stringValue===aR}function aQ(e){if(e.geoPointValue)return{geoPointValue:{...e.geoPointValue}};if(e.timestampValue&&"object"==typeof e.timestampValue)return{timestampValue:{...e.timestampValue}};if(e.mapValue){let t={mapValue:{fields:{}}};return ai(e.mapValue.fields,(e,r)=>t.mapValue.fields[e]=aQ(r)),t}if(e.arrayValue){let t={arrayValue:{values:[]}};for(let r=0;r<(e.arrayValue.values||[]).length;++r)t.arrayValue.values[r]=aQ(e.arrayValue.values[r]);return t}return{...e}}function aJ(e){return(((e.mapValue||{}).fields||{}).__type__||{}).stringValue===aN}let aY={mapValue:{fields:{[ax]:{stringValue:aR},[aP]:{arrayValue:{}}}}};function aX(e,t){let r=aV(e.value,t.value);return 0!==r?r:e.inclusive&&!t.inclusive?-1:!e.inclusive&&t.inclusive?1:0}function aZ(e,t){let r=aV(e.value,t.value);return 0!==r?r:e.inclusive&&!t.inclusive?1:!e.inclusive&&t.inclusive?-1:0}class a0{constructor(e){this.value=e}static empty(){return new a0({mapValue:{}})}field(e){if(e.isEmpty())return this.value;{let t=this.value;for(let r=0;r<e.length-1;++r)if(!aH(t=(t.mapValue.fields||{})[e.get(r)]))return null;return(t=(t.mapValue.fields||{})[e.lastSegment()])||null}}set(e,t){this.getFieldsMap(e.popLast())[e.lastSegment()]=aQ(t)}setAll(e){let t=ik.emptyPath(),r={},n=[];e.forEach((e,i)=>{if(!t.isImmediateParentOf(i)){let e=this.getFieldsMap(t);this.applyChanges(e,r,n),r={},n=[],t=i.popLast()}e?r[i.lastSegment()]=aQ(e):n.push(i.lastSegment())});let i=this.getFieldsMap(t);this.applyChanges(i,r,n)}delete(e){let t=this.field(e.popLast());aH(t)&&t.mapValue.fields&&delete t.mapValue.fields[e.lastSegment()]}isEqual(e){return aM(this.value,e.value)}getFieldsMap(e){let t=this.value;t.mapValue.fields||(t.mapValue={fields:{}});for(let r=0;r<e.length;++r){let n=t.mapValue.fields[e.get(r)];aH(n)&&n.mapValue.fields||(n={mapValue:{fields:{}}},t.mapValue.fields[e.get(r)]=n),t=n}return t.mapValue.fields}applyChanges(e,t,r){for(let n of(ai(t,(t,r)=>e[t]=r),r))delete e[n]}clone(){return new a0(aQ(this.value))}}class a1{constructor(e,t,r,n,i,s,a){this.key=e,this.documentType=t,this.version=r,this.readTime=n,this.createTime=i,this.data=s,this.documentState=a}static newInvalidDocument(e){return new a1(e,0,iB.min(),iB.min(),iB.min(),a0.empty(),0)}static newFoundDocument(e,t,r,n){return new a1(e,1,t,iB.min(),r,n,0)}static newNoDocument(e,t){return new a1(e,2,t,iB.min(),iB.min(),a0.empty(),0)}static newUnknownDocument(e,t){return new a1(e,3,t,iB.min(),iB.min(),a0.empty(),2)}convertToFoundDocument(e,t){return this.createTime.isEqual(iB.min())&&(2===this.documentType||0===this.documentType)&&(this.createTime=e),this.version=e,this.documentType=1,this.data=t,this.documentState=0,this}convertToNoDocument(e){return this.version=e,this.documentType=2,this.data=a0.empty(),this.documentState=0,this}convertToUnknownDocument(e){return this.version=e,this.documentType=3,this.data=a0.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=iB.min(),this}setReadTime(e){return this.readTime=e,this}get hasLocalMutations(){return 1===this.documentState}get hasCommittedMutations(){return 2===this.documentState}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return 0!==this.documentType}isFoundDocument(){return 1===this.documentType}isNoDocument(){return 2===this.documentType}isUnknownDocument(){return 3===this.documentType}isEqual(e){return e instanceof a1&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)}mutableCopy(){return new a1(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}class a2{constructor(e,t){this.position=e,this.inclusive=t}}function a6(e,t,r){let n=0;for(let i=0;i<e.position.length;i++){let s=t[i],a=e.position[i];if(n=s.field.isKeyField()?ix.comparator(ix.fromName(a.referenceValue),r.key):aV(a,r.data.field(s.field)),"desc"===s.dir&&(n*=-1),0!==n)break}return n}function a3(e,t){if(null===e)return null===t;if(null===t||e.inclusive!==t.inclusive||e.position.length!==t.position.length)return!1;for(let r=0;r<e.position.length;r++)if(!aM(e.position[r],t.position[r]))return!1;return!0}class a4{constructor(e,t="asc"){this.field=e,this.dir=t}}class a5{}class a8 extends a5{constructor(e,t,r){super(),this.field=e,this.op=t,this.value=r}static create(e,t,r){return e.isKeyField()?"in"===t||"not-in"===t?this.createKeyFieldInFilter(e,t,r):new oi(e,t,r):"array-contains"===t?new ol(e,r):"in"===t?new ou(e,r):"not-in"===t?new oh(e,r):"array-contains-any"===t?new oc(e,r):new a8(e,t,r)}static createKeyFieldInFilter(e,t,r){return"in"===t?new os(e,r):new oa(e,r)}matches(e){let t=e.data.field(this.field);return"!="===this.op?null!==t&&void 0===t.nullValue&&this.matchesComparison(aV(t,this.value)):null!==t&&aL(this.value)===aL(t)&&this.matchesComparison(aV(t,this.value))}matchesComparison(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return 0===e;case"!=":return 0!==e;case">":return e>0;case">=":return e>=0;default:return ii(47266,{operator:this.op})}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}}class a7 extends a5{constructor(e,t){super(),this.filters=e,this.op=t,this.Pe=null}static create(e,t){return new a7(e,t)}matches(e){return a9(this)?void 0===this.filters.find(t=>!t.matches(e)):void 0!==this.filters.find(t=>t.matches(e))}getFlattenedFilters(){return null!==this.Pe||(this.Pe=this.filters.reduce((e,t)=>e.concat(t.getFlattenedFilters()),[])),this.Pe}getFilters(){return Object.assign([],this.filters)}}function a9(e){return"and"===e.op}function oe(e){return"or"===e.op}function ot(e){return or(e)&&a9(e)}function or(e){for(let t of e.filters)if(t instanceof a7)return!1;return!0}function on(e,t){let r=e.filters.concat(t);return a7.create(r,e.op)}class oi extends a8{constructor(e,t,r){super(e,t,r),this.key=ix.fromName(r.referenceValue)}matches(e){let t=ix.comparator(e.key,this.key);return this.matchesComparison(t)}}class os extends a8{constructor(e,t){super(e,"in",t),this.keys=oo("in",t)}matches(e){return this.keys.some(t=>t.isEqual(e.key))}}class oa extends a8{constructor(e,t){super(e,"not-in",t),this.keys=oo("not-in",t)}matches(e){return!this.keys.some(t=>t.isEqual(e.key))}}function oo(e,t){return(t.arrayValue?.values||[]).map(e=>ix.fromName(e.referenceValue))}class ol extends a8{constructor(e,t){super(e,"array-contains",t)}matches(e){let t=e.data.field(this.field);return a$(t)&&aF(t.arrayValue,this.value)}}class ou extends a8{constructor(e,t){super(e,"in",t)}matches(e){let t=e.data.field(this.field);return null!==t&&aF(this.value.arrayValue,t)}}class oh extends a8{constructor(e,t){super(e,"not-in",t)}matches(e){if(aF(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;let t=e.data.field(this.field);return null!==t&&void 0===t.nullValue&&!aF(this.value.arrayValue,t)}}class oc extends a8{constructor(e,t){super(e,"array-contains-any",t)}matches(e){let t=e.data.field(this.field);return!(!a$(t)||!t.arrayValue.values)&&t.arrayValue.values.some(e=>aF(this.value.arrayValue,e))}}class od{constructor(e,t=null,r=[],n=[],i=null,s=null,a=null){this.path=e,this.collectionGroup=t,this.orderBy=r,this.filters=n,this.limit=i,this.startAt=s,this.endAt=a,this.Te=null}}function of(e,t=null,r=[],n=[],i=null,s=null,a=null){return new od(e,t,r,n,i,s,a)}function op(e){if(null===e.Te){let t=e.path.canonicalString();null!==e.collectionGroup&&(t+="|cg:"+e.collectionGroup),t+="|f:",t+=e.filters.map(e=>(function e(t){if(t instanceof a8)return t.field.canonicalString()+t.op.toString()+aq(t.value);if(ot(t))return t.filters.map(t=>e(t)).join(",");{let r=t.filters.map(t=>e(t)).join(",");return`${t.op}(${r})`}})(e)).join(","),t+="|ob:",t+=e.orderBy.map(e=>e.field.canonicalString()+e.dir).join(","),sa(e.limit)||(t+="|l:",t+=e.limit),e.startAt&&(t+="|lb:",t+=e.startAt.inclusive?"b:":"a:",t+=e.startAt.position.map(e=>aq(e)).join(",")),e.endAt&&(t+="|ub:",t+=e.endAt.inclusive?"a:":"b:",t+=e.endAt.position.map(e=>aq(e)).join(",")),e.Te=t}return e.Te}function om(e,t){if(e.limit!==t.limit||e.orderBy.length!==t.orderBy.length)return!1;for(let i=0;i<e.orderBy.length;i++){var r,n;if(r=e.orderBy[i],n=t.orderBy[i],!(r.dir===n.dir&&r.field.isEqual(n.field)))return!1}if(e.filters.length!==t.filters.length)return!1;for(let r=0;r<e.filters.length;r++)if(!function e(t,r){return t instanceof a8?r instanceof a8&&t.op===r.op&&t.field.isEqual(r.field)&&aM(t.value,r.value):t instanceof a7?r instanceof a7&&t.op===r.op&&t.filters.length===r.filters.length&&t.filters.reduce((t,n,i)=>t&&e(n,r.filters[i]),!0):void ii(19439)}(e.filters[r],t.filters[r]))return!1;return e.collectionGroup===t.collectionGroup&&!!e.path.isEqual(t.path)&&!!a3(e.startAt,t.startAt)&&a3(e.endAt,t.endAt)}function og(e){return ix.isDocumentKey(e.path)&&null===e.collectionGroup&&0===e.filters.length}function oy(e,t){return e.filters.filter(e=>e instanceof a8&&e.field.isEqual(t))}function ow(e,t,r){let n=aO,i=!0;for(let r of oy(e,t)){let e=aO,t=!0;switch(r.op){case"<":case"<=":var s;e="nullValue"in(s=r.value)?aO:"booleanValue"in s?{booleanValue:!1}:"integerValue"in s||"doubleValue"in s?{doubleValue:NaN}:"timestampValue"in s?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"stringValue"in s?{stringValue:""}:"bytesValue"in s?{bytesValue:""}:"referenceValue"in s?aj(ak.empty(),ix.empty()):"geoPointValue"in s?{geoPointValue:{latitude:-90,longitude:-180}}:"arrayValue"in s?{arrayValue:{}}:"mapValue"in s?aW(s)?aY:{mapValue:{}}:ii(35942,{value:s});break;case"==":case"in":case">=":e=r.value;break;case">":e=r.value,t=!1;break;case"!=":case"not-in":e=aO}0>aX({value:n,inclusive:i},{value:e,inclusive:t})&&(n=e,i=t)}if(null!==r){for(let s=0;s<e.orderBy.length;++s)if(e.orderBy[s].field.isEqual(t)){let e=r.position[s];0>aX({value:n,inclusive:i},{value:e,inclusive:r.inclusive})&&(n=e,i=r.inclusive);break}}return{value:n,inclusive:i}}function ov(e,t,r){let n=aD,i=!0;for(let r of oy(e,t)){let e=aD,t=!0;switch(r.op){case">=":case">":var s;e="nullValue"in(s=r.value)?{booleanValue:!1}:"booleanValue"in s?{doubleValue:NaN}:"integerValue"in s||"doubleValue"in s?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"timestampValue"in s?{stringValue:""}:"stringValue"in s?{bytesValue:""}:"bytesValue"in s?aj(ak.empty(),ix.empty()):"referenceValue"in s?{geoPointValue:{latitude:-90,longitude:-180}}:"geoPointValue"in s?{arrayValue:{}}:"arrayValue"in s?aY:"mapValue"in s?aW(s)?{mapValue:{}}:aD:ii(61959,{value:s}),t=!1;break;case"==":case"in":case"<=":e=r.value;break;case"<":e=r.value,t=!1;break;case"!=":case"not-in":e=aD}aZ({value:n,inclusive:i},{value:e,inclusive:t})>0&&(n=e,i=t)}if(null!==r){for(let s=0;s<e.orderBy.length;++s)if(e.orderBy[s].field.isEqual(t)){let e=r.position[s];aZ({value:n,inclusive:i},{value:e,inclusive:r.inclusive})>0&&(n=e,i=r.inclusive);break}}return{value:n,inclusive:i}}class o_{constructor(e,t=null,r=[],n=[],i=null,s="F",a=null,o=null){this.path=e,this.collectionGroup=t,this.explicitOrderBy=r,this.filters=n,this.limit=i,this.limitType=s,this.startAt=a,this.endAt=o,this.Ie=null,this.Ee=null,this.Re=null,this.startAt,this.endAt}}function oI(e){return new o_(e)}function ob(e){return 0===e.filters.length&&null===e.limit&&null==e.startAt&&null==e.endAt&&(0===e.explicitOrderBy.length||1===e.explicitOrderBy.length&&e.explicitOrderBy[0].field.isKeyField())}function oE(e){return null!==e.collectionGroup}function oT(e){if(null===e.Ie){let t;e.Ie=[];let r=new Set;for(let t of e.explicitOrderBy)e.Ie.push(t),r.add(t.field.canonicalString());let n=e.explicitOrderBy.length>0?e.explicitOrderBy[e.explicitOrderBy.length-1].dir:"asc";(t=new au(ik.comparator),e.filters.forEach(e=>{e.getFlattenedFilters().forEach(e=>{e.isInequality()&&(t=t.add(e.field))})}),t).forEach(t=>{r.has(t.canonicalString())||t.isKeyField()||e.Ie.push(new a4(t,n))}),r.has(ik.keyField().canonicalString())||e.Ie.push(new a4(ik.keyField(),n))}return e.Ie}function oS(e){return e.Ee||(e.Ee=oC(e,oT(e))),e.Ee}function oC(e,t){if("F"===e.limitType)return of(e.path,e.collectionGroup,t,e.filters,e.limit,e.startAt,e.endAt);{t=t.map(e=>{let t="desc"===e.dir?"asc":"desc";return new a4(e.field,t)});let r=e.endAt?new a2(e.endAt.position,e.endAt.inclusive):null,n=e.startAt?new a2(e.startAt.position,e.startAt.inclusive):null;return of(e.path,e.collectionGroup,t,e.filters,e.limit,r,n)}}function oA(e,t){let r=e.filters.concat([t]);return new o_(e.path,e.collectionGroup,e.explicitOrderBy.slice(),r,e.limit,e.limitType,e.startAt,e.endAt)}function ok(e,t,r){return new o_(e.path,e.collectionGroup,e.explicitOrderBy.slice(),e.filters.slice(),t,r,e.startAt,e.endAt)}function ox(e,t){return om(oS(e),oS(t))&&e.limitType===t.limitType}function oN(e){return`${op(oS(e))}|lt:${e.limitType}`}function oD(e){var t;let r;return`Query(target=${r=(t=oS(e)).path.canonicalString(),null!==t.collectionGroup&&(r+=" collectionGroup="+t.collectionGroup),t.filters.length>0&&(r+=`, filters: [${t.filters.map(e=>(function e(t){return t instanceof a8?`${t.field.canonicalString()} ${t.op} ${aq(t.value)}`:t instanceof a7?t.op.toString()+" {"+t.getFilters().map(e).join(" ,")+"}":"Filter"})(e)).join(", ")}]`),sa(t.limit)||(r+=", limit: "+t.limit),t.orderBy.length>0&&(r+=`, orderBy: [${t.orderBy.map(e=>`${e.field.canonicalString()} (${e.dir})`).join(", ")}]`),t.startAt&&(r+=", startAt: ",r+=t.startAt.inclusive?"b:":"a:",r+=t.startAt.position.map(e=>aq(e)).join(",")),t.endAt&&(r+=", endAt: ",r+=t.endAt.inclusive?"a:":"b:",r+=t.endAt.position.map(e=>aq(e)).join(",")),`Target(${r})`}; limitType=${e.limitType})`}function oR(e,t){var r,n,i,s;let a,o,l;return t.isFoundDocument()&&(a=t.key.path,null!==e.collectionGroup?t.key.hasCollectionId(e.collectionGroup)&&e.path.isPrefixOf(a):ix.isDocumentKey(e.path)?e.path.isEqual(a):e.path.isImmediateParentOf(a))&&function(e,t){for(let r of oT(e))if(!r.field.isKeyField()&&null===t.data.field(r.field))return!1;return!0}(e,t)&&function(e,t){for(let r of e.filters)if(!r.matches(t))return!1;return!0}(e,t)&&(r=e,n=t,(!r.startAt||(i=r.startAt,o=a6(i,oT(r),n),i.inclusive?!!(o<=0):!!(o<0)))&&(!r.endAt||(s=r.endAt,l=a6(s,oT(r),n),s.inclusive?!!(l>=0):!!(l>0))))}function oP(e){return e.collectionGroup||(e.path.length%2==1?e.path.lastSegment():e.path.get(e.path.length-2))}function oO(e){return(t,r)=>{let n=!1;for(let i of oT(e)){let e=function(e,t,r){var n;let i,s,a=e.field.isKeyField()?ix.comparator(t.key,r.key):(n=e.field,i=t.data.field(n),s=r.data.field(n),null!==i&&null!==s?aV(i,s):ii(42886));switch(e.dir){case"asc":return a;case"desc":return -1*a;default:return ii(19790,{direction:e.dir})}}(i,t,r);if(0!==e)return e;n=n||i.field.isKeyField()}return 0}}class oL{constructor(e,t){this.mapKeyFn=e,this.equalsFn=t,this.inner={},this.innerSize=0}get(e){let t=this.mapKeyFn(e),r=this.inner[t];if(void 0!==r){for(let[t,n]of r)if(this.equalsFn(t,e))return n}}has(e){return void 0!==this.get(e)}set(e,t){let r=this.mapKeyFn(e),n=this.inner[r];if(void 0===n)return this.inner[r]=[[e,t]],void this.innerSize++;for(let r=0;r<n.length;r++)if(this.equalsFn(n[r][0],e))return void(n[r]=[e,t]);n.push([e,t]),this.innerSize++}delete(e){let t=this.mapKeyFn(e),r=this.inner[t];if(void 0===r)return!1;for(let n=0;n<r.length;n++)if(this.equalsFn(r[n][0],e))return 1===r.length?delete this.inner[t]:r.splice(n,1),this.innerSize--,!0;return!1}forEach(e){ai(this.inner,(t,r)=>{for(let[t,n]of r)e(t,n)})}isEmpty(){return as(this.inner)}size(){return this.innerSize}}let oM=new aa(ix.comparator),oF=new aa(ix.comparator);function oV(...e){let t=oF;for(let r of e)t=t.insert(r.key,r);return t}function oU(e){let t=oF;return e.forEach((e,r)=>t=t.insert(e,r.overlayedDocument)),t}function oB(){return new oL(e=>e.toString(),(e,t)=>e.isEqual(t))}let oq=new aa(ix.comparator),oj=new au(ix.comparator);function oz(...e){let t=oj;for(let r of e)t=t.add(r);return t}let o$=new au(i_);function oK(e,t){if(e.useProto3Json){if(isNaN(t))return{doubleValue:"NaN"};if(t===1/0)return{doubleValue:"Infinity"};if(t===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:so(t)?"-0":t}}function oG(e){return{integerValue:""+e}}class oH{constructor(){this._=void 0}}function oW(e,t){return e instanceof o0?az(t)||t&&"doubleValue"in t?t:{integerValue:0}:null}class oQ extends oH{}class oJ extends oH{constructor(e){super(),this.elements=e}}function oY(e,t){let r=o2(t);for(let t of e.elements)r.some(e=>aM(e,t))||r.push(t);return{arrayValue:{values:r}}}class oX extends oH{constructor(e){super(),this.elements=e}}function oZ(e,t){let r=o2(t);for(let t of e.elements)r=r.filter(e=>!aM(e,t));return{arrayValue:{values:r}}}class o0 extends oH{constructor(e,t){super(),this.serializer=e,this.Ae=t}}function o1(e){return ay(e.integerValue||e.doubleValue)}function o2(e){return a$(e)&&e.arrayValue.values?e.arrayValue.values.slice():[]}class o6{constructor(e,t){this.field=e,this.transform=t}}class o3{constructor(e,t){this.version=e,this.transformResults=t}}class o4{constructor(e,t){this.updateTime=e,this.exists=t}static none(){return new o4}static exists(e){return new o4(void 0,e)}static updateTime(e){return new o4(e)}get isNone(){return void 0===this.updateTime&&void 0===this.exists}isEqual(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}}function o5(e,t){return void 0!==e.updateTime?t.isFoundDocument()&&t.version.isEqual(e.updateTime):void 0===e.exists||e.exists===t.isFoundDocument()}class o8{}function o7(e,t){if(!e.hasLocalMutations||t&&0===t.fields.length)return null;if(null===t)return e.isNoDocument()?new la(e.key,o4.none()):new lt(e.key,e.data,o4.none());{let r=e.data,n=a0.empty(),i=new au(ik.comparator);for(let e of t.fields)if(!i.has(e)){let t=r.field(e);null===t&&e.length>1&&(e=e.popLast(),t=r.field(e)),null===t?n.delete(e):n.set(e,t),i=i.add(e)}return new lr(e.key,n,new ad(i.toArray()),o4.none())}}function o9(e,t,r,n){return e instanceof lt?function(e,t,r,n){if(!o5(e.precondition,t))return r;let i=e.value.clone(),s=ls(e.fieldTransforms,n,t);return i.setAll(s),t.convertToFoundDocument(t.version,i).setHasLocalMutations(),null}(e,t,r,n):e instanceof lr?function(e,t,r,n){if(!o5(e.precondition,t))return r;let i=ls(e.fieldTransforms,n,t),s=t.data;return(s.setAll(ln(e)),s.setAll(i),t.convertToFoundDocument(t.version,s).setHasLocalMutations(),null===r)?null:r.unionWith(e.fieldMask.fields).unionWith(e.fieldTransforms.map(e=>e.field))}(e,t,r,n):o5(e.precondition,t)?(t.convertToNoDocument(t.version).setHasLocalMutations(),null):r}function le(e,t){var r,n;return e.type===t.type&&!!e.key.isEqual(t.key)&&!!e.precondition.isEqual(t.precondition)&&(r=e.fieldTransforms,n=t.fieldTransforms,!!(void 0===r&&void 0===n||!(!r||!n)&&iE(r,n,(e,t)=>{var r,n;return e.field.isEqual(t.field)&&(r=e.transform,n=t.transform,r instanceof oJ&&n instanceof oJ||r instanceof oX&&n instanceof oX?iE(r.elements,n.elements,aM):r instanceof o0&&n instanceof o0?aM(r.Ae,n.Ae):r instanceof oQ&&n instanceof oQ)})))&&(0===e.type?e.value.isEqual(t.value):1!==e.type||e.data.isEqual(t.data)&&e.fieldMask.isEqual(t.fieldMask))}class lt extends o8{constructor(e,t,r,n=[]){super(),this.key=e,this.value=t,this.precondition=r,this.fieldTransforms=n,this.type=0}getFieldMask(){return null}}class lr extends o8{constructor(e,t,r,n,i=[]){super(),this.key=e,this.data=t,this.fieldMask=r,this.precondition=n,this.fieldTransforms=i,this.type=1}getFieldMask(){return this.fieldMask}}function ln(e){let t=new Map;return e.fieldMask.fields.forEach(r=>{if(!r.isEmpty()){let n=e.data.field(r);t.set(r,n)}}),t}function li(e,t,r){let n=new Map;ia(e.length===r.length,32656,{Ve:r.length,de:e.length});for(let s=0;s<r.length;s++){var i;let a=e[s],o=a.transform,l=t.data.field(a.field);n.set(a.field,(i=r[s],o instanceof oJ?oY(o,l):o instanceof oX?oZ(o,l):i))}return n}function ls(e,t,r){let n=new Map;for(let i of e){let e=i.transform,s=r.data.field(i.field);n.set(i.field,function(e,t,r){var n;let i,s,a;return e instanceof oQ?(n=t,i={fields:{[a_]:{stringValue:av},[ab]:{timestampValue:{seconds:r.seconds,nanos:r.nanoseconds}}}},n&&aE(n)&&(n=aT(n)),n&&(i.fields[aI]=n),{mapValue:i}):e instanceof oJ?oY(e,t):e instanceof oX?oZ(e,t):(a=o1(s=oW(e,t))+o1(e.Ae),az(s)&&az(e.Ae)?oG(a):oK(e.serializer,a))}(e,s,t))}return n}class la extends o8{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}}class lo extends o8{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}}class ll{constructor(e,t,r,n){this.batchId=e,this.localWriteTime=t,this.baseMutations=r,this.mutations=n}applyToRemoteDocument(e,t){let r=t.mutationResults;for(let t=0;t<this.mutations.length;t++){let n=this.mutations[t];n.key.isEqual(e.key)&&function(e,t,r){let n,i;e instanceof lt?(n=e.value.clone(),i=li(e.fieldTransforms,t,r.transformResults),n.setAll(i),t.convertToFoundDocument(r.version,n).setHasCommittedMutations()):e instanceof lr?function(e,t,r){if(!o5(e.precondition,t))return t.convertToUnknownDocument(r.version);let n=li(e.fieldTransforms,t,r.transformResults),i=t.data;i.setAll(ln(e)),i.setAll(n),t.convertToFoundDocument(r.version,i).setHasCommittedMutations()}(e,t,r):t.convertToNoDocument(r.version).setHasCommittedMutations()}(n,e,r[t])}}applyToLocalView(e,t){for(let r of this.baseMutations)r.key.isEqual(e.key)&&(t=o9(r,e,t,this.localWriteTime));for(let r of this.mutations)r.key.isEqual(e.key)&&(t=o9(r,e,t,this.localWriteTime));return t}applyToLocalDocumentSet(e,t){let r=oB();return this.mutations.forEach(n=>{let i=e.get(n.key),s=i.overlayedDocument,a=this.applyToLocalView(s,i.mutatedFields),o=o7(s,a=t.has(n.key)?null:a);null!==o&&r.set(n.key,o),s.isValidDocument()||s.convertToNoDocument(iB.min())}),r}keys(){return this.mutations.reduce((e,t)=>e.add(t.key),oz())}isEqual(e){return this.batchId===e.batchId&&iE(this.mutations,e.mutations,(e,t)=>le(e,t))&&iE(this.baseMutations,e.baseMutations,(e,t)=>le(e,t))}}class lu{constructor(e,t,r,n){this.batch=e,this.commitVersion=t,this.mutationResults=r,this.docVersions=n}static from(e,t,r){ia(e.mutations.length===r.length,58842,{me:e.mutations.length,fe:r.length});let n=oq,i=e.mutations;for(let e=0;e<i.length;e++)n=n.insert(i[e].key,r[e].version);return new lu(e,t,r,n)}}class lh{constructor(e,t){this.largestBatchId=e,this.mutation=t}getKey(){return this.mutation.key}isEqual(e){return null!==e&&this.mutation===e.mutation}toString(){return`Overlay{
      largestBatchId: ${this.largestBatchId},
      mutation: ${this.mutation.toString()}
    }`}}class lc{constructor(e,t,r){this.alias=e,this.aggregateType=t,this.fieldPath=r}}class ld{constructor(e,t){this.count=e,this.unchangedNames=t}}function lf(e){switch(e){case io.OK:return ii(64938);case io.CANCELLED:case io.UNKNOWN:case io.DEADLINE_EXCEEDED:case io.RESOURCE_EXHAUSTED:case io.INTERNAL:case io.UNAVAILABLE:case io.UNAUTHENTICATED:return!1;case io.INVALID_ARGUMENT:case io.NOT_FOUND:case io.ALREADY_EXISTS:case io.PERMISSION_DENIED:case io.FAILED_PRECONDITION:case io.ABORTED:case io.OUT_OF_RANGE:case io.UNIMPLEMENTED:case io.DATA_LOSS:return!0;default:return ii(15467,{code:e})}}function lp(e){if(void 0===e)return ie("GRPC error has no .code"),io.UNKNOWN;switch(e){case y.OK:return io.OK;case y.CANCELLED:return io.CANCELLED;case y.UNKNOWN:return io.UNKNOWN;case y.DEADLINE_EXCEEDED:return io.DEADLINE_EXCEEDED;case y.RESOURCE_EXHAUSTED:return io.RESOURCE_EXHAUSTED;case y.INTERNAL:return io.INTERNAL;case y.UNAVAILABLE:return io.UNAVAILABLE;case y.UNAUTHENTICATED:return io.UNAUTHENTICATED;case y.INVALID_ARGUMENT:return io.INVALID_ARGUMENT;case y.NOT_FOUND:return io.NOT_FOUND;case y.ALREADY_EXISTS:return io.ALREADY_EXISTS;case y.PERMISSION_DENIED:return io.PERMISSION_DENIED;case y.FAILED_PRECONDITION:return io.FAILED_PRECONDITION;case y.ABORTED:return io.ABORTED;case y.OUT_OF_RANGE:return io.OUT_OF_RANGE;case y.UNIMPLEMENTED:return io.UNIMPLEMENTED;case y.DATA_LOSS:return io.DATA_LOSS;default:return ii(39323,{code:e})}}(w=y||(y={}))[w.OK=0]="OK",w[w.CANCELLED=1]="CANCELLED",w[w.UNKNOWN=2]="UNKNOWN",w[w.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",w[w.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",w[w.NOT_FOUND=5]="NOT_FOUND",w[w.ALREADY_EXISTS=6]="ALREADY_EXISTS",w[w.PERMISSION_DENIED=7]="PERMISSION_DENIED",w[w.UNAUTHENTICATED=16]="UNAUTHENTICATED",w[w.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",w[w.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",w[w.ABORTED=10]="ABORTED",w[w.OUT_OF_RANGE=11]="OUT_OF_RANGE",w[w.UNIMPLEMENTED=12]="UNIMPLEMENTED",w[w.INTERNAL=13]="INTERNAL",w[w.UNAVAILABLE=14]="UNAVAILABLE",w[w.DATA_LOSS=15]="DATA_LOSS";let lm=null;function lg(){return new TextEncoder}let ly=new o([0xffffffff,0xffffffff],0);function lw(e){let t=lg().encode(e),r=new l;return r.update(t),new Uint8Array(r.digest())}function lv(e){let t=new DataView(e.buffer),r=t.getUint32(0,!0),n=t.getUint32(4,!0),i=t.getUint32(8,!0),s=t.getUint32(12,!0);return[new o([r,n],0),new o([i,s],0)]}class l_{constructor(e,t,r){if(this.bitmap=e,this.padding=t,this.hashCount=r,t<0||t>=8)throw new lI(`Invalid padding: ${t}`);if(r<0||e.length>0&&0===this.hashCount)throw new lI(`Invalid hash count: ${r}`);if(0===e.length&&0!==t)throw new lI(`Invalid padding when bitmap length is 0: ${t}`);this.ge=8*e.length-t,this.pe=o.fromNumber(this.ge)}ye(e,t,r){let n=e.add(t.multiply(o.fromNumber(r)));return 1===n.compare(ly)&&(n=new o([n.getBits(0),n.getBits(1)],0)),n.modulo(this.pe).toNumber()}we(e){return!!(this.bitmap[Math.floor(e/8)]&1<<e%8)}mightContain(e){if(0===this.ge)return!1;let[t,r]=lv(lw(e));for(let e=0;e<this.hashCount;e++){let n=this.ye(t,r,e);if(!this.we(n))return!1}return!0}static create(e,t,r){let n=new l_(new Uint8Array(Math.ceil(e/8)),e%8==0?0:8-e%8,t);return r.forEach(e=>n.insert(e)),n}insert(e){if(0===this.ge)return;let[t,r]=lv(lw(e));for(let e=0;e<this.hashCount;e++){let n=this.ye(t,r,e);this.be(n)}}be(e){let t=Math.floor(e/8);this.bitmap[t]|=1<<e%8}}class lI extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}}class lb{constructor(e,t,r,n,i){this.snapshotVersion=e,this.targetChanges=t,this.targetMismatches=r,this.documentUpdates=n,this.resolvedLimboDocuments=i}static createSynthesizedRemoteEventForCurrentChange(e,t,r){let n=new Map;return n.set(e,lE.createSynthesizedTargetChangeForCurrentChange(e,t,r)),new lb(iB.min(),n,new aa(i_),oM,oz())}}class lE{constructor(e,t,r,n,i){this.resumeToken=e,this.current=t,this.addedDocuments=r,this.modifiedDocuments=n,this.removedDocuments=i}static createSynthesizedTargetChangeForCurrentChange(e,t,r){return new lE(r,t,oz(),oz(),oz())}}class lT{constructor(e,t,r,n){this.Se=e,this.removedTargetIds=t,this.key=r,this.De=n}}class lS{constructor(e,t){this.targetId=e,this.Ce=t}}class lC{constructor(e,t,r=ap.EMPTY_BYTE_STRING,n=null){this.state=e,this.targetIds=t,this.resumeToken=r,this.cause=n}}class lA{constructor(){this.ve=0,this.Fe=lN(),this.Me=ap.EMPTY_BYTE_STRING,this.xe=!1,this.Oe=!0}get current(){return this.xe}get resumeToken(){return this.Me}get Ne(){return 0!==this.ve}get Be(){return this.Oe}Le(e){e.approximateByteSize()>0&&(this.Oe=!0,this.Me=e)}ke(){let e=oz(),t=oz(),r=oz();return this.Fe.forEach((n,i)=>{switch(i){case 0:e=e.add(n);break;case 2:t=t.add(n);break;case 1:r=r.add(n);break;default:ii(38017,{changeType:i})}}),new lE(this.Me,this.xe,e,t,r)}Ke(){this.Oe=!1,this.Fe=lN()}qe(e,t){this.Oe=!0,this.Fe=this.Fe.insert(e,t)}Ue(e){this.Oe=!0,this.Fe=this.Fe.remove(e)}$e(){this.ve+=1}We(){this.ve-=1,ia(this.ve>=0,3241,{ve:this.ve})}Qe(){this.Oe=!0,this.xe=!0}}class lk{constructor(e){this.Ge=e,this.ze=new Map,this.je=oM,this.He=lx(),this.Je=lx(),this.Ze=new aa(i_)}Xe(e){for(let t of e.Se)e.De&&e.De.isFoundDocument()?this.Ye(t,e.De):this.et(t,e.key,e.De);for(let t of e.removedTargetIds)this.et(t,e.key,e.De)}tt(e){this.forEachTarget(e,t=>{let r=this.nt(t);switch(e.state){case 0:this.rt(t)&&r.Le(e.resumeToken);break;case 1:r.We(),r.Ne||r.Ke(),r.Le(e.resumeToken);break;case 2:r.We(),r.Ne||this.removeTarget(t);break;case 3:this.rt(t)&&(r.Qe(),r.Le(e.resumeToken));break;case 4:this.rt(t)&&(this.it(t),r.Le(e.resumeToken));break;default:ii(56790,{state:e.state})}})}forEachTarget(e,t){e.targetIds.length>0?e.targetIds.forEach(t):this.ze.forEach((e,r)=>{this.rt(r)&&t(r)})}st(e){let t=e.targetId,r=e.Ce.count,n=this.ot(t);if(n){let a=n.target;if(og(a))if(0===r){let e=new ix(a.path);this.et(t,e,a1.newNoDocument(e,iB.min()))}else ia(1===r,20013,{expectedCount:r});else{let n=this._t(t);if(n!==r){var i,s;let r,a,o=this.ut(e),l=o?this.ct(o,e,n):1;0!==l&&(this.it(t),this.Ze=this.Ze.insert(t,2===l?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch")),lm?.lt((i=e.Ce,s=this.Ge.ht(),r={localCacheCount:n,existenceFilterCount:i.count,databaseId:s.database,projectId:s.projectId},(a=i.unchangedNames)&&(r.bloomFilter={applied:0===l,hashCount:a?.hashCount??0,bitmapLength:a?.bits?.bitmap?.length??0,padding:a?.bits?.padding??0,mightContain:e=>o?.mightContain(e)??!1}),r))}}}}ut(e){let t,r,n=e.Ce.unchangedNames;if(!n||!n.bits)return null;let{bits:{bitmap:i="",padding:s=0},hashCount:a=0}=n;try{t=aw(i).toUint8Array()}catch(e){if(e instanceof af)return it("Decoding the base64 bloom filter in existence filter failed ("+e.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw e}try{r=new l_(t,s,a)}catch(e){return it(e instanceof lI?"BloomFilter error: ":"Applying bloom filter failed: ",e),null}return 0===r.ge?null:r}ct(e,t,r){return 2*(t.Ce.count!==r-this.Pt(e,t.targetId))}Pt(e,t){let r=this.Ge.getRemoteKeysForTarget(t),n=0;return r.forEach(r=>{let i=this.Ge.ht(),s=`projects/${i.projectId}/databases/${i.database}/documents/${r.path.canonicalString()}`;e.mightContain(s)||(this.et(t,r,null),n++)}),n}Tt(e){let t=new Map;this.ze.forEach((r,n)=>{let i=this.ot(n);if(i){if(r.current&&og(i.target)){let t=new ix(i.target.path);this.It(t).has(n)||this.Et(n,t)||this.et(n,t,a1.newNoDocument(t,e))}r.Be&&(t.set(n,r.ke()),r.Ke())}});let r=oz();this.Je.forEach((e,t)=>{let n=!0;t.forEachWhile(e=>{let t=this.ot(e);return!t||"TargetPurposeLimboResolution"===t.purpose||(n=!1,!1)}),n&&(r=r.add(e))}),this.je.forEach((t,r)=>r.setReadTime(e));let n=new lb(e,t,this.Ze,this.je,r);return this.je=oM,this.He=lx(),this.Je=lx(),this.Ze=new aa(i_),n}Ye(e,t){if(!this.rt(e))return;let r=2*!!this.Et(e,t.key);this.nt(e).qe(t.key,r),this.je=this.je.insert(t.key,t),this.He=this.He.insert(t.key,this.It(t.key).add(e)),this.Je=this.Je.insert(t.key,this.Rt(t.key).add(e))}et(e,t,r){if(!this.rt(e))return;let n=this.nt(e);this.Et(e,t)?n.qe(t,1):n.Ue(t),this.Je=this.Je.insert(t,this.Rt(t).delete(e)),this.Je=this.Je.insert(t,this.Rt(t).add(e)),r&&(this.je=this.je.insert(t,r))}removeTarget(e){this.ze.delete(e)}_t(e){let t=this.nt(e).ke();return this.Ge.getRemoteKeysForTarget(e).size+t.addedDocuments.size-t.removedDocuments.size}$e(e){this.nt(e).$e()}nt(e){let t=this.ze.get(e);return t||(t=new lA,this.ze.set(e,t)),t}Rt(e){let t=this.Je.get(e);return t||(t=new au(i_),this.Je=this.Je.insert(e,t)),t}It(e){let t=this.He.get(e);return t||(t=new au(i_),this.He=this.He.insert(e,t)),t}rt(e){let t=null!==this.ot(e);return t||n9("WatchChangeAggregator","Detected inactive target",e),t}ot(e){let t=this.ze.get(e);return t&&t.Ne?null:this.Ge.At(e)}it(e){this.ze.set(e,new lA),this.Ge.getRemoteKeysForTarget(e).forEach(t=>{this.et(e,t,null)})}Et(e,t){return this.Ge.getRemoteKeysForTarget(e).has(t)}}function lx(){return new aa(ix.comparator)}function lN(){return new aa(ix.comparator)}let lD={asc:"ASCENDING",desc:"DESCENDING"},lR={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},lP={and:"AND",or:"OR"};class lO{constructor(e,t){this.databaseId=e,this.useProto3Json=t}}function lL(e,t){return e.useProto3Json||sa(t)?t:{value:t}}function lM(e,t){return e.useProto3Json?`${new Date(1e3*t.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+t.nanoseconds).slice(-9)}Z`:{seconds:""+t.seconds,nanos:t.nanoseconds}}function lF(e,t){return e.useProto3Json?t.toBase64():t.toUint8Array()}function lV(e){let t;return ia(!!e,49232),iB.fromTimestamp(new iU((t=ag(e)).seconds,t.nanos))}function lU(e,t){return lB(e,t).canonicalString()}function lB(e,t){let r=new iC(["projects",e.projectId,"databases",e.database]).child("documents");return void 0===t?r:r.child(t)}function lq(e){let t=iC.fromString(e);return ia(l6(t),10190,{key:t.toString()}),t}function lj(e,t){return lU(e.databaseId,t.path)}function lz(e,t){let r=lq(t);if(r.get(1)!==e.databaseId.projectId)throw new il(io.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+r.get(1)+" vs "+e.databaseId.projectId);if(r.get(3)!==e.databaseId.database)throw new il(io.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+r.get(3)+" vs "+e.databaseId.database);return new ix(lH(r))}function l$(e,t){return lU(e.databaseId,t)}function lK(e){let t=lq(e);return 4===t.length?iC.emptyPath():lH(t)}function lG(e){return new iC(["projects",e.databaseId.projectId,"databases",e.databaseId.database]).canonicalString()}function lH(e){return ia(e.length>4&&"documents"===e.get(4),29091,{key:e.toString()}),e.popFirst(5)}function lW(e,t,r){return{name:lj(e,t),fields:r.value.mapValue.fields}}function lQ(e,t,r){let n=lz(e,t.name),i=lV(t.updateTime),s=t.createTime?lV(t.createTime):iB.min(),a=new a0({mapValue:{fields:t.fields}}),o=a1.newFoundDocument(n,i,s,a);return r&&o.setHasCommittedMutations(),r?o.setHasCommittedMutations():o}function lJ(e,t){var r,n;let i;if(t instanceof lt)i={update:lW(e,t.key,t.value)};else if(t instanceof la)i={delete:lj(e,t.key)};else if(t instanceof lr){let r;i={update:lW(e,t.key,t.data),updateMask:(n=t.fieldMask,r=[],n.fields.forEach(e=>r.push(e.canonicalString())),{fieldPaths:r})}}else{if(!(t instanceof lo))return ii(16599,{dt:t.type});i={verify:lj(e,t.key)}}return t.fieldTransforms.length>0&&(i.updateTransforms=t.fieldTransforms.map(e=>(function(e,t){let r=t.transform;if(r instanceof oQ)return{fieldPath:t.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(r instanceof oJ)return{fieldPath:t.field.canonicalString(),appendMissingElements:{values:r.elements}};if(r instanceof oX)return{fieldPath:t.field.canonicalString(),removeAllFromArray:{values:r.elements}};if(r instanceof o0)return{fieldPath:t.field.canonicalString(),increment:r.Ae};throw ii(20930,{transform:t.transform})})(0,e))),t.precondition.isNone||(i.currentDocument=void 0!==(r=t.precondition).updateTime?{updateTime:lM(e,r.updateTime.toTimestamp())}:void 0!==r.exists?{exists:r.exists}:ii(27497)),i}function lY(e,t){var r;let n=t.currentDocument?void 0!==(r=t.currentDocument).updateTime?o4.updateTime(lV(r.updateTime)):void 0!==r.exists?o4.exists(r.exists):o4.none():o4.none(),i=t.updateTransforms?t.updateTransforms.map(t=>{let r;return r=null,"setToServerValue"in t?(ia("REQUEST_TIME"===t.setToServerValue,16630,{proto:t}),r=new oQ):"appendMissingElements"in t?r=new oJ(t.appendMissingElements.values||[]):"removeAllFromArray"in t?r=new oX(t.removeAllFromArray.values||[]):"increment"in t?r=new o0(e,t.increment):ii(16584,{proto:t}),new o6(ik.fromServerFormat(t.fieldPath),r)}):[];if(t.update){t.update.name;let r=lz(e,t.update.name),s=new a0({mapValue:{fields:t.update.fields}});return t.updateMask?new lr(r,s,new ad((t.updateMask.fieldPaths||[]).map(e=>ik.fromServerFormat(e))),n,i):new lt(r,s,n,i)}return t.delete?new la(lz(e,t.delete),n):t.verify?new lo(lz(e,t.verify),n):ii(1463,{proto:t})}function lX(e,t){return{documents:[l$(e,t.path)]}}function lZ(e,t){var r,n;let i,s={structuredQuery:{}},a=t.path;null!==t.collectionGroup?(i=a,s.structuredQuery.from=[{collectionId:t.collectionGroup,allDescendants:!0}]):(i=a.popLast(),s.structuredQuery.from=[{collectionId:a.lastSegment()}]),s.parent=l$(e,i);let o=function(e){if(0!==e.length)return function e(t){var r;let n;return t instanceof a8?function(e){if("=="===e.op){if(aG(e.value))return{unaryFilter:{field:l1(e.field),op:"IS_NAN"}};if(aK(e.value))return{unaryFilter:{field:l1(e.field),op:"IS_NULL"}}}else if("!="===e.op){if(aG(e.value))return{unaryFilter:{field:l1(e.field),op:"IS_NOT_NAN"}};if(aK(e.value))return{unaryFilter:{field:l1(e.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:l1(e.field),op:lR[e.op],value:e.value}}}(t):t instanceof a7?1===(n=(r=t).getFilters().map(t=>e(t))).length?n[0]:{compositeFilter:{op:lP[r.op],filters:n}}:ii(54877,{filter:t})}(a7.create(e,"and"))}(t.filters);o&&(s.structuredQuery.where=o);let l=function(e){if(0!==e.length)return e.map(e=>({field:l1(e.field),direction:lD[e.dir]}))}(t.orderBy);l&&(s.structuredQuery.orderBy=l);let u=lL(e,t.limit);return null!==u&&(s.structuredQuery.limit=u),t.startAt&&(s.structuredQuery.startAt={before:(r=t.startAt).inclusive,values:r.position}),t.endAt&&(s.structuredQuery.endAt={before:!(n=t.endAt).inclusive,values:n.position}),{ft:s,parent:i}}function l0(e){var t,r,n;let i,s,a,o,l=lK(e.parent),u=e.structuredQuery,h=u.from?u.from.length:0,c=null;if(h>0){ia(1===h,65062);let e=u.from[0];e.allDescendants?c=e.collectionId:l=l.child(e.collectionId)}let d=[];u.where&&(d=(i=function e(t){return void 0!==t.unaryFilter?function(e){switch(e.unaryFilter.op){case"IS_NAN":let t=l2(e.unaryFilter.field);return a8.create(t,"==",{doubleValue:NaN});case"IS_NULL":let r=l2(e.unaryFilter.field);return a8.create(r,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":let n=l2(e.unaryFilter.field);return a8.create(n,"!=",{doubleValue:NaN});case"IS_NOT_NULL":let i=l2(e.unaryFilter.field);return a8.create(i,"!=",{nullValue:"NULL_VALUE"});case"OPERATOR_UNSPECIFIED":return ii(61313);default:return ii(60726)}}(t):void 0!==t.fieldFilter?a8.create(l2(t.fieldFilter.field),function(e){switch(e){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";case"OPERATOR_UNSPECIFIED":return ii(58110);default:return ii(50506)}}(t.fieldFilter.op),t.fieldFilter.value):void 0!==t.compositeFilter?a7.create(t.compositeFilter.filters.map(t=>e(t)),function(e){switch(e){case"AND":return"and";case"OR":return"or";default:return ii(1026)}}(t.compositeFilter.op)):ii(30097,{filter:t})}(u.where))instanceof a7&&ot(i)?i.getFilters():[i]);let f=[];u.orderBy&&(f=u.orderBy.map(e=>new a4(l2(e.field),function(e){switch(e){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(e.direction))));let p=null;u.limit&&(p=sa(s="object"==typeof(t=u.limit)?t.value:t)?null:s);let m=null;u.startAt&&(a=!!(r=u.startAt).before,m=new a2(r.values||[],a));let g=null;return u.endAt&&(o=!(n=u.endAt).before,g=new a2(n.values||[],o)),new o_(l,c,f,d,p,"F",m,g)}function l1(e){return{fieldPath:e.canonicalString()}}function l2(e){return ik.fromServerFormat(e.fieldPath)}function l6(e){return e.length>=4&&"projects"===e.get(0)&&"databases"===e.get(2)}function l3(e){return!!e&&"function"==typeof e._toProto&&"ProtoValue"===e._protoValueType}class l4{constructor(e,t,r,n,i=iB.min(),s=iB.min(),a=ap.EMPTY_BYTE_STRING,o=null){this.target=e,this.targetId=t,this.purpose=r,this.sequenceNumber=n,this.snapshotVersion=i,this.lastLimboFreeSnapshotVersion=s,this.resumeToken=a,this.expectedCount=o}withSequenceNumber(e){return new l4(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(e,t){return new l4(this.target,this.targetId,this.purpose,this.sequenceNumber,t,this.lastLimboFreeSnapshotVersion,e,null)}withExpectedCount(e){return new l4(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,e)}withLastLimboFreeSnapshotVersion(e){return new l4(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken,this.expectedCount)}}class l5{constructor(e){this.yt=e}}function l8(e,t){let r=t.key,n={prefixPath:r.getCollectionPath().popLast().toArray(),collectionGroup:r.collectionGroup,documentId:r.path.lastSegment(),readTime:l7(t.readTime),hasCommittedMutations:t.hasCommittedMutations};if(t.isFoundDocument()){var i;n.document={name:lj(i=e.yt,t.key),fields:t.data.value.mapValue.fields,updateTime:lM(i,t.version.toTimestamp()),createTime:lM(i,t.createTime.toTimestamp())}}else if(t.isNoDocument())n.noDocument={path:r.path.toArray(),readTime:l9(t.version)};else{if(!t.isUnknownDocument())return ii(57904,{document:t});n.unknownDocument={path:r.path.toArray(),version:l9(t.version)}}return n}function l7(e){let t=e.toTimestamp();return[t.seconds,t.nanoseconds]}function l9(e){let t=e.toTimestamp();return{seconds:t.seconds,nanoseconds:t.nanoseconds}}function ue(e){let t=new iU(e.seconds,e.nanoseconds);return iB.fromTimestamp(t)}function ut(e,t){let r=(t.baseMutations||[]).map(t=>lY(e.yt,t));for(let e=0;e<t.mutations.length-1;++e){let r=t.mutations[e];e+1<t.mutations.length&&void 0!==t.mutations[e+1].transform&&(r.updateTransforms=t.mutations[e+1].transform.fieldTransforms,t.mutations.splice(e+1,1),++e)}let n=t.mutations.map(t=>lY(e.yt,t)),i=iU.fromMillis(t.localWriteTimeMs);return new ll(t.batchId,i,r,n)}function ur(e){var t;let r,n=ue(e.readTime),i=void 0!==e.lastLimboFreeSnapshotVersion?ue(e.lastLimboFreeSnapshotVersion):iB.min();return new l4(void 0!==e.query.documents?(ia(1===(r=(t=e.query).documents.length),1966,{count:r}),oS(oI(lK(t.documents[0])))):oS(l0(e.query)),e.targetId,"TargetPurposeListen",e.lastListenSequenceNumber,n,i,ap.fromBase64String(e.resumeToken))}function un(e,t){let r,n=l9(t.snapshotVersion),i=l9(t.lastLimboFreeSnapshotVersion);r=og(t.target)?lX(e.yt,t.target):lZ(e.yt,t.target).ft;let s=t.resumeToken.toBase64();return{targetId:t.targetId,canonicalId:op(t.target),readTime:n,resumeToken:s,lastListenSequenceNumber:t.sequenceNumber,lastLimboFreeSnapshotVersion:i,query:r}}function ui(e){let t=l0({parent:e.parent,structuredQuery:e.structuredQuery});return"LAST"===e.limitType?ok(t,t.limit,"L"):t}function us(e,t){return new lh(t.largestBatchId,lY(e.yt,t.overlayMutation))}function ua(e,t){let r=t.path.lastSegment();return[e,su(t.path.popLast()),r]}function uo(e,t,r,n){return{indexId:e,uid:t,sequenceNumber:r,readTime:l9(n.readTime),documentKey:su(n.documentKey.path),largestBatchId:n.largestBatchId}}class ul{getBundleMetadata(e,t){return ar(e,sq).get(t).next(e=>{if(e)return{id:e.bundleId,createTime:ue(e.createTime),version:e.version}})}saveBundleMetadata(e,t){return ar(e,sq).put({bundleId:t.id,createTime:l9(lV(t.createTime)),version:t.version})}getNamedQuery(e,t){return ar(e,sj).get(t).next(e=>{if(e)return{name:e.name,query:ui(e.bundledQuery),readTime:ue(e.readTime)}})}saveNamedQuery(e,t){return ar(e,sj).put({name:t.name,readTime:l9(lV(t.readTime)),bundledQuery:t.bundledQuery})}}class uu{constructor(e,t){this.serializer=e,this.userId=t}static wt(e,t){return new uu(e,t.uid||"")}getOverlay(e,t){return ar(e,sZ).get(ua(this.userId,t)).next(e=>e?us(this.serializer,e):null)}getOverlays(e,t){let r=oB();return i0.forEach(t,t=>this.getOverlay(e,t).next(e=>{null!==e&&r.set(t,e)})).next(()=>r)}saveOverlays(e,t,r){let n=[];return r.forEach((r,i)=>{let s=new lh(t,i);n.push(this.bt(e,s))}),i0.waitFor(n)}removeOverlaysForBatchId(e,t,r){let n=new Set;t.forEach(e=>n.add(su(e.getCollectionPath())));let i=[];return n.forEach(t=>{let n=IDBKeyRange.bound([this.userId,t,r],[this.userId,t,r+1],!1,!0);i.push(ar(e,sZ).X(s1,n))}),i0.waitFor(i)}getOverlaysForCollection(e,t,r){let n=oB(),i=su(t),s=IDBKeyRange.bound([this.userId,i,r],[this.userId,i,1/0],!0);return ar(e,sZ).H(s1,s).next(e=>{for(let t of e){let e=us(this.serializer,t);n.set(e.getKey(),e)}return n})}getOverlaysForCollectionGroup(e,t,r,n){let i,s=oB(),a=IDBKeyRange.bound([this.userId,t,r],[this.userId,t,1/0],!0);return ar(e,sZ).ee({index:s6,range:a},(e,t,r)=>{let a=us(this.serializer,t);s.size()<n||a.largestBatchId===i?(s.set(a.getKey(),a),i=a.largestBatchId):r.done()}).next(()=>s)}bt(e,t){return ar(e,sZ).put(function(e,t,r){let[n,i,s]=ua(t,r.mutation.key);return{userId:t,collectionPath:i,documentId:s,collectionGroup:r.mutation.key.getCollectionGroup(),largestBatchId:r.largestBatchId,overlayMutation:lJ(e.yt,r.mutation)}}(this.serializer,this.userId,t))}}class uh{St(e){return ar(e,s4)}getSessionToken(e){return this.St(e).get("sessionToken").next(e=>{let t=e?.value;return t?ap.fromUint8Array(t):ap.EMPTY_BYTE_STRING})}setSessionToken(e,t){return this.St(e).put({name:"sessionToken",value:t.toUint8Array()})}}class uc{Dt(e,t){this.Ct(e,t),t.vt()}Ct(e,t){if("nullValue"in e)this.Ft(t,5);else if("booleanValue"in e)this.Ft(t,10),t.Mt(+!!e.booleanValue);else if("integerValue"in e)this.Ft(t,15),t.Mt(ay(e.integerValue));else if("doubleValue"in e){let r=ay(e.doubleValue);isNaN(r)?this.Ft(t,13):(this.Ft(t,15),so(r)?t.Mt(0):t.Mt(r))}else if("timestampValue"in e){let r=e.timestampValue;this.Ft(t,20),"string"==typeof r&&(r=ag(r)),t.xt(`${r.seconds||""}`),t.Mt(r.nanos||0)}else if("stringValue"in e)this.Ot(e.stringValue,t),this.Nt(t);else if("bytesValue"in e)this.Ft(t,30),t.Bt(aw(e.bytesValue)),this.Nt(t);else if("referenceValue"in e)this.Lt(e.referenceValue,t);else if("geoPointValue"in e){let r=e.geoPointValue;this.Ft(t,45),t.Mt(r.latitude||0),t.Mt(r.longitude||0)}else"mapValue"in e?aJ(e)?this.Ft(t,Number.MAX_SAFE_INTEGER):aW(e)?this.kt(e.mapValue,t):(this.Kt(e.mapValue,t),this.Nt(t)):"arrayValue"in e?(this.qt(e.arrayValue,t),this.Nt(t)):ii(19022,{Ut:e})}Ot(e,t){this.Ft(t,25),this.$t(e,t)}$t(e,t){t.xt(e)}Kt(e,t){let r=e.fields||{};for(let e of(this.Ft(t,55),Object.keys(r)))this.Ot(e,t),this.Ct(r[e],t)}kt(e,t){let r=e.fields||{};this.Ft(t,53);let n=r[aP].arrayValue?.values?.length||0;this.Ft(t,15),t.Mt(ay(n)),this.Ot(aP,t),this.Ct(r[aP],t)}qt(e,t){let r=e.values||[];for(let e of(this.Ft(t,50),r))this.Ct(e,t)}Lt(e,t){this.Ft(t,37),ix.fromName(e).path.forEach(e=>{this.Ft(t,60),this.$t(e,t)})}Ft(e,t){e.Mt(t)}Nt(e){e.Mt(2)}}function ud(e){return Math.ceil((64-function(e){let t=0;for(let r=0;r<8;++r){let n=function(e){if(0===e)return 8;let t=0;return e>>4||(t+=4,e<<=4),e>>6||(t+=2,e<<=2),e>>7||(t+=1),t}(255&e[r]);if(t+=n,8!==n)break}return t}(e))/8)}uc.Wt=new uc;class uf{constructor(){this.buffer=new Uint8Array(1024),this.position=0}Qt(e){let t=e[Symbol.iterator](),r=t.next();for(;!r.done;)this.Gt(r.value),r=t.next();this.zt()}jt(e){let t=e[Symbol.iterator](),r=t.next();for(;!r.done;)this.Ht(r.value),r=t.next();this.Jt()}Zt(e){for(let t of e){let e=t.charCodeAt(0);if(e<128)this.Gt(e);else if(e<2048)this.Gt(960|e>>>6),this.Gt(128|63&e);else if(t<"\uD800"||"\uDBFF"<t)this.Gt(480|e>>>12),this.Gt(128|63&e>>>6),this.Gt(128|63&e);else{let e=t.codePointAt(0);this.Gt(240|e>>>18),this.Gt(128|63&e>>>12),this.Gt(128|63&e>>>6),this.Gt(128|63&e)}}this.zt()}Xt(e){for(let t of e){let e=t.charCodeAt(0);if(e<128)this.Ht(e);else if(e<2048)this.Ht(960|e>>>6),this.Ht(128|63&e);else if(t<"\uD800"||"\uDBFF"<t)this.Ht(480|e>>>12),this.Ht(128|63&e>>>6),this.Ht(128|63&e);else{let e=t.codePointAt(0);this.Ht(240|e>>>18),this.Ht(128|63&e>>>12),this.Ht(128|63&e>>>6),this.Ht(128|63&e)}}this.Jt()}Yt(e){let t=this.en(e),r=ud(t);this.tn(1+r),this.buffer[this.position++]=255&r;for(let e=t.length-r;e<t.length;++e)this.buffer[this.position++]=255&t[e]}nn(e){let t=this.en(e),r=ud(t);this.tn(1+r),this.buffer[this.position++]=~(255&r);for(let e=t.length-r;e<t.length;++e)this.buffer[this.position++]=~(255&t[e])}rn(){this.sn(255),this.sn(255)}_n(){this.an(255),this.an(255)}reset(){this.position=0}seed(e){this.tn(e.length),this.buffer.set(e,this.position),this.position+=e.length}un(){return this.buffer.slice(0,this.position)}en(e){let t,r=((t=new DataView(new ArrayBuffer(8))).setFloat64(0,e,!1),new Uint8Array(t.buffer)),n=!!(128&r[0]);r[0]^=n?255:128;for(let e=1;e<r.length;++e)r[e]^=255*!!n;return r}Gt(e){let t=255&e;0===t?(this.sn(0),this.sn(255)):255===t?(this.sn(255),this.sn(0)):this.sn(t)}Ht(e){let t=255&e;0===t?(this.an(0),this.an(255)):255===t?(this.an(255),this.an(0)):this.an(e)}zt(){this.sn(0),this.sn(1)}Jt(){this.an(0),this.an(1)}sn(e){this.tn(1),this.buffer[this.position++]=e}an(e){this.tn(1),this.buffer[this.position++]=~e}tn(e){let t=e+this.position;if(t<=this.buffer.length)return;let r=2*this.buffer.length;r<t&&(r=t);let n=new Uint8Array(r);n.set(this.buffer),this.buffer=n}}class up{constructor(e){this.cn=e}Bt(e){this.cn.Qt(e)}xt(e){this.cn.Zt(e)}Mt(e){this.cn.Yt(e)}vt(){this.cn.rn()}}class um{constructor(e){this.cn=e}Bt(e){this.cn.jt(e)}xt(e){this.cn.Xt(e)}Mt(e){this.cn.nn(e)}vt(){this.cn._n()}}class ug{constructor(){this.cn=new uf,this.ascending=new up(this.cn),this.descending=new um(this.cn)}seed(e){this.cn.seed(e)}ln(e){return 0===e?this.ascending:this.descending}un(){return this.cn.un()}reset(){this.cn.reset()}}class uy{constructor(e,t,r,n){this.hn=e,this.Pn=t,this.Tn=r,this.In=n}En(){let e=this.In.length,t=0===e||255===this.In[e-1]?e+1:e,r=new Uint8Array(t);return r.set(this.In,0),t!==e?r.set([0],this.In.length):++r[r.length-1],new uy(this.hn,this.Pn,this.Tn,r)}Rn(e,t,r){return{indexId:this.hn,uid:e,arrayValue:u_(this.Tn),directionalValue:u_(this.In),orderedDocumentKey:u_(t),documentKey:r.path.toArray()}}An(e,t,r){let n=this.Rn(e,t,r);return[n.indexId,n.uid,n.arrayValue,n.directionalValue,n.orderedDocumentKey,n.documentKey]}}function uw(e,t){let r=e.hn-t.hn;return 0!==r||0!==(r=uv(e.Tn,t.Tn))||0!==(r=uv(e.In,t.In))?r:ix.comparator(e.Pn,t.Pn)}function uv(e,t){for(let r=0;r<e.length&&r<t.length;++r){let n=e[r]-t[r];if(0!==n)return n}return e.length-t.length}function u_(e){return G()?function(e){let t="";for(let r=0;r<e.length;r++)t+=String.fromCharCode(e[r]);return t}(e):e}function uI(e){return"string"!=typeof e?e:function(e){let t=new Uint8Array(e.length);for(let r=0;r<e.length;r++)t[r]=e.charCodeAt(r);return t}(e)}class ub{constructor(e){for(const t of(this.Vn=new au((e,t)=>ik.comparator(e.field,t.field)),this.collectionId=null!=e.collectionGroup?e.collectionGroup:e.path.lastSegment(),this.dn=e.orderBy,this.mn=[],e.filters))t.isInequality()?this.Vn=this.Vn.add(t):this.mn.push(t)}get fn(){return this.Vn.size>1}gn(e){if(ia(e.collectionGroup===this.collectionId,49279),this.fn)return!1;let t=ij(e);if(void 0!==t&&!this.pn(t))return!1;let r=iz(e),n=new Set,i=0,s=0;for(;i<r.length&&this.pn(r[i]);++i)n=n.add(r[i].fieldPath.canonicalString());if(i===r.length)return!0;if(this.Vn.size>0){let e=this.Vn.getIterator().getNext();if(!n.has(e.field.canonicalString())){let t=r[i];if(!this.yn(e,t)||!this.wn(this.dn[s++],t))return!1}++i}for(;i<r.length;++i){let e=r[i];if(s>=this.dn.length||!this.wn(this.dn[s++],e))return!1}return!0}bn(){if(this.fn)return null;let e=new au(ik.comparator),t=[];for(let r of this.mn)if(!r.field.isKeyField())if("array-contains"===r.op||"array-contains-any"===r.op)t.push(new iK(r.field,2));else{if(e.has(r.field))continue;e=e.add(r.field),t.push(new iK(r.field,0))}for(let r of this.dn)r.field.isKeyField()||e.has(r.field)||(e=e.add(r.field),t.push(new iK(r.field,+("asc"!==r.dir))));return new iq(iq.UNKNOWN_ID,this.collectionId,t,iG.empty())}pn(e){for(let t of this.mn)if(this.yn(t,e))return!0;return!1}yn(e,t){if(void 0===e||!e.field.isEqual(t.fieldPath))return!1;let r="array-contains"===e.op||"array-contains-any"===e.op;return 2===t.kind===r}wn(e,t){return!!e.field.isEqual(t.fieldPath)&&(0===t.kind&&"asc"===e.dir||1===t.kind&&"desc"===e.dir)}}function uE(e){return e instanceof a8}function uT(e){return e instanceof a7&&ot(e)}function uS(e){return uE(e)||uT(e)||function(e){if(e instanceof a7&&oe(e)){for(let t of e.getFilters())if(!uE(t)&&!uT(t))return!1;return!0}return!1}(e)}function uC(e,t){return ia(e instanceof a8||e instanceof a7,38388),ia(t instanceof a8||t instanceof a7,25473),uk(e instanceof a8?t instanceof a8?a7.create([e,t],"and"):uA(e,t):t instanceof a8?uA(t,e):function(e,t){if(ia(e.filters.length>0&&t.filters.length>0,48005),a9(e)&&a9(t))return on(e,t.getFilters());let r=oe(e)?e:t,n=oe(e)?t:e,i=r.filters.map(e=>uC(e,n));return a7.create(i,"or")}(e,t))}function uA(e,t){if(a9(t))return on(t,e.getFilters());{let r=t.filters.map(t=>uC(e,t));return a7.create(r,"or")}}function uk(e){if(ia(e instanceof a8||e instanceof a7,11850),e instanceof a8)return e;let t=e.getFilters();if(1===t.length)return uk(t[0]);if(or(e))return e;let r=t.map(e=>uk(e)),n=[];return r.forEach(t=>{t instanceof a8?n.push(t):t instanceof a7&&(t.op===e.op?n.push(...t.filters):n.push(t))}),1===n.length?n[0]:a7.create(n,e.op)}class ux{constructor(){this.Sn=new uN}addToCollectionParentIndex(e,t){return this.Sn.add(t),i0.resolve()}getCollectionParents(e,t){return i0.resolve(this.Sn.getEntries(t))}addFieldIndex(e,t){return i0.resolve()}deleteFieldIndex(e,t){return i0.resolve()}deleteAllFieldIndexes(e){return i0.resolve()}createTargetIndexes(e,t){return i0.resolve()}getDocumentsMatchingTarget(e,t){return i0.resolve(null)}getIndexType(e,t){return i0.resolve(0)}getFieldIndexes(e,t){return i0.resolve([])}getNextCollectionGroupToUpdate(e){return i0.resolve(null)}getMinOffset(e,t){return i0.resolve(iQ.min())}getMinOffsetFromCollectionGroup(e,t){return i0.resolve(iQ.min())}updateCollectionGroup(e,t,r){return i0.resolve()}updateIndexEntries(e,t){return i0.resolve()}}class uN{constructor(){this.index={}}add(e){let t=e.lastSegment(),r=e.popLast(),n=this.index[t]||new au(iC.comparator),i=!n.has(r);return this.index[t]=n.add(r),i}has(e){let t=e.lastSegment(),r=e.popLast(),n=this.index[t];return n&&n.has(r)}getEntries(e){return(this.index[e]||new au(iC.comparator)).toArray()}}let uD="IndexedDbIndexManager",uR=new Uint8Array(0);class uP{constructor(e,t){this.databaseId=t,this.Dn=new uN,this.Cn=new oL(e=>op(e),(e,t)=>om(e,t)),this.uid=e.uid||""}addToCollectionParentIndex(e,t){if(!this.Dn.has(t)){let r=t.lastSegment(),n=t.popLast();e.addOnCommittedListener(()=>{this.Dn.add(t)});let i={collectionId:r,parent:su(n)};return ar(e,sV).put(i)}return i0.resolve()}getCollectionParents(e,t){let r=[],n=IDBKeyRange.bound([t,""],[t+"\0",""],!1,!0);return ar(e,sV).H(n).next(e=>{for(let n of e){if(n.collectionId!==t)break;r.push(sh(n.parent))}return r})}addFieldIndex(e,t){let r=ar(e,sz),n={indexId:t.indexId,collectionGroup:t.collectionGroup,fields:t.fields.map(e=>[e.fieldPath.canonicalString(),e.kind])};delete n.indexId;let i=r.add(n);if(t.indexState){let r=ar(e,sK);return i.next(e=>{r.put(uo(e,this.uid,t.indexState.sequenceNumber,t.indexState.offset))})}return i.next()}deleteFieldIndex(e,t){let r=ar(e,sz),n=ar(e,sK),i=ar(e,sQ);return r.delete(t.indexId).next(()=>n.delete(IDBKeyRange.bound([t.indexId],[t.indexId+1],!1,!0))).next(()=>i.delete(IDBKeyRange.bound([t.indexId],[t.indexId+1],!1,!0)))}deleteAllFieldIndexes(e){let t=ar(e,sz),r=ar(e,sQ),n=ar(e,sK);return t.X().next(()=>r.X()).next(()=>n.X())}createTargetIndexes(e,t){return i0.forEach(this.vn(t),t=>this.getIndexType(e,t).next(r=>{if(0===r||1===r){let r=new ub(t).bn();if(null!=r)return this.addFieldIndex(e,r)}}))}getDocumentsMatchingTarget(e,t){let r=ar(e,sQ),n=!0,i=new Map;return i0.forEach(this.vn(t),t=>this.Fn(e,t).next(e=>{n&&(n=!!e),i.set(t,e)})).next(()=>{if(n){let e=oz(),n=[];return i0.forEach(i,(i,s)=>{n9(uD,`Using index id=${i.indexId}|cg=${i.collectionGroup}|f=${i.fields.map(e=>`${e.fieldPath}:${e.kind}`).join(",")} to execute ${op(t)}`);let a=function(e,t){let r=ij(t);if(void 0===r)return null;for(let t of oy(e,r.fieldPath))switch(t.op){case"array-contains-any":return t.value.arrayValue.values||[];case"array-contains":return[t.value]}return null}(s,i),o=function(e,t){let r=new Map;for(let n of iz(t))for(let t of oy(e,n.fieldPath))switch(t.op){case"==":case"in":r.set(n.fieldPath.canonicalString(),t.value);break;case"not-in":case"!=":return r.set(n.fieldPath.canonicalString(),t.value),Array.from(r.values())}return null}(s,i),l=function(e,t){let r=[],n=!0;for(let i of iz(t)){let t=0===i.kind?ow(e,i.fieldPath,e.startAt):ov(e,i.fieldPath,e.startAt);r.push(t.value),n&&(n=t.inclusive)}return new a2(r,n)}(s,i),u=function(e,t){let r=[],n=!0;for(let i of iz(t)){let t=0===i.kind?ov(e,i.fieldPath,e.endAt):ow(e,i.fieldPath,e.endAt);r.push(t.value),n&&(n=t.inclusive)}return new a2(r,n)}(s,i),h=this.Mn(i,s,l),c=this.Mn(i,s,u),d=this.xn(i,s,o),f=this.On(i.indexId,a,h,l.inclusive,c,u.inclusive,d);return i0.forEach(f,i=>r.Z(i,t.limit).next(t=>{t.forEach(t=>{let r=ix.fromSegments(t.documentKey);e.has(r)||(e=e.add(r),n.push(r))})}))}).next(()=>n)}return i0.resolve(null)})}vn(e){let t=this.Cn.get(e);return t||(t=0===e.filters.length?[e]:(function(e){if(0===e.getFilters().length)return[];let t=function e(t){if(ia(t instanceof a8||t instanceof a7,34018),t instanceof a8)return t;if(1===t.filters.length)return e(t.filters[0]);let r=t.filters.map(t=>e(t)),n=a7.create(r,t.op);return uS(n=uk(n))?n:(ia(n instanceof a7,64498),ia(a9(n),40251),ia(n.filters.length>1,57927),n.filters.reduce((e,t)=>uC(e,t)))}(function e(t){if(ia(t instanceof a8||t instanceof a7,20012),t instanceof a8){if(t instanceof ou){let e=t.value.arrayValue?.values?.map(e=>a8.create(t.field,"==",e))||[];return a7.create(e,"or")}return t}let r=t.filters.map(t=>e(t));return a7.create(r,t.op)}(e));return ia(uS(t),7391),uE(t)||uT(t)?[t]:t.getFilters()})(a7.create(e.filters,"and")).map(t=>of(e.path,e.collectionGroup,e.orderBy,t.getFilters(),e.limit,e.startAt,e.endAt)),this.Cn.set(e,t)),t}On(e,t,r,n,i,s,a){let o=(null!=t?t.length:1)*Math.max(r.length,i.length),l=o/(null!=t?t.length:1),u=[];for(let h=0;h<o;++h){let o=t?this.Nn(t[h/l]):uR,c=this.Bn(e,o,r[h%l],n),d=this.Ln(e,o,i[h%l],s),f=a.map(t=>this.Bn(e,o,t,!0));u.push(...this.createRange(c,d,f))}return u}Bn(e,t,r,n){let i=new uy(e,ix.empty(),t,r);return n?i:i.En()}Ln(e,t,r,n){let i=new uy(e,ix.empty(),t,r);return n?i.En():i}Fn(e,t){let r=new ub(t),n=null!=t.collectionGroup?t.collectionGroup:t.path.lastSegment();return this.getFieldIndexes(e,n).next(e=>{let t=null;for(let n of e)r.gn(n)&&(!t||n.fields.length>t.fields.length)&&(t=n);return t})}getIndexType(e,t){let r=2,n=this.vn(t);return i0.forEach(n,t=>this.Fn(e,t).next(e=>{e?0!==r&&e.fields.length<function(e){let t=new au(ik.comparator),r=!1;for(let n of e.filters)for(let e of n.getFlattenedFilters())e.field.isKeyField()||("array-contains"===e.op||"array-contains-any"===e.op?r=!0:t=t.add(e.field));for(let r of e.orderBy)r.field.isKeyField()||(t=t.add(r.field));return t.size+ +!!r}(t)&&(r=1):r=0})).next(()=>null!==t.limit&&n.length>1&&2===r?1:r)}kn(e,t){let r=new ug;for(let n of iz(e)){let e=t.data.field(n.fieldPath);if(null==e)return null;let i=r.ln(n.kind);uc.Wt.Dt(e,i)}return r.un()}Nn(e){let t=new ug;return uc.Wt.Dt(e,t.ln(0)),t.un()}Kn(e,t){let r,n=new ug;return uc.Wt.Dt(aj(this.databaseId,t),n.ln(0===(r=iz(e)).length?0:r[r.length-1].kind)),n.un()}xn(e,t,r){if(null===r)return[];let n=[];n.push(new ug);let i=0;for(let s of iz(e)){let e=r[i++];for(let r of n)if(this.qn(t,s.fieldPath)&&a$(e))n=this.Un(n,s,e);else{let t=r.ln(s.kind);uc.Wt.Dt(e,t)}}return this.$n(n)}Mn(e,t,r){return this.xn(e,t,r.position)}$n(e){let t=[];for(let r=0;r<e.length;++r)t[r]=e[r].un();return t}Un(e,t,r){let n=[...e],i=[];for(let e of r.arrayValue.values||[])for(let r of n){let n=new ug;n.seed(r.un()),uc.Wt.Dt(e,n.ln(t.kind)),i.push(n)}return i}qn(e,t){return!!e.filters.find(e=>e instanceof a8&&e.field.isEqual(t)&&("in"===e.op||"not-in"===e.op))}getFieldIndexes(e,t){let r=ar(e,sz),n=ar(e,sK);return(t?r.H(s$,IDBKeyRange.bound(t,t)):r.H()).next(e=>{let t=[];return i0.forEach(e,e=>n.get([e.indexId,this.uid]).next(r=>{let n,i;t.push((n=r?new iG(r.sequenceNumber,new iQ(ue(r.readTime),new ix(sh(r.documentKey)),r.largestBatchId)):iG.empty(),i=e.fields.map(([e,t])=>new iK(ik.fromServerFormat(e),t)),new iq(e.indexId,e.collectionGroup,i,n)))})).next(()=>t)})}getNextCollectionGroupToUpdate(e){return this.getFieldIndexes(e).next(e=>0===e.length?null:(e.sort((e,t)=>{let r=e.indexState.sequenceNumber-t.indexState.sequenceNumber;return 0!==r?r:i_(e.collectionGroup,t.collectionGroup)}),e[0].collectionGroup))}updateCollectionGroup(e,t,r){let n=ar(e,sz),i=ar(e,sK);return this.Wn(e).next(e=>n.H(s$,IDBKeyRange.bound(t,t)).next(t=>i0.forEach(t,t=>i.put(uo(t.indexId,this.uid,e,r)))))}updateIndexEntries(e,t){let r=new Map;return i0.forEach(t,(t,n)=>{let i=r.get(t.collectionGroup);return(i?i0.resolve(i):this.getFieldIndexes(e,t.collectionGroup)).next(i=>(r.set(t.collectionGroup,i),i0.forEach(i,r=>this.Qn(e,t,r).next(t=>{let i=this.Gn(n,r);return t.isEqual(i)?i0.resolve():this.zn(e,n,r,t,i)}))))})}jn(e,t,r,n){return ar(e,sQ).put(n.Rn(this.uid,this.Kn(r,t.key),t.key))}Hn(e,t,r,n){return ar(e,sQ).delete(n.An(this.uid,this.Kn(r,t.key),t.key))}Qn(e,t,r){let n=ar(e,sQ),i=new au(uw);return n.ee({index:sY,range:IDBKeyRange.only([r.indexId,this.uid,u_(this.Kn(r,t))])},(e,n)=>{i=i.add(new uy(r.indexId,t,uI(n.arrayValue),uI(n.directionalValue)))}).next(()=>i)}Gn(e,t){let r=new au(uw),n=this.kn(t,e);if(null==n)return r;let i=ij(t);if(null!=i){let s=e.data.field(i.fieldPath);if(a$(s))for(let i of s.arrayValue.values||[])r=r.add(new uy(t.indexId,e.key,this.Nn(i),n))}else r=r.add(new uy(t.indexId,e.key,uR,n));return r}zn(e,t,r,n,i){n9(uD,"Updating index entries for document '%s'",t.key);let s=[];return function(e,t,r,n,i){let s=e.getIterator(),a=t.getIterator(),o=ac(s),l=ac(a);for(;o||l;){let e=!1,t=!1;if(o&&l){let n=r(o,l);n<0?t=!0:n>0&&(e=!0)}else null!=o?t=!0:e=!0;e?(n(l),l=ac(a)):t?(i(o),o=ac(s)):(o=ac(s),l=ac(a))}}(n,i,uw,n=>{s.push(this.jn(e,t,r,n))},n=>{s.push(this.Hn(e,t,r,n))}),i0.waitFor(s)}Wn(e){let t=1;return ar(e,sK).ee({index:sH,reverse:!0,range:IDBKeyRange.upperBound([this.uid,Number.MAX_SAFE_INTEGER])},(e,r,n)=>{n.done(),t=r.sequenceNumber+1}).next(()=>t)}createRange(e,t,r){r=r.sort((e,t)=>uw(e,t)).filter((e,t,r)=>!t||0!==uw(e,r[t-1]));let n=[];for(let i of(n.push(e),r)){let r=uw(i,e),s=uw(i,t);if(0===r)n[0]=e.En();else if(r>0&&s<0)n.push(i),n.push(i.En());else if(s>0)break}n.push(t);let i=[];for(let e=0;e<n.length;e+=2){if(this.Jn(n[e],n[e+1]))return[];let t=n[e].An(this.uid,uR,ix.empty()),r=n[e+1].An(this.uid,uR,ix.empty());i.push(IDBKeyRange.bound(t,r))}return i}Jn(e,t){return uw(e,t)>0}getMinOffsetFromCollectionGroup(e,t){return this.getFieldIndexes(e,t).next(uO)}getMinOffset(e,t){return i0.mapArray(this.vn(t),t=>this.Fn(e,t).next(e=>e||ii(44426))).next(uO)}}function uO(e){ia(0!==e.length,28825);let t=e[0].indexState.offset,r=t.largestBatchId;for(let n=1;n<e.length;n++){let i=e[n].indexState.offset;0>iJ(i,t)&&(t=i),r<i.largestBatchId&&(r=i.largestBatchId)}return new iQ(t.readTime,t.documentKey,r)}let uL={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0};class uM{static withCacheSize(e){return new uM(e,uM.DEFAULT_COLLECTION_PERCENTILE,uM.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}constructor(e,t,r){this.cacheSizeCollectionThreshold=e,this.percentileToCollect=t,this.maximumSequenceNumbersToCollect=r}}function uF(e,t,r){let n=e.store(sm),i=e.store(s_),s=[],a=IDBKeyRange.only(r.batchId),o=0,l=n.ee({range:a},(e,t,r)=>(o++,r.delete()));s.push(l.next(()=>{ia(1===o,47070,{batchId:r.batchId})}));let u=[];for(let e of r.mutations){var h,c;let n=(h=e.key.path,c=r.batchId,[t,su(h),c]);s.push(i.delete(n)),u.push(e.key)}return i0.waitFor(s).next(()=>u)}function uV(e){let t;if(!e)return 0;if(e.document)t=e.document;else if(e.unknownDocument)t=e.unknownDocument;else{if(!e.noDocument)throw ii(14731);t=e.noDocument}return JSON.stringify(t).length}uM.DEFAULT_COLLECTION_PERCENTILE=10,uM.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,uM.DEFAULT=new uM(0x2800000,uM.DEFAULT_COLLECTION_PERCENTILE,uM.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),uM.DISABLED=new uM(-1,0,0);class uU{constructor(e,t,r,n){this.userId=e,this.serializer=t,this.indexManager=r,this.referenceDelegate=n,this.Zn={}}static wt(e,t,r,n){return ia(""!==e.uid,64387),new uU(e.isAuthenticated()?e.uid:"",t,r,n)}checkEmpty(e){let t=!0,r=IDBKeyRange.bound([this.userId,-1/0],[this.userId,1/0]);return uq(e).ee({index:sy,range:r},(e,r,n)=>{t=!1,n.done()}).next(()=>t)}addMutationBatch(e,t,r,n){let i=ar(e,s_),s=uq(e);return s.add({}).next(a=>{var o,l,u,h;let c,d;ia("number"==typeof a,49019);let f=new ll(a,t,r,n),p=(o=this.serializer,l=this.userId,c=f.baseMutations.map(e=>lJ(o.yt,e)),d=f.mutations.map(e=>lJ(o.yt,e)),{userId:l,batchId:f.batchId,localWriteTimeMs:f.localWriteTime.toMillis(),baseMutations:c,mutations:d}),m=[],g=new au((e,t)=>i_(e.canonicalString(),t.canonicalString()));for(let e of n){let t=(u=this.userId,h=e.key.path,[u,su(h),a]);g=g.add(e.key.path.popLast()),m.push(s.put(p)),m.push(i.put(t,sv))}return g.forEach(t=>{m.push(this.indexManager.addToCollectionParentIndex(e,t))}),e.addOnCommittedListener(()=>{this.Zn[a]=f.keys()}),i0.waitFor(m).next(()=>f)})}lookupMutationBatch(e,t){return uq(e).get(t).next(e=>e?(ia(e.userId===this.userId,48,"Unexpected user for mutation batch",{userId:e.userId,batchId:t}),ut(this.serializer,e)):null)}Xn(e,t){return this.Zn[t]?i0.resolve(this.Zn[t]):this.lookupMutationBatch(e,t).next(e=>{if(e){let r=e.keys();return this.Zn[t]=r,r}return null})}getNextMutationBatchAfterBatchId(e,t){let r=t+1,n=IDBKeyRange.lowerBound([this.userId,r]),i=null;return uq(e).ee({index:sy,range:n},(e,t,n)=>{t.userId===this.userId&&(ia(t.batchId>=r,47524,{Yn:r}),i=ut(this.serializer,t)),n.done()}).next(()=>i)}getHighestUnacknowledgedBatchId(e){let t=IDBKeyRange.upperBound([this.userId,1/0]),r=-1;return uq(e).ee({index:sy,range:t,reverse:!0},(e,t,n)=>{r=t.batchId,n.done()}).next(()=>r)}getAllMutationBatches(e){let t=IDBKeyRange.bound([this.userId,-1],[this.userId,1/0]);return uq(e).H(sy,t).next(e=>e.map(e=>ut(this.serializer,e)))}getAllMutationBatchesAffectingDocumentKey(e,t){let r=[this.userId,su(t.path)],n=IDBKeyRange.lowerBound(r),i=[];return ar(e,s_).ee({range:n},(r,n,s)=>{let[a,o,l]=r,u=sh(o);if(a===this.userId&&t.path.isEqual(u))return uq(e).get(l).next(e=>{if(!e)throw ii(61480,{er:r,batchId:l});ia(e.userId===this.userId,10503,"Unexpected user for mutation batch",{userId:e.userId,batchId:l}),i.push(ut(this.serializer,e))});s.done()}).next(()=>i)}getAllMutationBatchesAffectingDocumentKeys(e,t){let r=new au(i_),n=[];return t.forEach(t=>{let i=[this.userId,su(t.path)],s=IDBKeyRange.lowerBound(i),a=ar(e,s_).ee({range:s},(e,n,i)=>{let[s,a,o]=e,l=sh(a);s===this.userId&&t.path.isEqual(l)?r=r.add(o):i.done()});n.push(a)}),i0.waitFor(n).next(()=>this.tr(e,r))}getAllMutationBatchesAffectingQuery(e,t){let r=t.path,n=r.length+1,i=[this.userId,su(r)],s=IDBKeyRange.lowerBound(i),a=new au(i_);return ar(e,s_).ee({range:s},(e,t,i)=>{let[s,o,l]=e,u=sh(o);s===this.userId&&r.isPrefixOf(u)?u.length===n&&(a=a.add(l)):i.done()}).next(()=>this.tr(e,a))}tr(e,t){let r=[],n=[];return t.forEach(t=>{n.push(uq(e).get(t).next(e=>{if(null===e)throw ii(35274,{batchId:t});ia(e.userId===this.userId,9748,"Unexpected user for mutation batch",{userId:e.userId,batchId:t}),r.push(ut(this.serializer,e))}))}),i0.waitFor(n).next(()=>r)}removeMutationBatch(e,t){return uF(e.le,this.userId,t).next(r=>(e.addOnCommittedListener(()=>{this.nr(t.batchId)}),i0.forEach(r,t=>this.referenceDelegate.markPotentiallyOrphaned(e,t))))}nr(e){delete this.Zn[e]}performConsistencyCheck(e){return this.checkEmpty(e).next(t=>{if(!t)return i0.resolve();let r=IDBKeyRange.lowerBound([this.userId]),n=[];return ar(e,s_).ee({range:r},(e,t,r)=>{if(e[0]===this.userId){let t=sh(e[1]);n.push(t)}else r.done()}).next(()=>{ia(0===n.length,56720,{rr:n.map(e=>e.canonicalString())})})})}containsKey(e,t){return uB(e,this.userId,t)}ir(e){return ar(e,sp).get(this.userId).next(e=>e||{userId:this.userId,lastAcknowledgedBatchId:-1,lastStreamToken:""})}}function uB(e,t,r){let n=[t,su(r.path)],i=n[1],s=IDBKeyRange.lowerBound(n),a=!1;return ar(e,s_).ee({range:s,Y:!0},(e,r,n)=>{let[s,o,l]=e;s===t&&o===i&&(a=!0),n.done()}).next(()=>a)}function uq(e){return ar(e,sm)}class uj{constructor(e){this.sr=e}next(){return this.sr+=2,this.sr}static _r(){return new uj(0)}static ar(){return new uj(-1)}}class uz{constructor(e,t){this.referenceDelegate=e,this.serializer=t}allocateTargetId(e){return this.ur(e).next(t=>{let r=new uj(t.highestTargetId);return t.highestTargetId=r.next(),this.cr(e,t).next(()=>t.highestTargetId)})}getLastRemoteSnapshotVersion(e){return this.ur(e).next(e=>iB.fromTimestamp(new iU(e.lastRemoteSnapshotVersion.seconds,e.lastRemoteSnapshotVersion.nanoseconds)))}getHighestSequenceNumber(e){return this.ur(e).next(e=>e.highestListenSequenceNumber)}setTargetsMetadata(e,t,r){return this.ur(e).next(n=>(n.highestListenSequenceNumber=t,r&&(n.lastRemoteSnapshotVersion=r.toTimestamp()),t>n.highestListenSequenceNumber&&(n.highestListenSequenceNumber=t),this.cr(e,n)))}addTargetData(e,t){return this.lr(e,t).next(()=>this.ur(e).next(r=>(r.targetCount+=1,this.hr(t,r),this.cr(e,r))))}updateTargetData(e,t){return this.lr(e,t)}removeTargetData(e,t){return this.removeMatchingKeysForTargetId(e,t.targetId).next(()=>ar(e,sx).delete(t.targetId)).next(()=>this.ur(e)).next(t=>(ia(t.targetCount>0,8065),t.targetCount-=1,this.cr(e,t)))}removeTargets(e,t,r){let n=0,i=[];return ar(e,sx).ee((s,a)=>{let o=ur(a);o.sequenceNumber<=t&&null===r.get(o.targetId)&&(n++,i.push(this.removeTargetData(e,o)))}).next(()=>i0.waitFor(i)).next(()=>n)}forEachTarget(e,t){return ar(e,sx).ee((e,r)=>{t(ur(r))})}ur(e){return ar(e,sF).get(sM).next(e=>(ia(null!==e,2888),e))}cr(e,t){return ar(e,sF).put(sM,t)}lr(e,t){return ar(e,sx).put(un(this.serializer,t))}hr(e,t){let r=!1;return e.targetId>t.highestTargetId&&(t.highestTargetId=e.targetId,r=!0),e.sequenceNumber>t.highestListenSequenceNumber&&(t.highestListenSequenceNumber=e.sequenceNumber,r=!0),r}getTargetCount(e){return this.ur(e).next(e=>e.targetCount)}getTargetData(e,t){let r=op(t),n=IDBKeyRange.bound([r,-1/0],[r,1/0]),i=null;return ar(e,sx).ee({range:n,index:sN},(e,r,n)=>{let s=ur(r);om(t,s.target)&&(i=s,n.done())}).next(()=>i)}addMatchingKeys(e,t,r){let n=[],i=u$(e);return t.forEach(t=>{let s=su(t.path);n.push(i.put({targetId:r,path:s})),n.push(this.referenceDelegate.addReference(e,r,t))}),i0.waitFor(n)}removeMatchingKeys(e,t,r){let n=u$(e);return i0.forEach(t,t=>{let i=su(t.path);return i0.waitFor([n.delete([r,i]),this.referenceDelegate.removeReference(e,r,t)])})}removeMatchingKeysForTargetId(e,t){let r=u$(e),n=IDBKeyRange.bound([t],[t+1],!1,!0);return r.delete(n)}getMatchingKeysForTargetId(e,t){let r=IDBKeyRange.bound([t],[t+1],!1,!0),n=u$(e),i=oz();return n.ee({range:r,Y:!0},(e,t,r)=>{let n=new ix(sh(e[1]));i=i.add(n)}).next(()=>i)}containsKey(e,t){let r=su(t.path),n=IDBKeyRange.bound([r],[r+"\0"],!1,!0),i=0;return u$(e).ee({index:sO,Y:!0,range:n},([e,t],r,n)=>{0!==e&&(i++,n.done())}).next(()=>i>0)}At(e,t){return ar(e,sx).get(t).next(e=>e?ur(e):null)}}function u$(e){return ar(e,sR)}let uK="LruGarbageCollector";function uG([e,t],[r,n]){let i=i_(e,r);return 0===i?i_(t,n):i}class uH{constructor(e){this.Pr=e,this.buffer=new au(uG),this.Tr=0}Ir(){return++this.Tr}Er(e){let t=[e,this.Ir()];if(this.buffer.size<this.Pr)this.buffer=this.buffer.add(t);else{let e=this.buffer.last();0>uG(t,e)&&(this.buffer=this.buffer.delete(e).add(t))}}get maxValue(){return this.buffer.last()[0]}}class uW{constructor(e,t,r){this.garbageCollector=e,this.asyncQueue=t,this.localStore=r,this.Rr=null}start(){-1!==this.garbageCollector.params.cacheSizeCollectionThreshold&&this.Ar(6e4)}stop(){this.Rr&&(this.Rr.cancel(),this.Rr=null)}get started(){return null!==this.Rr}Ar(e){n9(uK,`Garbage collection scheduled in ${e}ms`),this.Rr=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",e,async()=>{this.Rr=null;try{await this.localStore.collectGarbage(this.garbageCollector)}catch(e){i8(e)?n9(uK,"Ignoring IndexedDB error during garbage collection: ",e):await iZ(e)}await this.Ar(3e5)})}}class uQ{constructor(e,t){this.Vr=e,this.params=t}calculateTargetCount(e,t){return this.Vr.dr(e).next(e=>Math.floor(t/100*e))}nthSequenceNumber(e,t){if(0===t)return i0.resolve(ss.ce);let r=new uH(t);return this.Vr.forEachTarget(e,e=>r.Er(e.sequenceNumber)).next(()=>this.Vr.mr(e,e=>r.Er(e))).next(()=>r.maxValue)}removeTargets(e,t,r){return this.Vr.removeTargets(e,t,r)}removeOrphanedDocuments(e,t){return this.Vr.removeOrphanedDocuments(e,t)}collect(e,t){return -1===this.params.cacheSizeCollectionThreshold?(n9("LruGarbageCollector","Garbage collection skipped; disabled"),i0.resolve(uL)):this.getCacheSize(e).next(r=>r<this.params.cacheSizeCollectionThreshold?(n9("LruGarbageCollector",`Garbage collection skipped; Cache size ${r} is lower than threshold ${this.params.cacheSizeCollectionThreshold}`),uL):this.gr(e,t))}getCacheSize(e){return this.Vr.getCacheSize(e)}gr(e,t){let r,n,i,s,o,l,u,h=Date.now();return this.calculateTargetCount(e,this.params.percentileToCollect).next(t=>(t>this.params.maximumSequenceNumbersToCollect?(n9("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.maximumSequenceNumbersToCollect} from ${t}`),n=this.params.maximumSequenceNumbersToCollect):n=t,s=Date.now(),this.nthSequenceNumber(e,n))).next(n=>(r=n,o=Date.now(),this.removeTargets(e,r,t))).next(t=>(i=t,l=Date.now(),this.removeOrphanedDocuments(e,r))).next(e=>(u=Date.now(),n7()<=a.DEBUG&&n9("LruGarbageCollector",`LRU Garbage Collection
	Counted targets in ${s-h}ms
	Determined least recently used ${n} in `+(o-s)+"ms\n"+`	Removed ${i} targets in `+(l-o)+"ms\n"+`	Removed ${e} documents in `+(u-l)+"ms\n"+`Total Duration: ${u-h}ms`),i0.resolve({didRun:!0,sequenceNumbersCollected:n,targetsRemoved:i,documentsRemoved:e})))}}class uJ{constructor(e,t){this.db=e,this.garbageCollector=function(e,t){return new uQ(e,t)}(this,t)}dr(e){let t=this.pr(e);return this.db.getTargetCache().getTargetCount(e).next(e=>t.next(t=>e+t))}pr(e){let t=0;return this.mr(e,e=>{t++}).next(()=>t)}forEachTarget(e,t){return this.db.getTargetCache().forEachTarget(e,t)}mr(e,t){return this.yr(e,(e,r)=>t(r))}addReference(e,t,r){return uY(e,r)}removeReference(e,t,r){return uY(e,r)}removeTargets(e,t,r){return this.db.getTargetCache().removeTargets(e,t,r)}markPotentiallyOrphaned(e,t){return uY(e,t)}wr(e,t){let r;return r=!1,ar(e,sp).te(n=>uB(e,n,t).next(e=>(e&&(r=!0),i0.resolve(!e)))).next(()=>r)}removeOrphanedDocuments(e,t){let r=this.db.getRemoteDocumentCache().newChangeBuffer(),n=[],i=0;return this.yr(e,(s,a)=>{if(a<=t){let t=this.wr(e,s).next(t=>{if(!t)return i++,r.getEntry(e,s).next(()=>(r.removeEntry(s,iB.min()),u$(e).delete([0,su(s.path)])))});n.push(t)}}).next(()=>i0.waitFor(n)).next(()=>r.apply(e)).next(()=>i)}removeTarget(e,t){let r=t.withSequenceNumber(e.currentSequenceNumber);return this.db.getTargetCache().updateTargetData(e,r)}updateLimboDocument(e,t){return uY(e,t)}yr(e,t){let r=u$(e),n,i=ss.ce;return r.ee({index:sO},([e,r],{path:s,sequenceNumber:a})=>{0===e?(i!==ss.ce&&t(new ix(sh(n)),i),i=a,n=s):i=ss.ce}).next(()=>{i!==ss.ce&&t(new ix(sh(n)),i)})}getCacheSize(e){return this.db.getRemoteDocumentCache().getSize(e)}}function uY(e,t){var r;return u$(e).put((r=e.currentSequenceNumber,{targetId:0,path:su(t.path),sequenceNumber:r}))}class uX{constructor(){this.changes=new oL(e=>e.toString(),(e,t)=>e.isEqual(t)),this.changesApplied=!1}addEntry(e){this.assertNotApplied(),this.changes.set(e.key,e)}removeEntry(e,t){this.assertNotApplied(),this.changes.set(e,a1.newInvalidDocument(e).setReadTime(t))}getEntry(e,t){this.assertNotApplied();let r=this.changes.get(t);return void 0!==r?i0.resolve(r):this.getFromCache(e,t)}getEntries(e,t){return this.getAllFromCache(e,t)}apply(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}assertNotApplied(){}}class uZ{constructor(e){this.serializer=e}setIndexManager(e){this.indexManager=e}addEntry(e,t,r){return ar(e,sI).put(r)}removeEntry(e,t,r){let n;return ar(e,sI).delete([(n=t.path.toArray()).slice(0,n.length-2),n[n.length-2],l7(r),n[n.length-1]])}updateMetadata(e,t){return this.getMetadata(e).next(r=>(r.byteSize+=t,this.br(e,r)))}getEntry(e,t){let r=a1.newInvalidDocument(t);return ar(e,sI).ee({index:sE,range:IDBKeyRange.only(u1(t))},(e,n)=>{r=this.Sr(t,n)}).next(()=>r)}Dr(e,t){let r={size:0,document:a1.newInvalidDocument(t)};return ar(e,sI).ee({index:sE,range:IDBKeyRange.only(u1(t))},(e,n)=>{r={document:this.Sr(t,n),size:uV(n)}}).next(()=>r)}getEntries(e,t){let r=oM;return this.Cr(e,t,(e,t)=>{let n=this.Sr(e,t);r=r.insert(e,n)}).next(()=>r)}vr(e,t){let r=oM,n=new aa(ix.comparator);return this.Cr(e,t,(e,t)=>{let i=this.Sr(e,t);r=r.insert(e,i),n=n.insert(e,uV(t))}).next(()=>({documents:r,Fr:n}))}Cr(e,t,r){if(t.isEmpty())return i0.resolve();let n=new au(u6);t.forEach(e=>n=n.add(e));let i=IDBKeyRange.bound(u1(n.first()),u1(n.last())),s=n.getIterator(),a=s.getNext();return ar(e,sI).ee({index:sE,range:i},(e,t,n)=>{let i=ix.fromSegments([...t.prefixPath,t.collectionGroup,t.documentId]);for(;a&&0>u6(a,i);)r(a,null),a=s.getNext();a&&a.isEqual(i)&&(r(a,t),a=s.hasNext()?s.getNext():null),a?n.j(u1(a)):n.done()}).next(()=>{for(;a;)r(a,null),a=s.hasNext()?s.getNext():null})}getDocumentsMatchingQuery(e,t,r,n,i){let s=t.path,a=[s.popLast().toArray(),s.lastSegment(),l7(r.readTime),r.documentKey.path.isEmpty()?"":r.documentKey.path.lastSegment()],o=[s.popLast().toArray(),s.lastSegment(),[Number.MAX_SAFE_INTEGER,Number.MAX_SAFE_INTEGER],""];return ar(e,sI).H(IDBKeyRange.bound(a,o,!0)).next(e=>{i?.incrementDocumentReadCount(e.length);let r=oM;for(let i of e){let e=this.Sr(ix.fromSegments(i.prefixPath.concat(i.collectionGroup,i.documentId)),i);e.isFoundDocument()&&(oR(t,e)||n.has(e.key))&&(r=r.insert(e.key,e))}return r})}getAllFromCollectionGroup(e,t,r,n){let i=oM,s=u2(t,r),a=u2(t,iQ.max());return ar(e,sI).ee({index:sS,range:IDBKeyRange.bound(s,a,!0)},(e,t,r)=>{let s=this.Sr(ix.fromSegments(t.prefixPath.concat(t.collectionGroup,t.documentId)),t);(i=i.insert(s.key,s)).size===n&&r.done()}).next(()=>i)}newChangeBuffer(e){return new u0(this,!!e&&e.trackRemovals)}getSize(e){return this.getMetadata(e).next(e=>e.byteSize)}getMetadata(e){return ar(e,sA).get(sk).next(e=>(ia(!!e,20021),e))}br(e,t){return ar(e,sA).put(sk,t)}Sr(e,t){if(t){let e=function(e,t){var r;let n,i;if(t.document)n=lQ(e.yt,t.document,!!t.hasCommittedMutations);else if(t.noDocument){let e=ix.fromSegments(t.noDocument.path),r=ue(t.noDocument.readTime);n=a1.newNoDocument(e,r),t.hasCommittedMutations&&n.setHasCommittedMutations()}else{if(!t.unknownDocument)return ii(56709);{let e=ix.fromSegments(t.unknownDocument.path),r=ue(t.unknownDocument.version);n=a1.newUnknownDocument(e,r)}}return t.readTime&&n.setReadTime((i=new iU((r=t.readTime)[0],r[1]),iB.fromTimestamp(i))),n}(this.serializer,t);if(!(e.isNoDocument()&&e.version.isEqual(iB.min())))return e}return a1.newInvalidDocument(e)}}class u0 extends uX{constructor(e,t){super(),this.Mr=e,this.trackRemovals=t,this.Or=new oL(e=>e.toString(),(e,t)=>e.isEqual(t))}applyChanges(e){let t=[],r=0,n=new au((e,t)=>i_(e.canonicalString(),t.canonicalString()));return this.changes.forEach((i,s)=>{let a=this.Or.get(i);if(t.push(this.Mr.removeEntry(e,i,a.readTime)),s.isValidDocument()){let o=l8(this.Mr.serializer,s);n=n.add(i.path.popLast());let l=uV(o);r+=l-a.size,t.push(this.Mr.addEntry(e,i,o))}else if(r-=a.size,this.trackRemovals){let r=l8(this.Mr.serializer,s.convertToNoDocument(iB.min()));t.push(this.Mr.addEntry(e,i,r))}}),n.forEach(r=>{t.push(this.Mr.indexManager.addToCollectionParentIndex(e,r))}),t.push(this.Mr.updateMetadata(e,r)),i0.waitFor(t)}getFromCache(e,t){return this.Mr.Dr(e,t).next(e=>(this.Or.set(t,{size:e.size,readTime:e.document.readTime}),e.document))}getAllFromCache(e,t){return this.Mr.vr(e,t).next(({documents:e,Fr:t})=>(t.forEach((t,r)=>{this.Or.set(t,{size:r,readTime:e.get(t).readTime})}),e))}}function u1(e){let t=e.path.toArray();return[t.slice(0,t.length-2),t[t.length-2],t[t.length-1]]}function u2(e,t){let r=t.documentKey.path.toArray();return[e,l7(t.readTime),r.slice(0,r.length-2),r.length>0?r[r.length-1]:""]}function u6(e,t){let r=e.path.toArray(),n=t.path.toArray(),i=0;for(let e=0;e<r.length-2&&e<n.length-2;++e)if(i=i_(r[e],n[e]))return i;return(i=i_(r.length,n.length))||(i=i_(r[r.length-2],n[n.length-2]))||i_(r[r.length-1],n[n.length-1])}class u3{constructor(e,t){this.overlayedDocument=e,this.mutatedFields=t}}class u4{constructor(e,t,r,n){this.remoteDocumentCache=e,this.mutationQueue=t,this.documentOverlayCache=r,this.indexManager=n}getDocument(e,t){let r=null;return this.documentOverlayCache.getOverlay(e,t).next(n=>(r=n,this.remoteDocumentCache.getEntry(e,t))).next(e=>(null!==r&&o9(r.mutation,e,ad.empty(),iU.now()),e))}getDocuments(e,t){return this.remoteDocumentCache.getEntries(e,t).next(t=>this.getLocalViewOfDocuments(e,t,oz()).next(()=>t))}getLocalViewOfDocuments(e,t,r=oz()){let n=oB();return this.populateOverlays(e,n,t).next(()=>this.computeViews(e,t,n,r).next(e=>{let t=oV();return e.forEach((e,r)=>{t=t.insert(e,r.overlayedDocument)}),t}))}getOverlayedDocuments(e,t){let r=oB();return this.populateOverlays(e,r,t).next(()=>this.computeViews(e,t,r,oz()))}populateOverlays(e,t,r){let n=[];return r.forEach(e=>{t.has(e)||n.push(e)}),this.documentOverlayCache.getOverlays(e,n).next(e=>{e.forEach((e,r)=>{t.set(e,r)})})}computeViews(e,t,r,n){let i=oM,s=oB(),a=oB();return t.forEach((e,t)=>{let a=r.get(t.key);n.has(t.key)&&(void 0===a||a.mutation instanceof lr)?i=i.insert(t.key,t):void 0!==a?(s.set(t.key,a.mutation.getFieldMask()),o9(a.mutation,t,a.mutation.getFieldMask(),iU.now())):s.set(t.key,ad.empty())}),this.recalculateAndSaveOverlays(e,i).next(e=>(e.forEach((e,t)=>s.set(e,t)),t.forEach((e,t)=>a.set(e,new u3(t,s.get(e)??null))),a))}recalculateAndSaveOverlays(e,t){let r=oB(),n=new aa((e,t)=>e-t),i=oz();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(e,t).next(e=>{for(let i of e)i.keys().forEach(e=>{let s=t.get(e);if(null===s)return;let a=r.get(e)||ad.empty();a=i.applyToLocalView(s,a),r.set(e,a);let o=(n.get(i.batchId)||oz()).add(e);n=n.insert(i.batchId,o)})}).next(()=>{let s=[],a=n.getReverseIterator();for(;a.hasNext();){let n=a.getNext(),o=n.key,l=n.value,u=oB();l.forEach(e=>{if(!i.has(e)){let n=o7(t.get(e),r.get(e));null!==n&&u.set(e,n),i=i.add(e)}}),s.push(this.documentOverlayCache.saveOverlays(e,o,u))}return i0.waitFor(s)}).next(()=>r)}recalculateAndSaveOverlaysForDocumentKeys(e,t){return this.remoteDocumentCache.getEntries(e,t).next(t=>this.recalculateAndSaveOverlays(e,t))}getDocumentsMatchingQuery(e,t,r,n){return ix.isDocumentKey(t.path)&&null===t.collectionGroup&&0===t.filters.length?this.getDocumentsMatchingDocumentQuery(e,t.path):oE(t)?this.getDocumentsMatchingCollectionGroupQuery(e,t,r,n):this.getDocumentsMatchingCollectionQuery(e,t,r,n)}getNextDocuments(e,t,r,n){return this.remoteDocumentCache.getAllFromCollectionGroup(e,t,r,n).next(i=>{let s=n-i.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(e,t,r.largestBatchId,n-i.size):i0.resolve(oB()),a=-1,o=i;return s.next(t=>i0.forEach(t,(t,r)=>(a<r.largestBatchId&&(a=r.largestBatchId),i.get(t)?i0.resolve():this.remoteDocumentCache.getEntry(e,t).next(e=>{o=o.insert(t,e)}))).next(()=>this.populateOverlays(e,t,i)).next(()=>this.computeViews(e,o,t,oz())).next(e=>({batchId:a,changes:oU(e)})))})}getDocumentsMatchingDocumentQuery(e,t){return this.getDocument(e,new ix(t)).next(e=>{let t=oV();return e.isFoundDocument()&&(t=t.insert(e.key,e)),t})}getDocumentsMatchingCollectionGroupQuery(e,t,r,n){let i=t.collectionGroup,s=oV();return this.indexManager.getCollectionParents(e,i).next(a=>i0.forEach(a,a=>{let o=new o_(a.child(i),null,t.explicitOrderBy.slice(),t.filters.slice(),t.limit,t.limitType,t.startAt,t.endAt);return this.getDocumentsMatchingCollectionQuery(e,o,r,n).next(e=>{e.forEach((e,t)=>{s=s.insert(e,t)})})}).next(()=>s))}getDocumentsMatchingCollectionQuery(e,t,r,n){let i;return this.documentOverlayCache.getOverlaysForCollection(e,t.path,r.largestBatchId).next(s=>(i=s,this.remoteDocumentCache.getDocumentsMatchingQuery(e,t,r,i,n))).next(e=>{i.forEach((t,r)=>{let n=r.getKey();null===e.get(n)&&(e=e.insert(n,a1.newInvalidDocument(n)))});let r=oV();return e.forEach((e,n)=>{let s=i.get(e);void 0!==s&&o9(s.mutation,n,ad.empty(),iU.now()),oR(t,n)&&(r=r.insert(e,n))}),r})}}class u5{constructor(e){this.serializer=e,this.Nr=new Map,this.Br=new Map}getBundleMetadata(e,t){return i0.resolve(this.Nr.get(t))}saveBundleMetadata(e,t){return this.Nr.set(t.id,{id:t.id,version:t.version,createTime:lV(t.createTime)}),i0.resolve()}getNamedQuery(e,t){return i0.resolve(this.Br.get(t))}saveNamedQuery(e,t){return this.Br.set(t.name,{name:t.name,query:ui(t.bundledQuery),readTime:lV(t.readTime)}),i0.resolve()}}class u8{constructor(){this.overlays=new aa(ix.comparator),this.Lr=new Map}getOverlay(e,t){return i0.resolve(this.overlays.get(t))}getOverlays(e,t){let r=oB();return i0.forEach(t,t=>this.getOverlay(e,t).next(e=>{null!==e&&r.set(t,e)})).next(()=>r)}saveOverlays(e,t,r){return r.forEach((r,n)=>{this.bt(e,t,n)}),i0.resolve()}removeOverlaysForBatchId(e,t,r){let n=this.Lr.get(r);return void 0!==n&&(n.forEach(e=>this.overlays=this.overlays.remove(e)),this.Lr.delete(r)),i0.resolve()}getOverlaysForCollection(e,t,r){let n=oB(),i=t.length+1,s=new ix(t.child("")),a=this.overlays.getIteratorFrom(s);for(;a.hasNext();){let e=a.getNext().value,s=e.getKey();if(!t.isPrefixOf(s.path))break;s.path.length===i&&e.largestBatchId>r&&n.set(e.getKey(),e)}return i0.resolve(n)}getOverlaysForCollectionGroup(e,t,r,n){let i=new aa((e,t)=>e-t),s=this.overlays.getIterator();for(;s.hasNext();){let e=s.getNext().value;if(e.getKey().getCollectionGroup()===t&&e.largestBatchId>r){let t=i.get(e.largestBatchId);null===t&&(t=oB(),i=i.insert(e.largestBatchId,t)),t.set(e.getKey(),e)}}let a=oB(),o=i.getIterator();for(;o.hasNext()&&(o.getNext().value.forEach((e,t)=>a.set(e,t)),!(a.size()>=n)););return i0.resolve(a)}bt(e,t,r){let n=this.overlays.get(r.key);if(null!==n){let e=this.Lr.get(n.largestBatchId).delete(r.key);this.Lr.set(n.largestBatchId,e)}this.overlays=this.overlays.insert(r.key,new lh(t,r));let i=this.Lr.get(t);void 0===i&&(i=oz(),this.Lr.set(t,i)),this.Lr.set(t,i.add(r.key))}}class u7{constructor(){this.sessionToken=ap.EMPTY_BYTE_STRING}getSessionToken(e){return i0.resolve(this.sessionToken)}setSessionToken(e,t){return this.sessionToken=t,i0.resolve()}}class u9{constructor(){this.kr=new au(he.Kr),this.qr=new au(he.Ur)}isEmpty(){return this.kr.isEmpty()}addReference(e,t){let r=new he(e,t);this.kr=this.kr.add(r),this.qr=this.qr.add(r)}$r(e,t){e.forEach(e=>this.addReference(e,t))}removeReference(e,t){this.Wr(new he(e,t))}Qr(e,t){e.forEach(e=>this.removeReference(e,t))}Gr(e){let t=new ix(new iC([])),r=new he(t,e),n=new he(t,e+1),i=[];return this.qr.forEachInRange([r,n],e=>{this.Wr(e),i.push(e.key)}),i}zr(){this.kr.forEach(e=>this.Wr(e))}Wr(e){this.kr=this.kr.delete(e),this.qr=this.qr.delete(e)}jr(e){let t=new ix(new iC([])),r=new he(t,e),n=new he(t,e+1),i=oz();return this.qr.forEachInRange([r,n],e=>{i=i.add(e.key)}),i}containsKey(e){let t=new he(e,0),r=this.kr.firstAfterOrEqual(t);return null!==r&&e.isEqual(r.key)}}class he{constructor(e,t){this.key=e,this.Hr=t}static Kr(e,t){return ix.comparator(e.key,t.key)||i_(e.Hr,t.Hr)}static Ur(e,t){return i_(e.Hr,t.Hr)||ix.comparator(e.key,t.key)}}class ht{constructor(e,t){this.indexManager=e,this.referenceDelegate=t,this.mutationQueue=[],this.Yn=1,this.Jr=new au(he.Kr)}checkEmpty(e){return i0.resolve(0===this.mutationQueue.length)}addMutationBatch(e,t,r,n){let i=this.Yn;this.Yn++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];let s=new ll(i,t,r,n);for(let t of(this.mutationQueue.push(s),n))this.Jr=this.Jr.add(new he(t.key,i)),this.indexManager.addToCollectionParentIndex(e,t.key.path.popLast());return i0.resolve(s)}lookupMutationBatch(e,t){return i0.resolve(this.Zr(t))}getNextMutationBatchAfterBatchId(e,t){let r=this.Xr(t+1),n=r<0?0:r;return i0.resolve(this.mutationQueue.length>n?this.mutationQueue[n]:null)}getHighestUnacknowledgedBatchId(){return i0.resolve(0===this.mutationQueue.length?-1:this.Yn-1)}getAllMutationBatches(e){return i0.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(e,t){let r=new he(t,0),n=new he(t,1/0),i=[];return this.Jr.forEachInRange([r,n],e=>{let t=this.Zr(e.Hr);i.push(t)}),i0.resolve(i)}getAllMutationBatchesAffectingDocumentKeys(e,t){let r=new au(i_);return t.forEach(e=>{let t=new he(e,0),n=new he(e,1/0);this.Jr.forEachInRange([t,n],e=>{r=r.add(e.Hr)})}),i0.resolve(this.Yr(r))}getAllMutationBatchesAffectingQuery(e,t){let r=t.path,n=r.length+1,i=r;ix.isDocumentKey(i)||(i=i.child(""));let s=new he(new ix(i),0),a=new au(i_);return this.Jr.forEachWhile(e=>{let t=e.key.path;return!!r.isPrefixOf(t)&&(t.length===n&&(a=a.add(e.Hr)),!0)},s),i0.resolve(this.Yr(a))}Yr(e){let t=[];return e.forEach(e=>{let r=this.Zr(e);null!==r&&t.push(r)}),t}removeMutationBatch(e,t){ia(0===this.ei(t.batchId,"removed"),55003),this.mutationQueue.shift();let r=this.Jr;return i0.forEach(t.mutations,n=>{let i=new he(n.key,t.batchId);return r=r.delete(i),this.referenceDelegate.markPotentiallyOrphaned(e,n.key)}).next(()=>{this.Jr=r})}nr(e){}containsKey(e,t){let r=new he(t,0),n=this.Jr.firstAfterOrEqual(r);return i0.resolve(t.isEqual(n&&n.key))}performConsistencyCheck(e){return this.mutationQueue.length,i0.resolve()}ei(e,t){return this.Xr(e)}Xr(e){return 0===this.mutationQueue.length?0:e-this.mutationQueue[0].batchId}Zr(e){let t=this.Xr(e);return t<0||t>=this.mutationQueue.length?null:this.mutationQueue[t]}}class hr{constructor(e){this.ti=e,this.docs=new aa(ix.comparator),this.size=0}setIndexManager(e){this.indexManager=e}addEntry(e,t){let r=t.key,n=this.docs.get(r),i=n?n.size:0,s=this.ti(t);return this.docs=this.docs.insert(r,{document:t.mutableCopy(),size:s}),this.size+=s-i,this.indexManager.addToCollectionParentIndex(e,r.path.popLast())}removeEntry(e){let t=this.docs.get(e);t&&(this.docs=this.docs.remove(e),this.size-=t.size)}getEntry(e,t){let r=this.docs.get(t);return i0.resolve(r?r.document.mutableCopy():a1.newInvalidDocument(t))}getEntries(e,t){let r=oM;return t.forEach(e=>{let t=this.docs.get(e);r=r.insert(e,t?t.document.mutableCopy():a1.newInvalidDocument(e))}),i0.resolve(r)}getDocumentsMatchingQuery(e,t,r,n){let i=oM,s=t.path,a=new ix(s.child("__id-9223372036854775808__")),o=this.docs.getIteratorFrom(a);for(;o.hasNext();){let{key:e,value:{document:a}}=o.getNext();if(!s.isPrefixOf(e.path))break;e.path.length>s.length+1||0>=iJ(iW(a),r)||(n.has(a.key)||oR(t,a))&&(i=i.insert(a.key,a.mutableCopy()))}return i0.resolve(i)}getAllFromCollectionGroup(e,t,r,n){ii(9500)}ni(e,t){return i0.forEach(this.docs,e=>t(e))}newChangeBuffer(e){return new hn(this)}getSize(e){return i0.resolve(this.size)}}class hn extends uX{constructor(e){super(),this.Mr=e}applyChanges(e){let t=[];return this.changes.forEach((r,n)=>{n.isValidDocument()?t.push(this.Mr.addEntry(e,n)):this.Mr.removeEntry(r)}),i0.waitFor(t)}getFromCache(e,t){return this.Mr.getEntry(e,t)}getAllFromCache(e,t){return this.Mr.getEntries(e,t)}}class hi{constructor(e){this.persistence=e,this.ri=new oL(e=>op(e),om),this.lastRemoteSnapshotVersion=iB.min(),this.highestTargetId=0,this.ii=0,this.si=new u9,this.targetCount=0,this.oi=uj._r()}forEachTarget(e,t){return this.ri.forEach((e,r)=>t(r)),i0.resolve()}getLastRemoteSnapshotVersion(e){return i0.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(e){return i0.resolve(this.ii)}allocateTargetId(e){return this.highestTargetId=this.oi.next(),i0.resolve(this.highestTargetId)}setTargetsMetadata(e,t,r){return r&&(this.lastRemoteSnapshotVersion=r),t>this.ii&&(this.ii=t),i0.resolve()}lr(e){this.ri.set(e.target,e);let t=e.targetId;t>this.highestTargetId&&(this.oi=new uj(t),this.highestTargetId=t),e.sequenceNumber>this.ii&&(this.ii=e.sequenceNumber)}addTargetData(e,t){return this.lr(t),this.targetCount+=1,i0.resolve()}updateTargetData(e,t){return this.lr(t),i0.resolve()}removeTargetData(e,t){return this.ri.delete(t.target),this.si.Gr(t.targetId),this.targetCount-=1,i0.resolve()}removeTargets(e,t,r){let n=0,i=[];return this.ri.forEach((s,a)=>{a.sequenceNumber<=t&&null===r.get(a.targetId)&&(this.ri.delete(s),i.push(this.removeMatchingKeysForTargetId(e,a.targetId)),n++)}),i0.waitFor(i).next(()=>n)}getTargetCount(e){return i0.resolve(this.targetCount)}getTargetData(e,t){let r=this.ri.get(t)||null;return i0.resolve(r)}addMatchingKeys(e,t,r){return this.si.$r(t,r),i0.resolve()}removeMatchingKeys(e,t,r){this.si.Qr(t,r);let n=this.persistence.referenceDelegate,i=[];return n&&t.forEach(t=>{i.push(n.markPotentiallyOrphaned(e,t))}),i0.waitFor(i)}removeMatchingKeysForTargetId(e,t){return this.si.Gr(t),i0.resolve()}getMatchingKeysForTargetId(e,t){let r=this.si.jr(t);return i0.resolve(r)}containsKey(e,t){return i0.resolve(this.si.containsKey(t))}}class hs{constructor(e,t){this._i={},this.overlays={},this.ai=new ss(0),this.ui=!1,this.ui=!0,this.ci=new u7,this.referenceDelegate=e(this),this.li=new hi(this),this.indexManager=new ux,this.remoteDocumentCache=function(e){return new hr(e)}(e=>this.referenceDelegate.hi(e)),this.serializer=new l5(t),this.Pi=new u5(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.ui=!1,Promise.resolve()}get started(){return this.ui}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(e){return this.indexManager}getDocumentOverlayCache(e){let t=this.overlays[e.toKey()];return t||(t=new u8,this.overlays[e.toKey()]=t),t}getMutationQueue(e,t){let r=this._i[e.toKey()];return r||(r=new ht(t,this.referenceDelegate),this._i[e.toKey()]=r),r}getGlobalsCache(){return this.ci}getTargetCache(){return this.li}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.Pi}runTransaction(e,t,r){n9("MemoryPersistence","Starting transaction:",e);let n=new ha(this.ai.next());return this.referenceDelegate.Ti(),r(n).next(e=>this.referenceDelegate.Ii(n).next(()=>e)).toPromise().then(e=>(n.raiseOnCommittedEvent(),e))}Ei(e,t){return i0.or(Object.values(this._i).map(r=>()=>r.containsKey(e,t)))}}class ha extends iX{constructor(e){super(),this.currentSequenceNumber=e}}class ho{constructor(e){this.persistence=e,this.Ri=new u9,this.Ai=null}static Vi(e){return new ho(e)}get di(){if(this.Ai)return this.Ai;throw ii(60996)}addReference(e,t,r){return this.Ri.addReference(r,t),this.di.delete(r.toString()),i0.resolve()}removeReference(e,t,r){return this.Ri.removeReference(r,t),this.di.add(r.toString()),i0.resolve()}markPotentiallyOrphaned(e,t){return this.di.add(t.toString()),i0.resolve()}removeTarget(e,t){this.Ri.Gr(t.targetId).forEach(e=>this.di.add(e.toString()));let r=this.persistence.getTargetCache();return r.getMatchingKeysForTargetId(e,t.targetId).next(e=>{e.forEach(e=>this.di.add(e.toString()))}).next(()=>r.removeTargetData(e,t))}Ti(){this.Ai=new Set}Ii(e){let t=this.persistence.getRemoteDocumentCache().newChangeBuffer();return i0.forEach(this.di,r=>{let n=ix.fromPath(r);return this.mi(e,n).next(e=>{e||t.removeEntry(n,iB.min())})}).next(()=>(this.Ai=null,t.apply(e)))}updateLimboDocument(e,t){return this.mi(e,t).next(e=>{e?this.di.delete(t.toString()):this.di.add(t.toString())})}hi(e){return 0}mi(e,t){return i0.or([()=>i0.resolve(this.Ri.containsKey(t)),()=>this.persistence.getTargetCache().containsKey(e,t),()=>this.persistence.Ei(e,t)])}}class hl{constructor(e,t){this.persistence=e,this.fi=new oL(e=>su(e.path),(e,t)=>e.isEqual(t)),this.garbageCollector=function(e,t){return new uQ(e,t)}(this,t)}static Vi(e,t){return new hl(e,t)}Ti(){}Ii(e){return i0.resolve()}forEachTarget(e,t){return this.persistence.getTargetCache().forEachTarget(e,t)}dr(e){let t=this.pr(e);return this.persistence.getTargetCache().getTargetCount(e).next(e=>t.next(t=>e+t))}pr(e){let t=0;return this.mr(e,e=>{t++}).next(()=>t)}mr(e,t){return i0.forEach(this.fi,(r,n)=>this.wr(e,r,n).next(e=>e?i0.resolve():t(n)))}removeTargets(e,t,r){return this.persistence.getTargetCache().removeTargets(e,t,r)}removeOrphanedDocuments(e,t){let r=0,n=this.persistence.getRemoteDocumentCache(),i=n.newChangeBuffer();return n.ni(e,n=>this.wr(e,n,t).next(e=>{e||(r++,i.removeEntry(n,iB.min()))})).next(()=>i.apply(e)).next(()=>r)}markPotentiallyOrphaned(e,t){return this.fi.set(t,e.currentSequenceNumber),i0.resolve()}removeTarget(e,t){let r=t.withSequenceNumber(e.currentSequenceNumber);return this.persistence.getTargetCache().updateTargetData(e,r)}addReference(e,t,r){return this.fi.set(r,e.currentSequenceNumber),i0.resolve()}removeReference(e,t,r){return this.fi.set(r,e.currentSequenceNumber),i0.resolve()}updateLimboDocument(e,t){return this.fi.set(t,e.currentSequenceNumber),i0.resolve()}hi(e){let t=e.key.toString().length;return e.isFoundDocument()&&(t+=function e(t){switch(aL(t)){case 0:case 1:return 4;case 2:return 8;case 3:case 8:return 16;case 4:let r=aT(t);return r?16+e(r):16;case 5:return 2*t.stringValue.length;case 6:return aw(t.bytesValue).approximateByteSize();case 7:return t.referenceValue.length;case 9:return(t.arrayValue.values||[]).reduce((t,r)=>t+e(r),0);case 10:case 11:var n;let i;return n=t.mapValue,i=0,ai(n.fields,(t,r)=>{i+=t.length+e(r)}),i;default:throw ii(13486,{value:t})}}(e.data.value)),t}wr(e,t,r){return i0.or([()=>this.persistence.Ei(e,t),()=>this.persistence.getTargetCache().containsKey(e,t),()=>{let e=this.fi.get(t);return i0.resolve(void 0!==e&&e>r)}])}getCacheSize(e){return this.persistence.getRemoteDocumentCache().getSize(e)}}class hu{constructor(e){this.serializer=e}k(e,t,r,n){let i=new i2("createOrUpgrade",t);r<1&&n>=1&&(e.createObjectStore(sd),e.createObjectStore(sp,{keyPath:"userId"}),e.createObjectStore(sm,{keyPath:sg,autoIncrement:!0}).createIndex(sy,sw,{unique:!0}),e.createObjectStore(s_),hh(e),e.createObjectStore(sc));let s=i0.resolve();return r<3&&n>=3&&(0!==r&&(e.deleteObjectStore(sR),e.deleteObjectStore(sx),e.deleteObjectStore(sF),hh(e)),s=s.next(()=>{let e,t;return e=i.store(sF),t={highestTargetId:0,highestListenSequenceNumber:0,lastRemoteSnapshotVersion:iB.min().toTimestamp(),targetCount:0},e.put(sM,t)})),r<4&&n>=4&&(0!==r&&(s=s.next(()=>i.store(sm).H().next(t=>{e.deleteObjectStore(sm),e.createObjectStore(sm,{keyPath:sg,autoIncrement:!0}).createIndex(sy,sw,{unique:!0});let r=i.store(sm),n=t.map(e=>r.put(e));return i0.waitFor(n)}))),s=s.next(()=>{e.createObjectStore(sB,{keyPath:"clientId"})})),r<5&&n>=5&&(s=s.next(()=>this.gi(i))),r<6&&n>=6&&(s=s.next(()=>(e.createObjectStore(sA),this.pi(i)))),r<7&&n>=7&&(s=s.next(()=>this.yi(i))),r<8&&n>=8&&(s=s.next(()=>this.wi(e,i))),r<9&&n>=9&&(s=s.next(()=>{e.objectStoreNames.contains("remoteDocumentChanges")&&e.deleteObjectStore("remoteDocumentChanges")})),r<10&&n>=10&&(s=s.next(()=>this.bi(i))),r<11&&n>=11&&(s=s.next(()=>{e.createObjectStore(sq,{keyPath:"bundleId"}),e.createObjectStore(sj,{keyPath:"name"})})),r<12&&n>=12&&(s=s.next(()=>{let t;(t=e.createObjectStore(sZ,{keyPath:s0})).createIndex(s1,s2,{unique:!1}),t.createIndex(s6,s3,{unique:!1})})),r<13&&n>=13&&(s=s.next(()=>{let t;(t=e.createObjectStore(sI,{keyPath:sb})).createIndex(sE,sT),t.createIndex(sS,sC)}).next(()=>this.Si(e,i)).next(()=>e.deleteObjectStore(sc))),r<14&&n>=14&&(s=s.next(()=>this.Di(e,i))),r<15&&n>=15&&(s=s.next(()=>{e.createObjectStore(sz,{keyPath:"indexId",autoIncrement:!0}).createIndex(s$,"collectionGroup",{unique:!1}),e.createObjectStore(sK,{keyPath:sG}).createIndex(sH,sW,{unique:!1}),e.createObjectStore(sQ,{keyPath:sJ}).createIndex(sY,sX,{unique:!1})})),r<16&&n>=16&&(s=s.next(()=>{t.objectStore(sK).clear()}).next(()=>{t.objectStore(sQ).clear()})),r<17&&n>=17&&(s=s.next(()=>{e.createObjectStore(s4,{keyPath:"name"})})),r<18&&n>=18&&G()&&(s=s.next(()=>{t.objectStore(sK).clear()}).next(()=>{t.objectStore(sQ).clear()})),s}pi(e){let t=0;return e.store(sc).ee((e,r)=>{t+=uV(r)}).next(()=>{let r={byteSize:t};return e.store(sA).put(sk,r)})}gi(e){let t=e.store(sp),r=e.store(sm);return t.H().next(t=>i0.forEach(t,t=>{let n=IDBKeyRange.bound([t.userId,-1],[t.userId,t.lastAcknowledgedBatchId]);return r.H(sy,n).next(r=>i0.forEach(r,r=>{ia(r.userId===t.userId,18650,"Cannot process batch from unexpected user",{batchId:r.batchId});let n=ut(this.serializer,r);return uF(e,t.userId,n).next(()=>{})}))}))}yi(e){let t=e.store(sR),r=e.store(sc);return e.store(sF).get(sM).next(e=>{let n=[];return r.ee((r,i)=>{let s=new iC(r),a=[0,su(s)];n.push(t.get(a).next(r=>r?i0.resolve():t.put({targetId:0,path:su(s),sequenceNumber:e.highestListenSequenceNumber})))}).next(()=>i0.waitFor(n))})}wi(e,t){e.createObjectStore(sV,{keyPath:sU});let r=t.store(sV),n=new uN,i=e=>{if(n.add(e)){let t=e.lastSegment(),n=e.popLast();return r.put({collectionId:t,parent:su(n)})}};return t.store(sc).ee({Y:!0},(e,t)=>i(new iC(e).popLast())).next(()=>t.store(s_).ee({Y:!0},([e,t,r],n)=>i(sh(t).popLast())))}bi(e){let t=e.store(sx);return t.ee((e,r)=>{let n=ur(r),i=un(this.serializer,n);return t.put(i)})}Si(e,t){let r=t.store(sc),n=[];return r.ee((e,r)=>{let i=t.store(sI),s=(r.document?new ix(iC.fromString(r.document.name).popFirst(5)):r.noDocument?ix.fromSegments(r.noDocument.path):r.unknownDocument?ix.fromSegments(r.unknownDocument.path):ii(36783)).path.toArray(),a={prefixPath:s.slice(0,s.length-2),collectionGroup:s[s.length-2],documentId:s[s.length-1],readTime:r.readTime||[0,0],unknownDocument:r.unknownDocument,noDocument:r.noDocument,document:r.document,hasCommittedMutations:!!r.hasCommittedMutations};n.push(i.put(a))}).next(()=>i0.waitFor(n))}Di(e,t){let r=t.store(sm),n=new uZ(this.serializer),i=new hs(ho.Vi,this.serializer.yt);return r.H().next(e=>{let r=new Map;return e.forEach(e=>{let t=r.get(e.userId)??oz();ut(this.serializer,e).keys().forEach(e=>t=t.add(e)),r.set(e.userId,t)}),i0.forEach(r,(e,r)=>{let s=new n4(r),a=uu.wt(this.serializer,s),o=i.getIndexManager(s);return new u4(n,uU.wt(s,this.serializer,o,i.referenceDelegate),a,o).recalculateAndSaveOverlaysForDocumentKeys(new at(t,ss.ce),e).next()})})}}function hh(e){e.createObjectStore(sR,{keyPath:sP}).createIndex(sO,sL,{unique:!0}),e.createObjectStore(sx,{keyPath:"targetId"}).createIndex(sN,sD,{unique:!0}),e.createObjectStore(sF)}let hc="IndexedDbPersistence",hd="Failed to obtain exclusive access to the persistence layer. To allow shared access, multi-tab synchronization has to be enabled in all tabs. If you are using `experimentalForceOwningTab:true`, make sure that only one tab has persistence enabled at any given time.";class hf{constructor(e,t,r,n,i,s,a,o,l,u,h=18){if(this.allowTabSynchronization=e,this.persistenceKey=t,this.clientId=r,this.Ci=i,this.window=s,this.document=a,this.Fi=l,this.Mi=u,this.xi=h,this.ai=null,this.ui=!1,this.isPrimary=!1,this.networkEnabled=!0,this.Oi=null,this.inForeground=!1,this.Ni=null,this.Bi=null,this.Li=-1/0,this.ki=e=>Promise.resolve(),!hf.v())throw new il(io.UNIMPLEMENTED,"This platform is either missing IndexedDB or is known to have an incomplete implementation. Offline persistence has been disabled.");this.referenceDelegate=new uJ(this,n),this.Ki=t+"main",this.serializer=new l5(o),this.qi=new i6(this.Ki,this.xi,new hu(this.serializer)),this.ci=new uh,this.li=new uz(this.referenceDelegate,this.serializer),this.remoteDocumentCache=function(e){return new uZ(e)}(this.serializer),this.Pi=new ul,this.window&&this.window.localStorage?this.Ui=this.window.localStorage:(this.Ui=null,!1===u&&ie(hc,"LocalStorage is unavailable. As a result, persistence may not work reliably. In particular enablePersistence() could fail immediately after refreshing the page."))}start(){return this.$i().then(()=>{if(!this.isPrimary&&!this.allowTabSynchronization)throw new il(io.FAILED_PRECONDITION,hd);return this.Wi(),this.Qi(),this.Gi(),this.runTransaction("getHighestListenSequenceNumber","readonly",e=>this.li.getHighestSequenceNumber(e))}).then(e=>{this.ai=new ss(e,this.Fi)}).then(()=>{this.ui=!0}).catch(e=>(this.qi&&this.qi.close(),Promise.reject(e)))}zi(e){return this.ki=async t=>{if(this.started)return e(t)},e(this.isPrimary)}setDatabaseDeletedListener(e){this.qi.q(async t=>{null===t.newVersion&&await e()})}setNetworkEnabled(e){this.networkEnabled!==e&&(this.networkEnabled=e,this.Ci.enqueueAndForget(async()=>{this.started&&await this.$i()}))}$i(){return this.runTransaction("updateClientMetadataAndTryBecomePrimary","readwrite",e=>ar(e,sB).put({clientId:this.clientId,updateTimeMs:Date.now(),networkEnabled:this.networkEnabled,inForeground:this.inForeground}).next(()=>{if(this.isPrimary)return this.ji(e).next(e=>{e||(this.isPrimary=!1,this.Ci.enqueueRetryable(()=>this.ki(!1)))})}).next(()=>this.Hi(e)).next(t=>this.isPrimary&&!t?this.Ji(e).next(()=>!1):!!t&&this.Zi(e).next(()=>!0))).catch(e=>{if(i8(e))return n9(hc,"Failed to extend owner lease: ",e),this.isPrimary;if(!this.allowTabSynchronization)throw e;return n9(hc,"Releasing owner lease after error during lease refresh",e),!1}).then(e=>{this.isPrimary!==e&&this.Ci.enqueueRetryable(()=>this.ki(e)),this.isPrimary=e})}ji(e){return ar(e,sd).get(sf).next(e=>i0.resolve(this.Xi(e)))}Yi(e){return ar(e,sB).delete(this.clientId)}async es(){if(this.isPrimary&&!this.ts(this.Li,18e5)){this.Li=Date.now();let e=await this.runTransaction("maybeGarbageCollectMultiClientState","readwrite-primary",e=>{let t=ar(e,sB);return t.H().next(e=>{let r=this.ns(e,18e5),n=e.filter(e=>-1===r.indexOf(e));return i0.forEach(n,e=>t.delete(e.clientId)).next(()=>n)})}).catch(()=>[]);if(this.Ui)for(let t of e)this.Ui.removeItem(this.rs(t.clientId))}}Gi(){this.Bi=this.Ci.enqueueAfterDelay("client_metadata_refresh",4e3,()=>this.$i().then(()=>this.es()).then(()=>this.Gi()))}Xi(e){return!!e&&e.ownerId===this.clientId}Hi(e){return this.Mi?i0.resolve(!0):ar(e,sd).get(sf).next(t=>{if(null!==t&&this.ts(t.leaseTimestampMs,5e3)&&!this.ss(t.ownerId)){if(this.Xi(t)&&this.networkEnabled)return!0;if(!this.Xi(t)){if(!t.allowTabSynchronization)throw new il(io.FAILED_PRECONDITION,hd);return!1}}return!(!this.networkEnabled||!this.inForeground)||ar(e,sB).H().next(e=>void 0===this.ns(e,5e3).find(e=>{if(this.clientId!==e.clientId){let t=!this.networkEnabled&&e.networkEnabled,r=!this.inForeground&&e.inForeground,n=this.networkEnabled===e.networkEnabled;if(t||r&&n)return!0}return!1}))}).next(e=>(this.isPrimary!==e&&n9(hc,`Client ${e?"is":"is not"} eligible for a primary lease.`),e))}async shutdown(){this.ui=!1,this._s(),this.Bi&&(this.Bi.cancel(),this.Bi=null),this.us(),this.cs(),await this.qi.runTransaction("shutdown","readwrite",[sd,sB],e=>{let t=new at(e,ss.ce);return this.Ji(t).next(()=>this.Yi(t))}),this.qi.close(),this.ls()}ns(e,t){return e.filter(e=>this.ts(e.updateTimeMs,t)&&!this.ss(e.clientId))}hs(){return this.runTransaction("getActiveClients","readonly",e=>ar(e,sB).H().next(e=>this.ns(e,18e5).map(e=>e.clientId)))}get started(){return this.ui}getGlobalsCache(){return this.ci}getMutationQueue(e,t){return uU.wt(e,this.serializer,t,this.referenceDelegate)}getTargetCache(){return this.li}getRemoteDocumentCache(){return this.remoteDocumentCache}getIndexManager(e){return new uP(e,this.serializer.yt.databaseId)}getDocumentOverlayCache(e){return uu.wt(this.serializer,e)}getBundleCache(){return this.Pi}runTransaction(e,t,r){var n;let i;n9(hc,"Starting transaction:",e);let s=18===(n=this.xi)||17===n?ae:16===n||15===n?s9:14===n||13===n?s7:12===n?s8:11===n?s5:void ii(60245);return this.qi.runTransaction(e,"readonly"===t?"readonly":"readwrite",s,n=>(i=new at(n,this.ai?this.ai.next():ss.ce),"readwrite-primary"===t?this.ji(i).next(e=>!!e||this.Hi(i)).next(t=>{if(!t)throw ie(`Failed to obtain primary lease for action '${e}'.`),this.isPrimary=!1,this.Ci.enqueueRetryable(()=>this.ki(!1)),new il(io.FAILED_PRECONDITION,iY);return r(i)}).next(e=>this.Zi(i).next(()=>e)):this.Ps(i).next(()=>r(i)))).then(e=>(i.raiseOnCommittedEvent(),e))}Ps(e){return ar(e,sd).get(sf).next(e=>{if(null!==e&&this.ts(e.leaseTimestampMs,5e3)&&!this.ss(e.ownerId)&&!this.Xi(e)&&!(this.Mi||this.allowTabSynchronization&&e.allowTabSynchronization))throw new il(io.FAILED_PRECONDITION,hd)})}Zi(e){let t={ownerId:this.clientId,allowTabSynchronization:this.allowTabSynchronization,leaseTimestampMs:Date.now()};return ar(e,sd).put(sf,t)}static v(){return i6.v()}Ji(e){let t=ar(e,sd);return t.get(sf).next(e=>this.Xi(e)?(n9(hc,"Releasing primary lease."),t.delete(sf)):i0.resolve())}ts(e,t){let r=Date.now();return!(e<r-t)&&(!(e>r)||(ie(`Detected an update time that is in the future: ${e} > ${r}`),!1))}Wi(){null!==this.document&&"function"==typeof this.document.addEventListener&&(this.Ni=()=>{this.Ci.enqueueAndForget(()=>(this.inForeground="visible"===this.document.visibilityState,this.$i()))},this.document.addEventListener("visibilitychange",this.Ni),this.inForeground="visible"===this.document.visibilityState)}us(){this.Ni&&(this.document.removeEventListener("visibilitychange",this.Ni),this.Ni=null)}Qi(){"function"==typeof this.window?.addEventListener&&(this.Oi=()=>{this._s();let e=/(?:Version|Mobile)\/1[456]/;K()&&(navigator.appVersion.match(e)||navigator.userAgent.match(e))&&this.Ci.enterRestrictedMode(!0),this.Ci.enqueueAndForget(()=>this.shutdown())},this.window.addEventListener("pagehide",this.Oi))}cs(){this.Oi&&(this.window.removeEventListener("pagehide",this.Oi),this.Oi=null)}ss(e){try{let t=null!==this.Ui?.getItem(this.rs(e));return n9(hc,`Client '${e}' ${t?"is":"is not"} zombied in LocalStorage`),t}catch(e){return ie(hc,"Failed to get zombied client id.",e),!1}}_s(){if(this.Ui)try{this.Ui.setItem(this.rs(this.clientId),String(Date.now()))}catch(e){ie("Failed to set zombie client id.",e)}}ls(){if(this.Ui)try{this.Ui.removeItem(this.rs(this.clientId))}catch(e){}}rs(e){return`firestore_zombie_${this.persistenceKey}_${e}`}}function hp(e,t){let r=e.projectId;return e.isDefaultDatabase||(r+="."+e.database),"firestore/"+t+"/"+r+"/"}class hm{constructor(e,t,r,n){this.targetId=e,this.fromCache=t,this.Ts=r,this.Is=n}static Es(e,t){let r=oz(),n=oz();for(let e of t.docChanges)switch(e.type){case 0:r=r.add(e.doc.key);break;case 1:n=n.add(e.doc.key)}return new hm(e,t.fromCache,r,n)}}class hg{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(e){this._documentReadCount+=e}}class hy{constructor(){this.Rs=!1,this.As=!1,this.Vs=100,this.ds=K()?8:i3(j())>0?6:4}initialize(e,t){this.fs=e,this.indexManager=t,this.Rs=!0}getDocumentsMatchingQuery(e,t,r,n){let i={result:null};return this.gs(e,t).next(e=>{i.result=e}).next(()=>{if(!i.result)return this.ps(e,t,n,r).next(e=>{i.result=e})}).next(()=>{if(i.result)return;let r=new hg;return this.ys(e,t,r).next(n=>{if(i.result=n,this.As)return this.ws(e,t,r,n.size)})}).next(()=>i.result)}ws(e,t,r,n){return r.documentReadCount<this.Vs?(n7()<=a.DEBUG&&n9("QueryEngine","SDK will not create cache indexes for query:",oD(t),"since it only creates cache indexes for collection contains","more than or equal to",this.Vs,"documents"),i0.resolve()):(n7()<=a.DEBUG&&n9("QueryEngine","Query:",oD(t),"scans",r.documentReadCount,"local documents and returns",n,"documents as results."),r.documentReadCount>this.ds*n?(n7()<=a.DEBUG&&n9("QueryEngine","The SDK decides to create cache indexes for query:",oD(t),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(e,oS(t))):i0.resolve())}gs(e,t){if(ob(t))return i0.resolve(null);let r=oS(t);return this.indexManager.getIndexType(e,r).next(n=>0===n?null:(null!==t.limit&&1===n&&(r=oS(t=ok(t,null,"F"))),this.indexManager.getDocumentsMatchingTarget(e,r).next(n=>{let i=oz(...n);return this.fs.getDocuments(e,i).next(n=>this.indexManager.getMinOffset(e,r).next(r=>{let s=this.bs(t,n);return this.Ss(t,s,i,r.readTime)?this.gs(e,ok(t,null,"F")):this.Ds(e,s,t,r)}))})))}ps(e,t,r,n){return ob(t)||n.isEqual(iB.min())?i0.resolve(null):this.fs.getDocuments(e,r).next(i=>{let s=this.bs(t,i);return this.Ss(t,s,r,n)?i0.resolve(null):(n7()<=a.DEBUG&&n9("QueryEngine","Re-using previous result from %s to execute query: %s",n.toString(),oD(t)),this.Ds(e,s,t,iH(n,-1)).next(e=>e))})}bs(e,t){let r=new au(oO(e));return t.forEach((t,n)=>{oR(e,n)&&(r=r.add(n))}),r}Ss(e,t,r,n){if(null===e.limit)return!1;if(r.size!==t.size)return!0;let i="F"===e.limitType?t.last():t.first();return!!i&&(i.hasPendingWrites||i.version.compareTo(n)>0)}ys(e,t,r){return n7()<=a.DEBUG&&n9("QueryEngine","Using full collection scan to execute query:",oD(t)),this.fs.getDocumentsMatchingQuery(e,t,iQ.min(),r)}Ds(e,t,r,n){return this.fs.getDocumentsMatchingQuery(e,r,n).next(e=>(t.forEach(t=>{e=e.insert(t.key,t)}),e))}}let hw="LocalStore";class hv{constructor(e,t,r,n){this.persistence=e,this.Cs=t,this.serializer=n,this.vs=new aa(i_),this.Fs=new oL(e=>op(e),om),this.Ms=new Map,this.xs=e.getRemoteDocumentCache(),this.li=e.getTargetCache(),this.Pi=e.getBundleCache(),this.Os(r)}Os(e){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(e),this.indexManager=this.persistence.getIndexManager(e),this.mutationQueue=this.persistence.getMutationQueue(e,this.indexManager),this.localDocuments=new u4(this.xs,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.xs.setIndexManager(this.indexManager),this.Cs.initialize(this.localDocuments,this.indexManager)}collectGarbage(e){return this.persistence.runTransaction("Collect garbage","readwrite-primary",t=>e.collect(t,this.vs))}}async function h_(e,t){return await e.persistence.runTransaction("Handle user change","readonly",r=>{let n;return e.mutationQueue.getAllMutationBatches(r).next(i=>(n=i,e.Os(t),e.mutationQueue.getAllMutationBatches(r))).next(t=>{let i=[],s=[],a=oz();for(let e of n)for(let t of(i.push(e.batchId),e.mutations))a=a.add(t.key);for(let e of t)for(let t of(s.push(e.batchId),e.mutations))a=a.add(t.key);return e.localDocuments.getDocuments(r,a).next(e=>({Ns:e,removedBatchIds:i,addedBatchIds:s}))})})}function hI(e){return e.persistence.runTransaction("Get last remote snapshot version","readonly",t=>e.li.getLastRemoteSnapshotVersion(t))}function hb(e,t,r){let n=oz(),i=oz();return r.forEach(e=>n=n.add(e)),t.getEntries(e,n).next(e=>{let n=oM;return r.forEach((r,s)=>{let a=e.get(r);s.isFoundDocument()!==a.isFoundDocument()&&(i=i.add(r)),s.isNoDocument()&&s.version.isEqual(iB.min())?(t.removeEntry(r,s.readTime),n=n.insert(r,s)):!a.isValidDocument()||s.version.compareTo(a.version)>0||0===s.version.compareTo(a.version)&&a.hasPendingWrites?(t.addEntry(s),n=n.insert(r,s)):n9(hw,"Ignoring outdated watch update for ",r,". Current version:",a.version," Watch version:",s.version)}),{Bs:n,Ls:i}})}function hE(e,t){return e.persistence.runTransaction("Allocate target","readwrite",r=>{let n;return e.li.getTargetData(r,t).next(i=>i?(n=i,i0.resolve(n)):e.li.allocateTargetId(r).next(i=>(n=new l4(t,i,"TargetPurposeListen",r.currentSequenceNumber),e.li.addTargetData(r,n).next(()=>n))))}).then(r=>{let n=e.vs.get(r.targetId);return(null===n||r.snapshotVersion.compareTo(n.snapshotVersion)>0)&&(e.vs=e.vs.insert(r.targetId,r),e.Fs.set(t,r.targetId)),r})}async function hT(e,t,r){let n=e.vs.get(t);try{r||await e.persistence.runTransaction("Release target",r?"readwrite":"readwrite-primary",t=>e.persistence.referenceDelegate.removeTarget(t,n))}catch(e){if(!i8(e))throw e;n9(hw,`Failed to update sequence numbers for target ${t}: ${e}`)}e.vs=e.vs.remove(t),e.Fs.delete(n.target)}function hS(e,t,r){let n=iB.min(),i=oz();return e.persistence.runTransaction("Execute query","readwrite",s=>{var a;let o;return(a=oS(t),void 0!==(o=e.Fs.get(a))?i0.resolve(e.vs.get(o)):e.li.getTargetData(s,a)).next(t=>{if(t)return n=t.lastLimboFreeSnapshotVersion,e.li.getMatchingKeysForTargetId(s,t.targetId).next(e=>{i=e})}).next(()=>e.Cs.getDocumentsMatchingQuery(s,t,r?n:iB.min(),r?i:oz())).next(r=>(hk(e,oP(t),r),{documents:r,ks:i}))})}function hC(e,t){let r=e.li,n=e.vs.get(t);return n?Promise.resolve(n.target):e.persistence.runTransaction("Get target data","readonly",e=>r.At(e,t).next(e=>e?e.target:null))}function hA(e,t){let r=e.Ms.get(t)||iB.min();return e.persistence.runTransaction("Get new document changes","readonly",n=>e.xs.getAllFromCollectionGroup(n,t,iH(r,-1),Number.MAX_SAFE_INTEGER)).then(r=>(hk(e,t,r),r))}function hk(e,t,r){let n=e.Ms.get(t)||iB.min();r.forEach((e,t)=>{t.readTime.compareTo(n)>0&&(n=t.readTime)}),e.Ms.set(t,n)}async function hx(e,t,r,n){let i=oz(),s=oM;for(let e of r){let r=t.Ks(e.metadata.name);e.document&&(i=i.add(r));let n=t.qs(e);n.setReadTime(t.Us(e.metadata.readTime)),s=s.insert(r,n)}let a=e.xs.newChangeBuffer({trackRemovals:!0}),o=await hE(e,oS(oI(iC.fromString(`__bundle__/docs/${n}`))));return e.persistence.runTransaction("Apply bundle documents","readwrite",t=>hb(t,a,s).next(e=>(a.apply(t),e)).next(r=>e.li.removeMatchingKeysForTargetId(t,o.targetId).next(()=>e.li.addMatchingKeys(t,i,o.targetId)).next(()=>e.localDocuments.getLocalViewOfDocuments(t,r.Bs,r.Ls)).next(()=>r.Bs)))}async function hN(e,t,r=oz()){let n=await hE(e,oS(ui(t.bundledQuery)));return e.persistence.runTransaction("Save named query","readwrite",i=>{let s=lV(t.readTime);if(n.snapshotVersion.compareTo(s)>=0)return e.Pi.saveNamedQuery(i,t);let a=n.withResumeToken(ap.EMPTY_BYTE_STRING,s);return e.vs=e.vs.insert(a.targetId,a),e.li.updateTargetData(i,a).next(()=>e.li.removeMatchingKeysForTargetId(i,n.targetId)).next(()=>e.li.addMatchingKeys(i,r,n.targetId)).next(()=>e.Pi.saveNamedQuery(i,t))})}let hD="firestore_clients";function hR(e,t){return`${hD}_${e}_${t}`}let hP="firestore_mutations";function hO(e,t,r){let n=`${hP}_${e}_${r}`;return t.isAuthenticated()&&(n+=`_${t.uid}`),n}let hL="firestore_targets";function hM(e,t){return`${hL}_${e}_${t}`}let hF="SharedClientState";class hV{constructor(e,t,r,n){this.user=e,this.batchId=t,this.state=r,this.error=n}static $s(e,t,r){let n=JSON.parse(r),i,s="object"==typeof n&&-1!==["pending","acknowledged","rejected"].indexOf(n.state)&&(void 0===n.error||"object"==typeof n.error);return s&&n.error&&(s="string"==typeof n.error.message&&"string"==typeof n.error.code)&&(i=new il(n.error.code,n.error.message)),s?new hV(e,t,n.state,i):(ie(hF,`Failed to parse mutation state for ID '${t}': ${r}`),null)}Ws(){let e={state:this.state,updateTimeMs:Date.now()};return this.error&&(e.error={code:this.error.code,message:this.error.message}),JSON.stringify(e)}}class hU{constructor(e,t,r){this.targetId=e,this.state=t,this.error=r}static $s(e,t){let r=JSON.parse(t),n,i="object"==typeof r&&-1!==["not-current","current","rejected"].indexOf(r.state)&&(void 0===r.error||"object"==typeof r.error);return i&&r.error&&(i="string"==typeof r.error.message&&"string"==typeof r.error.code)&&(n=new il(r.error.code,r.error.message)),i?new hU(e,r.state,n):(ie(hF,`Failed to parse target state for ID '${e}': ${t}`),null)}Ws(){let e={state:this.state,updateTimeMs:Date.now()};return this.error&&(e.error={code:this.error.code,message:this.error.message}),JSON.stringify(e)}}class hB{constructor(e,t){this.clientId=e,this.activeTargetIds=t}static $s(e,t){let r=JSON.parse(t),n="object"==typeof r&&r.activeTargetIds instanceof Array,i=o$;for(let e=0;n&&e<r.activeTargetIds.length;++e)n=sl(r.activeTargetIds[e]),i=i.add(r.activeTargetIds[e]);return n?new hB(e,i):(ie(hF,`Failed to parse client data for instance '${e}': ${t}`),null)}}class hq{constructor(e,t){this.clientId=e,this.onlineState=t}static $s(e){let t=JSON.parse(e);return"object"==typeof t&&-1!==["Unknown","Online","Offline"].indexOf(t.onlineState)&&"string"==typeof t.clientId?new hq(t.clientId,t.onlineState):(ie(hF,`Failed to parse online state: ${e}`),null)}}class hj{constructor(){this.activeTargetIds=o$}Qs(e){this.activeTargetIds=this.activeTargetIds.add(e)}Gs(e){this.activeTargetIds=this.activeTargetIds.delete(e)}Ws(){return JSON.stringify({activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()})}}class hz{constructor(e,t,r,n,i){this.window=e,this.Ci=t,this.persistenceKey=r,this.zs=n,this.syncEngine=null,this.onlineStateHandler=null,this.sequenceNumberHandler=null,this.js=this.Hs.bind(this),this.Js=new aa(i_),this.started=!1,this.Zs=[];const s=r.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");this.storage=this.window.localStorage,this.currentUser=i,this.Xs=hR(this.persistenceKey,this.zs),this.Ys=function(e){return`firestore_sequence_number_${e}`}(this.persistenceKey),this.Js=this.Js.insert(this.zs,new hj),this.eo=RegExp(`^${hD}_${s}_([^_]*)$`),this.no=RegExp(`^${hP}_${s}_(\\d+)(?:_(.*))?$`),this.ro=RegExp(`^${hL}_${s}_(\\d+)$`),this.io=function(e){return`firestore_online_state_${e}`}(this.persistenceKey),this.so=function(e){return`firestore_bundle_loaded_v2_${e}`}(this.persistenceKey),this.window.addEventListener("storage",this.js)}static v(e){return!(!e||!e.localStorage)}async start(){for(let e of(await this.syncEngine.hs())){if(e===this.zs)continue;let t=this.getItem(hR(this.persistenceKey,e));if(t){let r=hB.$s(e,t);r&&(this.Js=this.Js.insert(r.clientId,r))}}this.oo();let e=this.storage.getItem(this.io);if(e){let t=this._o(e);t&&this.ao(t)}for(let e of this.Zs)this.Hs(e);this.Zs=[],this.window.addEventListener("pagehide",()=>this.shutdown()),this.started=!0}writeSequenceNumber(e){this.setItem(this.Ys,JSON.stringify(e))}getAllActiveQueryTargets(){return this.uo(this.Js)}isActiveQueryTarget(e){let t=!1;return this.Js.forEach((r,n)=>{n.activeTargetIds.has(e)&&(t=!0)}),t}addPendingMutation(e){this.co(e,"pending")}updateMutationState(e,t,r){this.co(e,t,r),this.lo(e)}addLocalQueryTarget(e,t=!0){let r="not-current";if(this.isActiveQueryTarget(e)){let t=this.storage.getItem(hM(this.persistenceKey,e));if(t){let n=hU.$s(e,t);n&&(r=n.state)}}return t&&this.ho.Qs(e),this.oo(),r}removeLocalQueryTarget(e){this.ho.Gs(e),this.oo()}isLocalQueryTarget(e){return this.ho.activeTargetIds.has(e)}clearQueryState(e){this.removeItem(hM(this.persistenceKey,e))}updateQueryState(e,t,r){this.Po(e,t,r)}handleUserChange(e,t,r){t.forEach(e=>{this.lo(e)}),this.currentUser=e,r.forEach(e=>{this.addPendingMutation(e)})}setOnlineState(e){this.To(e)}notifyBundleLoaded(e){this.Io(e)}shutdown(){this.started&&(this.window.removeEventListener("storage",this.js),this.removeItem(this.Xs),this.started=!1)}getItem(e){let t=this.storage.getItem(e);return n9(hF,"READ",e,t),t}setItem(e,t){n9(hF,"SET",e,t),this.storage.setItem(e,t)}removeItem(e){n9(hF,"REMOVE",e),this.storage.removeItem(e)}Hs(e){if(e.storageArea===this.storage){if(n9(hF,"EVENT",e.key,e.newValue),e.key===this.Xs)return void ie("Received WebStorage notification for local change. Another client might have garbage-collected our state");this.Ci.enqueueRetryable(async()=>{if(this.started){if(null!==e.key){if(this.eo.test(e.key)){if(null==e.newValue){let t=this.Eo(e.key);return this.Ro(t,null)}{let t=this.Ao(e.key,e.newValue);if(t)return this.Ro(t.clientId,t)}}else if(this.no.test(e.key)){if(null!==e.newValue){let t=this.Vo(e.key,e.newValue);if(t)return this.mo(t)}}else if(this.ro.test(e.key)){if(null!==e.newValue){let t=this.fo(e.key,e.newValue);if(t)return this.po(t)}}else if(e.key===this.io){if(null!==e.newValue){let t=this._o(e.newValue);if(t)return this.ao(t)}}else if(e.key===this.Ys){let t=function(e){let t=ss.ce;if(null!=e)try{let r=JSON.parse(e);ia("number"==typeof r,30636,{yo:e}),t=r}catch(e){ie(hF,"Failed to read sequence number from WebStorage",e)}return t}(e.newValue);t!==ss.ce&&this.sequenceNumberHandler(t)}else if(e.key===this.so){let t=this.wo(e.newValue);await Promise.all(t.map(e=>this.syncEngine.bo(e)))}}}else this.Zs.push(e)})}}get ho(){return this.Js.get(this.zs)}oo(){this.setItem(this.Xs,this.ho.Ws())}co(e,t,r){let n=new hV(this.currentUser,e,t,r),i=hO(this.persistenceKey,this.currentUser,e);this.setItem(i,n.Ws())}lo(e){let t=hO(this.persistenceKey,this.currentUser,e);this.removeItem(t)}To(e){let t={clientId:this.zs,onlineState:e};this.storage.setItem(this.io,JSON.stringify(t))}Po(e,t,r){let n=hM(this.persistenceKey,e),i=new hU(e,t,r);this.setItem(n,i.Ws())}Io(e){let t=JSON.stringify(Array.from(e));this.setItem(this.so,t)}Eo(e){let t=this.eo.exec(e);return t?t[1]:null}Ao(e,t){let r=this.Eo(e);return hB.$s(r,t)}Vo(e,t){let r=this.no.exec(e),n=Number(r[1]),i=void 0!==r[2]?r[2]:null;return hV.$s(new n4(i),n,t)}fo(e,t){let r=Number(this.ro.exec(e)[1]);return hU.$s(r,t)}_o(e){return hq.$s(e)}wo(e){return JSON.parse(e)}async mo(e){if(e.user.uid===this.currentUser.uid)return this.syncEngine.So(e.batchId,e.state,e.error);n9(hF,`Ignoring mutation for non-active user ${e.user.uid}`)}po(e){return this.syncEngine.Do(e.targetId,e.state,e.error)}Ro(e,t){let r=t?this.Js.insert(e,t):this.Js.remove(e),n=this.uo(this.Js),i=this.uo(r),s=[],a=[];return i.forEach(e=>{n.has(e)||s.push(e)}),n.forEach(e=>{i.has(e)||a.push(e)}),this.syncEngine.Co(s,a).then(()=>{this.Js=r})}ao(e){this.Js.get(e.clientId)&&this.onlineStateHandler(e.onlineState)}uo(e){let t=o$;return e.forEach((e,r)=>{t=t.unionWith(r.activeTargetIds)}),t}}class h${constructor(){this.vo=new hj,this.Fo={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(e){}updateMutationState(e,t,r){}addLocalQueryTarget(e,t=!0){return t&&this.vo.Qs(e),this.Fo[e]||"not-current"}updateQueryState(e,t,r){this.Fo[e]=t}removeLocalQueryTarget(e){this.vo.Gs(e)}isLocalQueryTarget(e){return this.vo.activeTargetIds.has(e)}clearQueryState(e){delete this.Fo[e]}getAllActiveQueryTargets(){return this.vo.activeTargetIds}isActiveQueryTarget(e){return this.vo.activeTargetIds.has(e)}start(){return this.vo=new hj,Promise.resolve()}handleUserChange(e,t,r){}setOnlineState(e){}shutdown(){}writeSequenceNumber(e){}notifyBundleLoaded(e){}}class hK{Mo(e){}shutdown(){}}let hG="ConnectivityMonitor";class hH{constructor(){this.xo=()=>this.Oo(),this.No=()=>this.Bo(),this.Lo=[],this.ko()}Mo(e){this.Lo.push(e)}shutdown(){window.removeEventListener("online",this.xo),window.removeEventListener("offline",this.No)}ko(){window.addEventListener("online",this.xo),window.addEventListener("offline",this.No)}Oo(){for(let e of(n9(hG,"Network connectivity changed: AVAILABLE"),this.Lo))e(0)}Bo(){for(let e of(n9(hG,"Network connectivity changed: UNAVAILABLE"),this.Lo))e(1)}static v(){return"u">typeof window&&void 0!==window.addEventListener&&void 0!==window.removeEventListener}}let hW=null;function hQ(){return null===hW?hW=0x10000000+Math.round(0x80000000*Math.random()):hW++,"0x"+hW.toString(16)}let hJ="RestConnection",hY={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery",ExecutePipeline:"executePipeline"};class hX{get Ko(){return!1}constructor(e){this.databaseInfo=e,this.databaseId=e.databaseId;const t=e.ssl?"https":"http",r=encodeURIComponent(this.databaseId.projectId),n=encodeURIComponent(this.databaseId.database);this.qo=t+"://"+e.host,this.Uo=`projects/${r}/databases/${n}`,this.$o=this.databaseId.database===aA?`project_id=${r}`:`project_id=${r}&database_id=${n}`}Wo(e,t,r,n,i){let s=hQ(),a=this.Qo(e,t.toUriEncodedString());n9(hJ,`Sending RPC '${e}' ${s}:`,a,r);let o={"google-cloud-resource-prefix":this.Uo,"x-goog-request-params":this.$o};this.Go(o,n,i);let{host:l}=new URL(a),u=F(l);return this.zo(e,a,o,r,u).then(t=>(n9(hJ,`Received RPC '${e}' ${s}: `,t),t),t=>{throw it(hJ,`RPC '${e}' ${s} failed with error: `,t,"url: ",a,"request:",r),t})}jo(e,t,r,n,i,s){return this.Wo(e,t,r,n,i)}Go(e,t,r){e["X-Goog-Api-Client"]="gl-js/ fire/"+n5,e["Content-Type"]="text/plain",this.databaseInfo.appId&&(e["X-Firebase-GMPID"]=this.databaseInfo.appId),t&&t.headers.forEach((t,r)=>e[r]=t),r&&r.headers.forEach((t,r)=>e[r]=t)}Qo(e,t){let r=hY[e],n=`${this.qo}/v1/${t}:${r}`;return this.databaseInfo.apiKey&&(n=`${n}?key=${encodeURIComponent(this.databaseInfo.apiKey)}`),n}terminate(){}}class hZ{constructor(e){this.Ho=e.Ho,this.Jo=e.Jo}Zo(e){this.Xo=e}Yo(e){this.e_=e}t_(e){this.n_=e}onMessage(e){this.r_=e}close(){this.Jo()}send(e){this.Ho(e)}i_(){this.Xo()}s_(){this.e_()}o_(e){this.n_(e)}__(e){this.r_(e)}}let h0="WebChannelConnection",h1=(e,t,r)=>{e.listen(t,e=>{try{r(e)}catch(e){setTimeout(()=>{throw e},0)}})};class h2 extends hX{constructor(e){super(e),this.a_=[],this.forceLongPolling=e.forceLongPolling,this.autoDetectLongPolling=e.autoDetectLongPolling,this.useFetchStreams=e.useFetchStreams,this.longPollingOptions=e.longPollingOptions}static u_(){h2.c_||(h1(m(),p.STAT_EVENT,e=>{e.stat===f.PROXY?n9(h0,"STAT_EVENT: detected buffering proxy"):e.stat===f.NOPROXY&&n9(h0,"STAT_EVENT: detected no buffering proxy")}),h2.c_=!0)}zo(e,t,r,n,i){let s=hQ();return new Promise((i,a)=>{let o=new u;o.setWithCredentials(!0),o.listenOnce(c.COMPLETE,()=>{try{switch(o.getLastErrorCode()){case d.NO_ERROR:let t=o.getResponseJson();n9(h0,`XHR for RPC '${e}' ${s} received:`,JSON.stringify(t)),i(t);break;case d.TIMEOUT:n9(h0,`RPC '${e}' ${s} timed out`),a(new il(io.DEADLINE_EXCEEDED,"Request time out"));break;case d.HTTP_ERROR:let r=o.getStatus();if(n9(h0,`RPC '${e}' ${s} failed with status:`,r,"response text:",o.getResponseText()),r>0){let e=o.getResponseJson();Array.isArray(e)&&(e=e[0]);let t=e?.error;if(t&&t.status&&t.message){let e,r=(e=t.status.toLowerCase().replace(/_/g,"-"),Object.values(io).indexOf(e)>=0?e:io.UNKNOWN);a(new il(r,t.message))}else a(new il(io.UNKNOWN,"Server responded with status "+o.getStatus()))}else a(new il(io.UNAVAILABLE,"Connection failed."));break;default:ii(9055,{l_:e,streamId:s,h_:o.getLastErrorCode(),P_:o.getLastError()})}}finally{n9(h0,`RPC '${e}' ${s} completed.`)}});let l=JSON.stringify(n);n9(h0,`RPC '${e}' ${s} sending request:`,n),o.send(t,"POST",l,r,15)})}T_(e,t,r){let n=hQ(),i=[this.qo,"/","google.firestore.v1.Firestore","/",e,"/channel"],s=this.createWebChannelTransport(),a={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},o=this.longPollingOptions.timeoutSeconds;void 0!==o&&(a.longPollingTimeout=Math.round(1e3*o)),this.useFetchStreams&&(a.useFetchStreams=!0),this.Go(a.initMessageHeaders,t,r),a.encodeInitMessageHeaders=!0;let l=i.join("");n9(h0,`Creating RPC '${e}' stream ${n}: ${l}`,a);let u=s.createWebChannel(l,a);this.I_(u);let c=!1,d=!1,f=new hZ({Ho:t=>{d?n9(h0,`Not sending because RPC '${e}' stream ${n} is closed:`,t):(c||(n9(h0,`Opening RPC '${e}' stream ${n} transport.`),u.open(),c=!0),n9(h0,`RPC '${e}' stream ${n} sending:`,t),u.send(t))},Jo:()=>u.close()});return h1(u,h.EventType.OPEN,()=>{d||(n9(h0,`RPC '${e}' stream ${n} transport opened.`),f.i_())}),h1(u,h.EventType.CLOSE,()=>{d||(d=!0,n9(h0,`RPC '${e}' stream ${n} transport closed`),f.o_(),this.E_(u))}),h1(u,h.EventType.ERROR,t=>{d||(d=!0,it(h0,`RPC '${e}' stream ${n} transport errored. Name:`,t.name,"Message:",t.message),f.o_(new il(io.UNAVAILABLE,"The operation could not be completed")))}),h1(u,h.EventType.MESSAGE,t=>{if(!d){let r=t.data[0];ia(!!r,16349);let i=r?.error||r[0]?.error;if(i){n9(h0,`RPC '${e}' stream ${n} received error:`,i);let t=i.status,r=function(e){let t=y[e];if(void 0!==t)return lp(t)}(t),s=i.message;"NOT_FOUND"===t&&s.includes("database")&&s.includes("does not exist")&&s.includes(this.databaseId.database)&&it(`Database '${this.databaseId.database}' not found. Please check your project configuration.`),void 0===r&&(r=io.INTERNAL,s="Unknown error status: "+t+" with message "+i.message),d=!0,f.o_(new il(r,s)),u.close()}else n9(h0,`RPC '${e}' stream ${n} received:`,r),f.__(r)}}),h2.u_(),setTimeout(()=>{f.s_()},0),f}terminate(){this.a_.forEach(e=>e.close()),this.a_=[]}I_(e){this.a_.push(e)}E_(e){this.a_=this.a_.filter(t=>t===e)}Go(e,t,r){super.Go(e,t,r),this.databaseInfo.apiKey&&(e["x-goog-api-key"]=this.databaseInfo.apiKey)}createWebChannelTransport(){return g()}}function h6(){return"u">typeof window?window:null}function h3(){return"u">typeof document?document:null}function h4(e){return new lO(e,!0)}h2.c_=!1;class h5{constructor(e,t,r=1e3,n=1.5,i=6e4){this.Ci=e,this.timerId=t,this.R_=r,this.A_=n,this.V_=i,this.d_=0,this.m_=null,this.f_=Date.now(),this.reset()}reset(){this.d_=0}g_(){this.d_=this.V_}p_(e){this.cancel();let t=Math.floor(this.d_+this.y_()),r=Math.max(0,Date.now()-this.f_),n=Math.max(0,t-r);n>0&&n9("ExponentialBackoff",`Backing off for ${n} ms (base delay: ${this.d_} ms, delay with jitter: ${t} ms, last attempt: ${r} ms ago)`),this.m_=this.Ci.enqueueAfterDelay(this.timerId,n,()=>(this.f_=Date.now(),e())),this.d_*=this.A_,this.d_<this.R_&&(this.d_=this.R_),this.d_>this.V_&&(this.d_=this.V_)}w_(){null!==this.m_&&(this.m_.skipDelay(),this.m_=null)}cancel(){null!==this.m_&&(this.m_.cancel(),this.m_=null)}y_(){return(Math.random()-.5)*this.d_}}let h8="PersistentStream";class h7{constructor(e,t,r,n,i,s,a,o){this.Ci=e,this.b_=r,this.S_=n,this.connection=i,this.authCredentialsProvider=s,this.appCheckCredentialsProvider=a,this.listener=o,this.state=0,this.D_=0,this.C_=null,this.v_=null,this.stream=null,this.F_=0,this.M_=new h5(e,t)}x_(){return 1===this.state||5===this.state||this.O_()}O_(){return 2===this.state||3===this.state}start(){this.F_=0,4!==this.state?this.auth():this.N_()}async stop(){this.x_()&&await this.close(0)}B_(){this.state=0,this.M_.reset()}L_(){this.O_()&&null===this.C_&&(this.C_=this.Ci.enqueueAfterDelay(this.b_,6e4,()=>this.k_()))}K_(e){this.q_(),this.stream.send(e)}async k_(){if(this.O_())return this.close(0)}q_(){this.C_&&(this.C_.cancel(),this.C_=null)}U_(){this.v_&&(this.v_.cancel(),this.v_=null)}async close(e,t){this.q_(),this.U_(),this.M_.cancel(),this.D_++,4!==e?this.M_.reset():t&&t.code===io.RESOURCE_EXHAUSTED?(ie(t.toString()),ie("Using maximum backoff delay to prevent overloading the backend."),this.M_.g_()):t&&t.code===io.UNAUTHENTICATED&&3!==this.state&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),null!==this.stream&&(this.W_(),this.stream.close(),this.stream=null),this.state=e,await this.listener.t_(t)}W_(){}auth(){this.state=1;let e=this.Q_(this.D_),t=this.D_;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then(([e,r])=>{this.D_===t&&this.G_(e,r)},t=>{e(()=>{let e=new il(io.UNKNOWN,"Fetching auth token failed: "+t.message);return this.z_(e)})})}G_(e,t){let r=this.Q_(this.D_);this.stream=this.j_(e,t),this.stream.Zo(()=>{r(()=>this.listener.Zo())}),this.stream.Yo(()=>{r(()=>(this.state=2,this.v_=this.Ci.enqueueAfterDelay(this.S_,1e4,()=>(this.O_()&&(this.state=3),Promise.resolve())),this.listener.Yo()))}),this.stream.t_(e=>{r(()=>this.z_(e))}),this.stream.onMessage(e=>{r(()=>1==++this.F_?this.H_(e):this.onNext(e))})}N_(){this.state=5,this.M_.p_(async()=>{this.state=0,this.start()})}z_(e){return n9(h8,`close with error: ${e}`),this.stream=null,this.close(4,e)}Q_(e){return t=>{this.Ci.enqueueAndForget(()=>this.D_===e?t():(n9(h8,"stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve()))}}}class h9 extends h7{constructor(e,t,r,n,i,s){super(e,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",t,r,n,s),this.serializer=i}j_(e,t){return this.connection.T_("Listen",e,t)}H_(e){return this.onNext(e)}onNext(e){this.M_.reset();let t=function(e,t){let r;if("targetChange"in t){var n,i;t.targetChange;let s="NO_CHANGE"===(n=t.targetChange.targetChangeType||"NO_CHANGE")?0:"ADD"===n?1:"REMOVE"===n?2:"CURRENT"===n?3:"RESET"===n?4:ii(39313,{state:n}),a=t.targetChange.targetIds||[],o=(i=t.targetChange.resumeToken,e.useProto3Json?(ia(void 0===i||"string"==typeof i,58123),ap.fromBase64String(i||"")):(ia(void 0===i||i instanceof n0.Buffer||i instanceof Uint8Array,16193),ap.fromUint8Array(i||new Uint8Array))),l=t.targetChange.cause;r=new lC(s,a,o,l&&new il(void 0===l.code?io.UNKNOWN:lp(l.code),l.message||"")||null)}else if("documentChange"in t){t.documentChange;let n=t.documentChange;n.document,n.document.name,n.document.updateTime;let i=lz(e,n.document.name),s=lV(n.document.updateTime),a=n.document.createTime?lV(n.document.createTime):iB.min(),o=new a0({mapValue:{fields:n.document.fields}}),l=a1.newFoundDocument(i,s,a,o);r=new lT(n.targetIds||[],n.removedTargetIds||[],l.key,l)}else if("documentDelete"in t){t.documentDelete;let n=t.documentDelete;n.document;let i=lz(e,n.document),s=n.readTime?lV(n.readTime):iB.min(),a=a1.newNoDocument(i,s);r=new lT([],n.removedTargetIds||[],a.key,a)}else if("documentRemove"in t){t.documentRemove;let n=t.documentRemove;n.document;let i=lz(e,n.document);r=new lT([],n.removedTargetIds||[],i,null)}else{if(!("filter"in t))return ii(11601,{Vt:t});{t.filter;let e=t.filter;e.targetId;let{count:n=0,unchangedNames:i}=e,s=new ld(n,i);r=new lS(e.targetId,s)}}return r}(this.serializer,e),r=function(e){if(!("targetChange"in e))return iB.min();let t=e.targetChange;return t.targetIds&&t.targetIds.length?iB.min():t.readTime?lV(t.readTime):iB.min()}(e);return this.listener.J_(t,r)}Z_(e){let t,r={};r.database=lG(this.serializer),r.addTarget=function(e,t){let r,n=t.target;if((r=og(n)?{documents:lX(e,n)}:{query:lZ(e,n).ft}).targetId=t.targetId,t.resumeToken.approximateByteSize()>0){r.resumeToken=lF(e,t.resumeToken);let n=lL(e,t.expectedCount);null!==n&&(r.expectedCount=n)}else if(t.snapshotVersion.compareTo(iB.min())>0){r.readTime=lM(e,t.snapshotVersion.toTimestamp());let n=lL(e,t.expectedCount);null!==n&&(r.expectedCount=n)}return r}(this.serializer,e);let n=(this.serializer,null==(t=function(e){switch(e){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return ii(28987,{purpose:e})}}(e.purpose))?null:{"goog-listen-tags":t});n&&(r.labels=n),this.K_(r)}X_(e){let t={};t.database=lG(this.serializer),t.removeTarget=e,this.K_(t)}}class ce extends h7{constructor(e,t,r,n,i,s){super(e,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",t,r,n,s),this.serializer=i}get Y_(){return this.F_>0}start(){this.lastStreamToken=void 0,super.start()}W_(){this.Y_&&this.ea([])}j_(e,t){return this.connection.T_("Write",e,t)}H_(e){return ia(!!e.streamToken,31322),this.lastStreamToken=e.streamToken,ia(!e.writeResults||0===e.writeResults.length,55816),this.listener.ta()}onNext(e){var t,r;ia(!!e.streamToken,12678),this.lastStreamToken=e.streamToken,this.M_.reset();let n=(t=e.writeResults,r=e.commitTime,t&&t.length>0?(ia(void 0!==r,14353),t.map(e=>{let t;return(t=e.updateTime?lV(e.updateTime):lV(r)).isEqual(iB.min())&&(t=lV(r)),new o3(t,e.transformResults||[])})):[]),i=lV(e.commitTime);return this.listener.na(i,n)}ra(){let e={};e.database=lG(this.serializer),this.K_(e)}ea(e){let t={streamToken:this.lastStreamToken,writes:e.map(e=>lJ(this.serializer,e))};this.K_(t)}}class ct{}class cr extends ct{constructor(e,t,r,n){super(),this.authCredentials=e,this.appCheckCredentials=t,this.connection=r,this.serializer=n,this.ia=!1}sa(){if(this.ia)throw new il(io.FAILED_PRECONDITION,"The client has already been terminated.")}Wo(e,t,r,n){return this.sa(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([i,s])=>this.connection.Wo(e,lB(t,r),n,i,s)).catch(e=>{throw"FirebaseError"===e.name?(e.code===io.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),e):new il(io.UNKNOWN,e.toString())})}jo(e,t,r,n,i){return this.sa(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([s,a])=>this.connection.jo(e,lB(t,r),n,s,a,i)).catch(e=>{throw"FirebaseError"===e.name?(e.code===io.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),e):new il(io.UNKNOWN,e.toString())})}terminate(){this.ia=!0,this.connection.terminate()}}class cn{constructor(e,t){this.asyncQueue=e,this.onlineStateHandler=t,this.state="Unknown",this.oa=0,this._a=null,this.aa=!0}ua(){0===this.oa&&(this.ca("Unknown"),this._a=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,()=>(this._a=null,this.la("Backend didn't respond within 10 seconds."),this.ca("Offline"),Promise.resolve())))}ha(e){"Online"===this.state?this.ca("Unknown"):(this.oa++,this.oa>=1&&(this.Pa(),this.la(`Connection failed 1 times. Most recent error: ${e.toString()}`),this.ca("Offline")))}set(e){this.Pa(),this.oa=0,"Online"===e&&(this.aa=!1),this.ca(e)}ca(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}la(e){let t=`Could not reach Cloud Firestore backend. ${e}
This typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.aa?(ie(t),this.aa=!1):n9("OnlineStateTracker",t)}Pa(){null!==this._a&&(this._a.cancel(),this._a=null)}}let ci="RemoteStore";class cs{constructor(e,t,r,n,i){this.localStore=e,this.datastore=t,this.asyncQueue=r,this.remoteSyncer={},this.Ta=[],this.Ia=new Map,this.Ea=new Set,this.Ra=[],this.Aa=i,this.Aa.Mo(e=>{r.enqueueAndForget(async()=>{cp(this)&&(n9(ci,"Restarting streams for network reachability change."),await async function(e){e.Ea.add(4),await co(e),e.Va.set("Unknown"),e.Ea.delete(4),await ca(e)}(this))})}),this.Va=new cn(r,n)}}async function ca(e){if(cp(e))for(let t of e.Ra)await t(!0)}async function co(e){for(let t of e.Ra)await t(!1)}function cl(e,t){e.Ia.has(t.targetId)||(e.Ia.set(t.targetId,t),cf(e)?cd(e):cN(e).O_()&&ch(e,t))}function cu(e,t){let r=cN(e);e.Ia.delete(t),r.O_()&&cc(e,t),0===e.Ia.size&&(r.O_()?r.L_():cp(e)&&e.Va.set("Unknown"))}function ch(e,t){if(e.da.$e(t.targetId),t.resumeToken.approximateByteSize()>0||t.snapshotVersion.compareTo(iB.min())>0){let r=e.remoteSyncer.getRemoteKeysForTarget(t.targetId).size;t=t.withExpectedCount(r)}cN(e).Z_(t)}function cc(e,t){e.da.$e(t),cN(e).X_(t)}function cd(e){e.da=new lk({getRemoteKeysForTarget:t=>e.remoteSyncer.getRemoteKeysForTarget(t),At:t=>e.Ia.get(t)||null,ht:()=>e.datastore.serializer.databaseId}),cN(e).start(),e.Va.ua()}function cf(e){return cp(e)&&!cN(e).x_()&&e.Ia.size>0}function cp(e){return 0===e.Ea.size}async function cm(e){e.Va.set("Online")}async function cg(e){e.Ia.forEach((t,r)=>{ch(e,t)})}async function cy(e,t){e.da=void 0,cf(e)?(e.Va.ha(t),cd(e)):e.Va.set("Unknown")}async function cw(e,t,r){if(e.Va.set("Online"),t instanceof lC&&2===t.state&&t.cause)try{await async function(e,t){let r=t.cause;for(let n of t.targetIds)e.Ia.has(n)&&(await e.remoteSyncer.rejectListen(n,r),e.Ia.delete(n),e.da.removeTarget(n))}(e,t)}catch(r){n9(ci,"Failed to remove targets %s: %s ",t.targetIds.join(","),r),await cv(e,r)}else if(t instanceof lT?e.da.Xe(t):t instanceof lS?e.da.st(t):e.da.tt(t),!r.isEqual(iB.min()))try{let t,n=await hI(e.localStore);r.compareTo(n)>=0&&await ((t=e.da.Tt(r)).targetChanges.forEach((t,n)=>{if(t.resumeToken.approximateByteSize()>0){let i=e.Ia.get(n);i&&e.Ia.set(n,i.withResumeToken(t.resumeToken,r))}}),t.targetMismatches.forEach((t,r)=>{let n=e.Ia.get(t);if(!n)return;e.Ia.set(t,n.withResumeToken(ap.EMPTY_BYTE_STRING,n.snapshotVersion)),cc(e,t);let i=new l4(n.target,t,r,n.sequenceNumber);ch(e,i)}),e.remoteSyncer.applyRemoteEvent(t))}catch(t){n9(ci,"Failed to raise snapshot:",t),await cv(e,t)}}async function cv(e,t,r){if(!i8(t))throw t;e.Ea.add(1),await co(e),e.Va.set("Offline"),r||(r=()=>hI(e.localStore)),e.asyncQueue.enqueueRetryable(async()=>{n9(ci,"Retrying IndexedDB access"),await r(),e.Ea.delete(1),await ca(e)})}function c_(e,t){return t().catch(r=>cv(e,r,t))}async function cI(e){var t;let r=cD(e),n=e.Ta.length>0?e.Ta[e.Ta.length-1].batchId:-1;for(;cp(t=e)&&t.Ta.length<10;)try{let t=await function(e,t){return e.persistence.runTransaction("Get next mutation batch","readonly",r=>(void 0===t&&(t=-1),e.mutationQueue.getNextMutationBatchAfterBatchId(r,t)))}(e.localStore,n);if(null===t){0===e.Ta.length&&r.L_();break}n=t.batchId,function(e,t){e.Ta.push(t);let r=cD(e);r.O_()&&r.Y_&&r.ea(t.mutations)}(e,t)}catch(t){await cv(e,t)}cb(e)&&cE(e)}function cb(e){return cp(e)&&!cD(e).x_()&&e.Ta.length>0}function cE(e){cD(e).start()}async function cT(e){cD(e).ra()}async function cS(e){let t=cD(e);for(let r of e.Ta)t.ea(r.mutations)}async function cC(e,t,r){let n=e.Ta.shift(),i=lu.from(n,t,r);await c_(e,()=>e.remoteSyncer.applySuccessfulWrite(i)),await cI(e)}async function cA(e,t){t&&cD(e).Y_&&await async function(e,t){var r;if(lf(r=t.code)&&r!==io.ABORTED){let r=e.Ta.shift();cD(e).B_(),await c_(e,()=>e.remoteSyncer.rejectFailedWrite(r.batchId,t)),await cI(e)}}(e,t),cb(e)&&cE(e)}async function ck(e,t){e.asyncQueue.verifyOperationInProgress(),n9(ci,"RemoteStore received new credentials");let r=cp(e);e.Ea.add(3),await co(e),r&&e.Va.set("Unknown"),await e.remoteSyncer.handleCredentialChange(t),e.Ea.delete(3),await ca(e)}async function cx(e,t){t?(e.Ea.delete(2),await ca(e)):t||(e.Ea.add(2),await co(e),e.Va.set("Unknown"))}function cN(e){var t,r,n;return e.ma||(t=e.datastore,r=e.asyncQueue,n={Zo:cm.bind(null,e),Yo:cg.bind(null,e),t_:cy.bind(null,e),J_:cw.bind(null,e)},t.sa(),e.ma=new h9(r,t.connection,t.authCredentials,t.appCheckCredentials,t.serializer,n),e.Ra.push(async t=>{t?(e.ma.B_(),cf(e)?cd(e):e.Va.set("Unknown")):(await e.ma.stop(),e.da=void 0)})),e.ma}function cD(e){var t,r,n;return e.fa||(t=e.datastore,r=e.asyncQueue,n={Zo:()=>Promise.resolve(),Yo:cT.bind(null,e),t_:cA.bind(null,e),ta:cS.bind(null,e),na:cC.bind(null,e)},t.sa(),e.fa=new ce(r,t.connection,t.authCredentials,t.appCheckCredentials,t.serializer,n),e.Ra.push(async t=>{t?(e.fa.B_(),await cI(e)):(await e.fa.stop(),e.Ta.length>0&&(n9(ci,`Stopping write stream with ${e.Ta.length} pending writes`),e.Ta=[]))})),e.fa}class cR{constructor(e,t,r,n,i){this.asyncQueue=e,this.timerId=t,this.targetTimeMs=r,this.op=n,this.removalCallback=i,this.deferred=new iu,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(e=>{})}get promise(){return this.deferred.promise}static createAndSchedule(e,t,r,n,i){let s=new cR(e,t,Date.now()+r,n,i);return s.start(r),s}start(e){this.timerHandle=setTimeout(()=>this.handleDelayElapsed(),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){null!==this.timerHandle&&(this.clearTimeout(),this.deferred.reject(new il(io.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget(()=>null!==this.timerHandle?(this.clearTimeout(),this.op().then(e=>this.deferred.resolve(e))):Promise.resolve())}clearTimeout(){null!==this.timerHandle&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function cP(e,t){if(ie("AsyncQueue",`${t}: ${e}`),i8(e))return new il(io.UNAVAILABLE,`${t}: ${e}`);throw e}class cO{static emptySet(e){return new cO(e.comparator)}constructor(e){this.comparator=e?(t,r)=>e(t,r)||ix.comparator(t.key,r.key):(e,t)=>ix.comparator(e.key,t.key),this.keyedMap=oV(),this.sortedSet=new aa(this.comparator)}has(e){return null!=this.keyedMap.get(e)}get(e){return this.keyedMap.get(e)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(e){let t=this.keyedMap.get(e);return t?this.sortedSet.indexOf(t):-1}get size(){return this.sortedSet.size}forEach(e){this.sortedSet.inorderTraversal((t,r)=>(e(t),!1))}add(e){let t=this.delete(e.key);return t.copy(t.keyedMap.insert(e.key,e),t.sortedSet.insert(e,null))}delete(e){let t=this.get(e);return t?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(t)):this}isEqual(e){if(!(e instanceof cO)||this.size!==e.size)return!1;let t=this.sortedSet.getIterator(),r=e.sortedSet.getIterator();for(;t.hasNext();){let e=t.getNext().key,n=r.getNext().key;if(!e.isEqual(n))return!1}return!0}toString(){let e=[];return this.forEach(t=>{e.push(t.toString())}),0===e.length?"DocumentSet ()":"DocumentSet (\n  "+e.join("  \n")+"\n)"}copy(e,t){let r=new cO;return r.comparator=this.comparator,r.keyedMap=e,r.sortedSet=t,r}}class cL{constructor(){this.ga=new aa(ix.comparator)}track(e){let t=e.doc.key,r=this.ga.get(t);r?0!==e.type&&3===r.type?this.ga=this.ga.insert(t,e):3===e.type&&1!==r.type?this.ga=this.ga.insert(t,{type:r.type,doc:e.doc}):2===e.type&&2===r.type?this.ga=this.ga.insert(t,{type:2,doc:e.doc}):2===e.type&&0===r.type?this.ga=this.ga.insert(t,{type:0,doc:e.doc}):1===e.type&&0===r.type?this.ga=this.ga.remove(t):1===e.type&&2===r.type?this.ga=this.ga.insert(t,{type:1,doc:r.doc}):0===e.type&&1===r.type?this.ga=this.ga.insert(t,{type:2,doc:e.doc}):ii(63341,{Vt:e,pa:r}):this.ga=this.ga.insert(t,e)}ya(){let e=[];return this.ga.inorderTraversal((t,r)=>{e.push(r)}),e}}class cM{constructor(e,t,r,n,i,s,a,o,l){this.query=e,this.docs=t,this.oldDocs=r,this.docChanges=n,this.mutatedKeys=i,this.fromCache=s,this.syncStateChanged=a,this.excludesMetadataChanges=o,this.hasCachedResults=l}static fromInitialDocuments(e,t,r,n,i){let s=[];return t.forEach(e=>{s.push({type:0,doc:e})}),new cM(e,t,cO.emptySet(t),s,r,n,!0,!1,i)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(e){if(!(this.fromCache===e.fromCache&&this.hasCachedResults===e.hasCachedResults&&this.syncStateChanged===e.syncStateChanged&&this.mutatedKeys.isEqual(e.mutatedKeys)&&ox(this.query,e.query)&&this.docs.isEqual(e.docs)&&this.oldDocs.isEqual(e.oldDocs)))return!1;let t=this.docChanges,r=e.docChanges;if(t.length!==r.length)return!1;for(let e=0;e<t.length;e++)if(t[e].type!==r[e].type||!t[e].doc.isEqual(r[e].doc))return!1;return!0}}class cF{constructor(){this.wa=void 0,this.ba=[]}Sa(){return this.ba.some(e=>e.Da())}}class cV{constructor(){this.queries=cU(),this.onlineState="Unknown",this.Ca=new Set}terminate(){var e;let t;e=new il(io.ABORTED,"Firestore shutting down"),t=this.queries,this.queries=cU(),t.forEach((t,r)=>{for(let t of r.ba)t.onError(e)})}}function cU(){return new oL(e=>oN(e),ox)}async function cB(e,t){let r=3,n=t.query,i=e.queries.get(n);i?!i.Sa()&&t.Da()&&(r=2):(i=new cF,r=+!t.Da());try{switch(r){case 0:i.wa=await e.onListen(n,!0);break;case 1:i.wa=await e.onListen(n,!1);break;case 2:await e.onFirstRemoteStoreListen(n)}}catch(r){let e=cP(r,`Initialization of query '${oD(t.query)}' failed`);return void t.onError(e)}e.queries.set(n,i),i.ba.push(t),t.va(e.onlineState),i.wa&&t.Fa(i.wa)&&c$(e)}async function cq(e,t){let r=t.query,n=3,i=e.queries.get(r);if(i){let e=i.ba.indexOf(t);e>=0&&(i.ba.splice(e,1),0===i.ba.length?n=+!t.Da():!i.Sa()&&t.Da()&&(n=2))}switch(n){case 0:return e.queries.delete(r),e.onUnlisten(r,!0);case 1:return e.queries.delete(r),e.onUnlisten(r,!1);case 2:return e.onLastRemoteStoreUnlisten(r);default:return}}function cj(e,t){let r=!1;for(let n of t){let t=n.query,i=e.queries.get(t);if(i){for(let e of i.ba)e.Fa(n)&&(r=!0);i.wa=n}}r&&c$(e)}function cz(e,t,r){let n=e.queries.get(t);if(n)for(let e of n.ba)e.onError(r);e.queries.delete(t)}function c$(e){e.Ca.forEach(e=>{e.next()})}(_=v||(v={})).Ma="default",_.Cache="cache";class cK{constructor(e,t,r){this.query=e,this.xa=t,this.Oa=!1,this.Na=null,this.onlineState="Unknown",this.options=r||{}}Fa(e){if(!this.options.includeMetadataChanges){let t=[];for(let r of e.docChanges)3!==r.type&&t.push(r);e=new cM(e.query,e.docs,e.oldDocs,t,e.mutatedKeys,e.fromCache,e.syncStateChanged,!0,e.hasCachedResults)}let t=!1;return this.Oa?this.Ba(e)&&(this.xa.next(e),t=!0):this.La(e,this.onlineState)&&(this.ka(e),t=!0),this.Na=e,t}onError(e){this.xa.error(e)}va(e){this.onlineState=e;let t=!1;return this.Na&&!this.Oa&&this.La(this.Na,e)&&(this.ka(this.Na),t=!0),t}La(e,t){return!(e.fromCache&&this.Da())||(!this.options.Ka||"Offline"===t)&&(!e.docs.isEmpty()||e.hasCachedResults||"Offline"===t)}Ba(e){if(e.docChanges.length>0)return!0;let t=this.Na&&this.Na.hasPendingWrites!==e.hasPendingWrites;return!(!e.syncStateChanged&&!t)&&!0===this.options.includeMetadataChanges}ka(e){e=cM.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache,e.hasCachedResults),this.Oa=!0,this.xa.next(e)}Da(){return this.options.source!==v.Cache}}class cG{constructor(e,t){this.qa=e,this.byteLength=t}Ua(){return"metadata"in this.qa}}class cH{constructor(e){this.serializer=e}Ks(e){return lz(this.serializer,e)}qs(e){return e.metadata.exists?lQ(this.serializer,e.document,!1):a1.newNoDocument(this.Ks(e.metadata.name),this.Us(e.metadata.readTime))}Us(e){return lV(e)}}class cW{constructor(e,t){this.$a=e,this.serializer=t,this.Wa=[],this.Qa=[],this.collectionGroups=new Set,this.progress=cQ(e)}get queries(){return this.Wa}get documents(){return this.Qa}Ga(e){this.progress.bytesLoaded+=e.byteLength;let t=this.progress.documentsLoaded;if(e.qa.namedQuery)this.Wa.push(e.qa.namedQuery);else if(e.qa.documentMetadata){this.Qa.push({metadata:e.qa.documentMetadata}),e.qa.documentMetadata.exists||++t;let r=iC.fromString(e.qa.documentMetadata.name);this.collectionGroups.add(r.get(r.length-2))}else e.qa.document&&(this.Qa[this.Qa.length-1].document=e.qa.document,++t);return t!==this.progress.documentsLoaded?(this.progress.documentsLoaded=t,{...this.progress}):null}za(e){let t=new Map,r=new cH(this.serializer);for(let n of e)if(n.metadata.queries){let e=r.Ks(n.metadata.name);for(let r of n.metadata.queries){let n=(t.get(r)||oz()).add(e);t.set(r,n)}}return t}async ja(e){let t=await hx(e,new cH(this.serializer),this.Qa,this.$a.id),r=this.za(this.documents);for(let t of this.Wa)await hN(e,t,r.get(t.name));return this.progress.taskState="Success",{progress:this.progress,Ha:this.collectionGroups,Ja:t}}}function cQ(e){return{taskState:"Running",documentsLoaded:0,bytesLoaded:0,totalDocuments:e.totalDocuments,totalBytes:e.totalBytes}}class cJ{constructor(e){this.key=e}}class cY{constructor(e){this.key=e}}class cX{constructor(e,t){this.query=e,this.Za=t,this.Xa=null,this.hasCachedResults=!1,this.current=!1,this.Ya=oz(),this.mutatedKeys=oz(),this.eu=oO(e),this.tu=new cO(this.eu)}get nu(){return this.Za}ru(e,t){let r=t?t.iu:new cL,n=t?t.tu:this.tu,i=t?t.mutatedKeys:this.mutatedKeys,s=n,a=!1,o="F"===this.query.limitType&&n.size===this.query.limit?n.last():null,l="L"===this.query.limitType&&n.size===this.query.limit?n.first():null;if(e.inorderTraversal((e,t)=>{let u=n.get(e),h=oR(this.query,t)?t:null,c=!!u&&this.mutatedKeys.has(u.key),d=!!h&&(h.hasLocalMutations||this.mutatedKeys.has(h.key)&&h.hasCommittedMutations),f=!1;u&&h?u.data.isEqual(h.data)?c!==d&&(r.track({type:3,doc:h}),f=!0):this.su(u,h)||(r.track({type:2,doc:h}),f=!0,(o&&this.eu(h,o)>0||l&&0>this.eu(h,l))&&(a=!0)):!u&&h?(r.track({type:0,doc:h}),f=!0):u&&!h&&(r.track({type:1,doc:u}),f=!0,(o||l)&&(a=!0)),f&&(h?(s=s.add(h),i=d?i.add(e):i.delete(e)):(s=s.delete(e),i=i.delete(e)))}),null!==this.query.limit)for(;s.size>this.query.limit;){let e="F"===this.query.limitType?s.last():s.first();s=s.delete(e.key),i=i.delete(e.key),r.track({type:1,doc:e})}return{tu:s,iu:r,Ss:a,mutatedKeys:i}}su(e,t){return e.hasLocalMutations&&t.hasCommittedMutations&&!t.hasLocalMutations}applyChanges(e,t,r,n){let i=this.tu;this.tu=e.tu,this.mutatedKeys=e.mutatedKeys;let s=e.iu.ya();s.sort((e,t)=>{var r,n;let i;return r=e.type,n=t.type,(i=e=>{switch(e){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return ii(20277,{Vt:e})}})(r)-i(n)||this.eu(e.doc,t.doc)}),this.ou(r),n=n??!1;let a=t&&!n?this._u():[],o=0===this.Ya.size&&this.current&&!n?1:0,l=o!==this.Xa;return(this.Xa=o,0!==s.length||l)?{snapshot:new cM(this.query,e.tu,i,s,e.mutatedKeys,0===o,l,!1,!!r&&r.resumeToken.approximateByteSize()>0),au:a}:{au:a}}va(e){return this.current&&"Offline"===e?(this.current=!1,this.applyChanges({tu:this.tu,iu:new cL,mutatedKeys:this.mutatedKeys,Ss:!1},!1)):{au:[]}}uu(e){return!this.Za.has(e)&&!!this.tu.has(e)&&!this.tu.get(e).hasLocalMutations}ou(e){e&&(e.addedDocuments.forEach(e=>this.Za=this.Za.add(e)),e.modifiedDocuments.forEach(e=>{}),e.removedDocuments.forEach(e=>this.Za=this.Za.delete(e)),this.current=e.current)}_u(){if(!this.current)return[];let e=this.Ya;this.Ya=oz(),this.tu.forEach(e=>{this.uu(e.key)&&(this.Ya=this.Ya.add(e.key))});let t=[];return e.forEach(e=>{this.Ya.has(e)||t.push(new cY(e))}),this.Ya.forEach(r=>{e.has(r)||t.push(new cJ(r))}),t}cu(e){this.Za=e.ks,this.Ya=oz();let t=this.ru(e.documents);return this.applyChanges(t,!0)}lu(){return cM.fromInitialDocuments(this.query,this.tu,this.mutatedKeys,0===this.Xa,this.hasCachedResults)}}let cZ="SyncEngine";class c0{constructor(e,t,r){this.query=e,this.targetId=t,this.view=r}}class c1{constructor(e){this.key=e,this.hu=!1}}class c2{constructor(e,t,r,n,i,s){this.localStore=e,this.remoteStore=t,this.eventManager=r,this.sharedClientState=n,this.currentUser=i,this.maxConcurrentLimboResolutions=s,this.Pu={},this.Tu=new oL(e=>oN(e),ox),this.Iu=new Map,this.Eu=new Set,this.Ru=new aa(ix.comparator),this.Au=new Map,this.Vu=new u9,this.du={},this.mu=new Map,this.fu=uj.ar(),this.onlineState="Unknown",this.gu=void 0}get isPrimaryClient(){return!0===this.gu}}async function c6(e,t,r=!0){let n,i=dT(e),s=i.Tu.get(t);return s?(i.sharedClientState.addLocalQueryTarget(s.targetId),n=s.view.lu()):n=await c4(i,t,r,!0),n}async function c3(e,t){let r=dT(e);await c4(r,t,!0,!1)}async function c4(e,t,r,n){let i,s=await hE(e.localStore,oS(t)),a=s.targetId,o=e.sharedClientState.addLocalQueryTarget(a,r);return n&&(i=await c5(e,t,a,"current"===o,s.resumeToken)),e.isPrimaryClient&&r&&cl(e.remoteStore,s),i}async function c5(e,t,r,n,i){e.pu=(t,r,n)=>(async function(e,t,r,n){let i=t.view.ru(r);i.Ss&&(i=await hS(e.localStore,t.query,!1).then(({documents:e})=>t.view.ru(e,i)));let s=n&&n.targetChanges.get(t.targetId),a=n&&null!=n.targetMismatches.get(t.targetId),o=t.view.applyChanges(i,e.isPrimaryClient,s,a);return dh(e,t.targetId,o.au),o.snapshot})(e,t,r,n);let s=await hS(e.localStore,t,!0),a=new cX(t,s.ks),o=a.ru(s.documents),l=lE.createSynthesizedTargetChangeForCurrentChange(r,n&&"Offline"!==e.onlineState,i),u=a.applyChanges(o,e.isPrimaryClient,l);dh(e,r,u.au);let h=new c0(t,r,a);return e.Tu.set(t,h),e.Iu.has(r)?e.Iu.get(r).push(t):e.Iu.set(r,[t]),u.snapshot}async function c8(e,t,r){let n=e.Tu.get(t),i=e.Iu.get(n.targetId);i.length>1?(e.Iu.set(n.targetId,i.filter(e=>!ox(e,t))),e.Tu.delete(t)):e.isPrimaryClient?(e.sharedClientState.removeLocalQueryTarget(n.targetId),e.sharedClientState.isActiveQueryTarget(n.targetId)||await hT(e.localStore,n.targetId,!1).then(()=>{e.sharedClientState.clearQueryState(n.targetId),r&&cu(e.remoteStore,n.targetId),dl(e,n.targetId)}).catch(iZ)):(dl(e,n.targetId),await hT(e.localStore,n.targetId,!0))}async function c7(e,t){let r=e.Tu.get(t),n=e.Iu.get(r.targetId);e.isPrimaryClient&&1===n.length&&(e.sharedClientState.removeLocalQueryTarget(r.targetId),cu(e.remoteStore,r.targetId))}async function c9(e,t,r){let n=dS(e);try{var i,s;let e,a,o,l,u,h=await (i=n.localStore,o=iU.now(),l=t.reduce((e,t)=>e.add(t.key),oz()),i.persistence.runTransaction("Locally write mutations","readwrite",r=>{let n=oM,s=oz();return i.xs.getEntries(r,l).next(e=>{(n=e).forEach((e,t)=>{t.isValidDocument()||(s=s.add(e))})}).next(()=>i.localDocuments.getOverlayedDocuments(r,n)).next(n=>{e=n;let s=[];for(let r of t){let t=function(e,t){let r=null;for(let n of e.fieldTransforms){let e=t.data.field(n.field),i=oW(n.transform,e||null);null!=i&&(null===r&&(r=a0.empty()),r.set(n.field,i))}return r||null}(r,e.get(r.key).overlayedDocument);null!=t&&s.push(new lr(r.key,t,function e(t){let r=[];return ai(t.fields,(t,n)=>{let i=new ik([t]);if(aH(n)){let t=e(n.mapValue).fields;if(0===t.length)r.push(i);else for(let e of t)r.push(i.child(e))}else r.push(i)}),new ad(r)}(t.value.mapValue),o4.exists(!0)))}return i.mutationQueue.addMutationBatch(r,o,s,t)}).next(t=>{a=t;let n=t.applyToLocalDocumentSet(e,s);return i.documentOverlayCache.saveOverlays(r,t.batchId,n)})}).then(()=>({batchId:a.batchId,changes:oU(e)})));n.sharedClientState.addPendingMutation(h.batchId),s=h.batchId,(u=n.du[n.currentUser.toKey()])||(u=new aa(i_)),u=u.insert(s,r),n.du[n.currentUser.toKey()]=u,await dd(n,h.changes),await cI(n.remoteStore)}catch(t){let e=cP(t,"Failed to persist write");r.reject(e)}}async function de(e,t){var r;try{let n,i,s=await (r=e.localStore,n=t.snapshotVersion,i=r.vs,r.persistence.runTransaction("Apply remote event","readwrite-primary",e=>{let s=r.xs.newChangeBuffer({trackRemovals:!0});i=r.vs;let a=[];t.targetChanges.forEach((s,o)=>{var l;let u=i.get(o);if(!u)return;a.push(r.li.removeMatchingKeys(e,s.removedDocuments,o).next(()=>r.li.addMatchingKeys(e,s.addedDocuments,o)));let h=u.withSequenceNumber(e.currentSequenceNumber);null!==t.targetMismatches.get(o)?h=h.withResumeToken(ap.EMPTY_BYTE_STRING,iB.min()).withLastLimboFreeSnapshotVersion(iB.min()):s.resumeToken.approximateByteSize()>0&&(h=h.withResumeToken(s.resumeToken,n)),i=i.insert(o,h),l=h,(0===u.resumeToken.approximateByteSize()||l.snapshotVersion.toMicroseconds()-u.snapshotVersion.toMicroseconds()>=3e8||s.addedDocuments.size+s.modifiedDocuments.size+s.removedDocuments.size>0)&&a.push(r.li.updateTargetData(e,h))});let o=oM,l=oz();if(t.documentUpdates.forEach(n=>{t.resolvedLimboDocuments.has(n)&&a.push(r.persistence.referenceDelegate.updateLimboDocument(e,n))}),a.push(hb(e,s,t.documentUpdates).next(e=>{o=e.Bs,l=e.Ls})),!n.isEqual(iB.min())){let t=r.li.getLastRemoteSnapshotVersion(e).next(t=>r.li.setTargetsMetadata(e,e.currentSequenceNumber,n));a.push(t)}return i0.waitFor(a).next(()=>s.apply(e)).next(()=>r.localDocuments.getLocalViewOfDocuments(e,o,l)).next(()=>o)}).then(e=>(r.vs=i,e)));t.targetChanges.forEach((t,r)=>{let n=e.Au.get(r);n&&(ia(t.addedDocuments.size+t.modifiedDocuments.size+t.removedDocuments.size<=1,22616),t.addedDocuments.size>0?n.hu=!0:t.modifiedDocuments.size>0?ia(n.hu,14607):t.removedDocuments.size>0&&(ia(n.hu,42227),n.hu=!1))}),await dd(e,s,t)}catch(e){await iZ(e)}}function dt(e,t,r){var n;if(e.isPrimaryClient&&0===r||!e.isPrimaryClient&&1===r){let r,i=[];e.Tu.forEach((e,r)=>{let n=r.view.va(t);n.snapshot&&i.push(n.snapshot)}),(n=e.eventManager).onlineState=t,r=!1,n.queries.forEach((e,n)=>{for(let e of n.ba)e.va(t)&&(r=!0)}),r&&c$(n),i.length&&e.Pu.J_(i),e.onlineState=t,e.isPrimaryClient&&e.sharedClientState.setOnlineState(t)}}async function dr(e,t,r){e.sharedClientState.updateQueryState(t,"rejected",r);let n=e.Au.get(t),i=n&&n.key;if(i){let r=new aa(ix.comparator);r=r.insert(i,a1.newNoDocument(i,iB.min()));let n=oz().add(i),s=new lb(iB.min(),new Map,new aa(i_),r,n);await de(e,s),e.Ru=e.Ru.remove(i),e.Au.delete(t),dc(e)}else await hT(e.localStore,t,!1).then(()=>dl(e,t,r)).catch(iZ)}async function dn(e,t){var r;let n=t.batch.batchId;try{let i=await (r=e.localStore,r.persistence.runTransaction("Acknowledge batch","readwrite-primary",e=>{let n,i,s,a=t.batch.keys(),o=r.xs.newChangeBuffer({trackRemovals:!0});return(i=(n=t.batch).keys(),s=i0.resolve(),i.forEach(r=>{s=s.next(()=>o.getEntry(e,r)).next(e=>{let i=t.docVersions.get(r);ia(null!==i,48541),0>e.version.compareTo(i)&&(n.applyToRemoteDocument(e,t),e.isValidDocument()&&(e.setReadTime(t.commitVersion),o.addEntry(e)))})}),s.next(()=>r.mutationQueue.removeMutationBatch(e,n))).next(()=>o.apply(e)).next(()=>r.mutationQueue.performConsistencyCheck(e)).next(()=>r.documentOverlayCache.removeOverlaysForBatchId(e,a,t.batch.batchId)).next(()=>r.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(e,function(e){let t=oz();for(let r=0;r<e.mutationResults.length;++r)e.mutationResults[r].transformResults.length>0&&(t=t.add(e.batch.mutations[r].key));return t}(t))).next(()=>r.localDocuments.getDocuments(e,a))}));da(e,n,null),ds(e,n),e.sharedClientState.updateMutationState(n,"acknowledged"),await dd(e,i)}catch(e){await iZ(e)}}async function di(e,t,r){var n;try{let i=await (n=e.localStore,n.persistence.runTransaction("Reject batch","readwrite-primary",e=>{let r;return n.mutationQueue.lookupMutationBatch(e,t).next(t=>(ia(null!==t,37113),r=t.keys(),n.mutationQueue.removeMutationBatch(e,t))).next(()=>n.mutationQueue.performConsistencyCheck(e)).next(()=>n.documentOverlayCache.removeOverlaysForBatchId(e,r,t)).next(()=>n.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(e,r)).next(()=>n.localDocuments.getDocuments(e,r))}));da(e,t,r),ds(e,t),e.sharedClientState.updateMutationState(t,"rejected",r),await dd(e,i)}catch(e){await iZ(e)}}function ds(e,t){(e.mu.get(t)||[]).forEach(e=>{e.resolve()}),e.mu.delete(t)}function da(e,t,r){let n=e.du[e.currentUser.toKey()];if(n){let i=n.get(t);i&&(r?i.reject(r):i.resolve(),n=n.remove(t)),e.du[e.currentUser.toKey()]=n}}function dl(e,t,r=null){for(let n of(e.sharedClientState.removeLocalQueryTarget(t),e.Iu.get(t)))e.Tu.delete(n),r&&e.Pu.yu(n,r);e.Iu.delete(t),e.isPrimaryClient&&e.Vu.Gr(t).forEach(t=>{e.Vu.containsKey(t)||du(e,t)})}function du(e,t){e.Eu.delete(t.path.canonicalString());let r=e.Ru.get(t);null!==r&&(cu(e.remoteStore,r),e.Ru=e.Ru.remove(t),e.Au.delete(r),dc(e))}function dh(e,t,r){for(let n of r)n instanceof cJ?(e.Vu.addReference(n.key,t),function(e,t){let r=t.key,n=r.path.canonicalString();e.Ru.get(r)||e.Eu.has(n)||(n9(cZ,"New document in limbo: "+r),e.Eu.add(n),dc(e))}(e,n)):n instanceof cY?(n9(cZ,"Document no longer in limbo: "+n.key),e.Vu.removeReference(n.key,t),e.Vu.containsKey(n.key)||du(e,n.key)):ii(19791,{wu:n})}function dc(e){for(;e.Eu.size>0&&e.Ru.size<e.maxConcurrentLimboResolutions;){let t=e.Eu.values().next().value;e.Eu.delete(t);let r=new ix(iC.fromString(t)),n=e.fu.next();e.Au.set(n,new c1(r)),e.Ru=e.Ru.insert(r,n),cl(e.remoteStore,new l4(oS(oI(r.path)),n,"TargetPurposeLimboResolution",ss.ce))}}async function dd(e,t,r){let n=[],i=[],s=[];e.Tu.isEmpty()||(e.Tu.forEach((a,o)=>{s.push(e.pu(o,t,r).then(t=>{if((t||r)&&e.isPrimaryClient){let n=t?!t.fromCache:r?.targetChanges.get(o.targetId)?.current;e.sharedClientState.updateQueryState(o.targetId,n?"current":"not-current")}if(t){n.push(t);let e=hm.Es(o.targetId,t);i.push(e)}}))}),await Promise.all(s),e.Pu.J_(n),await async function(e,t){try{await e.persistence.runTransaction("notifyLocalViewChanges","readwrite",r=>i0.forEach(t,t=>i0.forEach(t.Ts,n=>e.persistence.referenceDelegate.addReference(r,t.targetId,n)).next(()=>i0.forEach(t.Is,n=>e.persistence.referenceDelegate.removeReference(r,t.targetId,n)))))}catch(e){if(!i8(e))throw e;n9(hw,"Failed to update sequence numbers: "+e)}for(let r of t){let t=r.targetId;if(!r.fromCache){let r=e.vs.get(t),n=r.snapshotVersion,i=r.withLastLimboFreeSnapshotVersion(n);e.vs=e.vs.insert(t,i)}}}(e.localStore,i))}async function df(e,t){if(!e.currentUser.isEqual(t)){n9(cZ,"User change. New user:",t.toKey());let r=await h_(e.localStore,t);e.currentUser=t,e.mu.forEach(e=>{e.forEach(e=>{e.reject(new il(io.CANCELLED,"'waitForPendingWrites' promise is rejected due to a user change."))})}),e.mu.clear(),e.sharedClientState.handleUserChange(t,r.removedBatchIds,r.addedBatchIds),await dd(e,r.Ns)}}function dp(e,t){let r=e.Au.get(t);if(r&&r.hu)return oz().add(r.key);{let r=oz(),n=e.Iu.get(t);if(!n)return r;for(let t of n){let n=e.Tu.get(t);r=r.unionWith(n.view.nu)}return r}}async function dm(e,t){let r=await hS(e.localStore,t.query,!0),n=t.view.cu(r);return e.isPrimaryClient&&dh(e,t.targetId,n.au),n}async function dg(e,t){return hA(e.localStore,t).then(t=>dd(e,t))}async function dy(e,t,r,n){var i,s;let a,o=await (i=e.localStore,a=i.mutationQueue,i.persistence.runTransaction("Lookup mutation documents","readonly",e=>a.Xn(e,t).next(t=>t?i.localDocuments.getDocuments(e,t):i0.resolve(null))));null!==o?("pending"===r?await cI(e.remoteStore):"acknowledged"===r||"rejected"===r?(da(e,t,n||null),ds(e,t),s=e.localStore,s.mutationQueue.nr(t)):ii(6720,"Unknown batchState",{bu:r}),await dd(e,o)):n9(cZ,"Cannot apply mutation batch with id: "+t)}async function dw(e,t){if(dT(e),dS(e),!0===t&&!0!==e.gu){let t=e.sharedClientState.getAllActiveQueryTargets(),r=await dv(e,t.toArray());for(let t of(e.gu=!0,await cx(e.remoteStore,!0),r))cl(e.remoteStore,t)}else if(!1===t&&!1!==e.gu){let t=[],r=Promise.resolve();e.Iu.forEach((n,i)=>{e.sharedClientState.isLocalQueryTarget(i)?t.push(i):r=r.then(()=>(dl(e,i),hT(e.localStore,i,!0))),cu(e.remoteStore,i)}),await r,await dv(e,t),e.Au.forEach((t,r)=>{cu(e.remoteStore,r)}),e.Vu.zr(),e.Au=new Map,e.Ru=new aa(ix.comparator),e.gu=!1,await cx(e.remoteStore,!1)}}async function dv(e,t,r){let n=[],i=[];for(let r of t){let t,s=e.Iu.get(r);if(s&&0!==s.length)for(let r of(t=await hE(e.localStore,oS(s[0])),s)){let t=e.Tu.get(r),n=await dm(e,t);n.snapshot&&i.push(n.snapshot)}else{let n=await hC(e.localStore,r);t=await hE(e.localStore,n),await c5(e,d_(n),r,!1,t.resumeToken)}n.push(t)}return e.Pu.J_(i),n}function d_(e){var t,r,n,i,s;return t=e.path,r=e.collectionGroup,n=e.orderBy,i=e.filters,s=e.limit,new o_(t,r,n,i,s,"F",e.startAt,e.endAt)}function dI(e){return e.localStore.persistence.hs()}async function db(e,t,r,n){if(e.gu)return void n9(cZ,"Ignoring unexpected query state notification.");let i=e.Iu.get(t);if(i&&i.length>0)switch(r){case"current":case"not-current":{let n=await hA(e.localStore,oP(i[0])),s=lb.createSynthesizedRemoteEventForCurrentChange(t,"current"===r,ap.EMPTY_BYTE_STRING);await dd(e,n,s);break}case"rejected":await hT(e.localStore,t,!0),dl(e,t,n);break;default:ii(64155,r)}}async function dE(e,t,r){let n=dT(e);if(n.gu){for(let e of t){if(n.Iu.has(e)&&n.sharedClientState.isActiveQueryTarget(e)){n9(cZ,"Adding an already active target "+e);continue}let t=await hC(n.localStore,e),r=await hE(n.localStore,t);await c5(n,d_(t),r.targetId,!1,r.resumeToken),cl(n.remoteStore,r)}for(let e of r)n.Iu.has(e)&&await hT(n.localStore,e,!1).then(()=>{cu(n.remoteStore,e),dl(n,e)}).catch(iZ)}}function dT(e){return e.remoteStore.remoteSyncer.applyRemoteEvent=de.bind(null,e),e.remoteStore.remoteSyncer.getRemoteKeysForTarget=dp.bind(null,e),e.remoteStore.remoteSyncer.rejectListen=dr.bind(null,e),e.Pu.J_=cj.bind(null,e.eventManager),e.Pu.yu=cz.bind(null,e.eventManager),e}function dS(e){return e.remoteStore.remoteSyncer.applySuccessfulWrite=dn.bind(null,e),e.remoteStore.remoteSyncer.rejectFailedWrite=di.bind(null,e),e}class dC{constructor(){this.kind="memory",this.synchronizeTabs=!1}async initialize(e){this.serializer=h4(e.databaseInfo.databaseId),this.sharedClientState=this.Du(e),this.persistence=this.Cu(e),await this.persistence.start(),this.localStore=this.vu(e),this.gcScheduler=this.Fu(e,this.localStore),this.indexBackfillerScheduler=this.Mu(e,this.localStore)}Fu(e,t){return null}Mu(e,t){return null}vu(e){var t,r;return t=this.persistence,r=new hy,new hv(t,r,e.initialUser,this.serializer)}Cu(e){return new hs(ho.Vi,this.serializer)}Du(e){return new h$}async terminate(){this.gcScheduler?.stop(),this.indexBackfillerScheduler?.stop(),this.sharedClientState.shutdown(),await this.persistence.shutdown()}}dC.provider={build:()=>new dC};class dA extends dC{constructor(e){super(),this.cacheSizeBytes=e}Fu(e,t){return ia(this.persistence.referenceDelegate instanceof hl,46915),new uW(this.persistence.referenceDelegate.garbageCollector,e.asyncQueue,t)}Cu(e){let t=void 0!==this.cacheSizeBytes?uM.withCacheSize(this.cacheSizeBytes):uM.DEFAULT;return new hs(e=>hl.Vi(e,t),this.serializer)}}class dk extends dC{constructor(e,t,r){super(),this.xu=e,this.cacheSizeBytes=t,this.forceOwnership=r,this.kind="persistent",this.synchronizeTabs=!1}async initialize(e){await super.initialize(e),await this.xu.initialize(this,e),await dS(this.xu.syncEngine),await cI(this.xu.remoteStore),await this.persistence.zi(()=>(this.gcScheduler&&!this.gcScheduler.started&&this.gcScheduler.start(),this.indexBackfillerScheduler&&!this.indexBackfillerScheduler.started&&this.indexBackfillerScheduler.start(),Promise.resolve()))}vu(e){var t,r;return t=this.persistence,r=new hy,new hv(t,r,e.initialUser,this.serializer)}Fu(e,t){return new uW(this.persistence.referenceDelegate.garbageCollector,e.asyncQueue,t)}Mu(e,t){let r=new si(t,this.persistence);return new sn(e.asyncQueue,r)}Cu(e){let t=hp(e.databaseInfo.databaseId,e.databaseInfo.persistenceKey),r=void 0!==this.cacheSizeBytes?uM.withCacheSize(this.cacheSizeBytes):uM.DEFAULT;return new hf(this.synchronizeTabs,t,e.clientId,r,e.asyncQueue,h6(),h3(),this.serializer,this.sharedClientState,!!this.forceOwnership)}Du(e){return new h$}}class dx extends dk{constructor(e,t){super(e,t,!1),this.xu=e,this.cacheSizeBytes=t,this.synchronizeTabs=!0}async initialize(e){await super.initialize(e);let t=this.xu.syncEngine;this.sharedClientState instanceof hz&&(this.sharedClientState.syncEngine={So:dy.bind(null,t),Do:db.bind(null,t),Co:dE.bind(null,t),hs:dI.bind(null,t),bo:dg.bind(null,t)},await this.sharedClientState.start()),await this.persistence.zi(async e=>{await dw(this.xu.syncEngine,e),this.gcScheduler&&(e&&!this.gcScheduler.started?this.gcScheduler.start():e||this.gcScheduler.stop()),this.indexBackfillerScheduler&&(e&&!this.indexBackfillerScheduler.started?this.indexBackfillerScheduler.start():e||this.indexBackfillerScheduler.stop())})}Du(e){let t=h6();if(!hz.v(t))throw new il(io.UNIMPLEMENTED,"IndexedDB persistence is only available on platforms that support LocalStorage.");let r=hp(e.databaseInfo.databaseId,e.databaseInfo.persistenceKey);return new hz(t,e.asyncQueue,r,e.clientId,e.initialUser)}}class dN{async initialize(e,t){this.localStore||(this.localStore=e.localStore,this.sharedClientState=e.sharedClientState,this.datastore=this.createDatastore(t),this.remoteStore=this.createRemoteStore(t),this.eventManager=this.createEventManager(t),this.syncEngine=this.createSyncEngine(t,!e.synchronizeTabs),this.sharedClientState.onlineStateHandler=e=>dt(this.syncEngine,e,1),this.remoteStore.remoteSyncer.handleCredentialChange=df.bind(null,this.syncEngine),await cx(this.remoteStore,this.syncEngine.isPrimaryClient))}createEventManager(e){return new cV}createDatastore(e){var t;let r=h4(e.databaseInfo.databaseId),n=new h2(e.databaseInfo);return t=e.authCredentials,new cr(t,e.appCheckCredentials,n,r)}createRemoteStore(e){var t,r;return t=this.localStore,r=this.datastore,new cs(t,r,e.asyncQueue,e=>dt(this.syncEngine,e,0),hH.v()?new hH:new hK)}createSyncEngine(e,t){var r,n,i,s,a,o;let l;return r=this.localStore,n=this.remoteStore,i=this.eventManager,s=this.sharedClientState,a=e.initialUser,o=e.maxConcurrentLimboResolutions,l=new c2(r,n,i,s,a,o),t&&(l.gu=!0),l}async terminate(){await async function(e){n9(ci,"RemoteStore shutting down."),e.Ea.add(5),await co(e),e.Aa.shutdown(),e.Va.set("Unknown")}(this.remoteStore),this.datastore?.terminate(),this.eventManager?.terminate()}}function dD(e,t=10240){let r=0;return{async read(){if(r<e.byteLength){let n={value:e.slice(r,r+t),done:!1};return r+=t,n}return{done:!0}},async cancel(){},releaseLock(){},closed:Promise.resolve()}}dN.provider={build:()=>new dN};class dR{constructor(e){this.observer=e,this.muted=!1}next(e){this.muted||this.observer.next&&this.Ou(this.observer.next,e)}error(e){this.muted||(this.observer.error?this.Ou(this.observer.error,e):ie("Uncaught Error in snapshot listener:",e.toString()))}Nu(){this.muted=!0}Ou(e,t){setTimeout(()=>{this.muted||e(t)},0)}}class dP{constructor(e,t){this.Bu=e,this.serializer=t,this.metadata=new iu,this.buffer=new Uint8Array,this.Lu=new TextDecoder("utf-8"),this.ku().then(e=>{e&&e.Ua()?this.metadata.resolve(e.qa.metadata):this.metadata.reject(Error(`The first element of the bundle is not a metadata, it is
             ${JSON.stringify(e?.qa)}`))},e=>this.metadata.reject(e))}close(){return this.Bu.cancel()}async getMetadata(){return this.metadata.promise}async Su(){return await this.getMetadata(),this.ku()}async ku(){let e=await this.Ku();if(null===e)return null;let t=this.Lu.decode(e),r=Number(t);return isNaN(r)&&this.qu(`length string (${t}) is not valid number`),new cG(JSON.parse(await this.Uu(r)),e.length+r)}$u(){return this.buffer.findIndex(e=>123===e)}async Ku(){for(;0>this.$u()&&!await this.Wu(););if(0===this.buffer.length)return null;let e=this.$u();e<0&&this.qu("Reached the end of bundle when a length string is expected.");let t=this.buffer.slice(0,e);return this.buffer=this.buffer.slice(e),t}async Uu(e){for(;this.buffer.length<e;)await this.Wu()&&this.qu("Reached the end of bundle when more is expected.");let t=this.Lu.decode(this.buffer.slice(0,e));return this.buffer=this.buffer.slice(e),t}qu(e){throw this.Bu.cancel(),Error(`Invalid bundle format: ${e}`)}async Wu(){let e=await this.Bu.read();if(!e.done){let t=new Uint8Array(this.buffer.length+e.value.length);t.set(this.buffer),t.set(e.value,this.buffer.length),this.buffer=t}return e.done}}class dO{constructor(e,t){this.bundleData=e,this.serializer=t,this.cursor=0,this.elements=[];let r=this.Su();if(!r||!r.Ua())throw Error(`The first element of the bundle is not a metadata object, it is
         ${JSON.stringify(r?.qa)}`);this.metadata=r;do null!==(r=this.Su())&&this.elements.push(r);while(null!==r)}getMetadata(){return this.metadata}Qu(){return this.elements}Su(){if(this.cursor===this.bundleData.length)return null;let e=this.Ku();return new cG(JSON.parse(this.Uu(e)),e)}Uu(e){if(this.cursor+e>this.bundleData.length)throw new il(io.INTERNAL,"Reached the end of bundle when more is expected.");return this.bundleData.slice(this.cursor,this.cursor+=e)}Ku(){let e=this.cursor,t=this.cursor;for(;t<this.bundleData.length;){if("{"===this.bundleData[t]){if(t===e)throw Error("First character is a bracket and not a number");return this.cursor=t,Number(this.bundleData.slice(e,t))}t++}throw Error("Reached the end of bundle when more is expected.")}}class dL{constructor(e){this.datastore=e,this.readVersions=new Map,this.mutations=[],this.committed=!1,this.lastTransactionError=null,this.writtenDocs=new Set}async lookup(e){if(this.ensureCommitNotCalled(),this.mutations.length>0)throw this.lastTransactionError=new il(io.INVALID_ARGUMENT,"Firestore transactions require all reads to be executed before all writes."),this.lastTransactionError;let t=await async function(e,t){let r={documents:t.map(t=>lj(e.serializer,t))},n=await e.jo("BatchGetDocuments",e.serializer.databaseId,iC.emptyPath(),r,t.length),i=new Map;n.forEach(t=>{var r;let n,s,a,o,l,u,h=(r=e.serializer,"found"in t?(ia(!!t.found,43571),t.found.name,t.found.updateTime,n=lz(r,t.found.name),s=lV(t.found.updateTime),a=t.found.createTime?lV(t.found.createTime):iB.min(),o=new a0({mapValue:{fields:t.found.fields}}),a1.newFoundDocument(n,s,a,o)):"missing"in t?(ia(!!t.missing,3894),ia(!!t.readTime,22933),l=lz(r,t.missing),u=lV(t.readTime),a1.newNoDocument(l,u)):ii(7234,{result:t}));i.set(h.key.toString(),h)});let s=[];return t.forEach(e=>{let t=i.get(e.toString());ia(!!t,55234,{key:e}),s.push(t)}),s}(this.datastore,e);return t.forEach(e=>this.recordVersion(e)),t}set(e,t){this.write(t.toMutation(e,this.precondition(e))),this.writtenDocs.add(e.toString())}update(e,t){try{this.write(t.toMutation(e,this.preconditionForUpdate(e)))}catch(e){this.lastTransactionError=e}this.writtenDocs.add(e.toString())}delete(e){this.write(new la(e,this.precondition(e))),this.writtenDocs.add(e.toString())}async commit(){if(this.ensureCommitNotCalled(),this.lastTransactionError)throw this.lastTransactionError;let e=this.readVersions;this.mutations.forEach(t=>{e.delete(t.key.toString())}),e.forEach((e,t)=>{let r=ix.fromPath(t);this.mutations.push(new lo(r,this.precondition(r)))}),await async function(e,t){let r={writes:t.map(t=>lJ(e.serializer,t))};await e.Wo("Commit",e.serializer.databaseId,iC.emptyPath(),r)}(this.datastore,this.mutations),this.committed=!0}recordVersion(e){let t;if(e.isFoundDocument())t=e.version;else{if(!e.isNoDocument())throw ii(50498,{Gu:e.constructor.name});t=iB.min()}let r=this.readVersions.get(e.key.toString());if(r){if(!t.isEqual(r))throw new il(io.ABORTED,"Document version changed between two reads.")}else this.readVersions.set(e.key.toString(),t)}precondition(e){let t=this.readVersions.get(e.toString());return!this.writtenDocs.has(e.toString())&&t?t.isEqual(iB.min())?o4.exists(!1):o4.updateTime(t):o4.none()}preconditionForUpdate(e){let t=this.readVersions.get(e.toString());if(!this.writtenDocs.has(e.toString())&&t){if(t.isEqual(iB.min()))throw new il(io.INVALID_ARGUMENT,"Can't update a document that doesn't exist.");return o4.updateTime(t)}return o4.exists(!0)}write(e){this.ensureCommitNotCalled(),this.mutations.push(e)}ensureCommitNotCalled(){}}class dM{constructor(e,t,r,n,i){this.asyncQueue=e,this.datastore=t,this.options=r,this.updateFunction=n,this.deferred=i,this.zu=r.maxAttempts,this.M_=new h5(this.asyncQueue,"transaction_retry")}ju(){this.zu-=1,this.Hu()}Hu(){this.M_.p_(async()=>{let e=new dL(this.datastore),t=this.Ju(e);t&&t.then(t=>{this.asyncQueue.enqueueAndForget(()=>e.commit().then(()=>{this.deferred.resolve(t)}).catch(e=>{this.Zu(e)}))}).catch(e=>{this.Zu(e)})})}Ju(e){try{let t=this.updateFunction(e);return!sa(t)&&t.catch&&t.then?t:(this.deferred.reject(Error("Transaction callback must return a Promise")),null)}catch(e){return this.deferred.reject(e),null}}Zu(e){this.zu>0&&this.Xu(e)?(this.zu-=1,this.asyncQueue.enqueueAndForget(()=>(this.Hu(),Promise.resolve()))):this.deferred.reject(e)}Xu(e){if("FirebaseError"===e?.name){let t=e.code;return"aborted"===t||"failed-precondition"===t||"already-exists"===t||!lf(t)}return!1}}let dF="FirestoreClient";class dV{constructor(e,t,r,n,i){this.authCredentials=e,this.appCheckCredentials=t,this.asyncQueue=r,this._databaseInfo=n,this.user=n4.UNAUTHENTICATED,this.clientId=iv.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this._uninitializedComponentsProvider=i,this.authCredentials.start(r,async e=>{n9(dF,"Received user=",e.uid),await this.authCredentialListener(e),this.user=e}),this.appCheckCredentials.start(r,e=>(n9(dF,"Received new app check token=",e),this.appCheckCredentialListener(e,this.user)))}get configuration(){return{asyncQueue:this.asyncQueue,databaseInfo:this._databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(e){this.authCredentialListener=e}setAppCheckTokenChangeListener(e){this.appCheckCredentialListener=e}terminate(){this.asyncQueue.enterRestrictedMode();let e=new iu;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted(async()=>{try{this._onlineComponents&&await this._onlineComponents.terminate(),this._offlineComponents&&await this._offlineComponents.terminate(),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),e.resolve()}catch(r){let t=cP(r,"Failed to shutdown persistence");e.reject(t)}}),e.promise}}async function dU(e,t){e.asyncQueue.verifyOperationInProgress(),n9(dF,"Initializing OfflineComponentProvider");let r=e.configuration;await t.initialize(r);let n=r.initialUser;e.setCredentialChangeListener(async e=>{n.isEqual(e)||(await h_(t.localStore,e),n=e)}),t.persistence.setDatabaseDeletedListener(()=>e.terminate()),e._offlineComponents=t}async function dB(e,t){e.asyncQueue.verifyOperationInProgress();let r=await dq(e);n9(dF,"Initializing OnlineComponentProvider"),await t.initialize(r,e.configuration),e.setCredentialChangeListener(e=>ck(t.remoteStore,e)),e.setAppCheckTokenChangeListener((e,r)=>ck(t.remoteStore,r)),e._onlineComponents=t}async function dq(e){if(!e._offlineComponents)if(e._uninitializedComponentsProvider){n9(dF,"Using user provided OfflineComponentProvider");try{await dU(e,e._uninitializedComponentsProvider._offline)}catch(t){if(!("FirebaseError"===t.name?t.code===io.FAILED_PRECONDITION||t.code===io.UNIMPLEMENTED:!("u">typeof DOMException&&t instanceof DOMException)||22===t.code||20===t.code||11===t.code))throw t;it("Error using user provided cache. Falling back to memory cache: "+t),await dU(e,new dC)}}else n9(dF,"Using default OfflineComponentProvider"),await dU(e,new dA(void 0));return e._offlineComponents}async function dj(e){return e._onlineComponents||(e._uninitializedComponentsProvider?(n9(dF,"Using user provided OnlineComponentProvider"),await dB(e,e._uninitializedComponentsProvider._online)):(n9(dF,"Using default OnlineComponentProvider"),await dB(e,new dN))),e._onlineComponents}function dz(e){return dq(e).then(e=>e.localStore)}function d$(e){return dj(e).then(e=>e.syncEngine)}function dK(e){return dj(e).then(e=>e.datastore)}async function dG(e){let t=await dj(e),r=t.eventManager;return r.onListen=c6.bind(null,t.syncEngine),r.onUnlisten=c8.bind(null,t.syncEngine),r.onFirstRemoteStoreListen=c3.bind(null,t.syncEngine),r.onLastRemoteStoreUnlisten=c7.bind(null,t.syncEngine),r}function dH(e,t,r={}){let n=new iu;return e.asyncQueue.enqueueAndForget(async()=>{var i,s;let a,o;return i=await dG(e),s=e.asyncQueue,a=new dR({next:e=>{a.Nu(),s.enqueueAndForget(()=>cq(i,o));let l=e.docs.has(t);!l&&e.fromCache?n.reject(new il(io.UNAVAILABLE,"Failed to get document because the client is offline.")):l&&e.fromCache&&r&&"server"===r.source?n.reject(new il(io.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):n.resolve(e)},error:e=>n.reject(e)}),cB(i,o=new cK(oI(t.path),a,{includeMetadataChanges:!0,Ka:!0}))}),n.promise}function dW(e,t,r={}){let n=new iu;return e.asyncQueue.enqueueAndForget(async()=>{var i,s;let a,o;return i=await dG(e),s=e.asyncQueue,o=new cK(t,a=new dR({next:e=>{a.Nu(),s.enqueueAndForget(()=>cq(i,o)),e.fromCache&&"server"===r.source?n.reject(new il(io.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):n.resolve(e)},error:e=>n.reject(e)}),{includeMetadataChanges:!0,Ka:!0}),cB(i,o)}),n.promise}function dQ(e){let t={};return void 0!==e.timeoutSeconds&&(t.timeoutSeconds=e.timeoutSeconds),t}let dJ=new Map,dY="firestore.googleapis.com";class dX{constructor(e){if(void 0===e.host){if(void 0!==e.ssl)throw new il(io.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host=dY,this.ssl=!0}else this.host=e.host,this.ssl=e.ssl??!0;if(this.isUsingEmulator=void 0!==e.emulatorOptions,this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,this.localCache=e.localCache,void 0===e.cacheSizeBytes)this.cacheSizeBytes=0x2800000;else{if(-1!==e.cacheSizeBytes&&e.cacheSizeBytes<1048576)throw new il(io.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=e.cacheSizeBytes}(function(e,t,r,n){if(!0===t&&!0===n)throw new il(io.INVALID_ARGUMENT,`${e} and ${r} cannot be used together.`)})("experimentalForceLongPolling",e.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",e.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:void 0===e.experimentalAutoDetectLongPolling?this.experimentalAutoDetectLongPolling=!0:this.experimentalAutoDetectLongPolling=!!e.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=dQ(e.experimentalLongPollingOptions??{}),function(e){if(void 0!==e.timeoutSeconds){if(isNaN(e.timeoutSeconds))throw new il(io.INVALID_ARGUMENT,`invalid long polling timeout: ${e.timeoutSeconds} (must not be NaN)`);if(e.timeoutSeconds<5)throw new il(io.INVALID_ARGUMENT,`invalid long polling timeout: ${e.timeoutSeconds} (minimum allowed value is 5)`);if(e.timeoutSeconds>30)throw new il(io.INVALID_ARGUMENT,`invalid long polling timeout: ${e.timeoutSeconds} (maximum allowed value is 30)`)}}(this.experimentalLongPollingOptions),this.useFetchStreams=!!e.useFetchStreams}isEqual(e){var t,r;return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&(t=this.experimentalLongPollingOptions,r=e.experimentalLongPollingOptions,t.timeoutSeconds===r.timeoutSeconds)&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams}}class dZ{constructor(e,t,r,n){this._authCredentials=e,this._appCheckCredentials=t,this._databaseId=r,this._app=n,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new dX({}),this._settingsFrozen=!1,this._emulatorOptions={},this._terminateTask="notTerminated"}get app(){if(!this._app)throw new il(io.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return"notTerminated"!==this._terminateTask}_setSettings(e){if(this._settingsFrozen)throw new il(io.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new dX(e),this._emulatorOptions=e.emulatorOptions||{},void 0!==e.credentials&&(this._authCredentials=function(e){if(!e)return new ic;switch(e.type){case"firstParty":return new ig(e.sessionIndex||"0",e.iamToken||null,e.authTokenFactory||null);case"provider":return e.client;default:throw new il(io.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}(e.credentials))}_getSettings(){return this._settings}_getEmulatorOptions(){return this._emulatorOptions}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return"notTerminated"===this._terminateTask&&(this._terminateTask=this._terminate()),this._terminateTask}async _restart(){"notTerminated"===this._terminateTask?await this._terminate():this._terminateTask="notTerminated"}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){let e;return(e=dJ.get(this))&&(n9("ComponentProvider","Removing Datastore"),dJ.delete(this),e.terminate()),Promise.resolve()}}class d0{constructor(e,t,r){this.converter=t,this._query=r,this.type="query",this.firestore=e}withConverter(e){return new d0(this.firestore,e,this._query)}}class d1{constructor(e,t,r){this.converter=t,this._key=r,this.type="document",this.firestore=e}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new d2(this.firestore,this.converter,this._key.path.popLast())}withConverter(e){return new d1(this.firestore,e,this._key)}toJSON(){return{type:d1._jsonSchemaVersion,referencePath:this._key.toString()}}static fromJSON(e,t,r){if(iV(t,d1._jsonSchema))return new d1(e,r||null,new ix(iC.fromString(t.referencePath)))}}d1._jsonSchemaVersion="firestore/documentReference/1.0",d1._jsonSchema={type:iF("string",d1._jsonSchemaVersion),referencePath:iF("string")};class d2 extends d0{constructor(e,t,r){super(e,t,oI(r)),this._path=r,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){let e=this._path.popLast();return e.isEmpty()?null:new d1(this.firestore,null,new ix(e))}withConverter(e){return new d2(this.firestore,e,this._path)}}function d6(e,t,...r){if(e=ei(e),iN("collection","path",t),e instanceof dZ){let n=iC.fromString(t,...r);return iR(n),new d2(e,null,n)}{if(!(e instanceof d1||e instanceof d2))throw new il(io.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");let n=e._path.child(iC.fromString(t,...r));return iR(n),new d2(e.firestore,null,n)}}function d3(e,t,...r){if(e=ei(e),1==arguments.length&&(t=iv.newId()),iN("doc","path",t),e instanceof dZ){let n=iC.fromString(t,...r);return iD(n),new d1(e,null,new ix(n))}{if(!(e instanceof d1||e instanceof d2))throw new il(io.INVALID_ARGUMENT,"Expected first argument to doc() to be a CollectionReference, a DocumentReference or FirebaseFirestore");let n=e._path.child(iC.fromString(t,...r));return iD(n),new d1(e.firestore,e instanceof d2?e.converter:null,new ix(n))}}function d4(e,t){return e=ei(e),t=ei(t),e instanceof d0&&t instanceof d0&&e.firestore===t.firestore&&ox(e._query,t._query)&&e.converter===t.converter}let d5="AsyncQueue";class d8{constructor(e=Promise.resolve()){this.Yu=[],this.ec=!1,this.tc=[],this.nc=null,this.rc=!1,this.sc=!1,this.oc=[],this.M_=new h5(this,"async_queue_retry"),this._c=()=>{let e=h3();e&&n9(d5,"Visibility state changed to "+e.visibilityState),this.M_.w_()},this.ac=e;const t=h3();t&&"function"==typeof t.addEventListener&&t.addEventListener("visibilitychange",this._c)}get isShuttingDown(){return this.ec}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.uc(),this.cc(e)}enterRestrictedMode(e){if(!this.ec){this.ec=!0,this.sc=e||!1;let t=h3();t&&"function"==typeof t.removeEventListener&&t.removeEventListener("visibilitychange",this._c)}}enqueue(e){if(this.uc(),this.ec)return new Promise(()=>{});let t=new iu;return this.cc(()=>this.ec&&this.sc?Promise.resolve():(e().then(t.resolve,t.reject),t.promise)).then(()=>t.promise)}enqueueRetryable(e){this.enqueueAndForget(()=>(this.Yu.push(e),this.lc()))}async lc(){if(0!==this.Yu.length){try{await this.Yu[0](),this.Yu.shift(),this.M_.reset()}catch(e){if(!i8(e))throw e;n9(d5,"Operation failed with retryable error: "+e)}this.Yu.length>0&&this.M_.p_(()=>this.lc())}}cc(e){let t=this.ac.then(()=>(this.rc=!0,e().catch(e=>{throw this.nc=e,this.rc=!1,ie("INTERNAL UNHANDLED ERROR: ",d7(e)),e}).then(e=>(this.rc=!1,e))));return this.ac=t,t}enqueueAfterDelay(e,t,r){this.uc(),this.oc.indexOf(e)>-1&&(t=0);let n=cR.createAndSchedule(this,e,t,r,e=>this.hc(e));return this.tc.push(n),n}uc(){this.nc&&ii(47125,{Pc:d7(this.nc)})}verifyOperationInProgress(){}async Tc(){let e;do e=this.ac,await e;while(e!==this.ac)}Ic(e){for(let t of this.tc)if(t.timerId===e)return!0;return!1}Ec(e){return this.Tc().then(()=>{for(let t of(this.tc.sort((e,t)=>e.targetTimeMs-t.targetTimeMs),this.tc))if(t.skipDelay(),"all"!==e&&t.timerId===e)break;return this.Tc()})}Rc(e){this.oc.push(e)}hc(e){let t=this.tc.indexOf(e);this.tc.splice(t,1)}}function d7(e){let t=e.message||"";return e.stack&&(t=e.stack.includes(e.message)?e.stack:e.message+"\n"+e.stack),t}class d9{constructor(){this._progressObserver={},this._taskCompletionResolver=new iu,this._lastProgress={taskState:"Running",totalBytes:0,totalDocuments:0,bytesLoaded:0,documentsLoaded:0}}onProgress(e,t,r){this._progressObserver={next:e,error:t,complete:r}}catch(e){return this._taskCompletionResolver.promise.catch(e)}then(e,t){return this._taskCompletionResolver.promise.then(e,t)}_completeWith(e){this._updateProgress(e),this._progressObserver.complete&&this._progressObserver.complete(),this._taskCompletionResolver.resolve(e)}_failWith(e){this._lastProgress.taskState="Error",this._progressObserver.next&&this._progressObserver.next(this._lastProgress),this._progressObserver.error&&this._progressObserver.error(e),this._taskCompletionResolver.reject(e)}_updateProgress(e){this._lastProgress=e,this._progressObserver.next&&this._progressObserver.next(e)}}class fe extends dZ{constructor(e,t,r,n){super(e,t,r,n),this.type="firestore",this._queue=new d8,this._persistenceKey=n?.name||"[DEFAULT]"}async _terminate(){if(this._firestoreClient){let e=this._firestoreClient.terminate();this._queue=new d8(e),this._firestoreClient=void 0,await e}}}function ft(e,t){let r=eU("object"==typeof e?e:eX(),"firestore").getImmediate({identifier:"string"==typeof e?e:t||aA});if(!r._initialized){let e=(e=>{let t=P(e);if(!t)return;let r=t.lastIndexOf(":");if(r<=0||r+1===t.length)throw Error(`Invalid host ${t} with no separate hostname and port!`);let n=parseInt(t.substring(r+1),10);return"["===t[0]?[t.substring(1,r-1),n]:[t.substring(0,r),n]})("firestore");e&&function(e,t,r,n={}){e=iL(e,dZ);let i=F(t),s=e._getSettings(),a={...s,emulatorOptions:e._getEmulatorOptions()},o=`${t}:${r}`;i&&(V(`https://${o}`),q("Firestore",!0)),s.host!==dY&&s.host!==o&&it("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used.");let l={...s,host:o,ssl:i,emulatorOptions:n};if(!Y(l,a)&&(e._setSettings(l),n.mockUserToken)){let t,r;if("string"==typeof n.mockUserToken)t=n.mockUserToken,r=n4.MOCK_USER;else{t=function(e,t){if(e.uid)throw Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');let r=t||"demo-project",n=e.iat||0,i=e.sub||e.user_id;if(!i)throw Error("mockUserToken must contain 'sub' or 'user_id' field!");let s={iss:`https://securetoken.google.com/${r}`,aud:r,iat:n,exp:n+3600,auth_time:n,sub:i,user_id:i,firebase:{sign_in_provider:"custom",identities:{}},...e};return[x(JSON.stringify({alg:"none",type:"JWT"})),x(JSON.stringify(s)),""].join(".")}(n.mockUserToken,e._app?.options.projectId);let i=n.mockUserToken.sub||n.mockUserToken.user_id;if(!i)throw new il(io.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");r=new n4(i)}e._authCredentials=new id(new ih(t,r))}}(r,...e)}return r}function fr(e){if(e._terminated)throw new il(io.FAILED_PRECONDITION,"The client has already been terminated.");return e._firestoreClient||function(e){var t,r,n,i,s;let a,o=e._freezeSettings(),l=(t=e._databaseId,r=e._app?.options.appId||"",n=e._persistenceKey,i=e._app?.options.apiKey,new aC(t,r,n,o.host,o.ssl,o.experimentalForceLongPolling,o.experimentalAutoDetectLongPolling,dQ(o.experimentalLongPollingOptions),o.useFetchStreams,o.isUsingEmulator,i));e._componentsProvider||o.localCache?._offlineComponentProvider&&o.localCache?._onlineComponentProvider&&(e._componentsProvider={_offline:o.localCache._offlineComponentProvider,_online:o.localCache._onlineComponentProvider}),e._firestoreClient=new dV(e._authCredentials,e._appCheckCredentials,e._queue,l,e._componentsProvider&&(s=e._componentsProvider,a=s?._online.build(),{_offline:s?._offline.build(a),_online:a}))}(e),e._firestoreClient}function fn(e,t){let r=fr(e=iL(e,fe)),n=new d9;return function(e,t,r,n){var i;let s=(i=h4(t),new dP(function(e,t){if(e instanceof Uint8Array)return dD(e,void 0);if(e instanceof ArrayBuffer)return dD(new Uint8Array(e),void 0);if(e instanceof ReadableStream)return e.getReader();throw Error("Source of `toByteStreamReader` has to be a ArrayBuffer or ReadableStream")}("string"==typeof r?lg().encode(r):r),i));e.asyncQueue.enqueueAndForget(async()=>{var t;(async function(e,t,r){try{var n,i;let s,a=await t.getMetadata();if(await (n=e.localStore,s=lV(a.createTime),n.persistence.runTransaction("hasNewerBundle","readonly",e=>n.Pi.getBundleMetadata(e,a.id)).then(e=>!!e&&e.createTime.compareTo(s)>=0)))return await t.close(),r._completeWith({taskState:"Success",documentsLoaded:a.totalDocuments,bytesLoaded:a.totalBytes,totalDocuments:a.totalDocuments,totalBytes:a.totalBytes}),Promise.resolve(new Set);r._updateProgress(cQ(a));let o=new cW(a,t.serializer),l=await t.Su();for(;l;){let e=await o.Ga(l);e&&r._updateProgress(e),l=await t.Su()}let u=await o.ja(e.localStore);return await dd(e,u.Ja,void 0),await (i=e.localStore,i.persistence.runTransaction("Save bundle","readwrite",e=>i.Pi.saveBundleMetadata(e,a))),r._completeWith(u.progress),Promise.resolve(u.Ha)}catch(e){return it(cZ,`Loading bundle failed with ${e}`),r._failWith(e),Promise.resolve(new Set)}})(t=await d$(e),s,n).then(e=>{t.sharedClientState.notifyBundleLoaded(e)})})}(r,e._databaseId,t,n),n}class fi{constructor(e){this._byteString=e}static fromBase64String(e){try{return new fi(ap.fromBase64String(e))}catch(e){throw new il(io.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+e)}}static fromUint8Array(e){return new fi(ap.fromUint8Array(e))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(e){return this._byteString.isEqual(e._byteString)}toJSON(){return{type:fi._jsonSchemaVersion,bytes:this.toBase64()}}static fromJSON(e){if(iV(e,fi._jsonSchema))return fi.fromBase64String(e.bytes)}}fi._jsonSchemaVersion="firestore/bytes/1.0",fi._jsonSchema={type:iF("string",fi._jsonSchemaVersion),bytes:iF("string")};class fs{constructor(...e){for(let t=0;t<e.length;++t)if(0===e[t].length)throw new il(io.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new ik(e)}isEqual(e){return this._internalPath.isEqual(e._internalPath)}}class fa{constructor(e){this._methodName=e}}class fo{constructor(e,t){if(!isFinite(e)||e<-90||e>90)throw new il(io.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(t)||t<-180||t>180)throw new il(io.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+t);this._lat=e,this._long=t}get latitude(){return this._lat}get longitude(){return this._long}isEqual(e){return this._lat===e._lat&&this._long===e._long}_compareTo(e){return i_(this._lat,e._lat)||i_(this._long,e._long)}toJSON(){return{latitude:this._lat,longitude:this._long,type:fo._jsonSchemaVersion}}static fromJSON(e){if(iV(e,fo._jsonSchema))return new fo(e.latitude,e.longitude)}}fo._jsonSchemaVersion="firestore/geoPoint/1.0",fo._jsonSchema={type:iF("string",fo._jsonSchemaVersion),latitude:iF("number"),longitude:iF("number")};class fl{constructor(e){this._values=(e||[]).map(e=>e)}toArray(){return this._values.map(e=>e)}isEqual(e){return function(e,t){if(e.length!==t.length)return!1;for(let r=0;r<e.length;++r)if(e[r]!==t[r])return!1;return!0}(this._values,e._values)}toJSON(){return{type:fl._jsonSchemaVersion,vectorValues:this._values}}static fromJSON(e){if(iV(e,fl._jsonSchema)){if(Array.isArray(e.vectorValues)&&e.vectorValues.every(e=>"number"==typeof e))return new fl(e.vectorValues);throw new il(io.INVALID_ARGUMENT,"Expected 'vectorValues' field to be a number array")}}}fl._jsonSchemaVersion="firestore/vectorValue/1.0",fl._jsonSchema={type:iF("string",fl._jsonSchemaVersion),vectorValues:iF("object")};let fu=/^__.*__$/;class fh{constructor(e,t,r){this.data=e,this.fieldMask=t,this.fieldTransforms=r}toMutation(e,t){return null!==this.fieldMask?new lr(e,this.data,this.fieldMask,t,this.fieldTransforms):new lt(e,this.data,t,this.fieldTransforms)}}class fc{constructor(e,t,r){this.data=e,this.fieldMask=t,this.fieldTransforms=r}toMutation(e,t){return new lr(e,this.data,this.fieldMask,t,this.fieldTransforms)}}function fd(e){switch(e){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw ii(40011,{dataSource:e})}}class ff{constructor(e,t,r,n,i,s){this.settings=e,this.databaseId=t,this.serializer=r,this.ignoreUndefinedProperties=n,void 0===i&&this.validatePath(),this.fieldTransforms=i||[],this.fieldMask=s||[]}get path(){return this.settings.path}get dataSource(){return this.settings.dataSource}contextWith(e){return new ff({...this.settings,...e},this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}childContextForField(e){let t=this.path?.child(e),r=this.contextWith({path:t,arrayElement:!1});return r.validatePathSegment(e),r}childContextForFieldPath(e){let t=this.path?.child(e),r=this.contextWith({path:t,arrayElement:!1});return r.validatePath(),r}childContextForArray(e){return this.contextWith({path:void 0,arrayElement:!0})}createError(e){return fk(e,this.settings.methodName,this.settings.hasConverter||!1,this.path,this.settings.targetDoc)}contains(e){return void 0!==this.fieldMask.find(t=>e.isPrefixOf(t))||void 0!==this.fieldTransforms.find(t=>e.isPrefixOf(t.field))}validatePath(){if(this.path)for(let e=0;e<this.path.length;e++)this.validatePathSegment(this.path.get(e))}validatePathSegment(e){if(0===e.length)throw this.createError("Document fields must not be empty");if(fd(this.dataSource)&&fu.test(e))throw this.createError('Document fields cannot begin and end with "__"')}}class fp{constructor(e,t,r){this.databaseId=e,this.ignoreUndefinedProperties=t,this.serializer=r||h4(e)}createContext(e,t,r,n=!1){return new ff({dataSource:e,methodName:t,targetDoc:r,path:ik.emptyPath(),arrayElement:!1,hasConverter:n},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}}function fm(e){let t=e._freezeSettings(),r=h4(e._databaseId);return new fp(e._databaseId,!!t.ignoreUndefinedProperties,r)}function fg(e,t,r,n,i,s={}){let a,o,l=e.createContext(s.merge||s.mergeFields?2:0,t,r,i);fT("Data must be an object, but it was:",l,n);let u=fb(n,l);if(s.merge)a=new ad(l.fieldMask),o=l.fieldTransforms;else if(s.mergeFields){let e=[];for(let n of s.mergeFields){let i=fS(t,n,r);if(!l.contains(i))throw new il(io.INVALID_ARGUMENT,`Field '${i}' is specified in your field mask but missing from your input data.`);fx(e,i)||e.push(i)}a=new ad(e),o=l.fieldTransforms.filter(e=>a.covers(e.field))}else a=null,o=l.fieldTransforms;return new fh(new a0(u),a,o)}class fy extends fa{_toFieldTransform(e){if(2!==e.dataSource)throw 1===e.dataSource?e.createError(`${this._methodName}() can only appear at the top level of your update data`):e.createError(`${this._methodName}() cannot be used with set() unless you pass {merge:true}`);return e.fieldMask.push(e.path),null}isEqual(e){return e instanceof fy}}function fw(e,t,r,n){let i=e.createContext(1,t,r);fT("Data must be an object, but it was:",i,n);let s=[],a=a0.empty();return ai(n,(e,n)=>{let o=fA(t,e,r);n=ei(n);let l=i.childContextForFieldPath(o);if(n instanceof fy)s.push(o);else{let e=fI(n,l);null!=e&&(s.push(o),a.set(o,e))}}),new fc(a,new ad(s),i.fieldTransforms)}function fv(e,t,r,n,i,s){let a=e.createContext(1,t,r),o=[fS(t,n,r)],l=[i];if(s.length%2!=0)throw new il(io.INVALID_ARGUMENT,`Function ${t}() needs to be called with an even number of arguments that alternate between field names and values.`);for(let e=0;e<s.length;e+=2)o.push(fS(t,s[e])),l.push(s[e+1]);let u=[],h=a0.empty();for(let e=o.length-1;e>=0;--e)if(!fx(u,o[e])){let t=o[e],r=l[e];r=ei(r);let n=a.childContextForFieldPath(t);if(r instanceof fy)u.push(t);else{let e=fI(r,n);null!=e&&(u.push(t),h.set(t,e))}}return new fc(h,new ad(u),a.fieldTransforms)}function f_(e,t,r,n=!1){return fI(r,e.createContext(n?4:3,t))}function fI(e,t){if(fE(e=ei(e)))return fT("Unsupported field value:",t,e),fb(e,t);if(e instanceof fa)return function(e,t){if(!fd(t.dataSource))throw t.createError(`${e._methodName}() can only be used with update() and set()`);if(!t.path)throw t.createError(`${e._methodName}() is not currently supported inside arrays`);let r=e._toFieldTransform(t);r&&t.fieldTransforms.push(r)}(e,t),null;if(void 0===e&&t.ignoreUndefinedProperties)return null;if(t.path&&t.fieldMask.push(t.path),e instanceof Array){if(t.settings.arrayElement&&4!==t.dataSource)throw t.createError("Nested arrays are not supported");let r=[],n=0;for(let i of e){let e=fI(i,t.childContextForArray(n));null==e&&(e={nullValue:"NULL_VALUE"}),r.push(e),n++}return{arrayValue:{values:r}}}return function(e,t){var r,n,i;if(null===(e=ei(e)))return{nullValue:"NULL_VALUE"};if("number"==typeof e)return r=t.serializer,sl(n=e)?oG(n):oK(r,n);if("boolean"==typeof e)return{booleanValue:e};if("string"==typeof e)return{stringValue:e};if(e instanceof Date){let r=iU.fromDate(e);return{timestampValue:lM(t.serializer,r)}}if(e instanceof iU){let r=new iU(e.seconds,1e3*Math.floor(e.nanoseconds/1e3));return{timestampValue:lM(t.serializer,r)}}if(e instanceof fo)return{geoPointValue:{latitude:e.latitude,longitude:e.longitude}};if(e instanceof fi)return{bytesValue:lF(t.serializer,e._byteString)};if(e instanceof d1){let r=t.databaseId,n=e.firestore._databaseId;if(!n.isEqual(r))throw t.createError(`Document reference is for database ${n.projectId}/${n.database} but should be for database ${r.projectId}/${r.database}`);return{referenceValue:lU(e.firestore._databaseId||t.databaseId,e._key.path)}}if(e instanceof fl)return{mapValue:{fields:{[ax]:{stringValue:aR},[aP]:{arrayValue:{values:((i=e)instanceof fl?i.toArray():i).map(e=>{if("number"!=typeof e)throw t.createError("VectorValues must only contain numeric values.");return oK(t.serializer,e)})}}}}};if(l3(e))return e._toProto(t.serializer);throw t.createError(`Unsupported field value: ${iO(e)}`)}(e,t)}function fb(e,t){let r={};return as(e)?t.path&&t.path.length>0&&t.fieldMask.push(t.path):ai(e,(e,n)=>{let i=fI(n,t.childContextForField(e));null!=i&&(r[e]=i)}),{mapValue:{fields:r}}}function fE(e){return!("object"!=typeof e||null===e||e instanceof Array||e instanceof Date||e instanceof iU||e instanceof fo||e instanceof fi||e instanceof d1||e instanceof fa||e instanceof fl||l3(e))}function fT(e,t,r){if(!fE(r)||!iP(r)){let n=iO(r);throw"an object"===n?t.createError(e+" a custom object"):t.createError(e+" "+n)}}function fS(e,t,r){if((t=ei(t))instanceof fs)return t._internalPath;if("string"==typeof t)return fA(e,t);throw fk("Field path arguments must be of type string or ",e,!1,void 0,r)}let fC=RegExp("[~\\*/\\[\\]]");function fA(e,t,r){if(t.search(fC)>=0)throw fk(`Invalid field path (${t}). Paths must not contain '~', '*', '/', '[', or ']'`,e,!1,void 0,r);try{return new fs(...t.split("."))._internalPath}catch(n){throw fk(`Invalid field path (${t}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,e,!1,void 0,r)}}function fk(e,t,r,n,i){let s=n&&!n.isEmpty(),a=void 0!==i,o=`Function ${t}() called with invalid data`;r&&(o+=" (via `toFirestore()`)"),o+=". ";let l="";return(s||a)&&(l+=" (found",s&&(l+=` in field ${n}`),a&&(l+=` in document ${i}`),l+=")"),new il(io.INVALID_ARGUMENT,o+e+l)}function fx(e,t){return e.some(e=>e.isEqual(t))}class fN{convertValue(e,t="none"){switch(aL(e)){case 0:return null;case 1:return e.booleanValue;case 2:return ay(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,t);case 5:return e.stringValue;case 6:return this.convertBytes(aw(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,t);case 11:return this.convertObject(e.mapValue,t);case 10:return this.convertVectorValue(e.mapValue);default:throw ii(62114,{value:e})}}convertObject(e,t){return this.convertObjectMap(e.fields,t)}convertObjectMap(e,t="none"){let r={};return ai(e,(e,n)=>{r[e]=this.convertValue(n,t)}),r}convertVectorValue(e){return new fl(e.fields?.[aP].arrayValue?.values?.map(e=>ay(e.doubleValue)))}convertGeoPoint(e){return new fo(ay(e.latitude),ay(e.longitude))}convertArray(e,t){return(e.values||[]).map(e=>this.convertValue(e,t))}convertServerTimestamp(e,t){switch(t){case"previous":let r=aT(e);return null==r?null:this.convertValue(r,t);case"estimate":return this.convertTimestamp(aS(e));default:return null}}convertTimestamp(e){let t=ag(e);return new iU(t.seconds,t.nanos)}convertDocumentKey(e,t){let r=iC.fromString(e);ia(l6(r),9688,{name:e});let n=new ak(r.get(1),r.get(3)),i=new ix(r.popFirst(5));return n.isEqual(t)||ie(`Document ${i} contains a document reference within a different database (${n.projectId}/${n.database}) which is not supported. It will be treated as a reference in the current database (${t.projectId}/${t.database}) instead.`),i}}class fD extends fN{constructor(e){super(),this.firestore=e}convertBytes(e){return new fi(e)}convertReference(e){let t=this.convertDocumentKey(e,this.firestore._databaseId);return new d1(this.firestore,null,t)}}let fR="@firebase/firestore",fP="4.11.0";function fO(e){if("object"!=typeof e||null===e)return!1;for(let t of["next","error","complete"])if(t in e&&"function"==typeof e[t])return!0;return!1}class fL{constructor(e="count",t){this._internalFieldPath=t,this.type="AggregateField",this.aggregateType=e}}class fM{constructor(e,t,r){this._userDataWriter=t,this._data=r,this.type="AggregateQuerySnapshot",this.query=e}data(){return this._userDataWriter.convertObjectMap(this._data)}_fieldsProto(){return new a0({mapValue:{fields:this._data}}).clone().value.mapValue.fields}}class fF{constructor(e,t,r,n,i){this._firestore=e,this._userDataWriter=t,this._key=r,this._document=n,this._converter=i}get id(){return this._key.path.lastSegment()}get ref(){return new d1(this._firestore,this._converter,this._key)}exists(){return null!==this._document}data(){if(this._document){if(this._converter){let e=new fV(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}return this._userDataWriter.convertValue(this._document.data.value)}}_fieldsProto(){return this._document?.data.clone().value.mapValue.fields??void 0}get(e){if(this._document){let t=this._document.data.field(fS("DocumentSnapshot.get",e));if(null!==t)return this._userDataWriter.convertValue(t)}}}class fV extends fF{data(){return super.data()}}function fU(e){if("L"===e.limitType&&0===e.explicitOrderBy.length)throw new il(io.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}class fB{}class fq extends fB{}function fj(e,t,...r){let n=[];for(let i of(t instanceof fB&&n.push(t),function(e){let t=e.filter(e=>e instanceof fK).length,r=e.filter(e=>e instanceof fz).length;if(t>1||t>0&&r>0)throw new il(io.INVALID_ARGUMENT,"InvalidQuery. When using composite filters, you cannot use more than one filter at the top level. Consider nesting the multiple filters within an `and(...)` statement. For example: change `query(query, where(...), or(...))` to `query(query, and(where(...), or(...)))`.")}(n=n.concat(r)),n))e=i._apply(e);return e}class fz extends fq{constructor(e,t,r){super(),this._field=e,this._op=t,this._value=r,this.type="where"}static _create(e,t,r){return new fz(e,t,r)}_apply(e){let t=this._parse(e);return f7(e._query,t),new d0(e.firestore,e.converter,oA(e._query,t))}_parse(e){let t=fm(e.firestore);return function(e,t,r,n,i,s,a){let o;if(i.isKeyField()){if("array-contains"===s||"array-contains-any"===s)throw new il(io.INVALID_ARGUMENT,`Invalid Query. You can't perform '${s}' queries on documentId().`);if("in"===s||"not-in"===s){f8(a,s);let t=[];for(let r of a)t.push(f5(n,e,r));o={arrayValue:{values:t}}}else o=f5(n,e,a)}else"in"!==s&&"not-in"!==s&&"array-contains-any"!==s||f8(a,s),o=f_(r,t,a,"in"===s||"not-in"===s);return a8.create(i,s,o)}(e._query,"where",t,e.firestore._databaseId,this._field,this._op,this._value)}}function f$(e,t,r){let n=fS("where",e);return fz._create(n,t,r)}class fK extends fB{constructor(e,t){super(),this.type=e,this._queryConstraints=t}static _create(e,t){return new fK(e,t)}_parse(e){let t=this._queryConstraints.map(t=>t._parse(e)).filter(e=>e.getFilters().length>0);return 1===t.length?t[0]:a7.create(t,this._getOperator())}_apply(e){let t=this._parse(e);return 0===t.getFilters().length?e:(function(e,t){let r=e;for(let e of t.getFlattenedFilters())f7(r,e),r=oA(r,e)}(e._query,t),new d0(e.firestore,e.converter,oA(e._query,t)))}_getQueryConstraints(){return this._queryConstraints}_getOperator(){return"and"===this.type?"and":"or"}}function fG(...e){return e.forEach(e=>f9("or",e)),fK._create("or",e)}function fH(...e){return e.forEach(e=>f9("and",e)),fK._create("and",e)}class fW extends fq{constructor(e,t){super(),this._field=e,this._direction=t,this.type="orderBy"}static _create(e,t){return new fW(e,t)}_apply(e){var t;let r,n=function(e,t,r){if(null!==e.startAt)throw new il(io.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(null!==e.endAt)throw new il(io.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");return new a4(t,r)}(e._query,this._field,this._direction);return new d0(e.firestore,e.converter,(t=e._query,r=t.explicitOrderBy.concat([n]),new o_(t.path,t.collectionGroup,r,t.filters.slice(),t.limit,t.limitType,t.startAt,t.endAt)))}}function fQ(e,t="asc"){let r=fS("orderBy",e);return fW._create(r,t)}class fJ extends fq{constructor(e,t,r){super(),this.type=e,this._limit=t,this._limitType=r}static _create(e,t,r){return new fJ(e,t,r)}_apply(e){return new d0(e.firestore,e.converter,ok(e._query,this._limit,this._limitType))}}function fY(e){return iM("limit",e),fJ._create("limit",e,"F")}function fX(e){return iM("limitToLast",e),fJ._create("limitToLast",e,"L")}class fZ extends fq{constructor(e,t,r){super(),this.type=e,this._docOrFields=t,this._inclusive=r}static _create(e,t,r){return new fZ(e,t,r)}_apply(e){var t;let r=f4(e,this.type,this._docOrFields,this._inclusive);return new d0(e.firestore,e.converter,(t=e._query,new o_(t.path,t.collectionGroup,t.explicitOrderBy.slice(),t.filters.slice(),t.limit,t.limitType,r,t.endAt)))}}function f0(...e){return fZ._create("startAt",e,!0)}function f1(...e){return fZ._create("startAfter",e,!1)}class f2 extends fq{constructor(e,t,r){super(),this.type=e,this._docOrFields=t,this._inclusive=r}static _create(e,t,r){return new f2(e,t,r)}_apply(e){var t;let r=f4(e,this.type,this._docOrFields,this._inclusive);return new d0(e.firestore,e.converter,(t=e._query,new o_(t.path,t.collectionGroup,t.explicitOrderBy.slice(),t.filters.slice(),t.limit,t.limitType,t.startAt,r)))}}function f6(...e){return f2._create("endBefore",e,!1)}function f3(...e){return f2._create("endAt",e,!0)}function f4(e,t,r,n){if(r[0]=ei(r[0]),r[0]instanceof fF)return function(e,t,r,n,i){if(!n)throw new il(io.NOT_FOUND,`Can't use a DocumentSnapshot that doesn't exist for ${r}().`);let s=[];for(let r of oT(e))if(r.field.isKeyField())s.push(aj(t,n.key));else{let e=n.data.field(r.field);if(aE(e))throw new il(io.INVALID_ARGUMENT,'Invalid query. You are trying to start or end a query using a document for which the field "'+r.field+'" is an uncommitted server timestamp. (Since the value of this field is unknown, you cannot start/end a query with it.)');if(null===e){let e=r.field.canonicalString();throw new il(io.INVALID_ARGUMENT,`Invalid query. You are trying to start or end a query using a document for which the field '${e}' (used as the orderBy) does not exist.`)}s.push(e)}return new a2(s,i)}(e._query,e.firestore._databaseId,t,r[0]._document,n);{let i=fm(e.firestore);return function(e,t,r,n,i,s){let a=e.explicitOrderBy;if(i.length>a.length)throw new il(io.INVALID_ARGUMENT,`Too many arguments provided to ${n}(). The number of arguments must be less than or equal to the number of orderBy() clauses`);let o=[];for(let s=0;s<i.length;s++){let l=i[s];if(a[s].field.isKeyField()){if("string"!=typeof l)throw new il(io.INVALID_ARGUMENT,`Invalid query. Expected a string for document ID in ${n}(), but got a ${typeof l}`);if(!oE(e)&&-1!==l.indexOf("/"))throw new il(io.INVALID_ARGUMENT,`Invalid query. When querying a collection and ordering by documentId(), the value passed to ${n}() must be a plain document ID, but '${l}' contains a slash.`);let r=e.path.child(iC.fromString(l));if(!ix.isDocumentKey(r))throw new il(io.INVALID_ARGUMENT,`Invalid query. When querying a collection group and ordering by documentId(), the value passed to ${n}() must result in a valid document path, but '${r}' is not because it contains an odd number of segments.`);let i=new ix(r);o.push(aj(t,i))}else{let e=f_(r,n,l);o.push(e)}}return new a2(o,s)}(e._query,e.firestore._databaseId,i,t,r,n)}}function f5(e,t,r){if("string"==typeof(r=ei(r))){if(""===r)throw new il(io.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid document ID, but it was an empty string.");if(!oE(t)&&-1!==r.indexOf("/"))throw new il(io.INVALID_ARGUMENT,`Invalid query. When querying a collection by documentId(), you must provide a plain document ID, but '${r}' contains a '/' character.`);let n=t.path.child(iC.fromString(r));if(!ix.isDocumentKey(n))throw new il(io.INVALID_ARGUMENT,`Invalid query. When querying a collection group by documentId(), the value provided must result in a valid document path, but '${n}' is not because it has an odd number of segments (${n.length}).`);return aj(e,new ix(n))}if(r instanceof d1)return aj(e,r._key);throw new il(io.INVALID_ARGUMENT,`Invalid query. When querying with documentId(), you must provide a valid string or a DocumentReference, but it was: ${iO(r)}.`)}function f8(e,t){if(!Array.isArray(e)||0===e.length)throw new il(io.INVALID_ARGUMENT,`Invalid Query. A non-empty array is required for '${t.toString()}' filters.`)}function f7(e,t){let r=function(e,t){for(let r of e)for(let e of r.getFlattenedFilters())if(t.indexOf(e.op)>=0)return e.op;return null}(e.filters,function(e){switch(e){case"!=":return["!=","not-in"];case"array-contains-any":case"in":return["not-in"];case"not-in":return["array-contains-any","in","not-in","!="];default:return[]}}(t.op));if(null!==r)throw r===t.op?new il(io.INVALID_ARGUMENT,`Invalid query. You cannot use more than one '${t.op.toString()}' filter.`):new il(io.INVALID_ARGUMENT,`Invalid query. You cannot use '${t.op.toString()}' filters with '${r.toString()}' filters.`)}function f9(e,t){if(!(t instanceof fz||t instanceof fK))throw new il(io.INVALID_ARGUMENT,`Function ${e}() requires AppliableConstraints created with a call to 'where(...)', 'or(...)', or 'and(...)'.`)}function pe(e,t,r){return e?r&&(r.merge||r.mergeFields)?e.toFirestore(t,r):e.toFirestore(t):t}class pt extends fN{constructor(e){super(),this.firestore=e}convertBytes(e){return new fi(e)}convertReference(e){let t=this.convertDocumentKey(e,this.firestore._databaseId);return new d1(this.firestore,null,t)}}function pr(e){return new fL("sum",fS("sum",e))}function pn(e){return new fL("avg",fS("average",e))}function pi(){return new fL("count")}function ps(e,t){return e instanceof fL&&t instanceof fL&&e.aggregateType===t.aggregateType&&e._internalFieldPath?.canonicalString()===t._internalFieldPath?.canonicalString()}function pa(e,t){return d4(e.query,t.query)&&Y(e.data(),t.data())}function po(e){return pl(e,{count:pi()})}function pl(e,t){var r;let n,i=iL(e.firestore,fe),s=fr(i),a=function(e,t){let r=[];for(let n in e)Object.prototype.hasOwnProperty.call(e,n)&&r.push(t(e[n],n,e));return r}(t,(e,t)=>new lc(t,e.aggregateType,e._internalFieldPath));return(r=e._query,n=new iu,s.asyncQueue.enqueueAndForget(async()=>{try{let e=await dK(s);n.resolve(async function(e,t,r){let{request:n,gt:i,parent:s}=function(e,t,r,n){let{ft:i,parent:s}=lZ(e,t),a={},o=[],l=0;return r.forEach(e=>{let t="aggregate_"+l++;a[t]=e.alias,"count"===e.aggregateType?o.push({alias:t,count:{}}):"avg"===e.aggregateType?o.push({alias:t,avg:{field:l1(e.fieldPath)}}):"sum"===e.aggregateType&&o.push({alias:t,sum:{field:l1(e.fieldPath)}})}),{request:{structuredAggregationQuery:{aggregations:o,structuredQuery:i.structuredQuery},parent:i.parent},gt:a,parent:s}}(e.serializer,(t.Re||(t.Re=oC(t,t.explicitOrderBy)),t.Re),r);e.connection.Ko||delete n.parent;let a=(await e.jo("RunAggregationQuery",e.serializer.databaseId,s,n,1)).filter(e=>!!e.result);ia(1===a.length,64727);let o=a[0].result?.aggregateFields;return Object.keys(o).reduce((e,t)=>(e[i[t]]=o[t],e),{})}(e,r,a))}catch(e){n.reject(e)}}),n.promise).then(t=>new fM(e,new fD(i),t))}class pu{constructor(e){this.kind="memory",this._onlineComponentProvider=dN.provider,this._offlineComponentProvider=e?.garbageCollector?e.garbageCollector._offlineComponentProvider:{build:()=>new dA(void 0)}}toJSON(){return{kind:this.kind}}}class ph{constructor(e){let t;this.kind="persistent",e?.tabManager?(e.tabManager._initialize(e),t=e.tabManager):(t=pv(void 0))._initialize(e),this._onlineComponentProvider=t._onlineComponentProvider,this._offlineComponentProvider=t._offlineComponentProvider}toJSON(){return{kind:this.kind}}}class pc{constructor(){this.kind="memoryEager",this._offlineComponentProvider=dC.provider}toJSON(){return{kind:this.kind}}}class pd{constructor(e){this.kind="memoryLru",this._offlineComponentProvider={build:()=>new dA(e)}}toJSON(){return{kind:this.kind}}}function pf(){return new pc}function pp(e){return new pd(e?.cacheSizeBytes)}function pm(e){return new pu(e)}function pg(e){return new ph(e)}class py{constructor(e){this.forceOwnership=e,this.kind="persistentSingleTab"}toJSON(){return{kind:this.kind}}_initialize(e){this._onlineComponentProvider=dN.provider,this._offlineComponentProvider={build:t=>new dk(t,e?.cacheSizeBytes,this.forceOwnership)}}}class pw{constructor(){this.kind="PersistentMultipleTab"}toJSON(){return{kind:this.kind}}_initialize(e){this._onlineComponentProvider=dN.provider,this._offlineComponentProvider={build:t=>new dx(t,e?.cacheSizeBytes)}}}function pv(e){return new py(e?.forceOwnership)}function p_(){return new pw}let pI="NOT SUPPORTED";class pb{constructor(e,t){this.hasPendingWrites=e,this.fromCache=t}isEqual(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}}class pE extends fF{constructor(e,t,r,n,i,s){super(e,t,r,n,s),this._firestore=e,this._firestoreImpl=e,this.metadata=i}exists(){return super.exists()}data(e={}){if(this._document){if(this._converter){let t=new pS(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(t,e)}return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps)}}get(e,t={}){if(this._document){let r=this._document.data.field(fS("DocumentSnapshot.get",e));if(null!==r)return this._userDataWriter.convertValue(r,t.serverTimestamps)}}toJSON(){if(this.metadata.hasPendingWrites)throw new il(io.FAILED_PRECONDITION,"DocumentSnapshot.toJSON() attempted to serialize a document with pending writes. Await waitForPendingWrites() before invoking toJSON().");let e=this._document,t={};return t.type=pE._jsonSchemaVersion,t.bundle="",t.bundleSource="DocumentSnapshot",t.bundleName=this._key.toString(),e&&e.isValidDocument()&&e.isFoundDocument()&&(this._userDataWriter.convertObjectMap(e.data.value.mapValue.fields,"previous"),this._firestore,this.ref.path,t.bundle="NOT SUPPORTED"),t}}function pT(e,t,r){if(iV(t,pE._jsonSchema)){var n;if(t.bundle===pI)throw new il(io.INVALID_ARGUMENT,"The provided JSON object was created in a client environment, which is not supported.");let i=h4(e._databaseId),s=(n=t.bundle,new dO(n,i)),a=s.t(),o=new cW(s.getMetadata(),i);for(let e of a)o.o(e);let l=o.documents;if(1!==l.length)throw new il(io.INVALID_ARGUMENT,`Expected bundle data to contain 1 document, but it contains ${l.length} documents.`);let u=lQ(i,l[0].document),h=new ix(iC.fromString(t.bundleName));return new pE(e,new pt(e),h,u,new pb(!1,!1),r||null)}}pE._jsonSchemaVersion="firestore/documentSnapshot/1.0",pE._jsonSchema={type:iF("string",pE._jsonSchemaVersion),bundleSource:iF("string","DocumentSnapshot"),bundleName:iF("string"),bundle:iF("string")};class pS extends pE{data(e={}){return super.data(e)}}class pC{constructor(e,t,r,n){this._firestore=e,this._userDataWriter=t,this._snapshot=n,this.metadata=new pb(n.hasPendingWrites,n.fromCache),this.query=r}get docs(){let e=[];return this.forEach(t=>e.push(t)),e}get size(){return this._snapshot.docs.size}get empty(){return 0===this.size}forEach(e,t){this._snapshot.docs.forEach(r=>{e.call(t,new pS(this._firestore,this._userDataWriter,r.key,r,new pb(this._snapshot.mutatedKeys.has(r.key),this._snapshot.fromCache),this.query.converter))})}docChanges(e={}){let t=!!e.includeMetadataChanges;if(t&&this._snapshot.excludesMetadataChanges)throw new il(io.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===t||(this._cachedChanges=function(e,t){if(e._snapshot.oldDocs.isEmpty()){let t=0;return e._snapshot.docChanges.map(r=>{let n=new pS(e._firestore,e._userDataWriter,r.doc.key,r.doc,new pb(e._snapshot.mutatedKeys.has(r.doc.key),e._snapshot.fromCache),e.query.converter);return r.doc,{type:"added",doc:n,oldIndex:-1,newIndex:t++}})}{let r=e._snapshot.oldDocs;return e._snapshot.docChanges.filter(e=>t||3!==e.type).map(t=>{let n=new pS(e._firestore,e._userDataWriter,t.doc.key,t.doc,new pb(e._snapshot.mutatedKeys.has(t.doc.key),e._snapshot.fromCache),e.query.converter),i=-1,s=-1;return 0!==t.type&&(i=r.indexOf(t.doc.key),r=r.delete(t.doc.key)),1!==t.type&&(s=(r=r.add(t.doc)).indexOf(t.doc.key)),{type:function(e){switch(e){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return ii(61501,{type:e})}}(t.type),doc:n,oldIndex:i,newIndex:s}})}}(this,t),this._cachedChangesIncludeMetadataChanges=t),this._cachedChanges}toJSON(){if(this.metadata.hasPendingWrites)throw new il(io.FAILED_PRECONDITION,"QuerySnapshot.toJSON() attempted to serialize a document with pending writes. Await waitForPendingWrites() before invoking toJSON().");let e={};e.type=pC._jsonSchemaVersion,e.bundleSource="QuerySnapshot",e.bundleName=iv.newId(),this._firestore._databaseId.database,this._firestore._databaseId.projectId;let t=[],r=[],n=[];return this.docs.forEach(e=>{null!==e._document&&(t.push(e._document),r.push(this._userDataWriter.convertObjectMap(e._document.data.value.mapValue.fields,"previous")),n.push(e.ref.path))}),this._firestore,this.query._query,e.bundleName,e.bundle="NOT SUPPORTED",e}}function pA(e,t,r){if(iV(t,pC._jsonSchema)){var n;if(t.bundle===pI)throw new il(io.INVALID_ARGUMENT,"The provided JSON object was created in a client environment, which is not supported.");let i=h4(e._databaseId),s=(n=t.bundle,new dO(n,i)),a=s.t(),o=new cW(s.getMetadata(),i);for(let e of a)o.o(e);if(1!==o.queries.length)throw new il(io.INVALID_ARGUMENT,`Snapshot data expected 1 query but found ${o.queries.length} queries.`);let l=ui(o.queries[0].bundledQuery),u=o.documents,h=new cO;u.map(e=>{let t=lQ(i,e.document);h=h.add(t)});let c=cM.fromInitialDocuments(l,h,oz(),!1,!1),d=new d0(e,r||null,l);return new pC(e,new pt(e),d,c)}}function pk(e,t){return e instanceof pE&&t instanceof pE?e._firestore===t._firestore&&e._key.isEqual(t._key)&&(null===e._document?null===t._document:e._document.isEqual(t._document))&&e._converter===t._converter:e instanceof pC&&t instanceof pC&&e._firestore===t._firestore&&d4(e.query,t.query)&&e.metadata.isEqual(t.metadata)&&e._snapshot.isEqual(t._snapshot)}pC._jsonSchemaVersion="firestore/querySnapshot/1.0",pC._jsonSchema={type:iF("string",pC._jsonSchemaVersion),bundleSource:iF("string","QuerySnapshot"),bundleName:iF("string"),bundle:iF("string")};let px={maxAttempts:5};class pN{constructor(e,t){this._firestore=e,this._commitHandler=t,this._mutations=[],this._committed=!1,this._dataReader=fm(e)}set(e,t,r){this._verifyNotCommitted();let n=pD(e,this._firestore),i=pe(n.converter,t,r),s=fg(this._dataReader,"WriteBatch.set",n._key,i,null!==n.converter,r);return this._mutations.push(s.toMutation(n._key,o4.none())),this}update(e,t,r,...n){let i;this._verifyNotCommitted();let s=pD(e,this._firestore);return i="string"==typeof(t=ei(t))||t instanceof fs?fv(this._dataReader,"WriteBatch.update",s._key,t,r,n):fw(this._dataReader,"WriteBatch.update",s._key,t),this._mutations.push(i.toMutation(s._key,o4.exists(!0))),this}delete(e){this._verifyNotCommitted();let t=pD(e,this._firestore);return this._mutations=this._mutations.concat(new la(t._key,o4.none())),this}commit(){return this._verifyNotCommitted(),this._committed=!0,this._mutations.length>0?this._commitHandler(this._mutations):Promise.resolve()}_verifyNotCommitted(){if(this._committed)throw new il(io.FAILED_PRECONDITION,"A write batch can no longer be used after commit() has been called.")}}function pD(e,t){if((e=ei(e)).firestore!==t)throw new il(io.INVALID_ARGUMENT,"Provided document reference is from a different Firestore instance.");return e}class pR{constructor(e,t){this._firestore=e,this._transaction=t,this._dataReader=fm(e)}get(e){let t=pD(e,this._firestore),r=new pt(this._firestore);return this._transaction.lookup([t._key]).then(e=>{if(!e||1!==e.length)return ii(24041);let n=e[0];if(n.isFoundDocument())return new fF(this._firestore,r,n.key,n,t.converter);if(n.isNoDocument())return new fF(this._firestore,r,t._key,null,t.converter);throw ii(18433,{doc:n})})}set(e,t,r){let n=pD(e,this._firestore),i=pe(n.converter,t,r),s=fg(this._dataReader,"Transaction.set",n._key,i,null!==n.converter,r);return this._transaction.set(n._key,s),this}update(e,t,r,...n){let i,s=pD(e,this._firestore);return i="string"==typeof(t=ei(t))||t instanceof fs?fv(this._dataReader,"Transaction.update",s._key,t,r,n):fw(this._dataReader,"Transaction.update",s._key,t),this._transaction.update(s._key,i),this}delete(e){let t=pD(e,this._firestore);return this._transaction.delete(t._key),this}}class pP extends pR{constructor(e,t){super(e,t),this._firestore=e}get(e){let t=pD(e,this._firestore),r=new fD(this._firestore);return super.get(e).then(e=>new pE(this._firestore,r,t._key,e._document,new pb(!1,!1),t.converter))}}function pO(e,t,r){var n,i;let s;e=iL(e,fe);let a={...px,...r};if(a.maxAttempts<1)throw new il(io.INVALID_ARGUMENT,"Max attempts must be at least 1");return n=fr(e),i=r=>t(new pP(e,r)),s=new iu,n.asyncQueue.enqueueAndForget(async()=>{let e=await dK(n);new dM(n.asyncQueue,e,a,i,s).ju()}),s.promise}function pL(e){e=iL(e,d1);let t=iL(e.firestore,fe);return dH(fr(t),e._key).then(r=>pQ(t,e,r))}function pM(e){var t;let r;e=iL(e,d1);let n=iL(e.firestore,fe),i=fr(n),s=new fD(n);return(t=e._key,r=new iu,i.asyncQueue.enqueueAndForget(async()=>(async function(e,t,r){try{let n=await e.persistence.runTransaction("read document","readonly",r=>e.localDocuments.getDocument(r,t));n.isFoundDocument()?r.resolve(n):n.isNoDocument()?r.resolve(null):r.reject(new il(io.UNAVAILABLE,"Failed to get document from cache. (However, this document may exist on the server. Run again without setting 'source' in the GetOptions to attempt to retrieve the document from the server.)"))}catch(n){let e=cP(n,`Failed to get document '${t} from cache`);r.reject(e)}})(await dz(i),t,r)),r.promise).then(t=>new pE(n,s,e._key,t,new pb(null!==t&&t.hasLocalMutations,!0),e.converter))}function pF(e){e=iL(e,d1);let t=iL(e.firestore,fe);return dH(fr(t),e._key,{source:"server"}).then(r=>pQ(t,e,r))}function pV(e){e=iL(e,d0);let t=iL(e.firestore,fe),r=fr(t),n=new fD(t);return fU(e._query),dW(r,e._query).then(r=>new pC(t,n,e,r))}function pU(e){var t;let r;e=iL(e,d0);let n=iL(e.firestore,fe),i=fr(n),s=new fD(n);return(t=e._query,r=new iu,i.asyncQueue.enqueueAndForget(async()=>(async function(e,t,r){try{let n=await hS(e,t,!0),i=new cX(t,n.ks),s=i.ru(n.documents),a=i.applyChanges(s,!1);r.resolve(a.snapshot)}catch(n){let e=cP(n,`Failed to execute query '${t} against cache`);r.reject(e)}})(await dz(i),t,r)),r.promise).then(t=>new pC(n,s,e,t))}function pB(e){e=iL(e,d0);let t=iL(e.firestore,fe),r=fr(t),n=new fD(t);return dW(r,e._query,{source:"server"}).then(r=>new pC(t,n,e,r))}function pq(e,t,r){e=iL(e,d1);let n=iL(e.firestore,fe),i=pe(e.converter,t,r),s=fm(n);return pW(n,[fg(s,"setDoc",e._key,i,null!==e.converter,r).toMutation(e._key,o4.none())])}function pj(e,t,r,...n){e=iL(e,d1);let i=iL(e.firestore,fe),s=fm(i);return pW(i,[("string"==typeof(t=ei(t))||t instanceof fs?fv(s,"updateDoc",e._key,t,r,n):fw(s,"updateDoc",e._key,t)).toMutation(e._key,o4.exists(!0))])}function pz(e){return pW(iL(e.firestore,fe),[new la(e._key,o4.none())])}function p$(e,t){let r=iL(e.firestore,fe),n=d3(e),i=pe(e.converter,t);return pW(r,[fg(fm(e.firestore),"addDoc",n._key,i,null!==e.converter,{}).toMutation(n._key,o4.exists(!1))]).then(()=>n)}function pK(e,...t){var r;let n,i,s,a,o;e=ei(e);let l={includeMetadataChanges:!1,source:"default"},u=0;"object"!=typeof t[0]||fO(t[u])||(l=t[u++]);let h={includeMetadataChanges:l.includeMetadataChanges,source:l.source};if(fO(t[u])){let e=t[u];t[u]=e.next?.bind(e),t[u+1]=e.error?.bind(e),t[u+2]=e.complete?.bind(e)}if(e instanceof d1)i=iL(e.firestore,fe),s=oI(e._key.path),n={next:r=>{t[u]&&t[u](pQ(i,e,r))},error:t[u+1],complete:t[u+2]};else{let r=iL(e,d0);i=iL(r.firestore,fe),s=r._query;let a=new fD(i);n={next:e=>{t[u]&&t[u](new pC(i,a,r,e))},error:t[u+1],complete:t[u+2]},fU(e._query)}return r=fr(i),o=new cK(s,a=new dR(n),h),r.asyncQueue.enqueueAndForget(async()=>cB(await dG(r),o)),()=>{a.Nu(),r.asyncQueue.enqueueAndForget(async()=>cq(await dG(r),o))}}function pG(e,t,...r){var n,i,s,a,o,l;let u=ei(e),h=function(e){let t={bundle:"",bundleName:"",bundleSource:""};for(let r of["bundle","bundleName","bundleSource"]){if(!(r in e)){t.error=`snapshotJson missing required field: ${r}`;break}let n=e[r];if("string"!=typeof n){t.error=`snapshotJson field '${r}' must be a string.`;break}if(0===n.length){t.error=`snapshotJson field '${r}' cannot be an empty string.`;break}"bundle"===r?t.bundle=n:"bundleName"===r?t.bundleName=n:"bundleSource"===r&&(t.bundleSource=n)}return t}(t);if(h.error)throw new il(io.INVALID_ARGUMENT,h.error);let c,d=0;if("object"!=typeof r[0]||fO(r[d])||(c=r[d++]),"QuerySnapshot"===h.bundleSource){let e,t,a=null;if("object"==typeof r[d]&&fO(r[d])){let e=r[d++];a={next:e.next,error:e.error,complete:e.complete}}else a={next:r[d++],error:r[d++],complete:r[d++]};return n=c,i=a,s=r[d],t=!1,fn(u,h.bundle).then(()=>{var e,t,r;return e=u,t=h.bundleName,(r=fr(e=iL(e,fe)),r.asyncQueue.enqueue(async()=>{var e;return e=await dz(r),e.persistence.runTransaction("Get named query","readonly",r=>e.Pi.getNamedQuery(r,t))})).then(t=>t?new d0(e,null,t.query):null)}).then(r=>{r&&!t&&(s&&r.withConverter(s),e=pK(r,n||{},i))}).catch(e=>(i.error&&i.error(e),()=>{})),()=>{t||(t=!0,e&&e())}}if("DocumentSnapshot"===h.bundleSource){let e,t,n=null;if("object"==typeof r[d]&&fO(r[d])){let e=r[d++];n={next:e.next,error:e.error,complete:e.complete}}else n={next:r[d++],error:r[d++],complete:r[d++]};return a=c,o=n,l=r[d],t=!1,fn(u,h.bundle).then(()=>{t||(e=pK(new d1(u,l||null,ix.fromPath(h.bundleName)),a||{},o))}).catch(e=>(o.error&&o.error(e),()=>{})),()=>{t||(t=!0,e&&e())}}throw new il(io.INVALID_ARGUMENT,`unsupported bundle source: ${h.bundleSource}`)}function pH(e,t){let r,n=fr(e=iL(e,fe));return r=new dR(fO(t)?t:{next:t}),n.asyncQueue.enqueueAndForget(async()=>{var e;return e=await dG(n),void(e.Ca.add(r),r.next())}),()=>{r.Nu(),n.asyncQueue.enqueueAndForget(async()=>{var e;return e=await dG(n),void e.Ca.delete(r)})}}function pW(e,t){var r;let n;return r=fr(e),n=new iu,r.asyncQueue.enqueueAndForget(async()=>c9(await d$(r),t,n)),n.promise}function pQ(e,t,r){let n=r.docs.get(t._key),i=new fD(e);return new pE(e,i,t._key,n,new pb(r.hasPendingWrites,r.fromCache),t.converter)}function pJ(e){return fr(e=iL(e,fe)),new pN(e,t=>pW(e,t))}function pY(e,t){let r=fr(e=iL(e,fe));if(!r._uninitializedComponentsProvider||"memory"===r._uninitializedComponentsProvider._offline.kind)return it("Cannot enable indexes when persistence is disabled"),Promise.resolve();let n=function(e){let t="string"==typeof e?function(e){try{return JSON.parse(e)}catch(e){throw new il(io.INVALID_ARGUMENT,"Failed to parse JSON: "+e?.message)}}(e):e,r=[];if(Array.isArray(t.indexes))for(let e of t.indexes){let t=pX(e,"collectionGroup"),n=[];if(Array.isArray(e.fields))for(let t of e.fields){let e=fA("setIndexConfiguration",pX(t,"fieldPath"));"CONTAINS"===t.arrayConfig?n.push(new iK(e,2)):"ASCENDING"===t.order?n.push(new iK(e,0)):"DESCENDING"===t.order&&n.push(new iK(e,1))}r.push(new iq(iq.UNKNOWN_ID,t,n,iG.empty()))}return r}(t);return r.asyncQueue.enqueue(async()=>(async function(e,t){let r=e.indexManager,n=[];return e.persistence.runTransaction("Configure indexes","readwrite",e=>r.getFieldIndexes(e).next(i=>(function(e,t,r,n,i){t=[...t],(e=[...e]).sort(r),t.sort(r);let s=e.length,a=t.length,o=0,l=0;for(;o<a&&l<s;){let s=r(e[l],t[o]);s<0?i(e[l++]):s>0?n(t[o++]):(o++,l++)}for(;o<a;)n(t[o++]);for(;l<s;)i(e[l++])})(i,t,i$,t=>{n.push(r.addFieldIndex(e,t))},t=>{n.push(r.deleteFieldIndex(e,t))})).next(()=>i0.waitFor(n)))})(await dz(r),n))}function pX(e,t){if("string"!=typeof e[t])throw new il(io.INVALID_ARGUMENT,"Missing string value for: "+t);return e[t]}class pZ{constructor(e){this._firestore=e,this.type="PersistentCacheIndexManager"}}function p0(e){e=iL(e,fe);let t=p4.get(e);if(t)return t;let r=fr(e);if("persistent"!==r._uninitializedComponentsProvider?._offline.kind)return null;let n=new pZ(e);return p4.set(e,n),n}function p1(e){p3(e,!0)}function p2(e){p3(e,!1)}function p6(e){var t;(t=fr(e._firestore)).asyncQueue.enqueue(async()=>{var e;let r;return r=(e=await dz(t)).indexManager,e.persistence.runTransaction("Delete All Indexes","readwrite",e=>r.deleteAllFieldIndexes(e))}).then(e=>n9("deleting all persistent cache indexes succeeded")).catch(e=>it("deleting all persistent cache indexes failed",e))}function p3(e,t){var r;(r=fr(e._firestore),r.asyncQueue.enqueue(async()=>{var e;return e=await dz(r),void(e.Cs.As=t)})).then(e=>n9(`setting persistent cache index auto creation isEnabled=${t} succeeded`)).catch(e=>it(`setting persistent cache index auto creation isEnabled=${t} failed`,e))}let p4=new WeakMap;class p5{constructor(){throw Error("instances of this class should not be created")}static onExistenceFilterMismatch(e){return p8.instance.onExistenceFilterMismatch(e)}}class p8{constructor(){this.i=new Map}static get instance(){return p7||function(e){if(lm)throw Error("a TestingHooksSpi instance is already set");lm=e}(p7=new p8),p7}u(e){this.i.forEach(t=>t(e))}onExistenceFilterMismatch(e){let t=Symbol(),r=this.i;return r.set(t,e),()=>r.delete(t)}}let p7=null;!function(e=!0){n5=eQ,eV(new es("firestore",(t,{instanceIdentifier:r,options:n})=>{let i=t.getProvider("app").getImmediate(),s=new fe(new ip(t.getProvider("auth-internal")),new iw(i,t.getProvider("app-check-internal")),function(e,t){if(!Object.prototype.hasOwnProperty.apply(e.options,["projectId"]))throw new il(io.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new ak(e.options.projectId,t)}(i,r),i);return n={useFetchStreams:e,...n},s._setSettings(n),s},"PUBLIC").setMultipleInstances(!0)),e1(fR,fP,void 0),e1(fR,fP,"esm2020")}(),e.s(["AggregateField",()=>fL,"AggregateQuerySnapshot",()=>fM,"DocumentSnapshot",()=>pE,"PersistentCacheIndexManager",()=>pZ,"QueryCompositeFilterConstraint",()=>fK,"QueryConstraint",()=>fq,"QueryDocumentSnapshot",()=>pS,"QueryEndAtConstraint",()=>f2,"QueryFieldFilterConstraint",()=>fz,"QueryLimitConstraint",()=>fJ,"QueryOrderByConstraint",()=>fW,"QuerySnapshot",()=>pC,"QueryStartAtConstraint",()=>fZ,"SnapshotMetadata",()=>pb,"Transaction",()=>pP,"WriteBatch",()=>pN,"_TestingHooks",()=>p5,"addDoc",()=>p$,"aggregateFieldEqual",()=>ps,"aggregateQuerySnapshotEqual",()=>pa,"and",()=>fH,"average",()=>pn,"count",()=>pi,"deleteAllPersistentCacheIndexes",()=>p6,"deleteDoc",()=>pz,"disablePersistentCacheIndexAutoCreation",()=>p2,"documentSnapshotFromJSON",()=>pT,"enablePersistentCacheIndexAutoCreation",()=>p1,"endAt",()=>f3,"endBefore",()=>f6,"executeWrite",()=>pW,"getAggregateFromServer",()=>pl,"getCountFromServer",()=>po,"getDoc",()=>pL,"getDocFromCache",()=>pM,"getDocFromServer",()=>pF,"getDocs",()=>pV,"getDocsFromCache",()=>pU,"getDocsFromServer",()=>pB,"getPersistentCacheIndexManager",()=>p0,"limit",()=>fY,"limitToLast",()=>fX,"memoryEagerGarbageCollector",()=>pf,"memoryLocalCache",()=>pm,"memoryLruGarbageCollector",()=>pp,"onSnapshot",()=>pK,"onSnapshotResume",()=>pG,"onSnapshotsInSync",()=>pH,"or",()=>fG,"orderBy",()=>fQ,"persistentLocalCache",()=>pg,"persistentMultipleTabManager",()=>p_,"persistentSingleTabManager",()=>pv,"query",()=>fj,"querySnapshotFromJSON",()=>pA,"runTransaction",()=>pO,"setDoc",()=>pq,"setIndexConfiguration",()=>pY,"snapshotEqual",()=>pk,"startAfter",()=>f1,"startAt",()=>f0,"sum",()=>pr,"updateDoc",()=>pj,"where",()=>f$,"writeBatch",()=>pJ],63802),e.s([],36180),e.i(63802),e.s(["Timestamp",()=>iU,"addDoc",()=>p$,"collection",()=>d6,"deleteDoc",()=>pz,"doc",()=>d3,"getDocs",()=>pV,"getFirestore",()=>ft,"orderBy",()=>fQ,"query",()=>fj,"where",()=>f$],98925);let p9=0===eZ().length?eJ({apiKey:"AIzaSyAgn82DCDTJit68gKjyy7tHj8GcErI4tJA",authDomain:"jagadoku-c7d1d.firebaseapp.com",projectId:"jagadoku-c7d1d",storageBucket:"jagadoku-c7d1d.firebasestorage.app",messagingSenderId:"1034602599554",appId:"1:1034602599554:web:b81eee1501765b793c909b"}):eX(),me=ft(p9),mt=function(e=eX()){let t=eU(e,"auth");if(t.isInitialized())return t.getImmediate();let r=function(e,t){let r=eU(e,"auth");if(r.isInitialized()){let e=r.getImmediate();if(Y(r.getOptions(),t??{}))return e;tl(e,"already-initialized")}return r.initialize({options:t})}(e,{popupRedirectResolver:nW,persistence:[nc,r3,r4]}),n=L("authTokenSyncURL");if(n&&"boolean"==typeof isSecureContext&&isSecureContext){let e=new URL(n,location.origin);if(location.origin===e.origin){let t,n=(t=e.toString(),async e=>{let r=e&&await e.getIdTokenResult(),n=r&&(new Date().getTime()-Date.parse(r.issuedAtTime))/1e3;if(n&&n>nX)return;let i=r?.token;nZ!==i&&(nZ=i,await fetch(t,{method:i?"POST":"DELETE",headers:i?{Authorization:`Bearer ${i}`}:{}}))});ei(r).beforeAuthStateChanged(n,()=>n(r.currentUser)),ei(r).onIdTokenChanged(e=>n(e),void 0,void 0)}}let i=P("auth");return i&&function(e,t,r){let n=ei(e);tf(/^https?:\/\//.test(t),n,"invalid-emulator-scheme");let i=ry(t),{host:s,port:a}=function(e){let t=ry(e),r=/(\/\/)?([^?#/]+)/.exec(e.substr(t.length));if(!r)return{host:"",port:null};let n=r[2].split("@").pop()||"",i=/^(\[[^\]]+\])(:|$)/.exec(n);if(i){let e=i[1];return{host:e,port:rw(n.substr(e.length+1))}}{let[e,t]=n.split(":");return{host:e,port:rw(t)}}}(t),o=null===a?"":`:${a}`,l={url:`${i}//${s}${o}/`},u=Object.freeze({host:s,port:a,protocol:i.replace(":",""),options:Object.freeze({disableWarnings:!1})});if(!n._canInitEmulator){tf(n.config.emulator&&n.emulatorConfig,n,"emulator-config-failed"),tf(Y(l,n.config.emulator)&&Y(u,n.emulatorConfig),n,"emulator-config-failed");return}n.config.emulator=l,n.emulatorConfig=u,n.settings.appVerificationDisabledForTesting=!0,F(s)?(V(`${i}//${s}${o}`),q("Auth",!0)):function(){function e(){let e=document.createElement("p"),t=e.style;e.innerText="Running in emulator mode. Do not use with production credentials.",t.position="fixed",t.width="100%",t.backgroundColor="#ffffff",t.border=".1em solid #000000",t.color="#b50000",t.bottom="0px",t.left="0px",t.margin="0px",t.zIndex="10000",t.textAlign="center",e.classList.add("firebase-emulator-warning"),document.body.appendChild(e)}"u">typeof console&&"function"==typeof console.info&&console.info("WARNING: You are using the Auth Emulator, which is intended for local testing only.  Do not use with production credentials."),"u">typeof window&&"u">typeof document&&("loading"===document.readyState?window.addEventListener("DOMContentLoaded",e):e())}()}(r,`http://${i}`),r}(p9);e.s(["auth",()=>mt,"db",()=>me],59141);let mr=(0,b.createContext)(void 0);function mn({children:e}){let[t,r]=(0,b.useState)(null),[n,i]=(0,b.useState)(!0);(0,b.useEffect)(()=>{var e;let t=(e=e=>{r(e),i(!1)},ei(mt).onAuthStateChanged(e,void 0,void 0));return()=>t()},[]);let s=async(e,t)=>{await (ez(mt.app)?Promise.reject(tc(mt)):rQ(ei(mt),rO.credential(e,t)).catch(async e=>{throw"auth/password-does-not-meet-requirements"===e.code&&rZ(mt),e}))},a=async(e,t)=>{await r0(mt,e,t)},o=async()=>{await ei(mt).signOut()};return(0,I.jsx)(mr.Provider,{value:{user:t,loading:n,login:s,register:a,logout:o},children:e})}e.s(["AuthProvider",()=>mn,"useAuth",0,()=>{let e=(0,b.useContext)(mr);if(!e)throw Error("useAuth must be used within AuthProvider");return e}],32341)}]);